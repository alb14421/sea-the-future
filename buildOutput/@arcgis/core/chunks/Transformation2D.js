/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{m as t,P as s,b as o,a as i,c as e,M as h,d as r,e as a,f as l}from"./Point2D.js";class y{constructor(t,s,o){if(t instanceof y)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=s,this.M=o}assignCopy(t){return this===t||(o(this.N*this.M===t.N*t.M),this.data.set(t.data),this.N=t.N,this.M=t.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let t=0;t<this.N;t++)for(let s=0;s<this.M;s++)this.setRowCol(t,s,t===s?1:0);return this}rows(){return this.N}cols(){return this.M}row(t){return o(0),{}}set(t,s){return this.data[t]=s,this}setRowCol(t,s,o){return this.data[t*this.M+s]=o,this}at(t){return this.data[t]}atRowCol(t,s){return this.data[t*this.M+s]}mulScalar(t,s){o(0)}mul(t,s){if(o(this.M===t.rows()),o(this.N===s.rows()),o(t.cols()===s.cols()),s===this){const o=new Float64Array(this.N*this.M),i=new y(o,this.N,this.M);return this.mul(t,i),void s.assignCopy(i)}if(s===t){const o=new Float64Array(t.N*t.M),i=new y(o,t.N,t.M);return this.mul(t,i),void s.assignCopy(i)}const i=t.cols();for(let o=0;o<this.N;o++)for(let e=0;e<i;e++){let i=0;for(let s=0;s<this.M;s++)i+=this.atRowCol(o,s)*t.atRowCol(s,e);s.setRowCol(o,e,i)}}mulTranspose(t,s){if(o(this.M===t.cols()),o(this.N===s.rows()),o(t.rows()===s.cols()),s===this){const o=new Float64Array(this.N*this.M),i=new y(o,this.N,this.M);return this.mulTranspose(t,i),void s.assignCopy(i)}if(s===t){const o=new Float64Array(t.N*t.M),i=new y(o,t.N,t.M);return this.mulTranspose(t,i),void s.assignCopy(i)}const i=t.rows();for(let o=0;o<this.N;o++)for(let e=0;e<i;e++){let i=0;for(let s=0;s<this.M;s++)i+=this.atRowCol(o,s)*t.atRowCol(e,s);s.setRowCol(o,e,i)}}mulLeft(t,s){o(0)}mulLeftTranspose(t,s){o(0)}mulDiag(t,s){if(o(this.M===t.N*t.M),o(this.N===s.rows()),o(this.M===s.cols()),s===this){const o=new Float64Array(this.N*this.M),i=new y(o,this.N,this.M);return this.mulDiag(t,i),void s.assignCopy(i)}const i=this.M;for(let o=0;o<this.N;o++)for(let e=0;e<i;e++)s.setRowCol(o,e,this.atRowCol(o,e)*t.at(e))}transposeInPlace(){if(this.N===this.M){for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++){const o=this.atRowCol(t,s);this.setRowCol(t,s,this.atRowCol(s,t)),this.setRowCol(s,t,o)}return this}const t=new Float64Array(this.N*this.M),s=new y(t,this.N,this.M);return s.assignCopy(this),this.M=l(this.N,this.N=this.M),s.transpose(this),this}transpose(t){if(this!==t){y.checkDims(t,this.M,this.N);for(let s=0;s<this.N;s++)for(let o=0;o<this.M;o++)t.setRowCol(o,s,this.atRowCol(s,o))}else t.transposeInPlace()}add(t,s){}svd(t,s,i,e=!1){if(y.checkDims(t,this.N,this.M),y.checkDims(s,this.M,1),y.checkDims(i,this.M,this.M),e){if(o(this.N===this.M),!this.symmetricEigen(s,i))return!1;for(let t=0;t<this.M;++t)s.at(t)<0&&s.set(t,0);return t.assignCopy(i),!0}let h,r,a,l,n,x,w,u=0,C=0,f=0,R=0,d=0;const c=this.M,M=this.N;t.assignCopy(this);const m=new Float64Array(c),N=new y(m,c,1),b=(t,s)=>s>=0?Math.abs(t):-Math.abs(t),p=(t,s)=>{if((t=Math.abs(t))>(s=Math.abs(s))){const o=s/t;return t*Math.sqrt(o*o+1)}if(s>0){const o=t/s;return s*Math.sqrt(o*o+1)}return 0};for(let o=0;o<c;o++){if(u=o+1,N.set(o,R*f),f=l=R=0,o<M){for(let s=o;s<M;s++)R+=Math.abs(t.atRowCol(s,o));if(R){for(let s=o;s<M;s++)t.setRowCol(s,o,t.atRowCol(s,o)/R),l+=t.atRowCol(s,o)*t.atRowCol(s,o);r=t.atRowCol(o,o),f=-b(Math.sqrt(l),r),a=r*f-l,t.setRowCol(o,o,r-f);for(let s=u;s<c;s++){l=0;for(let i=o;i<M;i++)l+=t.atRowCol(i,o)*t.atRowCol(i,s);r=l/a;for(let i=o;i<M;i++)t.setRowCol(i,s,t.atRowCol(i,s)+r*t.atRowCol(i,o))}for(let s=o;s<M;s++)t.setRowCol(s,o,t.atRowCol(s,o)*R)}}if(s.set(o,R*f),f=l=R=0,o<M&&o!==c-1){for(let s=u;s<c;s++)R+=Math.abs(t.atRowCol(o,s));if(R){for(let s=u;s<c;s++)t.setRowCol(o,s,t.atRowCol(o,s)/R),l+=t.atRowCol(o,s)*t.atRowCol(o,s);r=t.atRowCol(o,u),f=-b(Math.sqrt(l),r),a=r*f-l,t.setRowCol(o,u,r-f);for(let s=u;s<c;s++)N.set(s,t.atRowCol(o,s)/a);for(let s=u;s<M;s++){l=0;for(let i=u;i<c;i++)l+=t.atRowCol(s,i)*t.atRowCol(o,i);for(let o=u;o<c;o++)t.setRowCol(s,o,t.atRowCol(s,o)+l*N.at(o))}for(let s=u;s<c;s++)t.setRowCol(o,s,t.atRowCol(o,s)*R)}}const i=Math.abs(s.at(o))+Math.abs(N.at(o));d=i>d?i:d}for(let s=c-1;s>=0;s--){if(s<c-1){if(f){for(let o=u;o<c;o++)i.setRowCol(o,s,t.atRowCol(s,o)/t.atRowCol(s,u)/f);for(let o=u;o<c;o++){l=0;for(let e=u;e<c;e++)l+=t.atRowCol(s,e)*i.atRowCol(e,o);for(let t=u;t<c;t++)i.setRowCol(t,o,i.atRowCol(t,o)+l*i.atRowCol(t,s))}}for(let t=u;t<c;t++)i.setRowCol(s,t,0),i.setRowCol(t,s,0)}i.setRowCol(s,s,1),f=N.at(s),u=s}for(let o=(M<c?M:c)-1;o>=0;o--){u=o+1,f=s.at(o);for(let s=u;s<c;s++)t.setRowCol(o,s,0);if(f){f=1/f;for(let s=u;s<c;s++){l=0;for(let i=u;i<M;i++)l+=t.atRowCol(i,o)*t.atRowCol(i,s);r=l/t.atRowCol(o,o)*f;for(let i=o;i<M;i++)t.setRowCol(i,s,t.atRowCol(i,s)+r*t.atRowCol(i,o))}for(let s=o;s<M;s++)t.setRowCol(s,o,t.atRowCol(s,o)*f)}else for(let s=o;s<M;s++)t.setRowCol(s,o,0);t.setRowCol(o,o,t.atRowCol(o,o)+1)}for(let o=c-1;o>=0;o--)for(let e=1;;e++){let y=1;for(u=o;u>=0;u--){if(C=u-1,Math.abs(N.at(u))+d===d){y=0;break}if(Math.abs(s.at(C))+d===d)break}if(y){h=0,l=1;for(let i=u;i<=o&&(r=l*N.at(i),N.set(i,N.at(i)*h),Math.abs(r)+d!==d);i++){f=s.at(i),a=p(r,f),s.set(i,a),a=1/a,h=f*a,l=-r*a;for(let s=0;s<M;s++)x=t.atRowCol(s,C),w=t.atRowCol(s,i),t.setRowCol(s,C,x*h+w*l),t.setRowCol(s,i,w*h-x*l)}}if(w=s.at(o),u===o){if(w<0){s.set(o,-w);for(let t=0;t<c;t++)i.setRowCol(t,o,-i.atRowCol(t,o))}break}if(100===e)return!1;n=s.at(u),C=o-1,x=s.at(C),f=N.at(C),a=N.at(o),r=((x-w)*(x+w)+(f-a)*(f+a))/(2*a*x),f=p(r,1),r=((n-w)*(n+w)+a*(x/(r+b(f,r))-a))/n,h=l=1;for(let o=u;o<=C;o++){const e=o+1;f=N.at(e),x=s.at(e),a=l*f,f*=h,w=p(r,a),N.set(o,w),h=r/w,l=a/w,r=n*h+f*l,f=f*h-n*l,a=x*l,x*=h;for(let t=0;t<c;t++)n=i.atRowCol(t,o),w=i.atRowCol(t,e),i.setRowCol(t,o,n*h+w*l),i.setRowCol(t,e,w*h-n*l);w=p(r,a),s.set(o,w),w&&(w=1/w,h=r*w,l=a*w),r=h*f+l*x,n=h*x-l*f;for(let s=0;s<M;s++)x=t.atRowCol(s,o),w=t.atRowCol(s,e),t.setRowCol(s,o,x*h+w*l),t.setRowCol(s,e,w*h-x*l)}N.set(u,0),N.set(o,r),s.set(o,n)}const g=new Float64Array(this.N),v=new Float64Array(this.M),T=new y(g,this.N,1),I=new y(v,this.M,1);let A=1;do{A*=3,A++}while(A<=this.M);do{A/=3,A=Math.trunc(A);for(let o=A;o<this.M;o++){const e=s.at(o);for(let s=0;s<this.N;s++)T.set(s,t.atRowCol(s,o));for(let t=0;t<this.M;t++)I.set(t,i.atRowCol(t,o));let h=o;for(;s.at(h-A)<e;){s.set(h,s.at(h-A));for(let s=0;s<this.N;s++)t.setRowCol(s,h,t.atRowCol(s,h-A));for(let t=0;t<this.M;t++)i.setRowCol(t,h,i.atRowCol(t,h-A));if(h-=A,h<A)break}s.set(h,e);for(let s=0;s<this.N;s++)t.setRowCol(s,h,T.at(s));for(let t=0;t<this.M;t++)i.setRowCol(t,h,I.at(t))}}while(A>1);for(let s=0;s<this.M;s++){let o=0;for(let i=0;i<this.N;i++)t.atRowCol(i,s)<0&&o++;for(let t=0;t<this.M;t++)i.atRowCol(t,s)<0&&o++;if(o>Math.trunc((this.N+this.M)/2)){for(let o=0;o<this.N;o++)t.setRowCol(o,s,-t.atRowCol(o,s));for(let t=0;t<this.M;t++)i.setRowCol(t,s,-i.atRowCol(t,s))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++)if(this.atRowCol(t,s)!==this.atRowCol(s,t))return!1;return!0}isZero(){return o(0),!1}isIdentity(){return o(0),!1}equals(t,s){if(void 0!==s&&o(0),this.N!==t.N||this.M!==t.M)return!1;for(let s=0;s<this.N*this.M;s++)if(this.data[s]!==t.data[s])return!1;return!0}maxElement(){return o(0),0}minElement(){return o(0),0}determinant(){if(o(this.N===this.M),1===this.N)return this.data[0];if(2===this.N)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(3===this.N){const t=this;return t.atRowCol(0,0)*(t.atRowCol(1,1)*t.atRowCol(2,2)-t.atRowCol(1,2)*t.atRowCol(2,1))-t.atRowCol(0,1)*(t.atRowCol(1,0)*t.atRowCol(2,2)-t.atRowCol(2,0)*t.atRowCol(1,2))+t.atRowCol(0,2)*(t.atRowCol(1,0)*t.atRowCol(2,1)-t.atRowCol(1,1)*t.atRowCol(2,0))}const t=new Float64Array(this.N*this.N),s=new y(t,this.N,this.N),i=new Float64Array(this.N);if(!this.luDecomposition(s,i))return 0;let e=1;for(let t=0;t<this.N;t++)e*=s.atRowCol(t,t),i[t]!==t&&(e=-e);return e}submatrix(t,s,i){o(0)}inverse(t){o(0)}pseudoInverse(t,s=!1,o=2220446049250313e-31){if(t.setZero(),1===this.N&&1===this.M)return 0!==this.atRowCol(0,0)?t.setRowCol(0,0,1/this.atRowCol(0,0)):t.setRowCol(0,0,0),!0;if(2===this.N&&2===this.M){const s=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),o=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(s)>o)return t.setRowCol(0,0,this.atRowCol(1,1)/s),t.setRowCol(0,1,-this.atRowCol(0,1)/s),t.setRowCol(1,0,-this.atRowCol(1,0)/s),t.setRowCol(1,1,this.atRowCol(0,0)/s),!0}const i=new Float64Array(this.N*this.M),e=new y(i,this.N,this.M),h=new Float64Array(this.M),r=new y(h,this.M,1),a=new Float64Array(this.M*this.M),l=new y(a,this.M,this.M);if(!this.svd(e,r,l,s))return!1;const n=Math.max(this.N,this.M),x=o*Math.abs(r.at(0))*n;for(let t=0;t<this.M;t++)r.at(t)>x?r.set(t,1/r.at(t)):r.set(t,0);return l.mulDiag(r,t),t.mulTranspose(e,t),!0}luDecomposition(t,s){return o(0),!1}symmetricEigen(t,s){o(this.rows()===this.cols()),o(this.rows()===t.rows()),o(s.rows()===s.cols()&&s.rows()===this.rows()),o(this.isSymmetric());const i=new Float64Array(this.N*this.M),e=new y(i,this.N,this.M);e.assignCopy(this);const h=100/Number.EPSILON,r=this.rows(),a=new Float64Array(r),l=new Float64Array(r),n=new y(a,r,1),x=new y(l,r,1);for(let s=0;s<r;s++)n.set(s,e.atRowCol(s,s)),t.set(s,e.atRowCol(s,s)),x.set(s,0);s.setIdentity();const w=()=>{const o=n;s.transposeInPlace();let i=1;do{i*=3,i++}while(i<=r);do{i/=3,i=Math.trunc(i);for(let e=i;e<r;e++){const h=t.at(e),r=Math.abs(h);for(let t=0;t<this.M;t++)o.set(t,s.atRowCol(t,e));let a=e;for(;Math.abs(t.at(a-i))<r;){t.set(a,t.at(a-i));for(let t=0;t<this.M;t++)s.setRowCol(t,a,s.atRowCol(t,a-i));if(a-=i,a<i)break}if(a!==e){t.set(a,h);for(let t=0;t<this.M;t++)s.setRowCol(t,a,o.at(t))}}}while(i>1)};for(let o=1;;o++){let i=0;for(let t=1;t<r;t++)for(let s=0;s<t;s++)i+=Math.abs(e.atRowCol(t,s));if(0===i)return w(),!0;const a=o<4?.2*i/(r*r):0;for(let i=0;i<r;i++)for(let l=i+1;l<r;l++){let y=h*Math.abs(e.atRowCol(l,i));if(o>4&&y<=Math.abs(t.at(i))&&y<=Math.abs(t.at(l)))e.setRowCol(l,i,0);else if(Math.abs(e.atRowCol(l,i))>a){let o,h=t.at(l)-t.at(i);if(y<Math.abs(h))o=e.atRowCol(l,i)/h;else{const t=.5*h/e.atRowCol(l,i);o=1/(Math.abs(t)+Math.sqrt(1+t*t)),t<0&&(o=-o)}const a=1/Math.sqrt(1+o*o),n=o*a,w=n/(1+a);h=o*e.atRowCol(l,i),x.set(i,x.at(i)-h),x.set(l,x.at(l)+h),t.set(i,t.at(i)-h),t.set(l,t.at(l)+h),e.setRowCol(l,i,0);let u=0;for(;u<i;u++)y=e.atRowCol(i,u),h=e.atRowCol(l,u),e.setRowCol(i,u,y-n*(h+y*w)),e.setRowCol(l,u,h+n*(y-h*w));for(u++;u<l;u++)y=e.atRowCol(u,i),h=e.atRowCol(l,u),e.setRowCol(u,i,y-n*(h+y*w)),e.setRowCol(l,u,h+n*(y-h*w));for(u++;u<r;u++)y=e.atRowCol(u,i),h=e.atRowCol(u,l),e.setRowCol(u,i,y-n*(h+y*w)),e.setRowCol(u,l,h+n*(y-h*w));for(u=0;u<r;u++)y=s.atRowCol(i,u),h=s.atRowCol(l,u),s.setRowCol(i,u,y-n*(h+y*w)),s.setRowCol(l,u,h+n*(y-h*w))}}for(let s=0;s<r;s++)n.set(s,n.at(s)+x.at(s)),t.set(s,n.at(s)),x.set(s,0)}}static checkDims(t,s,i){o(t.rows()===s&&t.cols()===i)}}class n extends y{constructor(t){if(t.copy){const s=new Float64Array(t.copy.N*t.copy.M);return super(s,t.copy.N,t.copy.M),this.buffer=s,void this.assignCopy(t.copy)}const s=new Float64Array(t.NN*t.MM);super(s,t.NN,t.MM),this.buffer=s,t.initializerList&&a(this.buffer,t.initializerList,0,0,t.initializerList.length)}assignCopy(t){return this===t||super.assignCopy(t),this}}class x{constructor(t){this.m_TransformationType=1,void 0===t?this.setIdentity():t instanceof x?this.set(t):this.setScale(t)}set(t){return this.xx=t.xx,this.xy=t.xy,this.xd=t.xd,this.yx=t.yx,this.yy=t.yy,this.yd=t.yd,this}clone(){return(new x).set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(t){return this===t||this.xx===t.xx&&this.xy===t.xy&&this.xd===t.xd&&this.yx===t.yx&&this.yy===t.yy&&this.yd===t.yd}transformInPlace(t){const s=this.xx*t.x+this.xy*t.y+this.xd,o=this.yx*t.x+this.yy*t.y+this.yd;t.x=s,t.y=o}transform(t){const s=t.clone();return this.transformInPlace(s),s}queryTransform(t,s){const o=this.xx*t.x+this.xy*t.y+this.xd,i=this.yx*t.x+this.yy*t.y+this.yd;s.setCoords(o,i)}transformEnvInPlace(o){if(o.isEmpty())return;const i=t(s,4);o.queryCorners(i),this.transformPoints2D(i,4,i),o.setFromPoints(i,4)}queryTransformEnv(t,s){o(0)}transformPoints2D(t,s,o){for(let i=0;i<s;++i)this.queryTransform(t[i],o[i])}transformInterleavedPoints(t,o,i){o*=2;const e=s.getNAN();for(let s=0;s<o;s+=2)e.x=t[s],e.y=t[s+1],this.transformInPlace(e),i[s]=e.x,i[s+1]=e.y}multiply(t){return x.st_multiply(this,t,this),this}mulLeft(t){return o(0),this}static st_multiply(t,s,o){const i=t.xx*s.xx+t.yx*s.xy,e=t.xy*s.xx+t.yy*s.xy,h=t.xd*s.xx+t.yd*s.xy+s.xd,r=t.xx*s.yx+t.yx*s.yy,a=t.xy*s.yx+t.yy*s.yy,l=t.xd*s.yx+t.yd*s.yy+s.yd;o.xx=i,o.xy=e,o.xd=h,o.yx=r,o.yy=a,o.yd=l}getCoefficients(t){o(t.length>=6),t[0]=this.xx,t[1]=this.xy,t[2]=this.xd,t[3]=this.yx,t[4]=this.yy,t[5]=this.yd}setCoefficients(t){o(t.length>=6),this.xx=t[0],this.xy=t[1],this.xd=t[2],this.yx=t[3],this.yy=t[4],this.yd=t[5]}copyTo(t){o(0)}initializeFromRect(t,s){t.isEmpty()||s.isEmpty()||!t.width()||!t.height()?this.setZero():(this.xy=this.yx=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xd=s.xmin-t.xmin*this.xx,this.yd=s.ymin-t.ymin*this.yy)}initializeFromRectIsotropic(t,s){if(t.isEmpty()||!t.width()||!t.height()||s.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const o=s.getCenter(),i=t.getCenter();this.xd=o.x-i.x*this.xx,this.yd=o.y-i.y*this.yy}}initializeFromTwoPointsArray(t,o){if(t[0].equals(o[0])&&t[1].equals(o[1]))return void this.setIdentity();if(t[0].equals(t[1])){if(o[0].equals(o[1]))return void this.setShift(o[0].sub(t[0]));i("")}if(!t[0].equals(t[1])&&o[0].equals(o[1]))return this.setZero(),void this.shift(o[0]);this.setShiftCoords(-t[0].x,-t[0].y);const e=s.distance(t[0],t[1]),h=s.distance(o[0],o[1]),r=h/e;this.scale(r,r);const a=t[1].sub(t[0]);a.divThis(e);const l=o[1].sub(o[0]);l.divThis(h);const y=a.crossProduct(l),n=a.dotProduct(l);this.rotate(n,y),this.shiftCoords(o[0].x,o[0].y)}initializeFromTwoPoints(t,s,o,i){const e=[t,s],h=[o,i];this.initializeFromTwoPointsArray(e,h)}transformSizeInPlace(t){o(0)}transformSize(t,s){o(0)}transformTol(t){return o(0),0}transformWithoutTranslateArray(t,s,o){for(let i=0;i<s;++i)this.transformWithoutTranslate(t[i],o[i])}transformWithoutTranslateInPlace(t){const s=this.xx*t.x+this.xy*t.y,o=this.yx*t.x+this.yy*t.y;t.setCoords(s,o)}transformWithoutTranslate(t,s){const o=this.xx*t.x+this.xy*t.y,i=this.yx*t.x+this.yy*t.y;s.setCoords(o,i)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(1!==this.xx||1!==this.yy||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(t){const s=t*t;return!(e(this.xd)+e(this.yd)>s||e(this.xy+this.xd)+e(this.yy+this.yd-1)>s||e(this.xx+this.xd-1)+e(this.yx+this.yd)>s)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(t){const s=this.xx*this.xx+this.yx*this.yx,o=this.xy*this.xy+this.yy*this.yy,i=(s+o)*t;return Math.abs(s-o)<=i&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=i}isUniformNoRotation(){return 0!==this.xx&&Math.abs(this.xx)===Math.abs(this.yy)&&0===this.xy&&0===this.yx}isTranslate(){return 1===this.xx&&1===this.yy&&!this.xy&&!this.yx}isTranslateTol(t){const o=new s;return o.setCoords(0,1),this.transformWithoutTranslateInPlace(o),o.y-=1,!(o.sqrLength()>t*t)&&(o.setCoords(1,0),this.transformWithoutTranslateInPlace(o),o.x-=1,o.sqrLength()<=t*t)}isOrthonormal(t){const s=new x;return s.xx=this.xx*this.xx+this.xy*this.xy,s.xy=this.xx*this.yx+this.xy*this.yy,s.yx=this.yx*this.xx+this.yy*this.xy,s.yy=this.yx*this.yx+this.yy*this.yy,s.xd=0,s.yd=0,s.isIdentityTol(t)}isDegenerate(t){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*t*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return 0===this.xx&&0===this.yy&&0===this.xy&&0===this.yx&&0===this.xd&&0===this.yd}isScaleAndTranslateTol(t){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*t}setTranslate(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShiftCoords(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShift(t){return this.xx=1,this.xy=0,this.xd=t.x,this.yx=0,this.yy=1,this.yd=t.y,this}setScaleCoords(t,s){return this.xx=t,this.xy=0,this.xd=0,this.yx=0,this.yy=s,this.yd=0,this}setScale(t){return this.setScaleCoords(t,t),this}setFlipX(t,s){return this.xx=-1,this.xy=0,this.xd=t+s,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(t,s){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=t+s,this}setShear(t,s){return this.xx=1,this.xy=t,this.xd=0,this.yx=s,this.yy=1,this.yd=0,this}scale(t,s){return this.xx*=t,this.xy*=t,this.xd*=t,this.yx*=s,this.yy*=s,this.yd*=s,this}setRotateAngle(t){return this.setRotate(Math.cos(t),Math.sin(t))}setRotate(t,s){return this.xx=t,this.xy=-s,this.xd=0,this.yx=s,this.yy=t,this.yd=0,this}setRotateAngleAbout(t,s){return this.setRotateAbout(Math.cos(t),Math.sin(t),s)}setRotateAbout(t,s,o){return this.setTranslate(-o.x,-o.y),this.rotate(t,s),this.translate(o.x,o.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(t,s){return this.xd+=t,this.yd+=s,this}shift(t){return this.xd+=t.x,this.yd+=t.y,this}translate(t,s){return this.xd+=t,this.yd+=s,this}flipX(t,s){return this.xx=-this.xx,this.xy=-this.xy,this.xd=t+s-this.xd,this}flipY(t,s){return this.yx=-this.yx,this.yy=-this.yy,this.yd=t+s-this.yd,this}shear(t,s){const o=new x;return o.setShear(t,s),this.multiply(o)}rotateAngle(t){const s=new x;return s.setRotateAngle(t),this.multiply(s)}rotate(t,s){const o=new x;return o.setRotate(t,s),this.multiply(o)}rotateAbout(t,s,o){return this.translate(-o.x,-o.y),this.rotate(t,s),this.translate(o.x,o.y)}rotateAngleAbout(t,s){return this.rotateAbout(Math.cos(t),Math.sin(t),s)}setInvert(t){return this.set(t),this.invertThis()}invertThis(){let t=this.xx*this.yy-this.xy*this.yx;if(0===t)return this.setZero(),this;t=1/t;const s=(this.xy*this.yd-this.xd*this.yy)*t,o=(this.xd*this.yx-this.xx*this.yd)*t,i=this.yy*t,e=-this.xy*t,h=-this.yx*t,r=this.xx*t;return this.xd=s,this.yd=o,this.xx=i,this.yy=r,this.xy=e,this.yx=h,this}invertPrecise(t){return this.set(t),this.invertPreciseThis()}invertPreciseThis(){const t=h.constructDouble(this.xy),s=h.constructDouble(this.xx),o=s.mulDouble(this.yy).sub(t.mulDouble(this.yx));if(o.isZero())return this.setZero(),this;const i=o.clone();i.invertThis();const e=h.constructDouble(this.xd),r=t.mulDouble(this.yd).sub(e.mulDouble(this.yy)).mul(i).toDouble(),a=e.mulDouble(this.yx).sub(s.mulDouble(this.yd)).mul(i).toDouble(),l=i.mulDouble(this.yy).toDouble(),y=i.mulDouble(-this.xy).toDouble(),n=i.mulDouble(-this.yx).toDouble(),x=i.mulDouble(this.xx).toDouble();return this.xd=r,this.yd=a,this.xx=l,this.yy=x,this.xy=y,this.yx=n,this}extractScaleTransform(t,s){const o=Math.sqrt(this.xx*this.xx+this.xy*this.xy),i=Math.sqrt(this.yx*this.yx+this.yy*this.yy);s.setScaleCoords(1/o,1/i),s.multiply(this),t.setScaleCoords(o,i)}setFromTwoTriangles(t,o){let i=!0;for(let s=0;s<3;++s)i=i&&t[s].equals(o[s]);if(i)return this.setIdentity(),!0;const e=new s;e.setSub(t[0],t[1]);const h=new s;h.setSub(t[0],t[2]);const r=new s;r.setSub(o[0],o[1]);const a=new s;a.setSub(o[0],o[2]);const l=4*Number.EPSILON*(Math.abs(e.x*h.y)+Math.abs(h.x*e.y));let y=e.x*h.y-e.y*h.x;return Math.abs(y)>l?(y=1/y,this.xx=(r.x*h.y-e.y*a.x)*y,this.xy=(e.x*a.x-r.x*h.x)*y,this.yx=(r.y*h.y-e.y*a.y)*y,this.yy=(e.x*a.y-r.y*h.x)*y,this.xd=o[0].x-(this.xx*t[0].x+this.xy*t[0].y),this.yd=o[0].y-(this.yx*t[0].x+this.yy*t[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(t,i,e,h,a=null){return 0===i?(this.setIdentity(),void(a&&a.setIdentity())):1===i?(this.setShift(h[0].sub(e[0])),void(a&&a.setShift(e[0].sub(h[0])))):(i<3&&(t=1),void(4===t&&i>2?function(t,o,i,e,h){const a=s.average(i,o),l=s.average(e,o),y=new n({NN:2,MM:2});y.setZero();const x=new n({NN:2,MM:2});x.setZero();for(let t=0;t<o;++t)y.setRowCol(0,0,y.atRowCol(0,0)+(i[t].x-a.x)*(i[t].x-a.x)),y.setRowCol(0,1,y.atRowCol(0,1)+(i[t].x-a.x)*(i[t].y-a.y)),y.setRowCol(1,1,y.atRowCol(1,1)+(i[t].y-a.y)*(i[t].y-a.y)),x.setRowCol(0,0,x.atRowCol(0,0)+(e[t].x-l.x)*(i[t].x-a.x)),x.setRowCol(0,1,x.atRowCol(0,1)+(e[t].x-l.x)*(i[t].y-a.y)),x.setRowCol(1,0,x.atRowCol(1,0)+(e[t].y-l.y)*(i[t].x-a.x)),x.setRowCol(1,1,x.atRowCol(1,1)+(e[t].y-l.y)*(i[t].y-a.y));y.setRowCol(1,0,y.atRowCol(0,1));const w=new n({NN:2,MM:2});y.pseudoInverse(w,!0)||r("Failed to compute pseudo inverse"),x.mul(w,x),u(t,x);const C=a.clone();t.transformInPlace(C),t.xd=l.x-C.x,t.yd=l.y-C.y,h&&(x.pseudoInverse(w,!1)||r("Failed to compute pseudo inverse"),u(h,w),h.transformInPlace(l),h.xd=a.x-l.x,h.yd=a.y-l.y)}(this,i,e,h,a):function(t,i,e,h,a,l){o(1===t||0===t||2===t||3===t),i.setIdentity();const y=s.average(h,e),C=s.average(a,e);if(o(t<w.length&&t>0),8&w[t]){const s=new n({NN:2,MM:2});s.setZero();for(let t=0;t<e;++t)s.setRowCol(0,0,s.atRowCol(0,0)+(a[t].x-C.x)*(h[t].x-y.x)),s.setRowCol(1,0,s.atRowCol(1,0)+(a[t].x-C.x)*(h[t].y-y.y)),s.setRowCol(0,1,s.atRowCol(0,1)+(a[t].y-C.y)*(h[t].x-y.x)),s.setRowCol(1,1,s.atRowCol(1,1)+(a[t].y-C.y)*(h[t].y-y.y));const o=new n({NN:2,MM:2}),l=new n({NN:2,MM:1}),f=new n({NN:2,MM:2});s.svd(o,l,f)||r("Failed to compute svd");const R=new n({NN:2,MM:2});o.transpose(R);const d=new n({NN:2,MM:2});f.mul(R,d),32&w[t]||d.determinant()<0&&(R.setRowCol(1,0,-R.atRowCol(1,0)),R.setRowCol(1,1,-R.atRowCol(1,1)),f.mul(R,d));const c=new x;u(c,d),i.set(c)}if(2&w[t]){let t=0,s=0;for(let o=0;o<e;++o){const e=h[o].sub(y);t+=e.sqrLength(),i.transformInPlace(e),s+=e.dotProduct(a[o].sub(C))}if(0===t)0===s?i.setIdentity():i.setZero();else{const o=s/t;i.scale(o,o)}}else o(!(4&w[t]));const f=y.clone();i.transformInPlace(f),i.xd=C.x-f.x,i.yd=C.y-f.y,l&&(l.set(i),l.invertThis(),l.isZero()&&(l.xd=y.x,l.yd=y.y))}(t,this,i,e,h,a)))}calculateErrors(t,i,e,h){o(t>0&&null!==i&&null!==e);let r=0;for(let o=0;o<t;++o){const t=this.transform(i[o]),a=s.sqrDistance(e[o],t);r+=a,h&&(h[o]=Math.sqrt(a))}return Math.sqrt(r/t)}}const w=[43,11,41,9,61];function u(t,s){o(!(2!==s.rows()&&3!==s.rows()||2!==s.cols()&&3!==s.rows())),t.xx=s.atRowCol(0,0),t.xy=s.atRowCol(0,1),t.yx=s.atRowCol(1,0),t.yy=s.atRowCol(1,1),3===s.cols()?(t.xd=s.atRowCol(0,2),t.yd=s.atRowCol(1,2)):(t.xd=0,t.yd=0)}export{x as T};
