/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{y as e,r as t,P as s,a as n,G as o,o as r,p as a}from"./Point2D.js";import{f as i,J as c,K as g,u as m,y as u,N as h,P as p,b as y,Q as l}from"./ProjectionTransformation.js";import{d as _}from"./Envelope.js";import{Envelope2D as x}from"./Envelope2D.js";function f(){return{m_pGcs:new s,m_xyz:new _,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:d,setLength:P,assign:S}}function d(e,t,s,n){this.m_factor=e,this.m_pGcs.assign(t),this.m_xyz.assign(n),this.m_geoLength=s}function P(e){this.m_geoLength=e}function S(e){this.m_pGcs.assign(e.m_pGcs),this.m_xyz.assign(e.m_xyz),this.m_factor=e.m_factor,this.m_geoLength=e.m_geoLength}class N{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,s,n,o){if(e.hasNonLinearSegments()&&(e=(new i).execute(e,0,t.getTolerance(0),0,o)),t.isPannable()){let n=90,r=-90;if(1===s.getUnit().getUnitToBaseFactor()&&(n*=Math.PI/180,r*=Math.PI/180),2===t.getCoordinateSystemType()){let e=null;const s=[0,0,0,0];e=t.getPECoordSys(),s[0]=0,s[1]=n,s[2]=0,s[3]=r,c.geogToProj(e,2,s),n=s[1],r=s[3]}const a=new x;e.queryEnvelope(a),a.ymin=r,a.ymax=n,e=(new g).execute(e,a,t,o)}else{const s=t.getPCSHorizon();if((e=(new m).execute(e,s,t,o))===s){const t=e.clone();e=t}}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,s,n,1,o)}_ExecuteIterativeApproach(n,o,r,i,g,m){const h=u();r.querySpheroidData(h);const p=h.majorSemiAxis,y=h.e2,l=r.getUnit().getUnitToBaseFactor(),x=e(f,40),d=t(40,Number.NaN),P=f(),S=f();let N;const C=[0,0,0,0],G=o.getPECoordSys(),L=new s,T=new s,v=new s,b=new s,D=new s;let j=0;const z=n.querySegmentIterator();for(;z.nextPath();)for(;z.hasNextSegment();){const e=z.nextSegment();L.assign(e.getStartXY()),T.assign(e.getEndXY()),2===o.getCoordinateSystemType()?(C[0]=L.x,C[1]=L.y,C[2]=T.x,C[3]=T.y,c.projToGeog(G,2,C),v.x=C[0]*l,v.y=C[1]*l,b.x=C[2]*l,b.y=C[3]*l):(v.setCoordsPoint2D(L),b.setCoordsPoint2D(T),v.scale(l),b.scale(l));const t=new _,s=new _;w(p,y,v,t),w(p,y,b,s);let n=E(p,t,s);P.setValues(0,v,Number.NaN,t),S.setValues(1,b,n,s),N=g,x[0].assign(S),d[0]=g;let r=0;for(;;){r>128&&a("iterations exceeded");const t=.5*(P.m_factor+S.m_factor),s=e.getCoord2D(t);2===o.getCoordinateSystemType()?(C[0]=s.x,C[1]=s.y,c.projToGeog(G,1,C),D.x=C[0]*l,D.y=C[1]*l):(D.setCoordsPoint2D(s),D.scale(l)),v.setCoordsPoint2D(P.m_pGcs),b.setCoordsPoint2D(S.m_pGcs);const i=new _;w(p,y,D,i);const m=E(p,P.m_xyz,i),u=E(p,S.m_xyz,i);n=S.m_geoLength,Number.isNaN(n)&&(n=E(p,P.m_xyz,S.m_xyz));const h=m+u,f=N===g&&h>=20&&Math.abs(h-n)>1e-8*(n+h);if(r+2<40&&(f||Math.abs(h-n)>0&&N>0))S.setLength(u),x[r].assign(S),S.setValues(t,D,m,i),x[++r].assign(S),f?(N=g,d[r]=g):(N--,d[r-1]=N,d[r]=N);else{if(j+=h,0===r)break;P.assign(S),S.assign(x[--r]),N=d[r]}}}return j}execute(e,t,s){if(t&&0!==t.getCoordinateSystemType()||n(""),e.isEmpty()||e.getDimension()<1)return 0;let a=null;const i=t.getGCS();i!==t&&(a=h(t,i,null));const c=e.getGeometryType();if(c===o.enumEnvelope){const n=new p;return n.addEnvelope(e,!1),this._ExecuteShapePreservingLength(n,t,i,a,s)}if(r(c)){const n=new y;return n.addSegment(e,!0),this._ExecuteShapePreservingLength(n,t,i,a,s)}return this._ExecuteShapePreservingLength(e,t,i,a,s)}}function w(e,t,s,n){n.assign(l(e,t,s))}function E(e,t,s){const n=e,o=new _;o.setSub(t,s);const r=o.length();return 2*n*Math.asin(r/(2*n))}export{N as O};
