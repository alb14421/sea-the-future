/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{a as n,b as e,f as t,d as r}from"./mathUtils.js";import{sqlOr as o}from"../core/sql.js";function i(n,e){return{...e,filterMode:n.mode}}function a(n,e){return c(n,e).next().value??null}function u(t,r,i){const a=function(n){if("manual"===l(n))return null;const e=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:t,maxScale:r}of n.filters)e[0]=Math.max(e[0],m(t)),e[1]=Math.min(e[1],s(r));return e}(t);if(a&&(n(r,a[0])||e(i,a[1])))return"";const u=Array.from(c(t,r,i)),f=function(t,r,o){if(0===t.length)return!0;const i=m(t.at(0)?.minScale),a=s(t.at(-1)?.maxScale);if(e(i,r)||n(a,o))return!0;for(let n=0;n<t.length-1;n++){const r=t[n],o=t[n+1];if(e(m(o.minScale),s(r.maxScale)))return!0}return!1}(u,r,i)?"1=1":u.map(n=>n.where||"1=1").reduce((n,e)=>o(n,e),"");return f&&"1=1"!==f?f:""}function*c(n,e,t){if("manual"===l(n)){const e=n.filters.find(e=>e.id===n.activeFilterId);e&&(yield e)}else{"object"==typeof e&&(e=e.scale);for(const r of n.filters)f(r.minScale,r.maxScale,e,t)&&(yield r)}}function f(n,e,o,i){return n=m(n),o=m(o),e=s(e),!(!t(o,n)&&(i??o)>n||r(e,o)||void 0!==i&&t(i,n))}function l(n){return"mode"in n?n.mode:n.filterMode}function m(n){return n||Number.POSITIVE_INFINITY}function s(n){return n||0}export{u as a,i as c,a as g};
