/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../intl.js";import{i as e,q as t,equalsShallow as n}from"../core/lang.js";import{L as r}from"./Logger.js";import{t as a,r as i}from"./string.js";import{c as o}from"./formUtils.js";import{isTimeOnlyField as s}from"../layers/support/fieldUtils.js";import{b as l,v as u}from"./layerUtils.js";import{i as m}from"./utils7.js";import{g as p,a as d}from"./dateUtils.js";import{b as f,s as c,c as y,n as g}from"./formUtils2.js";import{s as b}from"./substitute.js";const v=e=>"field"===e?.type,x=e=>"group"===e?.type,j=e=>"relationship"===e?.type,h=e=>"text"===e.type,F=e=>"utilityNetworkAssociations"===e.type,N=e=>!x(e)&&null!=e.group,T=(e,t)=>N(e)&&e.group===t,V=e=>e.reduce((e,t)=>x(t)?[...e,...t.inputs]:[...e,t],[]),w=e=>V(e).filter(v),L=e=>V(e).filter(j),O=e=>V(e).filter(F),U=e=>null!=e&&($(e,"combo-box")||$(e,"radio-buttons")),$=(e,t)=>null!=e&&e.input?.type===t,E=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type);function Z(t){const{attributes:n,fieldsIndex:r,label:o,timeZone:s}=t;if(!n||"object"!=typeof n)return o;const l=Object.keys(n).filter(e=>a(o,e)),u=l.map(e=>n[e]),m=l.map(e=>r.get(e)).filter(e);return function(e,t){return i(i(e,e=>`{${e.toLowerCase()}}`),Object.fromEntries(Object.entries(t).map(([e,t])=>[e.toLowerCase(),t])))}(o,S({values:u,fields:m,timeZone:s}))}const C="expression/";function k(e){const[t,n]=e.split(C);return""===t&&n?n:(r.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${C}/expressionName'`),"")}function I(e){return`${C}${e}`}function q(e){return`field/${e}`}function A(e){return e.startsWith(C)}function B(e){return e.startsWith("expr/")}function S(e){const{fields:t,values:n}=e,r=e.timeZone??void 0,a=t.map((e,t)=>{let a=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find(e=>e.code===a);t?.name&&(a=t.name)}return(m(e)||s(e))&&(a=p(e,a,{timeZone:r,...d(e)})),[e.name,a]});return Object.fromEntries(a)}const W=e=>{const t={typeFieldName:null,types:[]};return e?(l(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map(({id:e,name:t,domains:n})=>({code:e,name:t,domains:n}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},z=(e,t,n)=>{const{dataType:r,error:a,minLength:i}=e,o=t?.validationErrors;if(!o||!a)return null;if("input-validation-error::cannot-be-empty"===a)return o.cannotBeNull;if("domain-validation-error::value-out-of-range"===a||"numeric-range-validation-error::out-of-range"===a){const{field:t,range:a}=e,i={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...d(t)}},s=f(a,o);return b(s,a,{format:{max:"date"===r?i:null!=a.max&&c(a.max)?y:g,min:"date"===r?i:null!=a.min&&c(a.min)?y:g}})}return"domain-validation-error::invalid-coded-value"===a?o.invalidCodedValue:"type-validation-error::invalid-type"===a?o.invalidType:"length-validation-error::too-short"===a?b(o.tooShort,{min:i}):null},D=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":"mesh"===r||"mesh"===n||"multipatch"===n?"cube":"multipoint"===r||"multipoint"===n?"point":r||n||"table"},G=e=>{const t=[];if(e.formTemplate){const{description:n,title:r}=e.formTemplate;e.fields?.forEach(e=>{const i=r&&a(r,e.name),o=n&&a(n,e.name);(i||o)&&t.push(e.name)})}return t};function H(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(o)??[]).some(({fieldName:t})=>!e.fieldsIndex.get(t))}function J(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function K(e,n){switch(n.objectType){case"any":return!0;case"null":return null==e;case"code":return e===n.codedValue?.code;case"range":return null!=e&&null!=n.minValue&&null!=n.maxValue&&+e>=n.minValue&&+e<=n.maxValue;default:return t(n.objectType),!1}}function M(e,t,r){const a=u(e),i=a?.find(e=>e.code===r);if(!i)return!1;const o=a?.find(e=>e.code===t);return!n(i.defaultValues,o?.defaultValues)&&Object.values(i.defaultValues).some(e=>null!=e)}export{k as A,B,H as C,U as a,v as b,G as c,x as d,j as e,h as f,S as g,F as h,$ as i,V as j,N as k,z as l,D as m,E as n,T as o,Z as p,O as q,w as r,M as s,L as t,W as u,J as v,K as w,I as x,q as y,A as z};
