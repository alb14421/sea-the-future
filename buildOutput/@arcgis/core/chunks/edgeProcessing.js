/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{d as t}from"./deduplicate.js";import{n as e}from"./InterleavedLayout.js";import{RegularEdgeInstancesLayout as o,SilhouetteEdgeInstancesLayout as n,EdgeInputBufferLayout as s}from"./bufferLayouts.js";import{R as r}from"../core/lang.js";import{j as i,n as c}from"./vec3.js";import{c as a}from"./vec3f64.js";import{c as f}from"./Normals.js";import{e as p}from"./edgePreprocessing.js";import"./mathUtils.js";import"./Indices.js";import"./BufferView.js";import"./vec2.js";import"./common.js";import"./vec4.js";import"./vec2f64.js";import"./vec4f64.js";import"./types.js";import"./enums.js";import"./VertexElementDescriptor.js";import"./VertexAttributeLocations.js";import"./PooledArray.js";function m(t,e,o){const n=e/3,s=new Uint32Array(o+1),r=new Uint32Array(o+1),i=(t,e)=>{t<e?s[t+1]++:r[e+1]++};for(let e=0;e<n;e++){const o=t[3*e],n=t[3*e+1],s=t[3*e+2];i(o,n),i(n,s),i(s,o)}let c=0,a=0;for(let t=0;t<o;t++){const e=s[t+1],o=r[t+1];s[t+1]=c,r[t+1]=a,c+=e,a+=o}const f=new Uint32Array(6*n),p=s[o],m=(t,e,o)=>{if(t<e){const n=s[t+1]++;f[2*n]=e,f[2*n+1]=o}else{const n=r[e+1]++;f[2*p+2*n]=t,f[2*p+2*n+1]=o}};for(let e=0;e<n;e++){const o=t[3*e],n=t[3*e+1],s=t[3*e+2];m(o,n,e),m(n,s,e),m(s,o,e)}const u=(t,e)=>{const o=2*t,n=e-t;for(let t=1;t<n;t++){const e=f[o+2*t],n=f[o+2*t+1];let s=t-1;for(;s>=0&&f[o+2*s]>e;s--)f[o+2*s+2]=f[o+2*s],f[o+2*s+3]=f[o+2*s+1];f[o+2*s+2]=e,f[o+2*s+3]=n}};for(let t=0;t<o;t++)u(s[t],s[t+1]),u(p+r[t],p+r[t+1]);const d=new Int32Array(3*n),l=(e,o)=>e===t[3*o]?0:e===t[3*o+1]?1:e===t[3*o+2]?2:-1,g=(t,e)=>{const o=l(t,e);d[3*e+o]=-1},h=(t,e,o,n)=>{const s=l(t,e);d[3*e+s]=n;const r=l(o,n);d[3*n+r]=e};for(let t=0;t<o;t++){let e=s[t];const o=s[t+1];let n=r[t];const i=r[t+1];for(;e<o&&n<i;){const o=f[2*e],s=f[2*p+2*n];o===s?(h(t,f[2*e+1],s,f[2*p+2*n+1]),e++,n++):o<s?(g(t,f[2*e+1]),e++):(g(s,f[2*p+2*n+1]),n++)}for(;e<o;)g(t,f[2*e+1]),e++;for(;n<i;)g(f[2*p+2*n],f[2*p+2*n+1]),n++}return d}class u{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?j:h}write(t,e,o){S.seed=this._edgeHashFunction(o);const n=S.getIntRange(0,255),s=S.getIntRange(0,this.settings.variants-1),r=S.getFloat();var i;const c=255*(.5*(i=-(1-Math.min(r/.7,1))+Math.max(0,r-.7)/(1-.7),Math.abs(i)**1.2*Math.sign(i))+.5);t.position0.setVec(e,o.position0),t.position1.setVec(e,o.position1),t.componentIndex.set(e,o.componentIndex),t.variantOffset.set(e,n),t.variantStroke.set(e,s),t.variantExtension.set(e,c)}}const d=new Float32Array(6),l=new Uint32Array(d.buffer),g=new Uint32Array(1);function h(t){return d[0]=t.position0[0],d[1]=t.position0[1],d[2]=t.position0[2],d[3]=t.position1[0],d[4]=t.position1[1],d[5]=t.position1[2],g[0]=31*(31*(31*(31*(31*(166811+l[0])+l[1])+l[2])+l[3])+l[4])+l[5],g[0]}function j(t){const e=d;e[0]=v(t.position0[0]),e[1]=v(t.position0[1]),e[2]=v(t.position0[2]),e[3]=v(t.position1[0]),e[4]=v(t.position1[1]),e[5]=v(t.position1[2]),g[0]=5381;for(let t=0;t<l.length;t++)g[0]=31*g[0]+l[t];return g[0]}const w=1e4;function v(t){return Math.round(t*w)/w}const y=a(),S=new r;function A(t){const e=B(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return N.updateSettings(t.writerSettings),b.updateSettings(t.writerSettings),p(e,N,b)}function B(e,o,n,r){if(o){const t=m(n,r,e.count);return new I(n,r,t,e)}const i=t(e.buffer,e.stride/4,{originalIndices:n}),c=m(i.indices,r,i.uniqueCount);return{faces:i.indices,facesLength:i.indices.length,neighbors:c,vertices:s.createView(i.buffer)}}class I{constructor(t,e,o,n){this.faces=t,this.facesLength=e,this.neighbors=o,this.vertices=n}}const N=new class{constructor(){this._commonWriter=new u}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return o.createBuffer(t)}write(t,e,o){this._commonWriter.write(t,e,o),i(y,o.faceNormal0,o.faceNormal1),c(y,y);const{typedBuffer:n,typedBufferStride:s}=t.normalCompressed;f(n,e,y[0],y[1],y[2],s)}},b=new class{constructor(){this._commonWriter=new u}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return n.createBuffer(t)}write(t,e,o){this._commonWriter.write(t,e,o);{const{typedBuffer:n,typedBufferStride:s}=t.normalCompressed;f(n,e,o.faceNormal0[0],o.faceNormal0[1],o.faceNormal0[2],s)}{const{typedBuffer:n,typedBufferStride:s}=t.normal2Compressed;f(n,e,o.faceNormal1[0],o.faceNormal1[1],o.faceNormal1[2],s)}}},x=e().vec3f("position0").vec3f("position1"),_=e().vec3f("position0").vec3f("position1").u16("componentIndex");export{A as extract,_ as extractComponentsEdgeLocationsLayout,B as extractEdgeInformation,x as extractEdgeLocationsLayout};
