/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{U as t}from"./Emissions.glsl.js";import{c as i,l as n}from"./mathUtils.js";import{k as s,e as r,v as h,i as e,j as o,m as a}from"./vec3.js";import{z as c,f as g,c as l}from"./vec3f64.js";class m extends t{constructor(t,i){super(t,"int",1,(n,s,r)=>n.setUniform1i(t,i(s,r)))}}class f extends t{constructor(t,i,n){super(t,"vec2",2,(s,r,h,e)=>s.setUniform2fv(t,i(r,h,e),n))}}class u{constructor(t=c()){this.intensity=t}}class _{constructor(t=c(),i=g(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class p{constructor(t=c(),i=g(.57735,.57735,.57735),n=!0,s=1,r=1){this.intensity=t,this.direction=i,this.castShadows=n,this.specularStrength=s,this.environmentStrength=r}}class y{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function b(t,i,n){(n=n||t).length=t.length;for(let s=0;s<t.length;s++)n[s]=t[s]*i[s];return n}function L(t,i,n){(n=n||t).length=t.length;for(let s=0;s<t.length;s++)n[s]=t[s]*i;return n}function d(t,i,n){(n=n||t).length=t.length;for(let s=0;s<t.length;s++)n[s]=t[s]+i[s];return n}function S(t){return(t+1)*(t+1)}function F(t,i,n){const s=t[0],r=t[1],h=t[2],e=n||[];return e.length=S(i),i>=0&&(e[0]=.28209479177),i>=1&&(e[1]=.4886025119*s,e[2]=.4886025119*h,e[3]=.4886025119*r),i>=2&&(e[4]=1.09254843059*s*r,e[5]=1.09254843059*r*h,e[6]=.31539156525*(3*h*h-1),e[7]=1.09254843059*s*h,e[8]=.54627421529*(s*s-r*r)),e}const H=[],v=[],w=[],M=[0],j=[0],I=l(),A=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class P{constructor(){this.color=l(),this.intensity=1}}class U{constructor(){this.direction=l(),this.ambient=new P,this.diffuse=new P}}const x=.4;class O{constructor(){this._shOrder=2,this._legacy=new U,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new y,this._mainLight=new p(l(),g(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){(function(t,n,e,o){!function(t,i){const n=S(t),s=i||{r:[],g:[],b:[]};s.r.length=s.g.length=s.b.length=n;for(let t=0;t<n;t++)s.r[t]=s.g[t]=s.b[t]=0}(n,o),s(e.intensity,0,0,0);let a=!1;const c=H,g=v,l=w;c.length=0,g.length=0,l.length=0;for(const i of t)i instanceof p&&!a?(r(e.direction,i.direction),r(e.intensity,i.intensity),e.specularStrength=i.specularStrength,e.environmentStrength=i.environmentStrength,e.castShadows=i.castShadows,a=!0):i instanceof p||i instanceof _?c.push(i):i instanceof u?g.push(i):i instanceof y&&l.push(i);(function(t,n){const s=(r=n.r.length,i(Math.floor(Math.sqrt(r)-1),0,2));var r;for(const i of t)h(I,i.direction),F(I,s,M),b(M,A),L(M,i.intensity[0],j),d(n.r,j),L(M,i.intensity[1],j),d(n.g,j),L(M,i.intensity[2],j),d(n.b,j)})(c,o),function(t,i){F(I,0,M);for(const n of t)i.r[0]+=M[0]*A[0]*n.intensity[0]*4*Math.PI,i.g[0]+=M[0]*A[0]*n.intensity[1]*4*Math.PI,i.b[0]+=M[0]*A[0]*n.intensity[2]*4*Math.PI}(g,o);for(const t of l)d(o.r,t.r),d(o.g,t.g),d(o.b,t.b)})(t,this._shOrder,this._mainLight,this._sphericalHarmonics),r(this._legacy.direction,this._mainLight.direction);const n=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*n,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*n,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*n,e(this._legacy.diffuse.color,this._mainLight.intensity,n),r(k,this._legacy.diffuse.color),e(k,k,.4*this.globalFactor),o(this._legacy.ambient.color,this._legacy.ambient.color,k)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),r(this._mainLight.direction,t.mainLight.direction),r(this._mainLight.intensity,t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,i,s){if(a(this._mainLight.intensity,t.mainLight.intensity,i.mainLight.intensity,s),this._mainLight.environmentStrength=n(t.mainLight.environmentStrength,i.mainLight.environmentStrength,s),this._mainLight.specularStrength=n(t.mainLight.specularStrength,i.mainLight.specularStrength,s),r(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=n(t.globalFactor,i.globalFactor,s),this.noonFactor=n(t.noonFactor,i.noonFactor,s),t.sh.r.length===i.sh.r.length)for(let r=0;r<i.sh.r.length;r++)this._sphericalHarmonics.r[r]=n(t.sh.r[r],i.sh.r[r],s),this._sphericalHarmonics.g[r]=n(t.sh.g[r],i.sh.g[r],s),this._sphericalHarmonics.b[r]=n(t.sh.b[r],i.sh.b[r],s);else for(let t=0;t<i.sh.r.length;t++)this._sphericalHarmonics.r[t]=i.sh.r[t],this._sphericalHarmonics.g[t]=i.sh.g[t],this._sphericalHarmonics.b[t]=i.sh.b[t]}}const k=l();export{u as A,f as F,m as I,p as M,O as S,x as a,_ as b};
