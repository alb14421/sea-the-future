/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import"../intl.js";import{s as e}from"./string.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./Logger.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import i from"../widgets/FeatureForm/UtilityNetworkAssociationInput.js";import"./widgetUtils.js";import{t as r,a as p}from"./jsxFactory.js";import{g as n}from"./getAssociationTitle.js";import{g as m}from"./getFeatureTitle.js";import a from"../core/Accessor.js";import{l}from"./componentsUtils.js";import{g as c}from"./globalCss.js";import{H as u}from"./Heading.js";import{m as j}from"./messageBundle.js";import{F as d}from"./FeatureUtilityNetworkAssociationsViewModel.js";import{U as y,i as b,a as f,f as h}from"./isConnectivityMidspan.js";import{s as g}from"./substitute.js";import"./date.js";import"./jsonMap.js";import"./object.js";import"./locale.js";import"./handleUtils.js";import"./constants.js";import"./datetime.js";import"./number.js";import"./messages.js";import"../core/Error.js";import"../config.js";import"../core/promiseUtils.js";import"./events.js";import"./maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./jsonUtils.js";import"./MapUtils.js";import"./persistableUrlUtils.js";import"./assets.js";import"./ensureType.js";import"./get.js";import"./utils.js";import"./metadata.js";import"./Lifecycle.js";import"./tracking.js";import"./Warning.js";import"../core/Identifiable.js";import"../core/reactiveUtils.js";import"./watch.js";import"./ObjectPool.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"./SetUtils.js";import"./SimpleTrackingTarget.js";import"./UpdatingHandles.js";import"./featureUtils.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"./guards.js";import"./layerUtils.js";import"../core/Collection.js";import"../core/Evented.js";import"../core/Handles.js";import"./ObservableBase.js";import"./shared.js";import"./SimpleObservable.js";import"../layers/catalog/catalogUtils.js";import"./utils7.js";import"./basemapUtils.js";import"./utils5.js";import"./colorUtils.js";import"./screenUtils.js";import"./mat4.js";import"./common.js";import"./basemapDefinitions.js";import"./timeZoneUtils.js";import"../widgets/FeatureForm/EditableInput.js";import"../widgets/FeatureForm/InputBase.js";import"./featureFormUtils.js";import"./formUtils.js";import"../form/elements/AttachmentElement.js";import"../form/elements/Element.js";import"../core/JSONSupport.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../core/accessorSupport/decorators/cast.js";import"./reader.js";import"./writer.js";import"./Input.js";import"../core/Clonable.js";import"../form/elements/inputs/attachments/AudioInput.js";import"./utils2.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"./enumeration.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../form/elements/RelationshipElement.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../form/elements/TextElement.js";import"../form/elements/UtilityNetworkAssociationsElement.js";import"../popup/support/UtilityNetworkAssociationType.js";import"./dateUtils.js";import"./mathUtils.js";import"./formUtils2.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"./chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./pe.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"../geometry/Polygon.js";import"./coordsUtils.js";import"./extentUtils.js";import"./boundsUtils.js";import"./aaBoundingRect.js";import"../geometry/Polyline.js";import"./typeUtils.js";import"./createFeatureId.js";import"./typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"./collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"./utils3.js";import"../symbols/edges/Edges3D.js";import"./materialUtils.js";import"./opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"./Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"./utils4.js";import"./colors.js";import"./symbolLayerUtils3D.js";import"./vec3f64.js";import"./aaBoundingBox.js";import"./DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"./lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"./Thumbnail.js";import"./calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"./urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"./ReactiveMap.js";import"./featureQueryAll.js";import"../rest/support/Query.js";import"./DataLayerSource.js";import"../layers/support/Field.js";import"./fieldType.js";import"./FullTextSearch.js";import"./spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../time/TimeExtent.js";import"./timeUtils.js";import"../rest/networks/support/NetworkElement.js";import"../rest/support/FeatureSet.js";import"./jsxWidgetSupport.js";import"../widgets/Widget.js";import"./domUtils.js";import"./uuid.js";import"./projector.js";import"./sanitizerUtils.js";function F(t){const{feature:e,heading:s}=t,o=s||m(e),i=function(t){const{feature:e,association:s,associationType:o,messages:i}=t,{attachment:r,connectivity:p,container:m,content:a,structure:l}=i,c=e.sourceLayer;if(!s&&!o)return;if(!s)switch(o){case"attachment":return r;case"container":return m;case"connectivity":return p;case"content":return a;case"structure":return l}if(!c)return;const u=e.attributes[c.globalIdField]===s.fromNetworkElement.globalId?"from":"to";return n(s,u,i)}(t)??"";return r("calcite-block",{description:i,heading:o})}let S=class extends a{constructor(t){super(t),this.associationDetails=!0}};t([s({type:Boolean,nonNullable:!0})],S.prototype,"associationDetails",void 0),S=t([o("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.VisibleElements")],S);const I="esri-feature-form-utility-network-association-list",L={base:I,header:`${I}__header`,headingContent:`${I}__heading-content`,listContainer:`${I}__list-container`};let U=class extends y{constructor(t,e){super(t,e),this._isLoadingSelectFeature=!1,this.associationInput=null,this.headingLevel=5,this.messagesFeatureForm=null,this.onSelectLayer=()=>{},this.onSelectFeature=async()=>{},this.onAddAssociation=()=>{},this.viewModel=new d,this.visibleElements=new S}initialize(){this.setUpObserver()}loadDependencies(){return l({chip:()=>import("./index35.js"),fab:()=>import("./index48.js"),icon:()=>import("./index.js"),list:()=>import("./index19.js"),"list-item":()=>import("./index18.js"),tooltip:()=>import("./index4.js")})}get associatedFeatureCount(){const{associationInput:t}=this;if(!t)return 0;const{associatedFeatureInfos:e,associatedLayer:s}=t,o=s?e.get(s):null;return o?o.length:0}render(){const{associationInput:t}=this;if(!t)return r("div",{class:this.classes(L.base,c.widget)});const{associatedLayer:e}=t,{state:s}=this.viewModel;return r("div",{class:this.classes(L.base,c.widget)},"loading"===s||"querying"===s?this.renderLoading():e?this._renderFeatureList(t,e):this._renderLayerList(t))}_renderLayerList(t){const{associatedFeatureInfos:e,editable:s}=t;return r("div",{class:L.listContainer},r("calcite-list",{label:this.messagesFeatureForm?.associations.associatedLayers},Array.from(e.keys(),e=>this._renderLayerItem(t,e))),s?r("calcite-fab",{appearance:"outline-fill",icon:"plus",key:`${t.uid}-add-button`,kind:"neutral",onclick:()=>this.onAddAssociation({feature:t.feature,associationType:t.activeAssociationType,utilityNetwork:t.utilityNetwork}),text:this.messagesCommon.add,textEnabled:!0}):null)}_renderFeatureList(t,e){return r(p,null,this._renderHeader(t,e),r("div",{class:L.listContainer},this.renderFeatureCountWarning(),r("calcite-list",{label:this.messagesFeatureForm?.associations.associatedFeatures},this._renderAssociatedFeatureListPage(t,e),this.renderFeatureObserver())))}_renderLayerTitle(t){return t.title?r(u,{key:"title",level:this.headingLevel},r("div",{class:L.headingContent},r("calcite-icon",{icon:"layer"}),t.title)):null}_renderTotal(t,e){const{messagesFeature:s}=this,{associatedFeatureInfos:o}=t,i=o.get(e),p=g(s?.numberRecords,{number:i?.length??"0"});return r("div",{key:e.id},p)}_renderHeader(t,e){const{messagesFeatureForm:s}=this,{activeAssociationType:o,featureItem:i,feature:p}=t;return r("div",{class:L.header,key:"filter"},this.visibleElements.associationDetails?r(F,{associationType:o?.type,feature:p,heading:i?.label,messages:s.associations}):void 0,this._renderLayerTitle(e),this.renderFilter(),this._renderTotal(t,e))}_renderAssociatedFeatureListPage(t,e){const{filterText:s,endIndex:o}=this,i=t.associatedFeatureInfos.get(e)?.filter(t=>t.title?.toLowerCase().includes(s)??!1).slice(0,o).toArray()??[];return[...this._renderTooltips(i),...this._renderAssociatedFeatureList(i)]}_renderItemTooltip(t){const{tooltipReferenceMap:e}=this,s=t.feature.uid.toString();return b(t.association)?r("calcite-tooltip",{key:`tooltip-${s}`,overlayPositioning:"fixed",referenceElement:e.get(s)},this.getConnectivityTooltip(t.association.associationType)):null}_renderAssociatedFeature(t){const s=this.messagesCommon.untitled,o=t.title||s,i=t.feature.uid.toString();return r("calcite-list-item",{description:e(t.terminalName??""),key:`associated-feature-type-${i}`,label:e(o),onCalciteListItemSelect:()=>this._selectAssociation(t)},b(t.association)?this.renderConnectivityIcon(t.association.associationType,i):null,f(t.association)?r("calcite-chip",{label:h(t.association),scale:"s",slot:"content-end"},h(t.association)):null,r("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderTooltips(t){return t.map(t=>this._renderItemTooltip(t))}_renderAssociatedFeatureList(t){return t.map(t=>this._renderAssociatedFeature(t))}_renderLayerItem(t,e){const{associatedFeatureInfos:s}=t,o=s.get(e)?.length??0;return r("calcite-list-item",{expanded:!0,key:`${e.id}-show-all`,label:e.title??this.messagesCommon.untitled,value:e.id,onCalciteListItemSelect:()=>this._showAllAssociations(e)},r("calcite-chip",{label:o.toString(),scale:"s",slot:"content-end"},o),r("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}async _selectAssociation(t){this._isLoadingSelectFeature||(this._isLoadingSelectFeature=!0,await this.onSelectFeature({feature:t.feature,association:t.association}),this._isLoadingSelectFeature=!1)}_showAllAssociations(t){this.onSelectLayer({layer:t,associationInput:this.associationInput})}};t([s()],U.prototype,"associatedFeatureCount",null),t([s({type:i})],U.prototype,"associationInput",void 0),t([s()],U.prototype,"headingLevel",void 0),t([s(),j("esri/widgets/FeatureForm/t9n/FeatureForm")],U.prototype,"messagesFeatureForm",void 0),t([s({constructOnly:!0})],U.prototype,"onSelectLayer",void 0),t([s({constructOnly:!0})],U.prototype,"onSelectFeature",void 0),t([s({constructOnly:!0})],U.prototype,"onAddAssociation",void 0),t([s({type:d})],U.prototype,"viewModel",void 0),t([s({type:S,nonNullable:!0})],U.prototype,"visibleElements",void 0),U=t([o("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.FeatureFormUtilityNetworkAssociationList")],U);const v=U;export{v as default};
