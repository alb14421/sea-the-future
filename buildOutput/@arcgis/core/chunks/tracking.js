/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as e}from"./Logger.js";import{p as s,g as t}from"./utils.js";const n={Dirty:1,Overridden:2,Computing:4,NonNullable:8,HasDefaultValue:16,DepTrackingInitialized:32,AutoTracked:64,ExplicitlyTracking:128};class i{constructor(e){this.accessed=void 0,this._handles=void 0,this._observer=e}destroy(){this.accessed?.clear(),this.clear()}onAccessed(e){null!=this._observer&&e!==this._observer&&(null==this.accessed&&(this.accessed=new Set),this.accessed.add(e))}onTrackingEnd(){null!=this._observer&&(this.clear(),null!=this.accessed&&(null==this._handles&&(this._handles=[]),this.accessed.forEach(e=>{this._handles.push(e.observe(this._observer))}),this.accessed.clear()))}clear(){if(null!=this._handles){for(let e=0;e<this._handles.length;++e)this._handles[e].remove();this._handles.length=0}}}const r=new i,a=[];let c=r;function l(e){c.onAccessed(e)}let o=!1,h=!1;function d(e,s,t){if(o)return g(e,s,t);let n=null;return f(e),n=s.call(t),p(),n}function u(e,s){return d(r,e,s)}function g(s,t,n){const i=o;o=!0,f(s);let r=null;try{r=t.call(n)}catch(s){h&&e.getLogger("esri.core.accessorSupport.tracking").error(s)}return p(),o=i,r}function f(e){c=e,a.push(e)}function p(){const e=a.length;if(e>1){const s=a.pop();c=a[e-2],s.onTrackingEnd()}else if(1===e){const e=a.pop();c=r,e.onTrackingEnd()}else c=r}function k(e,s){if(s.flags&n.DepTrackingInitialized)return;s.flags|=n.DepTrackingInitialized;const t=h;h=!1,s.flags&n.AutoTracked?g(s.trackingTarget,s.metadata.get,e):y(e,s),h=t}const T=[];function y(e,t){t.flags&n.ExplicitlyTracking||(t.flags|=n.ExplicitlyTracking,g(t.trackingTarget,()=>{const n=t.metadata.dependsOn||T;for(const t of n)if("string"!=typeof t||t.includes(".")){const n=s(t);for(let s=0,t=e;s<n.length&&null!=t&&"object"==typeof t;++s)t=_(t,n[s],s!==n.length-1)}else _(e,t,!1)}),t.flags&=-129)}function _(e,s,n){const i=s.endsWith("?")?s.slice(0,-1):s;if(null!=e.getItemAt||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=t(e);if(r){const s=r.propertiesByName.get(i);s&&(l(s),k(e,s))}return n?e[i]:void 0}export{n as F,i as T,y as a,u as b,k as i,d as r,l as t};
