/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{m as t}from"./handleUtils.js";import{M as e}from"../core/scheduling.js";import{g as r}from"./grouping.js";function i(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.pop();return o.push(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}class a{constructor(t,e,r,i){this._animation=t,this._repeatType=r,this._onFrameData=i,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;e>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case"None":this._currentFrame-=this._direction;break;case"Loop":this._currentFrame=0;break;case"Oscillate":this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case"None":this._currentFrame-=this._direction;break;case"Loop":this._currentFrame=this._animation.frameDurations.length-1;break;case"Oscillate":this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function n(n,o,s,m){const u=null==o.playAnimation||o.playAnimation,h=function(t,n,o,s){let m,{repeatType:u}=n;if(null==u&&(u="Loop"),!0===n.reverseAnimation&&(t=function(t){const{width:e,height:r}=t,i=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:i,getFrame:e=>{const r=t.frameDurations.length-1-e;return t.getFrame(r)},width:e,height:r}}(t)),null!=n.duration&&(t=function(t,r){const{width:i,height:a,getFrame:n}=t,o=r/t.duration,s=t.frameDurations.map(t=>e(t*o));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:n,width:i,height:a}}(t,e(1e3*n.duration))),null!=n.repeatDelay){const r=1e3*n.repeatDelay;"Loop"===u?t=i(t,e(r)):"Oscillate"===u&&(t=function(t,r){const{width:i,height:a,getFrame:n}=t,o=t.frameDurations.slice(),s=o.shift();return o.unshift(e(s+r)),{frameCount:t.frameCount,duration:t.duration+r,frameDurations:o,getFrame:n,width:i,height:a}}(i(t,e(r/2)),e(r/2)))}if(null!=n.startTimeOffset)m=e(1e3*n.startTimeOffset);else if(null!=n.randomizeStartTime){const i=82749913,a=null!=n.randomizeStartSeed?n.randomizeStartSeed:i,s=r(o,a);m=e(s*function(t){return e(t.frameDurations.reduce((t,e)=>t+e,0))}(t))}else m=e(0);return new a(t,m,u,s)}(n,o,s,m);let c,f=h.timeToFrame;return function t(){c=u?setTimeout(()=>{h.nextFrame(),f=h.timeToFrame,t()},f):void 0}(),t(()=>u&&clearTimeout(c))}export{n as p};
