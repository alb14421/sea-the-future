/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../config.js";import{version as t}from"../kernel.js";import{A as n,T as r,D as i,a}from"./TimeOnly.js";import{A as s}from"./enum.js";import{isPromiseLike as o}from"../core/promiseUtils.js";import{I as u}from"./ImmutableArray.js";import l from"../geometry/Point.js";import{e as f,a as c}from"./shared2.js";import{f as m,p as h}from"./number2.js";import d from"../geometry/Extent.js";import y from"../geometry/Geometry.js";import p from"../geometry/Multipoint.js";import g from"../geometry/Polygon.js";import b from"../geometry/Polyline.js";import S from"../geometry/SpatialReference.js";import{i as N}from"./coordsUtils.js";import{fromJSON as Z}from"../geometry/support/jsonUtils.js";import{a as _}from"./locale.js";import{e as T,a as x,c as C,b as k,i as A,d as D,f as O}from"./guards.js";import{D as j}from"./datetime.js";class w{}class F{constructor(){}}function M(e,t,n){if(e instanceof F&&!(e instanceof J)){const r=new J;return r.fn=e,r.parameterEvaluator=n,r.context=t,r}return e}class R extends F{constructor(e){super(),this.fn=e}createFunction(e){return(...t)=>this.fn(e,{preparsed:!0,arguments:t})}call(e,t){return this.fn(e,t)}marshalledCall(e,t,n,r){return r(e,t,(t,i,a)=>{a=a.map(t=>t instanceof F&&!(t instanceof J)?M(t,e,r):t);const s=this.call(n,{args:a});return o(s)?s.then(e=>M(e,n,r)):s})}}class J extends F{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,t){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}marshalledCall(e,t,n){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}}class v extends u{constructor(e,t,n,r,i,a){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=n,this._hasM=r,this._cacheId=i,this._partId=a}get(e){if(void 0===this._lazyPt[e]){const t=this._elements[e];if(void 0===t)return;const n=new l(t[0],t[1],this._spRef);this._hasZ&&(n.z=t[2]),this._hasM&&(n.m=this._hasZ?t[3]:t[2]),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=n}return this._lazyPt[e]}equalityTest(e){return e===this||null!==e&&e instanceof v!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class I extends u{constructor(e,t,n,r,i){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=n,this._hasM=r,this._spRef=t,this._cacheId=i}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new v(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&e instanceof I!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class P{constructor(e){this.value=e}}class Y{constructor(e){this.value=e}}const L={type:"VOID"},G=Symbol("BREAK"),z=Symbol("CONTINUE");function q(e,t,n){return""===t||null==t||t===n||t===n?e:e=e.split(t).join(n)}function V(e){return e instanceof F}function U(e){return e instanceof w}function H(e){return!!(C(e)||x(e)||ae(e)||se(e)||oe(e)||T(e)||null===e||e===L||"number"==typeof e)}function E(e,t){return void 0===e?t:e}function $(e){return null==e?"":k(e)||ie(e)?"Array":ae(e)?"Date":oe(e)?"Time":se(e)?"DateOnly":C(e)?"String":T(e)?"Boolean":x(e)?"Number":"esri.arcade.Attachment"===e?.declaredClass?"Attachment":"esri.arcade.Portal"===e?.declaredClass?"Portal":"esri.arcade.Dictionary"===e?.declaredClass?"Dictionary":re(e)?"KnowledgeGraph":e instanceof w?"Module":K(e)?"Feature":e instanceof l?"Point":e instanceof g?"Polygon":e instanceof b?"Polyline":e instanceof p?"Multipoint":e instanceof d?"Extent":V(e)?"Function":X(e)?"FeatureSet":ne(e)?"FeatureSetCollection":Q(e)?"Voxel":e===L?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognized Type"}function W(e){return e===L}function B(e){return e instanceof y}function K(e){return"esri.arcade.Feature"===e?.arcadeDeclaredClass}function Q(e){return"esri.arcade.Voxel"===e?.arcadeDeclaredClass}function X(e){return"esri.arcade.featureset.support.FeatureSet"===e?.declaredRootClass}function ee(e){return"esri.arcade.Dictionary"===e?.declaredClass}function te(e){return ee(e)||K(e)||Q(e)}function ne(e){return"esri.arcade.featureSetCollection"===e?.declaredRootClass}function re(e){return"esri.rest.knowledgeGraph.KnowledgeGraph"===e?.declaredClass}function ie(e){return e instanceof u}function ae(e){return e instanceof n}function se(e){return e instanceof i}function oe(e){return e instanceof r}function ue(e){return null!=e&&"object"==typeof e}function le(e,t,n,r,i){if(e.length<t||e.length>n)throw new s(r,"WrongNumberOfParameters",i)}function fe(e){return e<0?-Math.round(-e):Math.round(e)}function ce(e,t){return isNaN(e)||null==t||""===t?e.toString():(t=q(t,"‰",""),t=q(t,"¤",""),m(e,{pattern:t}))}function me(e,t){return null==t||""===t?e.toISOString(!0):e.toFormat(he(t),{locale:_(),numberingSystem:"latn"})}function he(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const i of e.match(r)||[])switch(i){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=i;break;default:i.length>=2&&i.startsWith("[")&&i.endsWith("]")?n+=`'${i.slice(1,-1)}'`:n+=`'${i}'`}return n}function de(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function ye(e,t,r){if(null===e){if(null===t||t===L)return de(null,null,r);if(x(t))return de(0,t,r);if(C(t))return de(0,_e(t),r);if(T(t))return de(0,_e(t),r);if(ae(t))return de(0,t.toNumber(),r);if(oe(t))return de(e,t.toNumber(),r);if(se(t))return de(e,t.toNumber(),r)}if(e===L){if(null===t||t===L)return de(null,null,r);if(x(t))return de(0,t,r);if(C(t))return de(0,_e(t),r);if(T(t))return de(0,_e(t),r);if(ae(t))return de(0,t.toNumber(),r);if(oe(t))return de(e,t.toNumber(),r);if(se(t))return de(e,t.toNumber(),r)}else if(x(e)){if(x(t))return de(e,t,r);if(T(t))return de(e,_e(t),r);if(null===t||t===L)return de(e,0,r);if(C(t))return de(e,_e(t),r);if(ae(t))return de(e,t.toNumber(),r);if(oe(t))return de(e,t.toNumber(),r);if(se(t))return de(e,t.toNumber(),r)}else if(C(e)){if(C(t))return de(be(e),be(t),r);if(ae(t))return de(_e(e),t.toNumber(),r);if(oe(t))return de(_e(e),t.toNumber(),r);if(se(t))return de(_e(e),t.toNumber(),r);if(x(t))return de(_e(e),t,r);if(null===t||t===L)return de(_e(e),0,r);if(T(t))return de(_e(e),_e(t),r)}else if(ae(e)){if(ae(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=n.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=n.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),de(e.toNumber(),t.toNumber(),r);if(null===t||t===L)return de(e.toNumber(),0,r);if(x(t))return de(e.toNumber(),t,r);if(T(t))return de(e.toNumber(),_e(t),r);if(C(t))return de(e.toNumber(),_e(t),r);if(oe(t))throw new s(null,"CannotCompareDateAndTime",null);if(se(t))return de(e.toNumber(),t.toNumber(),r)}else if(T(e)){if(T(t))return de(e,t,r);if(x(t))return de(_e(e),_e(t),r);if(ae(t))return de(_e(e),t.toNumber(),r);if(oe(t))return de(_e(e),t.toNumber(),r);if(se(t))return de(_e(e),t.toNumber(),r);if(null===t||t===L)return de(_e(e),0,r);if(C(t))return de(_e(e),_e(t),r)}else if(se(e)){if(ae(t))return de(e.toNumber(),t.toNumber(),r);if(null===t||t===L)return de(e.toNumber(),0,r);if(x(t))return de(e.toNumber(),t,r);if(T(t))return de(e.toNumber(),_e(t),r);if(C(t))return de(e.toNumber(),_e(t),r);if(oe(t))throw new s(null,"CannotCompareDateAndTime",null);if(se(t))return de(e.toNumber(),t.toNumber(),r)}else if(oe(e)){if(ae(t))throw new s(null,"CannotCompareDateAndTime",null);if(null===t||t===L)return de(e.toNumber(),0,r);if(x(t))return de(e.toNumber(),t,r);if(T(t))return de(e.toNumber(),_e(t),r);if(C(t))return de(e.toNumber(),_e(t),r);if(oe(t))return de(e.toNumber(),t.toNumber(),r);if(se(t))throw new s(null,"CannotCompareDateAndTime",null)}return!!pe(e,t)&&("<="===r||">="===r)}function pe(e,t){if(e===t)return!0;if(null===e&&t===L||null===t&&e===L)return!0;if(ae(e)&&ae(t))return e.equals(t);if(oe(e)&&oe(t))return e.equals(t);if(se(e)&&se(t))return e.equals(t);if(e instanceof I)return e.equalityTest(t);if(e instanceof v)return e.equalityTest(t);if(e instanceof l&&t instanceof l){const n=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(null!=n)return n===r}if(ue(e)&&ue(t)){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function ge(e,{useNumbersForDates:t}){let n="";for(const r in e){""!==n&&(n+=",");const i=e[r];null==i?n+=JSON.stringify(r)+":null":T(i)||x(i)||C(i)?n+=JSON.stringify(r)+":"+JSON.stringify(i):B(i)?n+=JSON.stringify(r)+":"+Ne(i):oe(i)||se(i)?n+=`${JSON.stringify(r)}:${JSON.stringify(i.toString())}`:ie(i)||Array.isArray(i)?n+=JSON.stringify(r)+":"+Ne(i,null,t):ae(i)?n+=t?JSON.stringify(r)+":"+JSON.stringify(i.getTime()):JSON.stringify(r)+":"+i.stringify():null!==i&&"object"==typeof i&&"castToText"in i&&(n+=JSON.stringify(r)+":"+i.castToText(t))}return"{"+n+"}"}function be(e,t){if(C(e))return e;if(null===e)return"";if(x(e))return ce(e,t);if(T(e))return e.toString();if(ae(e))return me(e,t);if(oe(e))return e.toFormat(t);if(se(e))return e.toFormat(t);if(e instanceof y)return JSON.stringify(e.toJSON());if(k(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=Ze(e[n]);return"["+t.join(",")+"]"}if(e instanceof u){const t=[];for(let n=0;n<e.length();n++)t[n]=Ze(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText():V(e)?"object, Function":e===L?"":U(e)?"object, Module":""}function Se(e){const t=[];if(e instanceof u){for(let n=0;n<e.length();n++)t[n]=_e(e.get(n));return t}if(!k(e))return null;for(let n=0;n<e.length;n++)t[n]=_e(e[n]);return t}function Ne(e,t,n=!1){if(C(e))return e;if(null===e)return"";if(x(e))return ce(e,t);if(T(e))return e.toString();if(ae(e))return me(e,t);if(oe(e))return e.toFormat(t);if(se(e))return e.toFormat(t);if(e instanceof y)return e instanceof d?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+we(e.spatialReference)+"}":we(e.toJSON(),(e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0);if(k(e)){const t=[];for(let r=0;r<e.length;r++)t[r]=Ze(e[r],n);return"["+t.join(",")+"]"}if(e instanceof u){const t=[];for(let r=0;r<e.length();r++)t[r]=Ze(e.get(r),n);return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText(n):V(e)?"object, Function":e===L?"":U(e)?"object, Module":""}function Ze(e,t=!1){if(null===e)return"null";if(T(e)||C(e))return JSON.stringify(e);if(x(e))return e.toString();if(e instanceof y)return Ne(e,null,t);if(e instanceof u)return Ne(e,null,t);if(Array.isArray(e))return Ne(e,null,t);if(ae(e))return t?JSON.stringify(e.getTime()):JSON.stringify(me(e,""));if(oe(e))return JSON.stringify(e.toString());if(se(e))return JSON.stringify(e.toString());if(null!==e&&"object"==typeof e){if("castToText"in e)return e.castToText(t)}else if(e===L)return"null";return"null"}function _e(e,t){return x(e)?e:null===e||""===e?0:ae(e)||se(e)||oe(e)?NaN:T(e)?e?1:0:k(e)||""===e||void 0===e?NaN:void 0!==t&&C(e)?(t=q(t,"‰",""),t=q(t,"¤",""),h(e,{pattern:t})):e===L?0:Number(e)}function Te(e,t){if(ae(e))return e;if(C(e)){const r=function(e,t){const n=/ (\d\d)/,r=a(t);let i=j.fromISO(e,{zone:r});return i.isValid||n.test(e)&&(e=e.replace(n,"T$1"),i=j.fromISO(e,{zone:t}),i.isValid)?i:null}(e,t);if(r)return n.dateTimeToArcadeDate(r)}return null}function xe(e){return T(e)?e:C(e)?"true"===(e=e.toLowerCase()):!!x(e)&&0!==e&&!isNaN(e)}function Ce(e,t){return null==e?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function ke(e){if(null===e)return null;if(e instanceof l)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof g){if(0===(e.curveRings??e.rings).length)return null;for(const t of e.curveRings??e.rings)if(t.length>0)return e;return null}if(e instanceof b){if(0===(e.curvePaths??e.paths).length)return null;for(const t of e.curvePaths??e.paths)if(t.length>0)return e;return null}return e instanceof p?0===e.points.length?null:e:e instanceof d?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function Ae(e,t){if(!e)return t;if(!e.domain)return t;let n=null,r=null;if(ae(t))n=t.toNumber();else if(se(t))n=t.toString();else if(oe(t))n=t.toStorageString();else if("string"===e.field.type||"esriFieldTypeString"===e.field.type)n=be(t);else{if(null==t)return null;if(""===t)return t;n=_e(t)}for(let t=0;t<e.domain.codedValues.length;t++){const i=e.domain.codedValues[t];i.code===n&&(r=i)}return null===r?be(t):r.name}function De(e,t){if(!e)return t;if(!e.domain)return t;let n=null;const r=be(t);for(let t=0;t<e.domain.codedValues.length;t++){const i=e.domain.codedValues[t];i.name===r&&(n=i)}return null===n?t:n.code}function Oe(e,t,n=null,r=null){if(!t)return null;if(!t.fields)return null;let i,a,o=null;for(let n=0;n<t.fields.length;n++){const r=t.fields[n];r.name.toLowerCase()===e.toString().toLowerCase()&&(o=r)}if(null===o)throw new s(null,"FieldNotFound",null,{key:e});let u=t.typeIdField,l="id",f=t.types;if(t.subtypeField&&(u=t.subtypeField,l="code",f=t.subtypes??[]),null===r&&n&&u)r=n.hasField(u)?n.field(u):null;else if(u&&null!==r){let e=!1;for(const t of f||[])if(r===t[l]){e=!0;break}if(!e)for(const t of f||[])if(r===t.name){r=t[l],e=!0;break}e||(r=null,n&&u&&(r=n.hasField(u)?n.field(u):null))}return null!=r&&f.some(e=>e[l]===r&&(i=e.domains?.[o.name],i&&"inherited"===i.type&&(i=je(o.name,t),a=!0),!0)),a||i||(i=je(e,t)),{field:o,domain:i}}function je(e,t){let n;return t.fields.some(t=>(t.name.toLowerCase()===e.toLowerCase()&&(n=t.domain),!!n)),n}function we(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(i=t.cmp,function(e){return function(t,n){const r={key:t,value:e[t]},a={key:n,value:e[n]};return i(r,a)}});var i;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let i,s;if(Array.isArray(t)){for(s="[",i=0;i<t.length;i++)i&&(s+=","),s+=e(t[i])||"null";return s+"]"}if(null===t)return"null";if(a.includes(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const o=a.push(t)-1,u=Object.keys(t).sort(r?.(t));for(s="",i=0;i<u.length;i++){const n=u[i],r=e(t[n]);r&&(s&&(s+=","),s+=JSON.stringify(n)+":"+r)}return a.splice(o,1),"{"+s+"}"}(e)}function Fe(e){if(null===e)return null;const t=[];for(const n of e)K(n)?t.push(n.geometry()):t.push(n);return t}function Me(e,t){if(!(t instanceof l))throw new s(null,"InvalidParameter",null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Re(e,t){if(k(e)||ie(e)){let n=!1,r=!1,i=[],a=t;if(k(e)){for(const t of e)Me(i,t);i.length>0&&(a=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof v)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else{if(!ie(e))throw new s(null,"InvalidParameter",null);for(const t of e.toArray())Me(i,t);i.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:(N(i)||(i=i.slice().reverse()),new g({rings:[i],spatialReference:a,hasZ:n,hasM:r}))}return e}function Je(e,t){if(k(e)||ie(e)){let n=!1,r=!1,i=[],a=t;if(k(e)){for(const t of e)Me(i,t);i.length>0&&(a=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof v)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(ie(e)){for(const t of e.toArray())Me(i,t);i.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new b({paths:[i],spatialReference:a,hasZ:n,hasM:r})}return e}function ve(e,t){if(k(e)||ie(e)){let n=!1,r=!1,i=[],a=t;if(k(e)){for(const t of e)Me(i,t);i.length>0&&(a=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof v)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(ie(e)){for(const t of e.toArray())Me(i,t);i.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new p({points:i,spatialReference:a,hasZ:n,hasM:r})}return e}function Ie(e,t=!0){if(null==e)return[];if(k(e)){const n=[];for(const r of e){const e=be(r);(t||""!==e)&&n.push(e)}return n}if(ie(e)){const n=[];for(let r=0;r<e.length();r++){const i=be(e.get(r));(t||""!==i)&&n.push(i)}return n}if(H(e)){const n=be(e);if(t||""!==n)return[n]}return[]}let Pe=0;function Ye(e){return Pe++,Pe%100==0?(Pe=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function Le(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function Ge(e,t=null){return null==e?null:T(e)||x(e)||C(e)?e:e instanceof y?!0===t?.keepGeometryType?e:e.toJSON():e instanceof u?e.toArray().map(e=>Ge(e,t)):Array.isArray(e)?e.map(e=>Ge(e,t)):A(e)?e:ae(e)?e.toJSDate():oe(e)?e.toString():se(e)?e.toJSDate():null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}async function ze(e,t,n,r,i){const a=await qe(e,t,n);i[r]=a}async function qe(e,t=null,n=null){if(e instanceof u&&(e=e.toArray()),null==e)return null;if(H(e)||e instanceof y||A(e)||ae(e))return Ge(e,n);if(Array.isArray(e)){const r=[],i=[];for(const a of e)null===a||H(a)||a instanceof y||A(a)||ae(a)?i.push(Ge(a,n)):(i.push(null),r.push(ze(a,t,n,i.length-1,i)));return r.length>0&&await Promise.all(r),i}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(t,n):null}function Ve(e){return Ue(e)?e.parent:e}function Ue(e){return e&&"declaredClass"in e&&"esri.layers.support.SubtypeSublayer"===e.declaredClass}function He(e,t,n){const r=Ve(e.fullSchema());return null===r?null:r.fields?Oe(t,r,e,n):null}function Ee(e){const t=Ve(e.fullSchema());return null===t?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map(e=>({name:e.name,code:e.code})):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(e=>({name:e.name,code:e.id})):[]}:null:null}function $e(e,t,n,r){const i=Ve(e.fullSchema());if(null===i)return null;if(!i.fields)return null;const a=Oe(t,i,e,r);if(void 0===n)try{n=e.field(t)}catch(e){return null}return Ae(a,n)}function We(e,t,n,r){const i=Ve(e.fullSchema());if(null===i)return null;if(!i.fields)return null;if(void 0===n){try{n=e.field(t)}catch(e){return null}return n}return De(Oe(t,i,e,r),n)}function Be(e){return e?.timeZone??"system"}function Ke(e){const t=Ve(e.fullSchema());if(null===t)return null;if(!t.fields)return null;const n=[];for(const e of t.fields)n.push(f(e));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:void 0===c[t.geometryType]?"":c[t.geometryType],fields:n}}function Qe(r,i){const a=n.systemTimeZoneCanonicalName;return"system"===r&&(r=a),{version:Xe,engineVersion:t,timeZone:r,userTimeZone:a,spatialReference:i instanceof S?i.toJSON():i,application:e.applicationName??"",engine:"web",locale:_()}}const Xe="1.32",et=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Y,ReturnResult:P,absRound:fe,arcadeVersion:Xe,autoCastArrayOfPointsToMultiPoint:ve,autoCastArrayOfPointsToPolygon:Re,autoCastArrayOfPointsToPolyline:Je,autoCastFeatureToGeometry:Fe,binaryOperator:Le,breakResult:G,castAsJson:Ge,castAsJsonAsync:qe,castRecordToText:ge,continueResult:z,defaultExecutingContext:Qe,defaultTimeZone:Be,defaultUndefined:E,equalityTest:pe,featureDomainCodeLookup:We,featureDomainValueLookup:$e,featureFullDomain:He,featureSchema:Ke,featureSubtypes:Ee,fixNullGeometry:ke,fixSpatialReference:Ce,formatDate:me,formatNumber:ce,getDomain:Oe,getDomainCode:De,getDomainValue:Ae,getType:$,greaterThanLessThan:ye,isArray:k,isBoolean:T,isDate:ae,isDateOnly:se,isDictionary:ee,isDictionaryLike:te,isFeature:K,isFeatureSet:X,isFeatureSetCollection:ne,isFunctionParameter:V,isGeometry:B,isGraphic:D,isImmutableArray:ie,isInteger:O,isJsDate:A,isKnowledgeGraph:re,isModule:U,isNumber:x,isObject:ue,isSimpleType:H,isString:C,isSubtypeGrouplayer:function(e){return e&&"declaredClass"in e&&"esri.layers.SubtypeGroupLayer"===e.declaredClass},isSubtypeSublayer:Ue,isTime:oe,isVoid:W,isVoxel:Q,multiReplace:q,parseGeometryFromJson:function(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),Z(n)},pcCheck:le,stableStringify:we,standardiseDateFormat:he,tick:Ye,toBoolean:xe,toDate:Te,toNumber:_e,toNumberArray:Se,toString:be,toStringArray:Ie,toStringExplicit:Ne,voidOperation:L},Symbol.toStringTag,{value:"Module"}));export{Ye as $,w as A,F as B,M as C,Fe as D,Ce as E,Re as F,Je as G,ve as H,Y as I,xe as J,E as K,Be as L,Te as M,R as N,Ie as O,q as P,He as Q,P as R,J as S,Oe as T,Ee as U,$e as V,Ae as W,We as X,De as Y,Ne as Z,Ke as _,H as a,Ue as a0,v as a1,I as a2,$ as a3,he as a4,fe as a5,ke as a6,Q as a7,Se as a8,Qe as a9,et as aa,B as b,ie as c,K as d,ne as e,X as f,ee as g,re as h,ae as i,V as j,ge as k,Ge as l,qe as m,se as n,oe as o,W as p,G as q,z as r,le as s,pe as t,_e as u,L as v,be as w,ye as x,Le as y,te as z};
