/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import t from"../core/Error.js";import{m as n}from"./handleUtils.js";import{createResolver as s}from"../core/promiseUtils.js";import{b as e,g as r,a as o}from"./locale.js";const i={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function a(t){if(function(t){return t in i}(t)){const n=i[t];return!0===n?t:n}return null}const d=[],c=new Map;function l(t){for(const n of c.keys())m(t.pattern,n)&&c.delete(n)}function h(t){return d.includes(t)||(l(t),d.unshift(t)),n(()=>{const n=d.indexOf(t);n>-1&&(d.splice(n,1),l(t))})}async function u(n){const s=o();c.has(n)||c.set(n,async function(n,s){const e=[];for(const t of d)if(m(t.pattern,n))try{return await t.fetchMessageBundle(n,s)}catch(t){e.push(t)}if(e.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${n}"`,{errors:e});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${n}"`)}(n,s));const e=c.get(n);return e&&await p.add(e),e}function f(t){const n=r(t);return n?a(t)??a(n):null}function m(t,n){return"string"==typeof t?n.startsWith(t):t.test(n)}e(()=>{c.clear()});const p=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=s())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}};export{u as f,f as n,h as r};
