/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../intl.js";import"../core/lang.js";import e from"../core/Error.js";import{c as t}from"./mathUtils.js";import{a as n,b as o,d as a,f as l,c as r}from"./date.js";import{t as s,b as i,d as u,T as m,c as f,e as c}from"../layers/support/fieldUtils.js";import{c as d,a as p}from"./guards.js";import{a as y}from"./constants.js";import{D as h,F as v}from"./datetime.js";import{a as O}from"./locale.js";const w=y,S={date:null,time:null,timeZoneOffset:null},g=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),j="latn",Z=new Set(["date-only","time-only","timestamp-offset"]);function x(e){return{locale:O(),numberingSystem:j,zone:e??w}}function b(e,t){return null==e?null:h.fromMillis(e,x(t))}function I(e,t){if(null==e||!d(e)||""===e){if(t){const e=h.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return S}const n=h.fromISO(e,{setZone:!0});return{date:n.toFormat(f,x()),time:n.toFormat(m.HMS_MS,x()),timeZoneOffset:n.offset.toString()}}function M(e,t){if(null==e||!p(e)||isNaN(e))return S;const n=b(e,t);return n?{date:n.toFormat(f,x(t)),time:n.toFormat(c,x(t))}:S}function F(e){switch(e.type){case"date":default:return r("short-date-short-time");case"date-only":return r("short-date");case"time-only":return r("short-time");case"timestamp-offset":return{...r("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function C(e,t,r){if(!e||null==t)return null;switch(e.type){case"date":return l(t,r);case"date-only":return a(t,r);case"time-only":return o(t,r);case"timestamp-offset":return n(t,r);default:return null}}function D(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:o,timeZoneComponent:a,oldValue:l}=e;if(!t?.value)return null;const{year:r,month:s,day:i}=h.fromFormat(t.value,f),{hour:u,minute:m,second:c,millisecond:d}=V(o,y)??h.now(),p=I(l,n),O=""===a?.value?null:a?.value,w=O?parseInt(O,10):null!=p.timeZoneOffset?parseInt(p.timeZoneOffset,10):(new Date).getTimezoneOffset(),S=v.instance(w),g=h.fromObject({year:r,month:s,day:i,hour:u,minute:m,second:c,millisecond:d},{zone:S});return g.isValid?g.toISO({includeOffset:!0}):null}function T(e){const{dateComponent:t,timeComponent:n,timeZone:o,max:a,min:l,oldValue:r}=e,s=V(t,o);let i=!!e.applyRange;if(!s)return null;let u=null;if(null!=n?.value){const e=V(n,o),t=Date.now(),l=null!=a&&a<t?a:t,r=h.fromMillis(l,x(o)),i=s||r,{year:m,month:f,day:c}=i,{hour:d,minute:p,second:y,millisecond:v}=e||r;u=i.set({year:m,month:f,day:c,hour:d,minute:p,second:y,millisecond:v})}else{const e=b(z({value:r??Date.now(),max:a,min:l}),o),{year:t,month:n,day:m}=s,{hour:f,minute:c,second:d,millisecond:p}=e;i=!0,u=s.set({year:t,month:n,day:m,hour:f,minute:c,second:d,millisecond:p})}if(!u.isValid)return null;const m=u.toMillis();return i?z({value:m,max:a,min:l}):m}function V(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=(e=>"valueAsDate"in e)(e)?h.fromFormat(e.value,f,x(t)):i(e.value),n?.isValid?n:null}function N(e){const{max:t,min:n,value:o}=e;return!(isNaN(o)||null!=t&&o>t||null!=n&&o<n)}function z(e){const{max:n,min:o,value:a}=e;return null!=n&&null!=o?t(a,o,n):null!=n&&a>n?n:null!=o&&a<o?o:a}function A(t){if(!t)return"";const n=t.split(".").at(0);if(!n||n.length<1)throw new e("invalid time-only field",`Cannot parse valid time-only field value from ${t}`);const o=n.split(":"),a=new Array(3);for(let e=0;e<3;e++){const t=o.at(e)??"";a[e]=t.padStart(2,"0")}return a.join(":")}function k(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return A(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function U(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function E(e){const{type:t,range:n,value:o}=e;if(null==o||!n||o===n.min||o===n.max)return!0;if("date"===t)return N({value:o,min:n.min,max:n.max});const{rawMax:a,rawMin:l}=n;let r=null,m=null,f=null;switch(t){case"date-only":r=u(a),m=u(l),f=u(o);break;case"time-only":r=i(a),m=i(l),f=i(o);break;case"timestamp-offset":r=s(a),m=s(l),f=s(o)}return!f||N({value:f.valueOf(),min:m?.valueOf(),max:r?.valueOf()})}export{F as a,k as b,Z as c,E as d,T as e,D as f,C as g,M as h,U as i,x as j,j as k,A as n,I as p,g as t,N as v};
