/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as s}from"./Logger.js";import{g as i}from"./mathUtils.js";import{O as n,d as t}from"./ray.js";import{i as a,t as r,a as o}from"./mat4.js";import{c as e}from"./mat4f64.js";import{e as c,i as u,j as g,k as b,x as f,l,y as p,d as m,h as d,g as h,t as j,w as I,n as P}from"./vec3.js";import{f as v,b as N,c as w}from"./vec3f64.js";import{f as M}from"./aaBoundingRect.js";import{a as y,d as T,c as S}from"./lineSegment.js";import{c as x,w as _,a as A,b as E,d as O,i as V,e as B,h as F,j as C,p as L,g as R,s as Y}from"./plane.js";import{s as k,p as q}from"./vector.js";const U=()=>s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),z=class{constructor(){this.plane=x(),this.origin=w(),this.basis1=w(),this.basis2=w()}};function G(s=ps){return{plane:x(s.plane),origin:N(s.origin),basis1:N(s.basis1),basis2:N(s.basis2)}}function W(s,i=G()){return D(s.origin,s.basis1,s.basis2,i)}function D(s,i,n,t=G()){return c(t.origin,s),c(t.basis1,i),c(t.basis2,n),H(t),a=t,r="fromValues()",Math.abs(m(a.basis1,a.basis2)/(l(a.basis1)*l(a.basis2)))>1e-6&&U().warn(r,"Provided basis vectors are not perpendicular"),Math.abs(m(a.basis1,us(a)))>1e-6&&U().warn(r,"Basis vectors and plane normal are not perpendicular"),Math.abs(-m(us(a),a.origin)-a.plane[3])>1e-6&&U().warn(r,"Plane offset is not consistent with plane origin"),t;var a,r}function H(s){E(s.basis2,s.basis1,s.origin,s.plane)}function J(s,i,n){s!==n&&W(s,n);const t=u(k.get(),us(s),i);return g(n.origin,n.origin,t),n.plane[3]-=i,n}function K(s,i=G()){const n=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return b(i.origin,s[0]+n,s[1]+t,0),b(i.basis1,n,0,0),b(i.basis2,0,t,0),O(0,0,1,0,i.plane),i}function Q(s,i,n){return!!V(s.plane,i,n)&&gs(s,n)}function X(s,n,t){const a=ms.get();ls(s,n,a,ms.get());let r=Number.POSITIVE_INFINITY;for(const o of Is){const e=fs(s,o,ds.get()),u=k.get();if(B(a,e,u)){const s=p(k.get(),n.origin,u),a=Math.abs(i(m(n.direction,s)));a<r&&(r=a,c(t,u))}}return r===Number.POSITIVE_INFINITY?$(s,n,t):t}function Z(s,i){return(i-s)/i}function $(s,i,n){if(Q(s,i,n))return n;const a=ms.get(),r=ms.get();ls(s,i,a,r);let o=Number.POSITIVE_INFINITY;for(const e of Is){const u=fs(s,e,ds.get()),g=k.get();if(F(a,u,g)){const s=t(i,g);if(!C(r,g))continue;s<o&&(o=s,c(n,g))}}return ns(s,i.origin)<o&&ss(s,i.origin,n),n}function ss(s,i,n){const t=L(s.plane,i,k.get()),a=y(bs(s,s.basis1),t,-1,1,k.get()),r=y(bs(s,s.basis2),t,-1,1,k.get());return d(n,g(k.get(),a,r),s.origin),n}function is(s,i,n){const{origin:t,basis1:a,basis2:r}=s,o=d(k.get(),i,t),e=q(a,o),c=q(r,o),u=q(us(s),o);return b(n,e,c,u)}function ns(s,i){const n=is(s,i,k.get()),{basis1:t,basis2:a}=s,r=l(t),o=l(a),e=Math.max(Math.abs(n[0])-r,0),c=Math.max(Math.abs(n[1])-o,0),u=n[2];return e*e+c*c+u*u}function ts(s,i){return Math.sqrt(ns(s,i))}function as(s,i){return C(s.plane,i)&&gs(s,i)}function rs(s,i){const n=-s.plane[3];return q(us(s),i)-n}function os(s,i){return h(s.basis1,i.basis1)&&h(s.basis2,i.basis2)&&h(s.origin,i.origin)}function es(s,i,n){return s!==n&&W(s,n),a(Ps,i),r(Ps,Ps),j(n.basis1,s.basis1,Ps),j(n.basis2,s.basis2,Ps),j(R(n.plane),R(s.plane),Ps),j(n.origin,s.origin,i),Y(n.plane,n.plane,n.origin),n}function cs(s,i,n,t){return s!==t&&W(s,t),o(vs,i,n),j(t.basis1,s.basis1,vs),j(t.basis2,s.basis2,vs),H(t),t}function us(s){return R(s.plane)}function gs(s,i){const n=d(k.get(),i,s.origin),t=I(s.basis1),a=I(s.basis2),r=m(s.basis1,n),o=m(s.basis2,n);return-r-t<0&&r-t<0&&-o-a<0&&o-a<0}function bs(s,i){const n=ds.get();return c(n.origin,s.origin),c(n.vector,i),n}function fs(s,i,n){const{basis1:t,basis2:a,origin:r}=s,o=u(k.get(),t,i.origin[0]),e=u(k.get(),a,i.origin[1]);g(n.origin,o,e),g(n.origin,n.origin,r);const c=u(k.get(),t,i.direction[0]),b=u(k.get(),a,i.direction[1]);return u(n.vector,g(c,c,b),2),n}function ls(s,i,n,t){const a=us(s);E(a,i.direction,i.origin,n),E(R(n),a,i.origin,t)}const ps={plane:x(),origin:v(0,0,0),basis1:v(1,0,0),basis2:v(0,1,0)},ms=new n(x),ds=new n(S),hs=w(),js=new n(()=>G()),Is=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Ps=e(),vs=e(),Ns=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:z,altitudeAt:rs,axisAt:function(s,i,n,t){return function(s,i,n){switch(i){case 0:c(n,s.basis1),P(n,n);break;case 1:c(n,s.basis2),P(n,n);break;case 2:c(n,us(s))}return n}(s,n,t)},cameraFrustumCoverage:Z,closestPoint:$,closestPointOnSilhouette:X,copy:W,copyWithoutVerify:function(s,i){c(i.origin,s.origin),c(i.basis1,s.basis1),c(i.basis2,s.basis2),A(i.plane,s.plane)},create:G,distance:ts,distance2:ns,distanceToSilhouette:function(s,i){let n=Number.NEGATIVE_INFINITY;for(const t of Is){const a=fs(s,t,ds.get()),r=T(a,i);r>n&&(n=r)}return Math.sqrt(n)},elevate:J,equals:os,extrusionContainsPoint:as,fromAABoundingRect:K,fromValues:D,getExtent:function(s,i){const n=s.basis1[0],t=s.basis2[1],[a,r]=s.origin;return M(a-n,r-t,a+n,r+t,i)},intersectRay:Q,intersectRayClosestSilhouette:function(s,i,n){if(Q(s,i,n))return n;const t=X(s,i,k.get());return g(n,i.origin,u(k.get(),i.direction,f(i.origin,t)/l(i.direction))),n},normal:us,projectPoint:ss,projectPointLocal:is,rotate:cs,setAltitudeAt:function(s,i,n,t){const a=rs(s,i),r=u(hs,us(s),n-a);return g(t,i,r),t},setExtent:function(s,i,n){return K(i,n),J(n,rs(s,s.origin),n),n},transform:es,up:ps,updateUnboundedPlane:H,wrap:function(s,i,n){const t=js.get();return t.origin=s,t.basis1=i,t.basis2=n,t.plane=_(0,0,0,0),H(t),t}},Symbol.toStringTag,{value:"Module"}));export{z as B,W as a,Ns as b,G as c,K as d,ts as e,D as f,Z as g,as as h,Q as i,os as j,us as n,cs as r,es as t,H as u};
