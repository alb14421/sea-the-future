/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{g as t,m as e}from"./builderUtils.js";import{g as s,e as a,p as n,a as h,f as o,o as i,c as r}from"./shapeUtils.js";import{m as p}from"./createTemplateExecutor.js";import{execute as l}from"../geometry/operators/offsetOperator.js";import{isPolyline as f}from"../geometry/support/jsonUtils.js";function g({templatePart:r,edits:l,relationships:g,shape:c,distance:u,isProportional:d,offsetDistance:P,vertexBeforeOffset:j,vertexPlacement:x,mode:v}){const V=j||0===P?c:m(c,P);if(null===V||!f(V))return;const Z=t(V);P=j?P:0;let O=0,S=null,U=0;for(let t=0;t<V.paths.length;t++){if(l.length>p&&"digitizing"===v)return;const f=V.paths[t].length,m=t===V.paths.length-1;for(let c=0;c<f;c++){if(l.length>p&&"digitizing"===v)return;if(c>0&&0!==u&&(O+=V.hasZ?s(V.paths[t][c-1],V.paths[t][c],Z):a(V.paths[t][c-1],V.paths[t][c])),(0!==c||1!==x)&&!(c===f-1&&2===x&&m||(0===c||c===f-1&&m)&&3===x||0===c&&u<0&&d||c===f-1&&u>0&&d)){if(0!==u){let e=1;if(d){const n=u<0?c-1:c+1;if(n>=f||n<0)continue;e=V.hasZ?s(V.paths[t][c],V.paths[t][n],Z):a(V.paths[t][c],V.paths[t][n])}const o=O+e*u;S=V.hasZ?n(V,o,P,Z):h(V,o,0)}else S=o(V,t,c),0!==P&&(S=i(S,c===f-1?[V.paths[t][c-1],V.paths[t][c]]:[V.paths[t][c],V.paths[t][c+1]],P));S&&e({templatePart:r,shape:S,edits:l,relationships:g,mode:v},`V${(U+c).toString()}`)}}U+=f}}function m(t,e){return l(t,e,{unit:"meters",joins:"miter",miterLimit:2})}function c(t){let e=0;for(const s of t.paths)e+=s.length;return e}function u({templatePart:p,edits:l,relationships:g,shape:u,distance:d,isProportional:P,offsetDistance:j,vertexBeforeOffset:x,vertexPlacement:v,mode:V}){const Z=x||0===j?u:m(u,j);if(null===Z||!f(Z))return;const O=t(Z);j=x?j:0;let S=null,U="";if(0!==d){const t=4===v?0:Z.paths.length-1,e=4===v?0:Z.paths[Z.paths.length-1].length-1,o=4===v?0:r(Z),i=4===v?Z.paths[0].length:Z.paths[Z.paths.length-1].length;let p=1;if(P){const n=d<0?e-1:e+1;if(n>=i||n<0)return;p=Z.hasZ?s(Z.paths[t][e],Z.paths[t][n],O):a(Z.paths[t][e],Z.paths[t][n])}const l=o+p*d;S=Z.hasZ?n(Z,l,j,O):h(Z,l,j),U=4===v?"V0":`V${(c(Z)-1).toString()}`}else{if(S=4===v?o(Z,0,0):o(Z,Z.paths.length-1,Z.paths[Z.paths.length-1].length-1),0!==j)if(4===v)S=i(S,[Z.paths[0][0],Z.paths[0][1]],j);else{const t=Z.paths[Z.paths.length-1];S=i(S,[t[t.length-2],t[t.length-1]],j)}U=4===v?"V0":`V${(c(Z)-1).toString()}`}S&&e({templatePart:p,shape:S,edits:l,relationships:g,mode:V},U)}export{g as l,m as o,u as v};
