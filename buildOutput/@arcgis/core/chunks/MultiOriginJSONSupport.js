/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import r,{o as s,n as e,i}from"../core/Accessor.js";import{s as o,a as n,b as a}from"../core/JSONSupport.js";import{clone as h}from"../core/lang.js";import{g as u}from"./utils.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{g}from"./get.js";class p{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(s),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const r=new p,e=this._originStores[0];e&&e.forEach((t,s)=>{r.set(s,h(t),0)});for(let e=2;e<s;e++){const s=this._originStores[e];s&&s.forEach((s,i)=>{t&&t.has(i)||r.set(i,h(s),e)})}return r}get(t,r){const s=void 0===r?this._values:this._originStores[r];return s?s.get(t):void 0}keys(t){const r=null==t?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,s=7){let e=this._originStores[s];if(e||(e=new Map,this._originStores[s]=e),e.set(t,r),!this._values.has(t)||this._propertyOriginMap.get(t)<=s){const e=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,s),e!==r}return!1}delete(t,r=7){const s=this._originStores[r];if(!s)return;const e=s.get(t);if(s.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let s=r-1;s>=0;s--){const r=this._originStores[s];if(r&&r.has(t)){this._values.set(t,r.get(t)),this._propertyOriginMap.set(t,s);break}}}return e}has(t,r){const s=void 0===r?this._values:this._originStores[r];return!!s&&s.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const s=this._originStores[r],e=s?.get(t),i=this._values.get(t);return this._values.set(t,e),this._propertyOriginMap.set(t,r),i!==e}originOf(t){return this._propertyOriginMap.get(t)||0}isAtOrigin(t,r){return this.has(t,r)&&this.originOf(t)===r}isBelowOrigin(t,r){return!this.has(t)||this.originOf(t)<r}forEach(t){this._values.forEach(t)}}const l=r=>{const s=r;let a=class extends s{constructor(...t){super(...t);const r=u(this),s=r.store,e=new p;r.store=e,o(r,s,e)}read(t,r){n(this,t,r)}getAtOrigin(t,r){const s=f(this),i=e(r);if("string"==typeof t)return s.get(t,i);const o={};return t.forEach(t=>{o[t]=s.get(t,i)}),o}originOf(t){return i(this.originIdOf(t))}originIdOf(t){return f(this).originOf(t)}revert(t,r){const s=f(this),i=e(r),o=u(this);let n;n="string"==typeof t?"*"===t?s.keys(i):[t]:t,n.forEach(t=>{o.invalidate(t),s.revert(t,i),o.commit(t)})}};return a=t([c("esri.core.ReadOnlyMultiOriginJSONSupport")],a),a};function f(t){return u(t).store}const O=r=>{const i=r;let o=class extends i{constructor(...t){super(...t)}clear(t,r="user"){u(this).clearOrigin(t,e(r))}write(t,r){return a(this,t=t||{},r),t}setAtOrigin(t,r,s){u(this).setAtOrigin(t,r,e(s))}removeOrigin(t){const r=_(this),s=e(t),i=r.keys(s);for(const t of i)r.originOf(t)===s&&r.set(t,r.get(t,s),7)}updateOrigin(t,r){const i=_(this),o=e(r),n=g(this,t);for(let r=o+1;r<s;++r)i.delete(t,r);i.set(t,n,o)}toJSON(t){return this.write({},t)}};return o=t([c("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],o),o.prototype.toJSON.isDefaultToJSON=!0,o};function _(t){return u(t).store}const S=r=>{const s=O(l(r));let e=class extends s{constructor(...t){super(...t)}};return e=t([c("esri.core.MultiOriginJSONSupport")],e),e},v=S(r);export{S as M,v as a};
