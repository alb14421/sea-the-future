/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{p as e}from"./screenUtils.js";function t(t){const s=n(o(t)),i=s,a=Math.max(s/2,5),l=Math.round(e(t.maxPathLength)/a)+1,{density:r}=t;return{smoothing:e(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:l,minSpeedThreshold:.001,segmentLength:a,maxTurnAngle:1,collisions:!0,lineCollisionWidth:i,lineSpacing:10,density:r,geometries:t.geometries}}function n(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function s(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function i(e){return{kind:"constant",value:[.1,.1,.1,1]}}function o(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[e(t.trailWidth)]};const n=t.getVisualVariablesForType("size")[0],s=[],i=[];let o;if(n.stops){for(const t of n.stops)s.push(t.value),i.push(e(t.size));o=n.stops.length}else s.push(n.minDataValue,n.maxDataValue),i.push(e(n.minSize),e(n.maxSize)),o=2;return{kind:"ramp",stops:s,values:i,count:o}}function a(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:s(e.color)};const t=e.getVisualVariablesForType("color")[0],n=[],i=[];for(const e of t.stops)n.push(e.value),Array.prototype.push.apply(i,s(e.color));return{kind:"ramp",stops:n,values:i,count:t.stops.length}}function l(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],n=[],s=[];for(const e of t.stops)n.push(e.value),s.push(e.opacity);return{kind:"ramp",stops:n,values:s,count:t.stops.length}}function r(e,t,n,s){switch(t){case"int":e.setUniform1iv(n,s);break;case"float":e.setUniform1fv(n,s);break;case"vec2":e.setUniform2fv(n,s);break;case"vec3":e.setUniform3fv(n,s);break;case"vec4":e.setUniform4fv(n,s)}}function u(e,t,n,s){"constant"===s.kind?r(e,n,`u_${t}`,s.value):(r(e,"float",`u_${t}_stops`,s.stops),r(e,n,`u_${t}_values`,s.values),e.setUniform1i(`u_${t}_count`,s.count))}function c(e,t){let n=!0;return n=n&&e.collisions===t.collisions,n=n&&e.density===t.density,n=n&&e.interpolate===t.interpolate,n=n&&e.lineCollisionWidth===t.lineCollisionWidth,n=n&&e.lineSpacing===t.lineSpacing,n=n&&e.maxTurnAngle===t.maxTurnAngle,n=n&&e.minSpeedThreshold===t.minSpeedThreshold,n=n&&e.segmentLength===t.segmentLength,n=n&&e.smoothing===t.smoothing,n=n&&e.velocityScale===t.velocityScale,n=n&&e.verticesPerLine===t.verticesPerLine,n}function p(e,t){return e===t||null!=e&&null!=t&&e.equals(t)}function f(e,t){if(!c(e.simulationSettings,t.simulationSettings))return!1;if(!p(e.timeExtent,t.timeExtent))return!1;let n=!0;return n=n&&e.loadImagery===t.loadImagery,n=n&&e.createFlowMesh===t.createFlowMesh,n=n&&e.color.kind===t.color.kind,n=n&&e.opacity.kind===t.opacity.kind,n=n&&e.size.kind===t.size.kind,n}export{u as a,f as b,o as c,l as d,a as e,n as f,t as g,i as h,c as s,p as t};
