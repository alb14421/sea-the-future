/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../request.js";import r from"../core/Error.js";import{h as t}from"../core/lang.js";import{throwIfAbortError as s}from"../core/promiseUtils.js";import{removeFile as o,normalize as n}from"../core/urlUtils.js";import l from"../portal/Portal.js";import a from"../portal/PortalQueryParams.js";const f=new Map;function u(e,t,n){return null!=e?.styleUrl?async function(e,r){try{return{data:(await y(e,r)).data,baseUrl:o(e),styleUrl:e}}catch(e){return s(e),null}}(e.styleUrl,n):null!=e?.styleName?function(e,t,s){const o=null!=t.portal?t.portal:l.getDefault();let n;const u=`${o.url} - ${o.user?.username} - ${e}`,c=f.get(u);if(c)return c;const i=function(e,t,s){return t.load(s).then(()=>{const r=new a({disableExtraQuery:!0,query:`owner:${b} AND type:${p} AND typekeywords:"${e}"`});return t.queryItems(r,s)}).then(({results:t})=>{let o=null;const n=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const r=e.typeKeywords?.some(e=>e.toLowerCase()===n);if(r&&e.type===p&&e.owner===b){o=e;break}}if(!o)throw new r("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return o.load(s)})}(e,o,s).then(e=>(n=e,e.fetchData())).then(r=>({data:r,baseUrl:n.itemUrl??"",styleName:e}));return f.set(u,i),i}(e.styleName,t,n):Promise.reject(new r("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function c(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function i(e,r){for(const t of r)switch(t){case"cim":if(e.cimRef)return{format:t,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const r=m(e,"gltf_basisu");if(r)return{format:t,url:r};break}case"web-gltf":{const r=m(e,"gltf");if(r)return{format:t,url:r};break}case"web":{const r=m(e,"gltf");if(r)return{format:"web-gltf",url:r};if(e.webRef)return{format:t,url:encodeURI(e.webRef)};break}}}function m(e,r){if(!t("enable-feature:force-wosr"))return e.formatInfos?.find(e=>e.type===r)?.href}function y(r,t){const s={responseType:"json",query:{f:"json"},...t};return e(n(r),s)}const b="esri_en",p="Style",d="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{d as S,u as f,c as m,y as r,i as s};
