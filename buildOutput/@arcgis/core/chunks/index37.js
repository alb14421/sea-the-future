/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{C as e,n as t,h as i,i as a,a as n,b as l,r as o,o as s,c as r,O as c,d as h,D as d,e as p,g as u,f as C,S as m,p as v,j as g,k as f,l as b,m as y,R as x,H as S,q as w,t as $,s as I,u as k,v as D,w as F}from"./index72.js";import"./index.js";import"./index38.js";import"./index60.js";import"./customElement.js";import"./index34.js";import{i as j,L as A,c as O,s as P,x as T,a as H,k as N,E as R}from"./componentsUtils.js";import{n as z}from"./ref.js";import{i as U}from"./keyed.js";import{a as K,p as L,f as E,g as B}from"./dom.js";import{c as M}from"./component.js";import"./index73.js";import"./index28.js";import"./index6.js";import"./index74.js";import"./index75.js";import"./index76.js";import{c as V}from"./repeat.js";import{u as W,I as _}from"./interactive.js";import{i as q}from"./key.js";import{c as X,r as G,a as J}from"./math.js";import{u as Y}from"./useT9n.js";import{c as Q}from"./observers.js";import{t as Z}from"./throttle2.js";import"./global.js";import"./logger2.js";import"./live.js";import"./directive-helpers.js";import"./form.js";import"./label.js";import"./Validation.js";import"./input2.js";import"./locale2.js";import"./assets.js";import"../config.js";import"../core/lang.js";import"./object.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Error.js";import"./Logger.js";import"./string.js";import"./jsonUtils.js";import"./MapUtils.js";import"../core/promiseUtils.js";import"./handleUtils.js";import"./events.js";import"./maybe.js";import"./persistableUrlUtils.js";import"./guid.js";import"./static.js";import"./core.js";import"./XButton.js";import"./debounce.js";
/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const ee=j`:host{display:block}.container{display:flex;inline-size:100%;flex-wrap:nowrap;align-items:center}.hex-input{flex-grow:1;text-transform:uppercase}.opacity-input{inline-size:100px;margin-inline-start:-1px}:host([hidden]){display:none}[hidden]{display:none}`,te=e();class ie extends A{constructor(){super(...arguments),this.internalColor=te,this.alphaChannel=!1,this.allowEmpty=!1,this.hexLabel="Hex",this.scale="m",this.value=t(i(te,this.alphaChannel),this.alphaChannel,!0),this.calciteColorPickerHexInputChange=O({cancelable:!1})}static{this.properties={internalColor:[16,{},{state:!0}],alphaChannel:[5,{},{type:Boolean}],allowEmpty:[5,{},{type:Boolean}],hexLabel:1,messages:[0,{},{attribute:!1}],numberingSystem:1,scale:[3,{},{reflect:!0}],value:[3,{},{reflect:!0}]}}static{this.styles=ee}async setFocus(){return await M(this),K(this.hexInputNode)}connectedCallback(){super.connectedCallback(),this.previousNonNullValue=this.value;const{allowEmpty:e,alphaChannel:i,value:n}=this;if(n){const e=t(n,i);return void(a(e,i)&&this.internalSetValue(e,e,!1))}e&&this.internalSetValue(void 0,void 0,!1)}willUpdate(e){e.has("value")&&(this.hasUpdated||this.value!==t(i(te,this.alphaChannel),this.alphaChannel,!0))&&this.internalSetValue(this.value,e.get("value"),!1)}onHexInputBlur(){const e=this.hexInputNode,t=e.value,i=`#${t}`,{allowEmpty:s,internalColor:r}=this,c=s&&!t,h=n(i);(l(i,!0)||l(i,!1))&&this.onHexInputChange(),c||a(i)&&h||(e.value=s&&!r?"":this.formatHexForInternalInput(o(r.object())))}onOpacityInputBlur(){const e=this.opacityInputNode,t=e.value,{allowEmpty:i,internalColor:a}=this;i&&!t||(e.value=i&&!a?"":this.formatOpacityForInternalInput(a))}onOpacityInputInput(){this.onOpacityInputChange()}onHexInputChange(){let e=this.hexInputNode.value;if(e){const i=t(e,!1);a(i)&&this.alphaChannel&&this.internalColor&&(e=`${i+t(this.internalColor.hexa(),!0).slice(-2)}`)}this.internalSetValue(e,this.value)}onOpacityInputChange(){const e=this.opacityInputNode;let t;if(e.value){const i=s(Number(e.value));t=this.internalColor?.alpha(i).hexa()}else t=e.value;this.internalSetValue(t,this.value)}onInputFocus(e){"calciteInternalInputTextFocus"===e.type?this.hexInputNode.selectText():this.opacityInputNode.selectText()}onHexInputInput(){const e=`#${this.hexInputNode.value}`,t=this.value;a(e,this.alphaChannel)&&n(e,this.alphaChannel)&&this.internalSetValue(e,t)}onInputKeyDown(e){const{altKey:t,ctrlKey:a,metaKey:n,shiftKey:o}=e,{alphaChannel:s,hexInputNode:r,internalColor:c,value:d}=this,{key:p}=e,u=e.composedPath();if("Tab"===p&&l(d,this.alphaChannel)||"Enter"===p)return u.includes(r)?this.onHexInputChange():this.onOpacityInputChange(),void("Enter"===p&&e.preventDefault());const C="ArrowDown"===p||"ArrowUp"===p,m=this.value;if(C){if(!d)return this.internalSetValue(this.previousNonNullValue,m),void e.preventDefault();const t="ArrowUp"===p?1:-1,a=o?10:1;return this.internalSetValue(i(this.nudgeRGBChannels(c,a*t,u.includes(r)?"rgb":"a"),s),m),void e.preventDefault()}const v=t||a||n,g=1===p.length,f=h.test(p);!g||v||f||e.preventDefault()}onHexInputPaste(e){const t=e.clipboardData.getData("text");a(t,this.alphaChannel)&&n(t,this.alphaChannel)&&(e.preventDefault(),this.hexInputNode.value=t.slice(1),this.internalSetValue(t,this.value))}internalSetValue(n,l,o=!0){if(n){const{alphaChannel:l}=this,s=t(n,l,l);if(a(s,l)){const{internalColor:a}=this,n=e(s),r=t(i(n,l),l),c=!a||r!==t(i(a,l),l);return this.internalColor=n,this.previousNonNullValue=r,this.value=r,void(c&&o&&this.calciteColorPickerHexInputChange.emit())}}else if(this.allowEmpty)return this.internalColor=void 0,this.value=void 0,void(o&&this.calciteColorPickerHexInputChange.emit());this.value=l}storeHexInputRef(e){this.hexInputNode=e}storeOpacityInputRef(e){this.opacityInputNode=e}formatHexForInternalInput(e){return e?e.replace("#","").slice(0,6):""}formatOpacityForInternalInput(e){return e?`${r(e.alpha())}`:""}nudgeRGBChannels(t,i,a){let n;const l=t.array(),o=l.slice(0,3);if("rgb"===a)n=[...o.map(e=>e+i),this.alphaChannel?l[3]:void 0];else{const e=s(r(t.alpha())+i);n=[...o,e]}return e(n)}render(){const{alphaChannel:e,hexLabel:t,internalColor:i,messages:a,scale:n,value:l}=this,o=this.formatHexForInternalInput(l),s=this.formatOpacityForInternalInput(i),r="l"===n?"m":"s";return T`<div class=${P("container")}><calcite-input-text class=${P("hex-input")} .label=${a?.hex||t} .maxLength=${this.alphaChannel?8:6} @keydown=${this.onInputKeyDown} @paste=${this.onHexInputPaste} @calciteInputTextChange=${this.onHexInputChange} @calciteInputTextInput=${this.onHexInputInput} @calciteInternalInputTextBlur=${this.onHexInputBlur} @calciteInternalInputTextFocus=${this.onInputFocus} prefix-text=# .scale=${r} .value=${o} ${z(this.storeHexInputRef)}></calcite-input-text>${e?U("opacity-input",T`<calcite-input-number class=${P("opacity-input")} .label=${a?.opacity} .max=${c.max} max-length=3 .min=${c.min} number-button-type=none .numberingSystem=${this.numberingSystem} @keydown=${this.onInputKeyDown} @calciteInputNumberInput=${this.onOpacityInputInput} @calciteInternalInputNumberBlur=${this.onOpacityInputBlur} @calciteInternalInputNumberFocus=${this.onInputFocus} .scale=${r} suffix-text=% .value=${s} ${z(this.storeOpacityInputRef)}></calcite-input-number>`):null}</div>`}}H("calcite-color-picker-hex-input",ie);
/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */
const ae=j`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal);inline-size:var(--calcite-internal-color-picker-min-width);min-inline-size:var(--calcite-internal-color-picker-min-width)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([scale=s]){--calcite-internal-color-picker-min-width: 200px;--calcite-color-picker-spacing: 8px}:host([scale=s]) .saved-colors{gap:.25rem;grid-template-columns:repeat(auto-fill,20px)}:host([scale=m]){--calcite-internal-color-picker-min-width: 240px;--calcite-color-picker-spacing: 12px}:host([scale=l]){--calcite-internal-color-picker-min-width: 304px;--calcite-color-picker-spacing: 16px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) .section:first-of-type{padding-block-start:var(--calcite-color-picker-spacing)}:host([scale=l]) .saved-colors{grid-template-columns:repeat(auto-fill,32px)}:host([scale=l]) .control-section{display:flex;flex-direction:column;flex-wrap:wrap;align-items:baseline}:host([scale=l]) .color-hex-options{inline-size:100%;display:flex;flex-shrink:1;flex-direction:column;justify-content:space-around}:host([scale=l]) .color-mode-container{flex-shrink:3}.container{background-color:var(--calcite-color-foreground-1);display:flex;flex-direction:column;block-size:min-content;border:1px solid var(--calcite-color-border-1)}.control-and-scope{position:relative;display:flex;cursor:pointer;touch-action:none}.color-field,.control-and-scope{-webkit-user-select:none;user-select:none}.scope{pointer-events:none;position:absolute;z-index:var(--calcite-z-index);block-size:1px;inline-size:1px;border-radius:9999px;background-color:transparent;font-size:var(--calcite-font-size--1);outline-color:transparent}.scope:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))));outline-offset:6px}.hex-and-channels-group{display:flex;inline-size:100%;flex-direction:column;flex-wrap:wrap}.section{padding-block:0 var(--calcite-color-picker-spacing);padding-inline:var(--calcite-color-picker-spacing)}.section:first-of-type{padding-block-start:var(--calcite-color-picker-spacing)}.sliders{display:flex;flex-direction:column;justify-content:space-between;margin-inline-start:var(--calcite-color-picker-spacing);gap:var(--calcite-spacing-xxs)}.preview-and-sliders{display:flex;align-items:center;padding:var(--calcite-color-picker-spacing)}.color-hex-options,.section--split{flex-grow:1}.header{display:flex;align-items:center;justify-content:space-between;color:var(--calcite-color-text-1)}.color-mode-container{padding-block-start:var(--calcite-color-picker-spacing)}.channels{display:flex}.channel{flex-grow:1}.channel[data-channel-index="3"]{margin-inline-start:-1px;min-inline-size:81px}:host([scale=s]) .channel[data-channel-index="3"]{min-inline-size:68px}:host([scale=l]) .channel[data-channel-index="3"]{min-inline-size:88px}.saved-colors{display:grid;gap:.5rem;padding-block-start:var(--calcite-color-picker-spacing);grid-template-columns:repeat(auto-fill,24px)}.saved-colors-buttons{display:flex}.saved-color{outline-offset:0;outline-color:transparent;cursor:pointer}.saved-color:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.saved-color:hover{transition:outline-color var(--calcite-internal-animation-timing-fast) ease-in-out;outline:2px solid var(--calcite-color-border-2);outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}`;class ne extends A{constructor(){super(),this._color=d,this.internalColorUpdateContext=null,this.isActiveChannelInputEmpty=!1,this.mode=p.HEX,this.resizeObserver=Q("resize",e=>this.resizeCanvas(e)),this.shiftKeyChannelAdjustment=0,this.upOrDownArrowKeyTracker=null,this._valueWasSet=!1,this.messages=Y({blocking:!0}),this.captureColorFieldColor=(e,t,i=!0)=>{const{width:a,height:n}=this.dynamicDimensions.colorField,l=Math.round(S.s/a*e),o=Math.round(S.v/n*(n-t));this.internalColorSet(this.baseColorFieldColor.hsv().saturationv(l).value(o),i)},this.drawColorControls=Z((e="all")=>{"all"!==e&&"color-field"!==e||!this.colorFieldRenderingContext||this.drawColorField(),"all"!==e&&"hue-slider"!==e||!this.hueSliderRenderingContext||this.drawHueSlider(),this.alphaChannel&&("all"===e||"opacity-slider"===e)&&this.opacitySliderRenderingContext&&this.drawOpacitySlider()},16),this.globalPointerMoveHandler=e=>{const{activeCanvasInfo:t,el:i}=this;if(!i.isConnected||!t)return;const{context:a,bounds:n}=t;let l,o;const{clientX:s,clientY:r}=e;a.canvas.matches(":hover")?(l=s-n.x,o=r-n.y):(l=s<n.x+n.width&&s>n.x?s-n.x:s<n.x?0:n.width,o=r<n.y+n.height&&r>n.y?r-n.y:r<n.y?0:n.height),a===this.colorFieldRenderingContext?this.captureColorFieldColor(l,o,!1):a===this.hueSliderRenderingContext?this.captureHueSliderColor(l):a===this.opacitySliderRenderingContext&&this.captureOpacitySliderValue(l)},this.globalPointerUpHandler=e=>{if(!L(e))return;const t=this.activeCanvasInfo;this.activeCanvasInfo=null,this.drawColorControls(),t&&this.calciteColorPickerChange.emit()},this.resizeCanvas=Z(e=>{if(!this.hasUpdated)return;const[t]=e,i=Math.floor(t.contentBoxSize[0].inlineSize);this.dynamicDimensions.colorField.width!==i&&(this.updateDynamicDimensions(i),this.updateCanvasSize(),this.drawColorControls())},16),this.updateDynamicDimensions=e=>{const t={width:u(e,this.staticDimensions,this.alphaChannel),height:this.staticDimensions.slider.height};this.dynamicDimensions={colorField:C(e),slider:t}},this.channelMode="rgb",this.channels=this.toChannels(d),this.staticDimensions=m.m,this.savedColors=[],this.allowEmpty=!1,this.alphaChannel=!1,this.channelsDisabled=!1,this.clearable=!1,this.disabled=!1,this.format="auto",this.hexDisabled=!1,this.savedDisabled=!1,this.scale="m",this.calciteColorPickerChange=O({cancelable:!1}),this.calciteColorPickerInput=O({cancelable:!1}),this.listen("keydown",this.handleChannelKeyUpOrDown,{capture:!0}),this.listen("keyup",this.handleChannelKeyUpOrDown,{capture:!0})}static{this.properties={channelMode:[16,{},{state:!0}],channels:[16,{},{state:!0}],colorFieldScopeLeft:[16,{},{state:!0}],colorFieldScopeTop:[16,{},{state:!0}],staticDimensions:[16,{},{state:!0}],hueScopeLeft:[16,{},{state:!0}],opacityScopeLeft:[16,{},{state:!0}],savedColors:[16,{},{state:!0}],scopeOrientation:[16,{},{state:!0}],allowEmpty:[7,{},{reflect:!0,type:Boolean}],alphaChannel:[5,{},{type:Boolean}],channelsDisabled:[5,{},{type:Boolean}],clearable:[7,{},{reflect:!0,type:Boolean}],color:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],format:[3,{},{reflect:!0}],hexDisabled:[5,{},{type:Boolean}],messageOverrides:[0,{},{attribute:!1}],numberingSystem:[3,{},{reflect:!0}],savedDisabled:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],storageId:[3,{},{reflect:!0}],value:1}}static{this.styles=ae}get color(){return this._color}set color(e){const t=this._color;this._color=e,this.handleColorChange(e,t)}get value(){return this._value}set value(e){const t=this._value;this._value=e,this.handleValueChange(e,t),this._valueWasSet=!0}async setFocus(){await M(this),E(this.el)}connectedCallback(){super.connectedCallback(),this.observeResize()}async load(){this._valueWasSet||(this._value??=t(i(d,this.alphaChannel))),this.handleAllowEmptyOrClearableChange();const{isClearable:a,color:n,format:l,value:o}=this,s=a&&!o,r=v(o),c=s||"auto"===l&&r||l===r,h=s?null:c?e(o):n;c||this.showIncompatibleColorWarning(o,l),this.setMode(l,!1),this.internalColorSet(h,!1,"initial"),this.updateStaticDimensions(this.scale),this.updateDynamicDimensions(m[this.scale].minWidth);const p=`${g}${this.storageId}`;this.storageId&&localStorage.getItem(p)&&(this.savedColors=JSON.parse(localStorage.getItem(p)))}willUpdate(e){(e.has("allowEmpty")&&(this.hasUpdated||!1!==this.allowEmpty)||e.has("clearable")&&(this.hasUpdated||!1!==this.clearable))&&this.handleAllowEmptyOrClearableChange(),e.has("alphaChannel")&&(this.hasUpdated||!1!==this.alphaChannel)&&this.handleAlphaChannelChange(this.alphaChannel),this.hasUpdated&&(e.has("alphaChannel")&&!1!==this.alphaChannel||e.has("staticDimensions")&&this.staticDimensions!==m.m)&&this.handleAlphaChannelDimensionsChange(),(e.has("alphaChannel")&&(this.hasUpdated||!1!==this.alphaChannel)||e.has("format")&&(this.hasUpdated||"auto"!==this.format))&&this.handleFormatOrAlphaChannelChange(),e.has("scale")&&(this.hasUpdated||"m"!==this.scale)&&this.handleScaleChange(this.scale)}updated(){W(this)}loaded(){this.handleAlphaChannelDimensionsChange()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("pointermove",this.globalPointerMoveHandler),window.removeEventListener("pointerup",this.globalPointerUpHandler),this.resizeObserver?.disconnect()}get baseColorFieldColor(){return this.color||this.previousColor||d}get effectiveSliderWidth(){return this.dynamicDimensions.slider.width}observeResize(){this.resizeObserver?.observe(this.el)}handleAllowEmptyOrClearableChange(){this.isClearable=this.clearable||this.allowEmpty}handleAlphaChannelChange(e){const{format:t}=this;e&&"auto"!==t&&!f(t)&&(console.warn(`ignoring alphaChannel as the current format (${t}) does not support alpha`),this.alphaChannel=!1)}handleAlphaChannelDimensionsChange(){this.drawColorControls()}handleColorChange(e,t){this.drawColorControls(),this.updateChannelsFromColor(e),this.previousColor=t}handleFormatOrAlphaChannelChange(){this.setMode(this.format),this.internalColorSet(this.color,!1,"internal")}handleScaleChange(e="m"){this.updateStaticDimensions(e),this.updateCanvasSize(),this.drawColorControls()}handleValueChange(t,i){const{isClearable:a,format:n}=this;let l=!1;if(!a||t){const e=v(t);if(!e||"auto"!==n&&e!==n)return this.showIncompatibleColorWarning(t,n),void(this._value=i);l=this.mode!==e,this.setMode(e,null===this.internalColorUpdateContext)}const o=this.activeCanvasInfo;if("initial"===this.internalColorUpdateContext)return;if("user-interaction"===this.internalColorUpdateContext)return this.calciteColorPickerInput.emit(),void(o||this.calciteColorPickerChange.emit());const s=a&&!t?null:e(null!=t&&"object"==typeof t&&f(this.mode)?b(t):t),r=!y(s,this.color);(l||r)&&this.internalColorSet(s,this.alphaChannel&&!(this.mode.endsWith("a")||this.mode.endsWith("a-css"))||"internal"===this.internalColorUpdateContext,"internal")}handleTabActivate(e){this.channelMode=e.currentTarget.getAttribute("data-color-mode"),this.updateChannelsFromColor(this.color)}handleColorFieldScopeKeyDown(e){const{key:t}=e,i={ArrowUp:{x:0,y:-10},ArrowRight:{x:10,y:0},ArrowDown:{x:0,y:10},ArrowLeft:{x:-10,y:0}};i[t]&&(e.preventDefault(),this.scopeOrientation="ArrowDown"===t||"ArrowUp"===t?"vertical":"horizontal",this.captureColorFieldColor(this.colorFieldScopeLeft+i[t].x||0,this.colorFieldScopeTop+i[t].y||0,!1))}handleHueScopeKeyDown(e){const t=e.shiftKey?10:1,{key:i}=e,a={ArrowUp:1,ArrowRight:1,ArrowDown:-1,ArrowLeft:-1};if(a[i]){e.preventDefault();const n=a[i]*t,l=this.baseColorFieldColor.hue(),o=this.baseColorFieldColor.hue(l+n);this.internalColorSet(o,!1)}}handleHexInputChange(a){a.stopPropagation();const{isClearable:n,color:l}=this,o=a.target.value;!n||o?o!==(l&&t(i(l,f(this.mode))))&&this.internalColorSet(e(o)):this.internalColorSet(null)}handleSavedColorSelect(t){const i=t.currentTarget;this.internalColorSet(e(i.color))}handleChannelInput(e){const t=e.currentTarget,i=Number(t.getAttribute("data-channel-index")),a=3===i?c.max:"rgb"===this.channelMode?x[Object.keys(x)[i]]:S[Object.keys(S)[i]];let n;if(t.value){const e=Number(t.value)+this.shiftKeyChannelAdjustment;n=X(e,0,a).toString()}else n="",this.isActiveChannelInputEmpty=!0,this.upOrDownArrowKeyTracker=null;t.value=n,(""!==n&&0!==this.shiftKeyChannelAdjustment||""!==n)&&this.handleChannelChange(e)}handleChannelBlur(e){const t=e.currentTarget,i=Number(t.getAttribute("data-channel-index")),a=[...this.channels];!t.value&&!this.isClearable&&(t.value=a[i]?.toString())}handleChannelFocus(e){e.currentTarget.selectText()}handleChannelKeyUpOrDown(e){this.shiftKeyChannelAdjustment=0;const{key:t}=e;if("ArrowUp"!==t&&"ArrowDown"!==t||!e.composedPath().some(e=>e.classList?.contains(w.channel)))return;const{shiftKey:i}=e;if(e.preventDefault(),!this.color)return this.internalColorSet(this.previousColor),void e.stopPropagation();this.shiftKeyChannelAdjustment="ArrowUp"===t&&i?9:"ArrowDown"===t&&i?-9:0,"ArrowUp"===t&&(this.upOrDownArrowKeyTracker="up"),"ArrowDown"===t&&(this.upOrDownArrowKeyTracker="down")}getChannelInputLimit(e){return"rgb"===this.channelMode?x[Object.keys(x)[e]]:S[Object.keys(S)[e]]}handleChannelChange(e){const t=e.currentTarget,i=Number(t.getAttribute("data-channel-index")),a=[...this.channels];if(this.isClearable&&!t.value)return this.channels=[null,null,null,null],void this.internalColorSet(null);const n=3===i;this.isActiveChannelInputEmpty&&this.upOrDownArrowKeyTracker&&(t.value="up"===this.upOrDownArrowKeyTracker?(a[i]+1<=this.getChannelInputLimit(i)?a[i]+1:this.getChannelInputLimit(i)).toString():(a[i]-1>=0?a[i]-1:0).toString(),this.isActiveChannelInputEmpty=!1,this.upOrDownArrowKeyTracker=null);const l=t.value?Number(t.value):a[i];a[i]=n?s(l):l,this.updateColorFromChannels(a)}handleSavedColorKeyDown(e){q(e.key)&&(e.preventDefault(),this.handleSavedColorSelect(e))}handleColorFieldPointerDown(e){this.handleCanvasControlPointerDown(e,this.colorFieldRenderingContext,this.captureColorFieldColor,this.colorFieldScopeNode)}focusScope(e){requestAnimationFrame(()=>{e.focus()})}handleHueSliderPointerDown(e){this.handleCanvasControlPointerDown(e,this.hueSliderRenderingContext,this.captureHueSliderColor,this.hueScopeNode)}handleOpacitySliderPointerDown(e){this.handleCanvasControlPointerDown(e,this.opacitySliderRenderingContext,this.captureOpacitySliderValue,this.opacityScopeNode)}handleCanvasControlPointerDown(e,t,i,a){L(e)&&(window.addEventListener("pointermove",this.globalPointerMoveHandler),window.addEventListener("pointerup",this.globalPointerUpHandler,{once:!0}),this.activeCanvasInfo={context:t,bounds:t.canvas.getBoundingClientRect()},i.call(this,e.offsetX,e.offsetY),this.focusScope(a))}storeColorFieldScope(e){this.colorFieldScopeNode=e}storeHueScope(e){this.hueScopeNode=e}handleKeyDown(e){"Enter"===e.key&&e.preventDefault()}showIncompatibleColorWarning(e,t){console.warn(`ignoring color value (${e}) as it is not compatible with the current format (${t})`)}setMode(e,t=!0){const i="auto"===e?this.mode:e;this.mode=this.ensureCompatibleMode(i,t)}ensureCompatibleMode(e,t){const{alphaChannel:i}=this,a=f(e);if(i&&!a){const i=$(e);return t&&console.warn(`setting format to (${i}) as the provided one (${e}) does not support alpha`),i}if(!i&&a){const i=I(e);return t&&console.warn(`setting format to (${i}) as the provided one (${e}) does not support alpha`),i}return e}captureHueSliderColor(e){const t=k/this.effectiveSliderWidth*e;this.internalColorSet(this.baseColorFieldColor.hue(t),!1)}captureOpacitySliderValue(e){const t=s(c.max/this.effectiveSliderWidth*e);this.internalColorSet(this.baseColorFieldColor.alpha(t),!1)}internalColorSet(e,t=!0,i="user-interaction"){t&&y(e,this.color)||(this.internalColorUpdateContext=i,this.color=e,this.value=this.toValue(e),this.internalColorUpdateContext=null)}toValue(e,a=this.mode){if(!e)return null;if(a.includes("hex")){const n=a===p.HEXA;return t(i(e.round(),n),n)}if(a.includes("-css")){const t=e[a.replace("-css","").replace("a","")]().round().string();return(a.endsWith("a")||a.endsWith("a-css"))&&1===e.alpha()?`${t.slice(0,3)}a(${t.slice(4,-1)}, ${e.alpha()})`:t}const n=e[I(a)]().round().object();return a.endsWith("a")?D(n):n}getSliderCapSpacing(){const{staticDimensions:{slider:{height:e},thumb:{radius:t}}}=this;return 2*t-e}updateStaticDimensions(e="m"){this.staticDimensions=m[e]}deleteColor(){const e=i(this.color,this.alphaChannel);if(!(this.savedColors.indexOf(e)>-1))return;const t=this.savedColors.filter(t=>t!==e);this.savedColors=t;const a=`${g}${this.storageId}`;this.storageId&&localStorage.setItem(a,JSON.stringify(t))}saveColor(){const e=i(this.color,this.alphaChannel);if(this.savedColors.indexOf(e)>-1)return;const t=[...this.savedColors,e];this.savedColors=t;const a=`${g}${this.storageId}`;this.storageId&&localStorage.setItem(a,JSON.stringify(t))}drawColorField(){const e=this.colorFieldRenderingContext,{width:t,height:i}=this.dynamicDimensions.colorField;e.fillStyle=this.baseColorFieldColor.hsv().saturationv(100).value(100).alpha(1).string(),e.fillRect(0,0,t,i);const a=e.createLinearGradient(0,0,t,0);a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=a,e.fillRect(0,0,t,i);const n=e.createLinearGradient(0,0,0,i);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=n,e.fillRect(0,0,t,i),this.drawActiveColorFieldColor()}setCanvasContextSize(e,{height:t,width:i}){if(!e)return;const a=window.devicePixelRatio||1;e.width=i*a,e.height=t*a,e.style.height=`${t}px`,e.style.width=`${i}px`,e.getContext("2d").scale(a,a)}initColorField(e){e&&(this.colorFieldRenderingContext=e.getContext("2d"),this.updateCanvasSize("color-field"),this.drawColorControls())}initHueSlider(e){e&&(this.hueSliderRenderingContext=e.getContext("2d"),this.updateCanvasSize("hue-slider"),this.drawHueSlider())}initOpacitySlider(e){e&&(this.opacitySliderRenderingContext=e.getContext("2d"),this.updateCanvasSize("opacity-slider"),this.drawOpacitySlider())}updateCanvasSize(e="all"){const{dynamicDimensions:t,staticDimensions:i}=this;"all"!==e&&"color-field"!==e||this.setCanvasContextSize(this.colorFieldRenderingContext?.canvas,t.colorField);const a={width:this.effectiveSliderWidth,height:i.slider.height+2*(i.thumb.radius-t.slider.height/2)};"all"!==e&&"hue-slider"!==e||this.setCanvasContextSize(this.hueSliderRenderingContext?.canvas,a),"all"!==e&&"opacity-slider"!==e||this.setCanvasContextSize(this.opacitySliderRenderingContext?.canvas,a)}drawActiveColorFieldColor(){const{color:e}=this;if(!e)return;const t=e.hsv(),{staticDimensions:{thumb:{radius:i}}}=this,{width:a,height:n}=this.dynamicDimensions.colorField,l=t.saturationv()/(S.s/a),o=n-t.value()/(S.v/n);requestAnimationFrame(()=>{this.colorFieldScopeLeft=l,this.colorFieldScopeTop=o}),this.drawThumb(this.colorFieldRenderingContext,i,l,o,t,!1)}drawThumb(e,t,i,a,n,l){const o=2*Math.PI;if(e.beginPath(),e.arc(i,a,t,0,o),e.fillStyle="#fff",e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),l&&n.alpha()<1){const n=e.createPattern(this.getCheckeredBackgroundPattern(),"repeat");e.beginPath(),e.arc(i,a,t-3,0,o),e.fillStyle=n,e.fill()}e.globalCompositeOperation="source-atop",e.beginPath(),e.arc(i,a,t-3,0,o);const s=l?n.alpha():1;e.fillStyle=n.rgb().alpha(s).string(),e.fill(),e.globalCompositeOperation="source-over"}drawActiveHueSliderColor(){const{color:e}=this;if(!e)return;const t=e.hsv().saturationv(100).value(100),{staticDimensions:{thumb:{radius:i}}}=this,a=this.effectiveSliderWidth,n=t.hue()/(k/a),l=i,o=this.getSliderBoundX(n,a,i);requestAnimationFrame(()=>{this.hueScopeLeft=o}),this.drawThumb(this.hueSliderRenderingContext,i,o,l,t,!1)}drawHueSlider(){const t=this.hueSliderRenderingContext,{staticDimensions:{slider:{height:i},thumb:{radius:a}}}=this,n=a-i/2,l=this.effectiveSliderWidth,o=t.createLinearGradient(0,0,l,0),s=["red","yellow","lime","cyan","blue","magenta","#ff0004"],r=1/(s.length-1);let c=0;s.forEach(t=>{o.addColorStop(c,e(t).string()),c+=r}),t.clearRect(0,0,l,i+2*this.getSliderCapSpacing()),this.drawSliderPath(t,i,l,0,n),t.fillStyle=o,t.fill(),t.strokeStyle="rgba(0,0,0,0.3)",t.lineWidth=1,t.stroke(),this.drawActiveHueSliderColor()}drawOpacitySlider(){const e=this.opacitySliderRenderingContext,{baseColorFieldColor:t,staticDimensions:{slider:{height:i},thumb:{radius:a}}}=this,n=a-i/2,l=this.effectiveSliderWidth;e.clearRect(0,0,l,i+2*this.getSliderCapSpacing());const o=e.createLinearGradient(0,n,l,0),s=t.rgb().alpha(0),r=t.rgb().alpha(.5),c=t.rgb().alpha(1);o.addColorStop(0,s.string()),o.addColorStop(.5,r.string()),o.addColorStop(1,c.string()),this.drawSliderPath(e,i,l,0,n);const h=e.createPattern(this.getCheckeredBackgroundPattern(),"repeat");e.fillStyle=h,e.fill(),e.fillStyle=o,e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),this.drawActiveOpacitySliderColor()}drawSliderPath(e,t,i,a,n){const l=t/2+1;e.beginPath(),e.moveTo(a+l,n),e.lineTo(a+i-l,n),e.quadraticCurveTo(a+i,n,a+i,n+l),e.lineTo(a+i,n+t-l),e.quadraticCurveTo(a+i,n+t,a+i-l,n+t),e.lineTo(a+l,n+t),e.quadraticCurveTo(a,n+t,a,n+t-l),e.lineTo(a,n+l),e.quadraticCurveTo(a,n,a+l,n),e.closePath()}getCheckeredBackgroundPattern(){if(this.checkerPattern)return this.checkerPattern;const e=document.createElement("canvas");e.width=10,e.height=10;const t=e.getContext("2d");return t.fillStyle="#ccc",t.fillRect(0,0,10,10),t.fillStyle="#fff",t.fillRect(0,0,5,5),t.fillRect(5,5,5,5),this.checkerPattern=e,e}drawActiveOpacitySliderColor(){const{color:e}=this;if(!e)return;const t=e,{staticDimensions:{thumb:{radius:i}}}=this,a=this.effectiveSliderWidth,n=r(t.alpha())/(c.max/a),l=i,o=this.getSliderBoundX(n,a,i);requestAnimationFrame(()=>{this.opacityScopeLeft=o}),this.drawThumb(this.opacitySliderRenderingContext,i,o,l,t,!0)}getSliderBoundX(e,t,i){const a=J(e,t,i);return 0===a?e:-1===a?G(e,0,t,i,2*i):G(e,0,t,t-2*i,t-i)}storeOpacityScope(e){this.opacityScopeNode=e}handleOpacityScopeKeyDown(e){const t=e.shiftKey?10:1,{key:i}=e,a={ArrowUp:.01,ArrowRight:.01,ArrowDown:-.01,ArrowLeft:-.01};if(a[i]){e.preventDefault();const n=a[i]*t,l=this.baseColorFieldColor.alpha(),o=this.baseColorFieldColor.alpha(l+n);this.internalColorSet(o,!1)}}updateColorFromChannels(t){this.internalColorSet(e(t,this.channelMode))}updateChannelsFromColor(e){this.channels=e?this.toChannels(e):[null,null,null,null]}toChannels(e){const{channelMode:t}=this,i=e[t]().array().map((e,t)=>3===t?e:Math.floor(e));return 3===i.length&&i.push(1),i}getAdjustedScopePosition(e,t){return[e-F/2,t-F/2]}render(){const{channelsDisabled:e,color:t,colorFieldScopeLeft:a,colorFieldScopeTop:n,staticDimensions:{thumb:{radius:l}},hexDisabled:o,hueScopeLeft:s,messages:h,alphaChannel:p,opacityScopeLeft:u,savedColors:C,savedDisabled:m,scale:v,scopeOrientation:g}=this,f=this.effectiveSliderWidth,b=t?i(t,p):null,y=l,x=s??f*d.hue()/S.h,$=l,I=u??f*r(d.alpha())/c.max,k=void 0===t,D="vertical"===g,[F,j]=this.getAdjustedScopePosition(a,n),[A,O]=this.getAdjustedScopePosition(x,y),[H,R]=this.getAdjustedScopePosition(I,$);return _({disabled:this.disabled,children:T`<div class=${P(w.container)}><div class=${P(w.controlAndScope)}><canvas class=${P(w.colorField)} @pointerdown=${this.handleColorFieldPointerDown} ${z(this.initColorField)}></canvas><div .ariaLabel=${D?h.value:h.saturation} .ariaValueMax=${D?S.v:S.s} aria-valuemin=0 .ariaValueNow=${(D?t?.saturationv():t?.value())||"0"} class=${P({[w.scope]:!0,[w.colorFieldScope]:!0})} @keydown=${this.handleColorFieldScopeKeyDown} role=slider style=${N({top:`${j||0}px`,left:`${F||0}px`})} tabindex=0 ${z(this.storeColorFieldScope)}></div></div><div class=${P(w.previewAndSliders)}><calcite-color-picker-swatch class=${P(w.preview)} .color=${b} .scale=${this.alphaChannel?"l":this.scale}></calcite-color-picker-swatch><div class=${P(w.sliders)}><div class=${P(w.controlAndScope)}><canvas class=${P({[w.slider]:!0,[w.hueSlider]:!0})} @pointerdown=${this.handleHueSliderPointerDown} ${z(this.initHueSlider)}></canvas><div .ariaLabel=${h.hue} .ariaValueMax=${S.h} aria-valuemin=0 .ariaValueNow=${t?.round().hue()||d.round().hue()} class=${P({[w.scope]:!0,[w.hueScope]:!0})} @keydown=${this.handleHueScopeKeyDown} role=slider style=${N({top:`${O}px`,left:`${A}px`})} tabindex=0 ${z(this.storeHueScope)}></div></div>${p?T`<div class=${P(w.controlAndScope)}><canvas class=${P({[w.slider]:!0,[w.opacitySlider]:!0})} @pointerdown=${this.handleOpacitySliderPointerDown} ${z(this.initOpacitySlider)}></canvas><div .ariaLabel=${h.opacity} .ariaValueMax=${c.max} .ariaValueMin=${c.min} .ariaValueNow=${(t||d).round().alpha()} class=${P({[w.scope]:!0,[w.opacityScope]:!0})} @keydown=${this.handleOpacityScopeKeyDown} role=slider style=${N({top:`${R}px`,left:`${H}px`})} tabindex=0 ${z(this.storeOpacityScope)}></div></div>`:null}</div></div>${o&&e?null:T`<div class=${P({[w.controlSection]:!0,[w.section]:!0})}><div class=${P(w.hexAndChannelsGroup)}>${o?null:T`<div class=${P(w.hexOptions)}><calcite-color-picker-hex-input .allowEmpty=${this.isClearable} .alphaChannel=${p} class=${P(w.control)} .messages=${h} .numberingSystem=${this.numberingSystem} @calciteColorPickerHexInputChange=${this.handleHexInputChange} .scale=${v} .value=${b}></calcite-color-picker-hex-input></div>`}${e?null:T`<calcite-tabs class=${P({[w.colorModeContainer]:!0,[w.splitSection]:!0})} .scale=${"l"===v?"m":"s"}><calcite-tab-nav slot=title-group>${this.renderChannelsTabTitle("rgb")}${this.renderChannelsTabTitle("hsv")}</calcite-tab-nav>${this.renderChannelsTab("rgb")}${this.renderChannelsTab("hsv")}</calcite-tabs>`}</div></div>`}${m?null:T`<div class=${P({[w.savedColorsSection]:!0,[w.section]:!0})}><div class=${P(w.header)}><label>${h.saved}</label><div class=${P(w.savedColorsButtons)}><calcite-button appearance=transparent class=${P(w.deleteColor)} .disabled=${k} icon-start=minus kind=neutral .label=${h.deleteColor} @click=${this.deleteColor} .scale=${v} type=button></calcite-button><calcite-button appearance=transparent class=${P(w.saveColor)} .disabled=${k} icon-start=plus kind=neutral .label=${h.saveColor} @click=${this.saveColor} .scale=${v} type=button></calcite-button></div></div>${C.length>0?T`<div class=${P(w.savedColors)}>${V(C,e=>e,e=>T`<calcite-color-picker-swatch class=${P(w.savedColor)} .color=${e} @click=${this.handleSavedColorSelect} @keydown=${this.handleSavedColorKeyDown} .scale=${v} tabindex=0></calcite-color-picker-swatch>`)}</div>`:null}</div>`}</div>`})}renderChannelsTabTitle(e){const{channelMode:t,messages:i}=this,a=e===t,n="rgb"===e?i.rgb:i.hsv;return U(e,T`<calcite-tab-title class=${P(w.colorMode)} data-color-mode=${e??R} @calciteTabsActivate=${this.handleTabActivate} .selected=${a}>${n}</calcite-tab-title>`)}renderChannelsTab(e){const{isClearable:t,channelMode:i,channels:a,messages:n,alphaChannel:l}=this,o=e===i,s="rgb"===e?[n.red,n.green,n.blue]:[n.hue,n.saturation,n.value],c=B(this.el),h=l?a:a.slice(0,3);return U(e,T`<calcite-tab class=${P(w.control)} .selected=${o}><div class=${P(w.channels)} dir=ltr>${h.map((e,i)=>{const a=3===i;return a&&(e=t&&!e?e:r(e)),this.renderChannel(e,i,s[i],c,a?"%":"")})}</div></calcite-tab>`)}renderChannel(e,t,i,a,n){return U(t,T`<calcite-input-number class=${P(w.channel)} data-channel-index=${t??R} dir=${a??R} .label=${i} lang=${this.messages._lang??R} number-button-type=none .numberingSystem=${this.numberingSystem} @keydown=${this.handleKeyDown} @calciteInputNumberChange=${this.handleChannelChange} @calciteInputNumberInput=${this.handleChannelInput} @calciteInternalInputNumberBlur=${this.handleChannelBlur} @calciteInternalInputNumberFocus=${this.handleChannelFocus} .scale=${"l"===this.scale?"m":"s"} style=${N({marginLeft:t>0&&("s"!==this.scale||!this.alphaChannel||3!==t)?"-1px":""})} .suffixText=${n} .value=${e?.toString()}></calcite-input-number>`)}}H("calcite-color-picker",ne);export{ne as ColorPicker};
