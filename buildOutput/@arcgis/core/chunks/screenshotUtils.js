/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../core/lang.js";import{c as t}from"./mathUtils.js";export{c as createEmptyImageData}from"./imageUtils.js";import"../request.js";import"../config.js";import"./object.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Error.js";import"./Logger.js";import"./string.js";import"./jsonUtils.js";import"./MapUtils.js";import"../core/promiseUtils.js";import"./handleUtils.js";import"./events.js";import"./maybe.js";import"./persistableUrlUtils.js";function i(i,h){const{format:e,quality:o,rotation:r,disableDecorations:n}=i||{},a=s(i,h.padding),l=function(t,i){const h={x:0,y:0,width:i.width,height:i.height};if(t?.area){null!=t.area.x&&(h.x=Math.floor(t.area.x)),null!=t.area.y&&(h.y=Math.floor(t.area.y));const e=null!=t.area.width?Math.floor(t.area.width):null,o=null!=t.area.height?Math.floor(t.area.height):null;if(h.width=i.width-h.x,h.height=i.height-h.y,null!=e&&null!=o)h.width=Math.min(h.width,e),h.height=Math.min(h.height,o);else if(null==e&&null!=o){const t=Math.min(h.width,e);h.height=t/h.width*h.height,h.width=t}else if(null!=e&&null==o){const t=Math.min(h.height,o);h.width=t/h.height*h.width,h.height=t}}return function(t,i){const h=Math.floor(Math.max(t.x,0)),e=Math.floor(Math.max(t.y,0)),o={x:h,y:e,width:Math.floor(Math.min(t.width,i.width-h)),height:Math.floor(Math.min(t.height,i.height-e))},r=o.width/o.height,n=t.width/t.height;if(n===r)return o;if(n>r){const t=Math.floor(o.width/n),i=o.height-t;return{x:o.x,y:Math.floor(o.y+i/2),width:o.width,height:t}}const a=Math.floor(o.height*n),l=o.width-a;return{x:Math.floor(o.x+l/2),y:o.y,width:a,height:o.height}}(function(t,i){if(null==i?.width||null==i.height)return t;const h=i.width/i.height,e=t.width/t.height;if(e===h)return t;if(e<h){const i=Math.floor(t.height*h);return t.x-=(i-t.width)/2,t.width=i,t}const o=Math.floor(t.width/h);return t.y-=(o-t.height)/2,t.height=o,t}(h,t),i)}(i,{width:h.width-a.left-a.right,height:h.height-a.top-a.bottom}),{width:g,height:f}=function(t,i){if(!t)return i;const h=t.width,e=t.height;if(null!=h&&null!=e)return{width:Math.floor(h),height:Math.floor(e)};if(null==h&&null==e)return i;const o=i.width/i.height;return null==e?{width:Math.floor(h),height:Math.floor(h/o)}:{width:Math.floor(e*o),height:Math.floor(e)}}(i,l),d=m(e),u=M[d];return{format:d,quality:t(null!=o?o:u,0,100),area:l,width:g,height:f,rotation:r,disableDecorations:!!n,ignoreBackground:!!i?.ignoreBackground,ignorePadding:!!i?.ignorePadding}}function h(t,h){const e=i(t,h),o=e.area,r=e.width/o.width,n=s(e,h.padding),a=n.left+n.right,l=n.top+n.bottom,g=h.width-a,f=h.height-l,d=Math.floor(g*r+a),u=Math.floor(f*r+l),c=t?.layers??[],m=e.ignoreBackground,p=e.ignorePadding;return{framebufferWidth:d,framebufferHeight:u,region:{x:Math.floor(o.x*r)+n.left,y:Math.floor(o.y*r)+n.top,width:e.width,height:e.height},format:e.format,quality:e.quality,rotation:e.rotation,pixelRatio:r,layers:c,disableDecorations:e.disableDecorations,ignoreBackground:m,ignorePadding:p,olidColor:!1}}function e(t,i,h){const{ctx:e,canvas:o}=r(t,h),a=e.getImageData(0,0,t.width,t.height),g=l(o,i);return n(o),{dataUrl:g,data:a}}function o(t,i){const{ctx:h,canvas:e}=r(t,i),o=h.getImageData(0,0,t.width,t.height);return n(e),o}function r(t,i){const h=(null==a&&(a=document.createElement("canvas")),a);i.premultipliedAlpha&&function(t){const i=t.data,h=i.length;for(let t=0;t<h;t+=4){const h=i[t+3];if(255!==h&&h>0){const e=255/h;i[t]=i[t]*e,i[t+1]=i[t+1]*e,i[t+2]=i[t+2]*e}}}(t),h.width=t.width,h.height=t.height;const e=h.getContext("2d",{willReadFrequently:!0});return e.putImageData(t,0,0),i.flipY&&function(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}(e),{ctx:e,canvas:h}}function n(t){t.width=0,t.height=0}let a=null;function l(t,i){const h=p[i.format],e=i.quality/100;return t.toDataURL(h,e)}function g(i,h){const e=m(i),o=M[e];return{format:e,quality:t(null!=h?h:o,0,100)}}function f(t,i){return i/Math.max(t[0],t[1])}function d(t,i,h,e=0,o=0,r=t.width-e,n=t.height-o,a=!1){const{data:l}=t,{width:g,height:f,data:d}=i,u=r/g,s=n/f,c=Math.ceil(u/2),m=Math.ceil(s/2),p=t.width;for(let t=0;t<f;t++)for(let i=0;i<g;i++){const r=4*(i+(a?f-t-1:t)*g);let n=0,w=0,M=0,j=0,x=0,y=0;const b=(t+.5)*s;for(let r=Math.floor(t*s);r<(t+1)*s;r++){const t=Math.abs(b-(r+.5))/m,a=(i+.5)*u,g=t*t;for(let t=Math.floor(i*u);t<(i+1)*u;t++){const i=Math.abs(a-(t+.5))/c,f=Math.sqrt(g+i*i);if(f>=1)continue;let d=2*f*f*f-3*f*f+1;const u=4*(e+t+(o+r)*p);y+=d*l[u+3],w+=d,!h&&l[u+3]<255&&(d=d*l[u+3]/255),M+=d*l[u],j+=d*l[u+1],x+=d*l[u+2],n+=d}}d[r]=M/n,d[r+1]=j/n,d[r+2]=x/n,d[r+3]=y/w}return i}function u(t,i,h){if(!i)return t;const{framebufferWidth:e,framebufferHeight:o,pixelRatio:r,region:n}=t,a=s(t,h),l=a.left+a.right,g=a.top+a.bottom,f=e-l,d=o-g,u=Math.min(8,Math.min((2048-l)/f,(2048-g)/d));return u<1.5?t:{...t,framebufferWidth:Math.round(f*u)+l,framebufferHeight:Math.round(d*u)+g,pixelRatio:r*u,resample:{region:{x:Math.round((n.x-a.left)*u)+a.left,y:Math.round((n.y-a.top)*u)+a.top,width:Math.round(n.width*u),height:Math.round(n.height*u)},width:e,height:o}}}function s(t,i){return!i||t?.ignorePadding?j:i}function m(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return w}}const p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},w="png",M={png:100,jpg:98,jpeg:98},j={top:0,right:0,bottom:0,left:0};export{i as completeUserSettings,e as encode,o as encodeData,g as getFormatAndQuality,f as getMaximumResolutionScale,d as resampleHermite,u as screenshotSuperSampleSettings,l as toDataUrl,h as toRenderSettings};
