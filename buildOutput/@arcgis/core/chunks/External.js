/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import s from"../request.js";import{e}from"../core/lang.js";import{throwIfAborted as t}from"../core/promiseUtils.js";import{g as r,a}from"./infoFor3D.js";class i{constructor(s,e,t){this.assetName=s,this.assetMimeType=e,this.parts=t}equals(s){return this===s||this.assetName===s.assetName&&this.assetMimeType===s.assetMimeType&&e(this.parts,s.parts,(s,e)=>s.equals(e))}isOnService(s){return this.parts.every(e=>e.isOnService(s))}makeHash(){let s="";for(const e of this.parts)s+=e.partHash;return s}async toBlob(s){const{parts:e}=this;if(1===e.length)return e[0].toBlob(s);const r=await Promise.all(e.map(e=>e.toBlob(s)));return t(s),new Blob(r)}}class n{constructor(s,e){this.partUrl=s,this.partHash=e}equals(s){return this===s||this.partUrl===s.partUrl&&this.partHash===s.partHash}isOnService(s){return this.partUrl.startsWith(`${s.path}/assets/`)}async toBlob(e){const{data:r}=await s(this.partUrl,{responseType:"blob"});return t(e),r}}function o(s){return function(s){switch(s?.type){case"client":return Array.isArray(s.files)?s.files.some(l):l(s.files);case"service":return s.assets.some(l);case"loadable":return!0;default:return!1}}(s?.source)}const c=/^(model\/gltf\+json)|(model\/gltf-binary)$/,u=/\.(gltf|glb)/i;function l(s){if(s instanceof File){const{type:e,name:t}=s;return c.test(e)||u.test(t)}return c.test(s.assetMimeType)||u.test(s.assetName)}function f(s,e){if(!s)return!1;const{source:t}=s;return function(s,e){return"service"===s.type&&s.assets.every(s=>s.isOnService(e))}(t,e)}function p(s,e){if(s===e)return!0;const{source:t}=s,{source:r}=e;if(t===r)return!0;if("service"===t.type&&"service"===r.type){if(t.assets.length!==r.assets.length)return!1;const s=(s,e)=>s.assetName<e.assetName?-1:s.assetName>e.assetName?1:0,e=[...t.assets].sort(s),a=[...r.assets].sort(s);for(let s=0;s<e.length;++s)if(!e[s].equals(a[s]))return!1;return!0}return!1}function m(s,e){return s instanceof File?r(s,e):a(s.assetMimeType,s.assetName,e)}function h(s){switch(s.type){case"client":return Array.isArray(s.files)?s.files:[s.files];case"service":return s.assets;case"loadable":return}}function y(s){return!!s.original}export{n as S,i as a,h as b,m as c,o as d,f as e,p as f,y as i};
