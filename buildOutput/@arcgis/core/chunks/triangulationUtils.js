/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{e as t}from"./earcut.js";import{i as n}from"./coordsUtils.js";import{d as e,a as o,n as s}from"./DoubleArray.js";import{c as r}from"./Indices.js";import{e as i}from"./mathUtils.js";import{m as a,E as c}from"./unitUtils.js";import{k as l}from"./vec3.js";import{g as f,c as h,k as g}from"./plane.js";import{d as u}from"./deduplicate.js";function p(t,n,e){const o=function(t,n,e,o){const s=(i=n,Array.isArray(i[0])?(t,e)=>n[t][e]:(t,e)=>n[3*t+e]),r=o?a(o)/c(o):1;var i;return g(t,(t,n)=>l(t,s(n,0)*r,s(n,1)*r,s(n,2)),e)}(m,t,n,e)?f(m):[0,0,1];return Math.abs(o[2])>Math.cos(i(80))?2:Math.abs(o[1])>Math.abs(o[0])?1:0}const m=h();function d(n){const i=y(n.rings,n.hasZ,1,n.spatialReference),a=new Array;let c=0,l=0;for(const n of i.polygons){const o=n.count,s=n.index,f=e(i.position,3*s,3*o),h=n.holeIndices.map(t=>t-s),g=r(t(f,h,3));a.push({position:f,faces:g}),c+=f.length,l+=g.length}const f=function(t,n,e){if(1===t.length)return t[0];const o=s(n),i=new Array(e);let a=0,c=0,l=0;for(const n of t){for(let t=0;t<n.position.length;t++)o[a++]=n.position[t];for(const t of n.faces)i[c++]=t+l;l=a/3}return{position:o,faces:r(i)}}(a,c,l),h=Array.isArray(f.position)?u(f.position,3,{originalIndices:f.faces}):u(f.position.buffer,6,{originalIndices:f.faces});return f.position=o(new Float64Array(h.buffer)),f.faces=h.indices,f}function y(t,n,e,o){const r=t.length,i=new Array(r),a=new Array(r),c=new Array(r);let l=0;for(let n=0;n<r;++n)l+=t[n].length;let f=0,h=0,g=0;const u=s(3*l);let p=0;for(let s=r-1;s>=0;s--){const l=t[s],m=1===e&&j(l,n,o);if(m&&1!==r)i[f++]=l;else{let t=l.length;for(let n=0;n<f;++n)t+=i[n].length;const e={index:p,pathLengths:new Array(f+1),count:t,holeIndices:new Array(f)};e.pathLengths[0]=l.length,l.length>0&&(c[g++]={index:p,count:l.length}),p=m?A(l,l.length-1,-1,u,p,l.length,n):A(l,0,1,u,p,l.length,n);for(let t=0;t<f;++t){const o=i[t];e.holeIndices[t]=p,e.pathLengths[t+1]=o.length,o.length>0&&(c[g++]={index:p,count:o.length}),p=A(o,0,1,u,p,o.length,n)}f=0,e.count>0&&(a[h++]=e)}}for(let t=0;t<f;++t){const e=i[t];e.length>0&&(c[g++]={index:p,count:e.length}),p=A(e,0,1,u,p,e.length,n)}return a.length=h,c.length=g,{position:u,polygons:a,outlines:c}}function A(t,n,e,o,s,r,i){s*=3;for(let a=0;a<r;++a){const r=t[n];o[s++]=r[0],o[s++]=r[1],o[s++]=i&&r[2]?r[2]:0,n+=e}return s/3}function j(t,e,o){if(!e)return!n(t);switch(p(t,t.length-1,o)){case 0:return!n(t,1,2);case 1:return!n(t,0,2);case 2:return!n(t,0,1)}}export{p as l,y as r,d as t};
