/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{s as t,o as e}from"./vec2.js";import{c as r}from"./vec2f64.js";import{O as n}from"./vec4f64.js";import{U as a}from"./unitUtils.js";import{l as o}from"./projectBuffer.js";import{n as i}from"./DoubleArray.js";import{G as s,n as u}from"./Matrix4PassUniform.js";import{n as l}from"../core/lang.js";import{m as c}from"./BufferView.js";import{a as f}from"./Indices.js";import{A as p}from"./orientedBoundingBox.js";function m(t,e=!1){return t<=l?e?new Array(t).fill(0):new Array(t):c(t)}function h(r,l,c=null){const m=[],h=l.mapPositions;!function(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,a=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(r)&&n,o=r.length/3-(a?1:0),i=new Array(2*(o-1)),s=a?r.slice(0,-3):r;let u=0;for(let t=0;t<o-1;t++)i[u++]=t,i[u++]=t+1;e.push(["position",new p(s,i,3,a)])}(l,m);const g=m[0][1].data,w=m[0][1].indices.length,d=f(w);return function(t,e,r){if(null!=t.attributeData.colorFeature)return;const a=t.attributeData.color;e.push(["color",new p(a??n,r,4)])}(l,m,d),function(t,e,r){null==t.attributeData.sizeFeature&&e.push(["size",new p([t.attributeData.size??1],r,1,!0)])}(l,m,d),function(t,e,r){t.attributeData.normal&&e.push(["normal",new p(t.attributeData.normal,r,3)])}(l,m,d),function(t,e,r){null!=t.attributeData.colorFeature&&e.push(["colorFeatureAttribute",new p([t.attributeData.colorFeature],r,1,!0)])}(l,m,d),function(t,e,r){null!=t.attributeData.sizeFeature&&e.push(["sizeFeatureAttribute",new p([t.attributeData.sizeFeature],r,1,!0)])}(l,m,d),function(t,e){const{attributeData:{position:r,timeStamps:n}}=t;if(!n)return;const a=r.length/3,o=new Array(2*(a-1));let i=0;for(let t=0;t<a-1;t++)o[i++]=t,o[i++]=t+1;e.push(["timeStamps",new p(n,o,3)])}(l,m),function(t,e,r){null!=t.attributeData.opacityFeature&&e.push(["opacityFeatureAttribute",new p([t.attributeData.opacityFeature],r,1,!0)])}(l,m,d),function(r,n,s){if(null==r.overlayInfo||1!==r.overlayInfo.renderCoordsHelper.viewingMode||!r.overlayInfo.spatialReference.isGeographic)return;const l=i(s.length),c=a(r.overlayInfo.spatialReference);for(let t=0;t<l.length;t+=3)o(s,t,l,t,c);const f=s.length/3,m=u(f+1);let h=b,g=D,w=0,d=0;t(h,l[d++],l[d++]),d++,m[0]=0;for(let r=1;r<f+1;++r)r===f&&(d=0),t(g,l[d++],l[d++]),d++,w+=e(h,g),m[r]=w,[h,g]=[g,h];n.push(["distanceToStart",new p(m,n[0][1].indices,1,!0)])}(l,m,g),new s(r,m,h,2,c)}const b=r(),D=r();function g(t,e,r){if(null==t||0===t.length)return[];const n=[];return t.forEach((t,a)=>{const o=t.length,s=i(3*o);t.forEach((t,e)=>{s[3*e]=t[0],s[3*e+1]=t[1],s[3*e+2]=t[2]});const u=null!=r?function(t){const e=m(3*t.length),r=t[0],n=t[t.length-1];for(let a=0;a<t.length;a++)e[3*a]=t[a],e[3*a+1]=r,e[3*a+2]=n;return e}(r[a]):void 0,l={attributeData:{position:s,normal:e,timeStamps:u},removeDuplicateStartEnd:!1};n.push(l)}),n}export{h as c,g as l,m as n};
