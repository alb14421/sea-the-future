/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{d as e,a as t}from"./defaultCIMValues.js";function r(e,t,r,n){return function(e){return"function"==typeof e}(e)?e(t,r,n):e}function n(e){return[e.r,e.g,e.b,e.a]}function o(e){let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0}function a(e,t){const r=[];let n=0,a=-1;do{if(a=e.indexOf("[",n),a>=n){if(a>n){const t=e.slice(n,a);r.push([t,null,o(t)])}if(n=a+1,a=e.indexOf("]",n),a>=n){if(a>n){const o=t[e.slice(n,a)];o&&r.push([null,o,!1])}n=a+1}}}while(-1!==a);if(n<e.length){const t=e.slice(n);r.push([t,null,o(t)])}return r}function l(e,t,r){let n="",o=null;for(const r of t){const[t,a,l]=r;if(null!=t&&""!==t)l?o=t:(null!=o&&(n+=o,o=null),n+=t);else{const t=e.readAttribute(a);null!=t&&""!==t&&(null!==o&&(n+=o,o=null),n+=t)}}return i(n,r)}function s(e,t,r,n){let o="",a=null;for(const n of t){const[t,l,s]=n;if(null!=t&&""!==t)s?a=t:(null!=a&&(o+=a,a=null),o+=t);else{let t=l;null!=r&&(t=_(l,r));const n=e.attributes[t];null!=n&&""!==n&&(null!=a&&(o+=a,a=null),o+=n)}}return i(o,n)}function i(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function c(e,t,r,n,o,a,l=!0){const s=t/o,i=r/a,c=Math.ceil(s/2),u=Math.ceil(i/2);for(let r=0;r<a;r++)for(let f=0;f<o;f++){const M=4*(f+(l?a-r-1:r)*o);let y=0,m=0,C=0,p=0,h=0,I=0,b=0;const d=(r+.5)*i;for(let n=Math.floor(r*i);n<(r+1)*i;n++){const r=Math.abs(d-(n+.5))/u,o=(f+.5)*s,a=r*r;for(let r=Math.floor(f*s);r<(f+1)*s;r++){let l=Math.abs(o-(r+.5))/c;const s=Math.sqrt(a+l*l);s>=-1&&s<=1&&(y=2*s*s*s-3*s*s+1,y>0&&(l=4*(r+n*t),b+=y*e[l+3],C+=y,e[l+3]<255&&(y=y*e[l+3]/250),p+=y*e[l],h+=y*e[l+1],I+=y*e[l+2],m+=y))}}n[M]=p/m,n[M+1]=h/m,n[M+2]=I/m,n[M+3]=b/C}}function u(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function f(e){return e.data?.symbol??null}function M(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function y(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function m(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function C(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const p=(e,t=0)=>null==e||isNaN(e)?t:e,h=(e,t)=>null!=e?e:t,I=(e,t)=>e??t,b=e=>e.tintColor?u(e.tintColor):[255,255,255,1];class d{constructor(e){this._import=e}getImportPromise(){return null==this._promise&&(this._promise=this._import().then(e=>this.module=e)),this._promise}}function k(e){return new d(e)}function S(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function P(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function g(e){let t="normal",r="normal";if(e){const n=e.toLowerCase();n.includes("italic")?t="italic":n.includes("oblique")&&(t="oblique"),n.includes("bold")?r="bold":n.includes("light")&&(r="lighter")}return{style:t,weight:r}}function w(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function L(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=L(t);if(null!=e)return e}break;case"CIMTextSymbol":return L(e.symbol);case"CIMSolidFill":return e.color}return null}function A(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=A(e);if(null!=t)return t}break}case"CIMTextSymbol":return A(e.symbol);case"CIMSolidStroke":return e.color}}function N(e){for(const t of e)if(t.enable)switch(t.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1}function T(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=T(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return T(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function x(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function v(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function F(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}))}const V=e=>e.includes("data:image/svg+xml");function z(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function G(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function O(e,t,r,n,o,a,l=!0){const{infos:s}=a;let i=1,c=0,u=0,f=0,M=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:n,size:o,frameHeight:a,rotateClockWise:y,scaleSymbolsProportionally:m}of s)M=e?1:i,u=W(t,r,c,M,u),f=U(t,r,c,M,f),a&&(m||l)&&(i*=o/a),c=X(n,y,c);const y=W(n,o,c,M,u),m=U(n,o,c,M,f);return{size:e*i,rotation:X(t,r,c),offsetX:y,offsetY:m}}function D(e){if(null==e)return!1;if(Array.isArray(e))return e.every(e=>D(e));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function q(r,n){if("color"===n||"outlinecolor"===n||"backgroundcolor"===n||"borderlinecolor"===n||"tintcolor"===n)return[...t[n]];const o=e[r];if(!o)throw new Error(`InternalError: default value for type ${r}.`);return o[n]}function E(e){return"string"==typeof e?function(e){return e.split(" ").map(e=>Number(e))}(e):e}function j(e){return e?.dashTemplate&&(e.dashTemplate=E(e.dashTemplate)),e}function B(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return B(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return B(e.symbol)}}return"Normal"}function R(t){if(t)switch(t.type){case"CIMTextSymbol":return t.height;case"CIMPointSymbol":{let r=0;if(t.symbolLayers)for(const n of t.symbolLayers)if(n)switch(n.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=n.size??e.CIMVectorMarker.size;t>r&&(r=t);break}}return r}case"CIMLineSymbol":case"CIMPolygonSymbol":{let r=0;if(t.symbolLayers)for(const n of t.symbolLayers)if(n)switch(n.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=n.width;null!=e&&e>r&&(r=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(n.markerPlacement&&C(n.markerPlacement)){const t=n.size??e.CIMVectorMarker.size;t>r&&(r=t)}break;case"CIMPictureFill":{const e=n.height;null!=e&&e>r&&(r=e)}}return r}}}function _(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function H(e){return e.map(e=>({...e,propertyName:G(e.propertyName)}))}function J(e){const t={};for(const r in e){const n=e[r];t[G(r)]=n}return t}function U(e,t,r,n,o){const a=r*Math.PI/180;if(a){const r=Math.cos(a);return(Math.sin(a)*e+r*t)*n+o}return t*n+o}function W(e,t,r,n,o){const a=r*Math.PI/180;return a?(Math.cos(a)*e-Math.sin(a)*t)*n+o:e*n+o}function X(e,t,r){return t?r-e:r+e}function Y(e,t,r){const n="Color"===r||"TintColor"===r||"ToColor"===r,o="Rotation"===r||"Angle"===r||"ToRotation"===r;let a=t[G(r)];if(null!=a&&(n?a=[a[0]/255,a[1]/255,a[2]/255,a[3]/255]:o&&(a*=Math.PI/180)),null==a&&(a=q(t.type,r.toLowerCase()),null!=a&&(n?a=[a[0]/255,a[1]/255,a[2]/255,a[3]]:o&&(a*=Math.PI/180))),null!=t.primitiveName){const l=e[t.primitiveName];if(null!=l){const e=l[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(a=e,null!=a&&(n?a=[a[0]/255,a[1]/255,a[2]/255,a[3]/255]:o&&(a*=Math.PI/180))):(a={valueExpressionInfo:e,defaultValue:a},null!=a&&(n?a={type:"Process",op:"ArcadeColor",value:a}:o&&(a={type:"Process",op:"Divide",left:a,right:180/Math.PI}))))}}if(null==a)throw new Error(`Failed to derive a value or an expression for "${r}".`);return a}function $(e,t,r){if(null!=t[G(r)])return!0;if(null!=t.primitiveName){const n=e[t.primitiveName];if(null!=n&&null!=n[r])return!0}return!1}function K(e,t){return Math.max(Math.min((e??t)/100,1),0)}export{I as A,T as B,L as C,A as D,w as E,g as F,v as G,x as H,D as I,E as J,c as K,k as L,V as M,K as N,P as O,S as P,r as Q,M as a,C as b,m as c,j as d,J as e,H as f,F as g,a as h,y as i,s as j,B as k,l,z as m,u as n,O as o,Y as p,$ as q,R as r,h as s,f as t,G as u,n as v,N as w,b as x,p as y,q as z};
