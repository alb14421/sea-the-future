/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{n as t,t as n,p as e,o as r,q as i,s as o,u as a,v as s,w as c}from"./arcade.js";import{D as l}from"./Dictionary.js";import{A as u}from"./enum.js";import{c as f}from"./TimeOnly.js";import{D as m,s as d,i as p,o as w,n as j,w as y,c as h,E as g,f as S,F as N,b as O,G as v,H as P,u as J,J as A,K as I,L as F}from"./languageUtils.js";import{g as b}from"./portalUtils.js";import{i as R}from"./operatorsWorkerConnection.js";import{e as U}from"../core/lang.js";import D from"../geometry/Extent.js";import x from"../geometry/Geometry.js";import L from"../geometry/Multipoint.js";import C from"../geometry/Point.js";import k from"../geometry/Polygon.js";import T from"../geometry/Polyline.js";import{fromJSON as E}from"../geometry/support/jsonUtils.js";import M from"../portal/Portal.js";import{l as q}from"./utils12.js";import{b as Z}from"./guards.js";import"./arcadeEnvironment.js";import"./Logger.js";import"../config.js";import"./object.js";import"./string.js";import"./SetUtils.js";import"../core/Accessor.js";import"../core/Handles.js";import"./maybe.js";import"../core/accessorSupport/decorators/subclass.js";import"./Lifecycle.js";import"./metadata.js";import"./utils.js";import"./handleUtils.js";import"./tracking.js";import"./ensureType.js";import"./MapUtils.js";import"./Warning.js";import"../core/Error.js";import"./get.js";import"./ObjectPool.js";import"./ObservableBase.js";import"../core/accessorSupport/decorators/property.js";import"./watch.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"../core/promiseUtils.js";import"./events.js";import"./SimpleTrackingTarget.js";import"./Feature.js";import"./deepClone.js";import"./featureConversionUtils.js";import"./aaBoundingBox.js";import"./aaBoundingRect.js";import"./mathUtils.js";import"./DoubleArray.js";import"./OptimizedFeature.js";import"./memoryEstimations.js";import"./OptimizedGeometry.js";import"./OptimizedFeatureSet.js";import"./createFeatureId.js";import"../layers/support/FieldsIndex.js";import"./UnknownTimeZone.js";import"./datetime.js";import"./jsonUtils.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"./constants.js";import"./timeZoneUtils.js";import"./aiServices.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./persistableUrlUtils.js";import"./utils9.js";import"./tslib.es6.js";import"../core/JSONSupport.js";import"./commonProperties3.js";import"./ImmutableArray.js";import"./locale.js";import"./shared2.js";import"../layers/support/Field.js";import"./jsonMap.js";import"./enumeration.js";import"./reader.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"../core/sql/WhereClause.js";import"./streamLayerUtils.js";import"./coordsUtils.js";import"./unitUtils.js";import"./pe.js";import"./assets.js";import"./unitConversion.js";import"./number2.js";import"./hash.js";import"./uuid.js";import"../geometry/SpatialReference.js";import"./writer.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"./Queue.js";import"./SimpleObservable.js";import"../core/workers/RemoteClient.js";import"../intl.js";import"./date.js";import"./number.js";import"./substitute.js";import"./messages.js";import"../geometry/support/webMercatorUtils.js";import"./zmUtils.js";import"../core/accessorSupport/decorators/cast.js";import"./extentUtils.js";import"./boundsUtils.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";function z(t){if(null==t)return t;switch(typeof t){case"string":case"number":return t;default:throw new u(null,"InvalidParameter",null)}}function B(B){"async"===B.mode&&(B.functions.disjoint=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null===o[0]||null===o[1]||R("disjoint",[o[0].toJSON(),o[1].toJSON()])))},B.functions.intersects=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null!==o[0]&&null!==o[1]&&R("intersects",[o[0].toJSON(),o[1].toJSON()])))},B.functions.touches=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null!==o[0]&&null!==o[1]&&R("touches",[o[0].toJSON(),o[1].toJSON()])))},B.functions.crosses=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null!==o[0]&&null!==o[1]&&R("crosses",[o[0].toJSON(),o[1].toJSON()])))},B.functions.within=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null!==o[0]&&null!==o[1]&&R("within",[o[0].toJSON(),o[1].toJSON()])))},B.functions.contains=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null!==o[0]&&null!==o[1]&&R("contains",[o[0].toJSON(),o[1].toJSON()])))},B.functions.overlaps=function(n,e){return B.standardFunctionAsync(n,e,(r,i,o)=>(o=m(o),t(o,n,e),null!==o[0]&&null!==o[1]&&R("overlaps",[o[0].toJSON(),o[1].toJSON()])))},B.functions.equals=function(t,n){return B.standardFunctionAsync(t,n,(e,r,i)=>(d(i,2,2,t,n),i[0]===i[1]||(i[0]instanceof x&&i[1]instanceof x?R("equals",[i[0].toJSON(),i[1].toJSON()]):(p(i[0])&&p(i[1])||!!(w(i[0])&&w(i[1])||j(i[0])&&j(i[1])))&&i[0].equals(i[1]))))},B.functions.relate=function(t,n){return B.standardFunctionAsync(t,n,(e,r,i)=>{if(i=m(i),d(i,3,3,t,n),i[0]instanceof x&&i[1]instanceof x)return R("relate",[i[0].toJSON(),i[1].toJSON(),y(i[2])]);if(i[0]instanceof x&&null===i[1])return!1;if(i[1]instanceof x&&null===i[0])return!1;if(null===i[0]&&null===i[1])return!1;throw new u(t,"InvalidParameter",n)})},B.functions.intersection=function(n,e){return B.standardFunctionAsync(n,e,async(r,i,o)=>(o=m(o),t(o,n,e),null===o[0]||null===o[1]?null:E(await R("intersection",[o[0].toJSON(),o[1].toJSON()]))))},B.functions.union=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(0===(i=m(i)).length)throw new u(t,"WrongNumberOfParameters",n);const o=[];if(1===i.length)if(Z(i[0])){for(const e of m(i[0]))if(null!==e){if(!(e instanceof x))throw new u(t,"InvalidParameter",n);o.push(e.toJSON())}}else{if(!h(i[0])){if(i[0]instanceof x)return g(f(i[0]),t.spatialReference);if(null===i[0])return null;throw new u(t,"InvalidParameter",n)}for(const e of m(i[0].toArray()))if(null!==e){if(!(e instanceof x))throw new u(t,"InvalidParameter",n);o.push(e.toJSON())}}else for(const e of i)if(null!==e){if(!(e instanceof x))throw new u(t,"InvalidParameter",n);o.push(e.toJSON())}return 0===o.length?null:E(await R("union",[o]))})},B.functions.difference=function(n,e){return B.standardFunctionAsync(n,e,async(r,i,o)=>(o=m(o),t(o,n,e),null===o[0]?null:null===o[1]?f(o[0]):E(await R("difference",[o[0].toJSON(),o[1].toJSON()]))))},B.functions.symmetricdifference=function(n,e){return B.standardFunctionAsync(n,e,async(r,i,o)=>(o=m(o),t(o,n,e),null===o[0]&&null===o[1]?null:null===o[0]?f(o[1]):null===o[1]?f(o[0]):E(await R("symmetricDifference",[o[0].toJSON(),o[1].toJSON()]))))},B.functions.clip=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,2,t,n),!(i[1]instanceof D)&&null!==i[1])throw new u(t,"InvalidParameter",n);if(null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);return null===i[1]?null:E(await R("clip",[i[0].toJSON(),i[1].toJSON()]))})},B.functions.cut=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,2,t,n),!(i[1]instanceof T)&&null!==i[1])throw new u(t,"InvalidParameter",n);if(null===i[0])return[];if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);return null===i[1]?[f(i[0])]:(await R("cut",[i[0].toJSON(),i[1].toJSON()])).map(t=>E(t))})},B.functions.area=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(d(i,1,2,t,n),i=m(i),S(i[0])){const e=await i[0].sumArea(z(i[1]),null,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,"Cancelled",n);return e}let o=i[0];if((Z(o)||h(o))&&(o=N(i[0],t.spatialReference)),null===o)return 0;if(!(o instanceof x))throw new u(t,"InvalidParameter",n);return R("area",[o.toJSON(),z(i[1])])})},B.functions.areageodetic=function(t,e){return B.standardFunctionAsync(t,e,async(r,i,o)=>{d(o,1,3,t,e);let a=(o=m(o))[0];(Z(a)||h(a))&&(a=N(a,t.spatialReference));const s=z(o[1]),c=n(o[2]);if(S(a)){const n=await a.sumArea(s,c,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,"Cancelled",e);return n}if(null==a)return 0;if(!O(a))throw new u(t,"InvalidParameter",e);return R("geodeticArea",[a.toJSON(),s,c])})},B.functions.length=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(d(i,1,2,t,n),i=m(i),S(i[0])){const e=await i[0].sumLength(z(i[1]),null,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,"Cancelled",n);return e}let o=i[0];if((Z(i[0])||h(i[0]))&&(o=v(i[0],t.spatialReference)),null===o)return 0;if(!(o instanceof x))throw new u(t,"InvalidParameter",n);return R("length",[o.toJSON(),z(i[1])])})},B.functions.length3d=function(t,n){return B.standardFunctionAsync(t,n,async(r,i,o)=>{if(d(o,1,2,t,n),null===(o=m(o))[0])return 0;let a=o[0];if((Z(o[0])||h(o[0]))&&(a=v(o[0],t.spatialReference)),null===a)return 0;if(!(a instanceof x))throw new u(t,"InvalidParameter",n);if(!0===a.hasZ){const{convertFromSpatialReferenceUnit:t,toLengthUnit:n}=await import("./unitConversion.js"),r=e(a);return t(a.spatialReference,n(o[1]),r)}return R("length",[a.toJSON(),z(o[1])])})},B.functions.lengthgeodetic=function(t,e){return B.standardFunctionAsync(t,e,async(r,i,o)=>{d(o,1,3,t,e);let a=(o=m(o))[0];(Z(o[0])||h(o[0]))&&(a=v(o[0],t.spatialReference));const s=z(o[1]),c=n(o[2]);if(S(a)){const n=await a.sumLength(s,c,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,"Cancelled",e);return n}if(null===a)return 0;if(!O(a))throw new u(t,"InvalidParameter",e);return R("geodeticLength",[a.toJSON(),s,c])})},B.functions.distance=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{i=m(i),d(i,2,3,t,n);let o=i[0];if((Z(i[0])||h(i[0]))&&(o=P(i[0],t.spatialReference)),!(o instanceof x))throw new u(t,"InvalidParameter",n);let a=i[1];if((Z(i[1])||h(i[1]))&&(a=P(i[1],t.spatialReference)),!(a instanceof x))throw new u(t,"InvalidParameter",n);return R("distance",[o.toJSON(),a.toJSON(),z(i[2])])})},B.functions.distancegeodetic=function(t,e){return B.standardFunctionAsync(t,e,async(r,i,o)=>{o=m(o),d(o,2,4,t,e);const a=o[0];if(!(a instanceof C))throw new u(t,"InvalidParameter",e);const s=o[1];if(!(s instanceof C))throw new u(t,"InvalidParameter",e);const c=new T({paths:[],spatialReference:a.spatialReference});return c.addPath([a,s]),R("geodeticLength",[c.toJSON(),z(o[2]),n(o[3])])})},B.functions.densify=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,3,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);const o=J(i[1]);if(isNaN(o))throw new u(t,"InvalidParameter",n);if(o<=0)throw new u(t,"InvalidParameter",n);switch(i[0].type){case"polygon":case"polyline":case"extent":return E(await R("densify",[i[0].toJSON(),o,z(i[2])]));default:return i[0]}})},B.functions.densifygeodetic=function(t,e){return B.standardFunctionAsync(t,e,async(r,i,o)=>{o=m(o),d(o,2,4,t,e);const a=o[0];if(null==a)return null;if(!O(a))throw new u(t,"InvalidParameter",e);const s=J(o[1]);if(isNaN(s))throw new u(t,"InvalidParameter",e);if(s<=0)throw new u(t,"InvalidParameter",e);const c=z(o[2]),l=n(o[3]);switch(a.type){case"polygon":case"polyline":case"extent":return E(await R("geodeticDensify",[a.toJSON(),s,c,l]));default:return a}})},B.functions.generalize=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,4,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);const o=J(i[1]);if(isNaN(o))throw new u(t,"InvalidParameter",n);const a=A(I(i[2],!0));return E(await R("generalize",[i[0].toJSON(),o,z(i[3]),{removeDegenerateParts:a}]))})},B.functions.buffer=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,3,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);const o=J(i[1]);if(isNaN(o))throw new u(t,"InvalidParameter",n);return 0===o?f(i[0]):E(await R("buffer",[i[0].toJSON(),o,z(i[2])]))})},B.functions.buffergeodetic=function(t,e){return B.standardFunctionAsync(t,e,async(r,i,o)=>{o=m(o),d(o,2,4,t,e);const a=o[0];if(null==a)return null;if(!O(a))throw new u(t,"InvalidParameter",e);const s=J(o[1]);if(isNaN(s))throw new u(t,"InvalidParameter",e);if(0===s)return f(a);const c=z(o[2]),l=n(o[3]);return E(await R("geodesicBuffer",[a.toJSON(),s,c,l]))})},B.functions.offset=function(t,n){return B.standardFunctionAsync(t,n,async(e,i,o)=>{if(o=m(o),d(o,2,6,t,n),null===o[0])return null;if(!(o[0]instanceof k||o[0]instanceof T))throw new u(t,"InvalidParameter",n);const a=J(o[1]);if(isNaN(a))throw new u(t,"InvalidParameter",n);const s=r(o[3]),c=J(I(o[4],10));if(isNaN(c))throw new u(t,"InvalidParameter",n);const l=J(I(o[5],0));if(isNaN(l))throw new u(t,"InvalidParameter",n);return E(await R("offset",[o[0].toJSON(),a,z(o[2]),{joins:s,miterLimit:c,flattenError:l}]))})},B.functions.rotate=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,3,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);const o=i[0]instanceof D?k.fromExtent(i[0]):i[0],a=J(i[1]);if(isNaN(a))throw new u(t,"InvalidParameter",n);const s=I(i[2],null);if(null===s){const t="point"===o.type?o:o.extent?.center;return E(await R("rotate",[o.toJSON(),a,t?.x,t?.y]))}if(s instanceof C)return E(await R("rotate",[o.toJSON(),a,s.x,s.y]));throw new u(t,"InvalidParameter",n)})},B.functions.centroid=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,o)=>{if(o=m(o),d(o,1,2,t,n),null===o[0])return null;const a=i(o[1]);let s=o[0];if((Z(o[0])||h(o[0]))&&(s="geometric"===a?P(o[0],t.spatialReference):N(o[0],t.spatialReference),null===s))return null;if(!(s instanceof x))throw new u(t,"InvalidParameter",n);return E("geometric"===a?await R("centroid",[s.toJSON()]):await R("labelPoint",[s.toJSON()]))})},B.functions.measuretocoordinate=function(t,n){return B.standardFunctionAsync(t,n,o)},B.functions.pointtocoordinate=function(t,n){return B.standardFunctionAsync(t,n,a)},B.functions.distancetocoordinate=function(t,n){return B.standardFunctionAsync(t,n,s)},B.functions.multiparttosinglepart=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,1,1,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);if(i[0]instanceof C)return[g(f(i[0]),t.spatialReference)];if(i[0]instanceof D)return[g(f(i[0]),t.spatialReference)];const o=E(await R("simplify",[i[0].toJSON()]));if(o instanceof k){const t=[],n=[];for(let e=0;e<o.rings.length;e++)if(o.isClockwise(o.rings[e])){const n=E({rings:[o.rings[e]],hasZ:!0===o.hasZ,hasM:!0===o.hasM,spatialReference:o.spatialReference.toJSON()});t.push(n)}else n.push({ring:o.rings[e],pt:o.getPoint(e,0)});for(let e=0;e<n.length;e++)for(let r=0;r<t.length;r++)if(t[r].contains(n[e].pt)){t[r].addRing(n[e].ring);break}return t}if(o instanceof T){const t=[];for(let n=0;n<o.paths.length;n++){const e=E({paths:[o.paths[n]],hasZ:!0===o.hasZ,hasM:!0===o.hasM,spatialReference:o.spatialReference.toJSON()});t.push(e)}return t}if(i[0]instanceof L){const n=[],e=g(f(i[0]),t.spatialReference);for(let t=0;t<e.points.length;t++)n.push(e.getPoint(t));return n}return null})},B.functions.isselfintersecting=function(t,n){return B.standardFunctionAsync(t,n,async(t,n,e)=>{d(e,1,1,t,n);let r=(e=m(e))[0];if((Z(e[0])||h(e[0]))&&(r=v(e[0],t.spatialReference)),r instanceof L){const t=r.points;for(let n=0;n<t.length;n++)for(let e=n+1;e<t.length;e++)if(U(t[n],t[e]))return!0;return!1}return(r instanceof T||r instanceof k)&&await R("isSelfIntersecting",[r.toJSON()])})},B.functions.issimple=function(t,n){return B.standardFunctionAsync(t,n,(e,r,i)=>{if(i=m(i),d(i,1,1,t,n),null===i[0])return!0;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);return R("isSimple",[i[0].toJSON()])})},B.functions.simplify=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,1,1,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);return E(await R("simplify",[i[0].toJSON()]))})},B.functions.convexhull=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,1,1,t,n),null===i[0])return null;if(!(i[0]instanceof x))throw new u(t,"InvalidParameter",n);return E(await R("convexHull",[i[0].toJSON()]))})},B.functions.getuser=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{d(i,0,2,t,n);let o=I(i[1],""),a=!0===o;if(o=!0===o||!1===o?"":y(o),0===i.length||i[0]instanceof c){let n;n=t.services?.portal?t.services.portal:M.getDefault(),i.length>0&&(n=b(i[0],n));const e=await q(n,o,a);if(e){const n=JSON.parse(JSON.stringify(e));for(const t of["lastLogin","created","modified"])void 0!==n[t]&&null!==n[t]&&(n[t]=new Date(n[t]));return l.convertObjectToArcadeDictionary(n,F(t))}return null}let s=null;if(S(i[0])&&(s=i[0]),s){if(a=!1,o)return null;await s.load();const n=await s.getOwningSystemUrl();if(!n){if(!o){const n=await s.getIdentityUser();return n?l.convertObjectToArcadeDictionary({username:n},F(t)):null}return null}let e;e=t.services?.portal?t.services.portal:M.getDefault(),e=b(new c(n),e);const r=await q(e,o,a);if(r){const n=JSON.parse(JSON.stringify(r));for(const t of["lastLogin","created","modified"])void 0!==n[t]&&null!==n[t]&&(n[t]=new Date(n[t]));return l.convertObjectToArcadeDictionary(n,F(t))}return null}throw new u(t,"InvalidParameter",n)})},B.functions.nearestcoordinate=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,2,t,n),!(i[0]instanceof x||null===i[0]))throw new u(t,"InvalidParameter",n);if(!(i[1]instanceof C||null===i[1]))throw new u(t,"InvalidParameter",n);if(null===i[0]||null===i[1])return null;const o=i[0]instanceof D?k.fromExtent(i[0]):i[0],a=await R("getNearestCoordinate",[o.toJSON(),i[1].toJSON(),{calculateLeftRightSide:!0}]);return null===a?null:l.convertObjectToArcadeDictionary({coordinate:E(a.coordinate),distance:a.distance,sideOfLine:0===a.distance?"straddle":a.isRightSide?"right":"left"},F(t),!1,!0)})},B.functions.nearestvertex=function(t,n){return B.standardFunctionAsync(t,n,async(e,r,i)=>{if(i=m(i),d(i,2,2,t,n),!(i[0]instanceof x||null===i[0]))throw new u(t,"InvalidParameter",n);if(!(i[1]instanceof C||null===i[1]))throw new u(t,"InvalidParameter",n);if(null===i[0]||null===i[1])return null;const o=i[0]instanceof D?k.fromExtent(i[0]):i[0],a=await R("getNearestVertex",[o.toJSON(),i[1].toJSON()]);return null===a?null:l.convertObjectToArcadeDictionary({coordinate:E(a.coordinate),distance:a.distance,sideOfLine:0===a.distance?"straddle":a.isRightSide?"right":"left"},F(t),!1,!0)})})}export{B as registerFunctions};
