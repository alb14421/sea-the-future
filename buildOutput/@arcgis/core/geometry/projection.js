/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{e as s}from"../core/Accessor.js";import n from"../core/Error.js";import{L as r}from"../chunks/Logger.js";import{throwIfAborted as t}from"../core/promiseUtils.js";import{S as o}from"../chunks/SimpleObservable.js";import{c as e}from"../chunks/vec3f64.js";import{a as i,b as c}from"./support/webMercatorUtils.js";import{B as u,p as l,A as p,C as a}from"../chunks/unitUtils.js";import m from"./Extent.js";import h from"./Multipoint.js";import{l as f,i as j,p as k}from"../chunks/pe.js";import g from"./Point.js";import d from"./Polygon.js";import y from"./Polyline.js";import x from"./SpatialReference.js";import{g as w,p as b}from"../chunks/projectBuffer.js";import{p as S}from"../chunks/projectXYZToVector.js";import U from"./support/GeographicTransformation.js";import{g as z}from"../chunks/zscale.js";import"../core/lang.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../core/accessorSupport/decorators/subclass.js";import"../chunks/Lifecycle.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/tracking.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/object.js";import"../chunks/Warning.js";import"../chunks/get.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../core/accessorSupport/decorators/property.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";import"../config.js";import"../chunks/string.js";import"../chunks/events.js";import"../chunks/jsonMap.js";import"../chunks/tslib.es6.js";import"./Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/writer.js";import"../chunks/zmUtils.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../chunks/geodesicConstants.js";import"./support/GeographicTransformationStep.js";s(r.getLogger("esri.geometry.projection"),"esri.geometry.projection",{replacement:"esri.geometry.operators.projectOperator",version:"4.32",warnOnce:!0});let M=null,v=null,R=null;const Z={},T=new o;function A(){return!!M&&j()}function G(s){return null==R&&(R=Promise.all([f(),import("../chunks/geometryEngineBase.js").then(s=>s.g),import("../chunks/hydrated.js")])),R.then(([,n,{hydratedAdapter:r}])=>{t(s),v=r,M=n.default,M._enableProjection(k),T.notify()})}function P(s,n,r=null,t=null){return Array.isArray(s)?0===s.length?[]:(i(s),B(v,s,s[0].spatialReference,n,r,t)):(c(s),B(v,[s],s.spatialReference,n,r,t)[0])}function B(s,n,r,t,o=null,e=null){if(null==r||null==t)return n;if(function(s,n,r){return!r&&(!!l(s,n)||p(s)&&p(n)&&!!w(s,n))}(r,t,o))return n.map(s=>W(s,r,t));if(null==o&&u(r))return n.map(s=>W(s,r,x.WGS84)).map(s=>L(s,t));if(null==o&&u(t))return n.map(s=>L(s,x.WGS84)).map(s=>W(s,x.WGS84,t));if(null==o){const s=U.cacheKey(r,t);void 0!==Z[s]?o=Z[s]:(null==(o=O(r,t,void 0))&&(o=new U),Z[s]=o)}if(null==M||null==s)throw new _;return null!=e?M._project(s,n,r,t,o,e):M._project(s,n,r,t,o)}function O(s,n,r=null){if(null==s||null==n)return null;if(null==M||null==v)throw new _;const t=M._getTransformation(v,s,n,r,r?.spatialReference);return null!==t?U.fromGE(t):null}function E(s,n,r=null){if(null==M||null==v)throw new _;const t=M._getTransformationBySuitability(v,s,n,r,r?.spatialReference);if(null!==t){const s=[];for(const n of t)s.push(U.fromGE(n));return s}return[]}class _ extends n{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function L(s,n){try{const r=P(s,n);if(null==r)return null;"xmin"in s&&"xmin"in r&&(r.zmin=s.zmin,r.zmax=s.zmax);const t=z(r.type,s.spatialReference,n);return null!=t&&t(r),r}catch(s){if(!(s instanceof _))throw s;return null}}function W(s,n,r){return s?"x"in s?function(s,n,r,t){q[0]=s.x,q[1]=s.y;const o=s.z;return q[2]=void 0!==o?o:0,b(q,n,0,q,t,0)?(r.x=q[0],r.y=q[1],r.spatialReference=t,void 0!==o||a(t)?(r.z=q[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),void 0===s.m?(r.m=void 0,r.hasM=!1):(r.m=s.m,r.hasM=!0),r):null}(s,n,new g,r):"xmin"in s?function(s,n,r,t){const{xmin:o,ymin:e,xmax:i,ymax:c,hasZ:u,hasM:l}=s,p=u?s.zmin:0;if(!S(o,e,p,n,q,t))return null;const m=u||a(t);r.xmin=q[0],r.ymin=q[1],m&&(r.zmin=q[2]);const h=u?s.zmax:0;return S(i,c,h,n,q,t)?(r.xmax=q[0],r.ymax=q[1],m&&(r.zmax=q[2]),l&&(r.mmin=s.mmin,r.mmax=s.mmax),r.spatialReference=t,r):null}(s,n,new m,r):"rings"in s?function(s,n,r,t){const{rings:o,hasZ:e,hasM:i}=s,c=[];if(!C(o,e??!1,i??!1,n,c,t,0))return null;const u=e||a(t);return r.rings=c,r.spatialReference=t,r.hasZ=u,r.hasM=i,r}(s,n,new d,r):"paths"in s?function(s,n,r,t){const{paths:o,hasZ:e,hasM:i}=s,c=[];if(!C(o,e??!1,i??!1,n,c,t,0))return null;const u=e||a(t);return r.paths=c,r.spatialReference=t,r.hasZ=u,r.hasM=i,r}(s,n,new y,r):"points"in s?function(s,n,r,t){const{points:o,hasZ:e,hasM:i}=s,c=[],u=o.length,l=[];for(const s of o)l.push(s[0],s[1],e?s[2]:0);if(!b(l,n,0,l,t,0,u))return null;const p=e||a(t);for(let s=0;s<u;++s){const n=3*s,r=l[n],t=l[n+1];p&&i?c.push([r,t,l[n+2],o[s][3]]):p?c.push([r,t,l[n+2]]):i?c.push([r,t,o[s][2]]):c.push([r,t])}return r.points=c,r.spatialReference=t,r.hasZ=e,r.hasM=i,r}(s,n,new h,r):null:null}function C(s,n,r,t,o,e,i=0){const c=new Array;for(const r of s)for(const s of r)c.push(s[0],s[1],n?s[2]:i);if(!b(c,t,0,c,e,0))return!1;let u=0;o.length=0;const l=n||a(e);for(const n of s){const s=new Array;for(const t of n)l&&r?s.push([c[u++],c[u++],c[u++],t[3]]):l?s.push([c[u++],c[u++],c[u++]]):r?(s.push([c[u++],c[u++],t[2]]),u++):(s.push([c[u++],c[u++]]),u++);o.push(s)}return!0}const q=e();export{O as getTransformation,E as getTransformations,A as isLoaded,G as load,P as project};
