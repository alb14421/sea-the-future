/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{clone as e,e as n}from"../core/lang.js";import{c as s}from"../core/Accessor.js";import{L as r}from"../chunks/Logger.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import{w as l}from"../chunks/writer.js";import a,{i as u,p as c}from"./Extent.js";import h from"./Geometry.js";import p from"./Point.js";import m from"./SpatialReference.js";import{f,b as g,i as y}from"../chunks/coordsUtils.js";import{b as j}from"../chunks/extentUtils.js";import{project as x}from"./support/webMercatorUtils.js";import{u as I}from"../chunks/zmUtils.js";import"../core/Handles.js";import"../chunks/maybe.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/Lifecycle.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/events.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/Warning.js";import"../chunks/unitUtils.js";import"../chunks/jsonMap.js";import"../chunks/pe.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";function k(t){const e=[];for(t.reset();t.nextPath();){const n=[];for(;t.nextPoint();)n.push([t.x,t.y]);e.push(n)}return t.reset(),e}function N(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function P(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function R(t){return t?d(t.rings,t.hasZ??!1):null}function d(t,e){if(!t?.length)return null;const n=[],s=[],r=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,i=t.length;n<i;n++){const i=S(t[n],e,r);i&&s.push(i)}if(s.sort((t,n)=>{let s=t[2]-n[2];return 0===s&&e&&(s=t[4]-n[4]),s}),s.length&&(n[0]=s[0][0],n[1]=s[0][1],e&&(n[2]=s[0][3]),(n[0]<r[0]||n[0]>r[1]||n[1]<r[2]||n[1]>r[3]||e&&(n[2]<r[4]||n[2]>r[5]))&&(n.length=0)),!n.length){const s=t[0]&&t[0].length?function(t,e){const n=e?[0,0,0]:[0,0],s=e?[0,0,0]:[0,0];let r=0,i=0,o=0,l=0;for(let a=0,u=t.length;a<u-1;a++){const u=t[a],c=t[a+1];if(u&&c){n[0]=u[0],n[1]=u[1],s[0]=c[0],s[1]=c[1],e&&u.length>2&&c.length>2&&(n[2]=u[2],s[2]=c[2]);const t=g(n,s);if(t){r+=t;const n=f(u,c);i+=t*n[0],o+=t*n[1],e&&n.length>2&&(l+=t*n[2])}}}return r>0?e?[i/r,o/r,l/r]:[i/r,o/r]:t.length?t[0]:null}(t[0],e):null;if(!s)return null;n[0]=s[0],n[1]=s[1],e&&s.length>2&&(n[2]=s[2])}return n}function S(t,e,n){let s=0,r=0,i=0,o=0,l=0;const a=t.length?t[0][0]:0,u=t.length?t[0][1]:0,c=t.length&&e?t[0][2]:0;for(let h=0;h<t.length;h++){const p=t[h],m=t[(h+1)%t.length],[f,g,y]=p,j=f-a,x=g-u,[I,k,N]=m,P=I-a,R=k-u,d=j*R-P*x;if(o+=d,s+=(j+P)*d,r+=(x+R)*d,e&&p.length>2&&m.length>2){const t=y-c,e=N-c,n=j*e-P*t;i+=(t+e)*n,l+=n}f<n[0]&&(n[0]=f),f>n[1]&&(n[1]=f),g<n[2]&&(n[2]=g),g>n[3]&&(n[3]=g),e&&(y<n[4]&&(n[4]=y),y>n[5]&&(n[5]=y))}if(o>0&&(o*=-1),l>0&&(l*=-1),!o)return null;o*=.5,l*=.5;const h=[s/(6*o)+a,r/(6*o)+u,o];return e&&(n[4]===n[5]||0===l?(h[3]=(n[4]+n[5])/2,h[4]=0):(h[3]=i/(6*l)+c,h[4]=l)),h}function w(t,e){let n=0,s=0,r=0;t.nextPoint();const i=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let l=0;l<t.pathSize;l++){t.seekInPath(l);const a=[t.x,t.y];t.seekInPath((l+1)%t.pathSize);const u=[t.x,t.y],[c,h]=a,p=c-i,m=h-o,[f,g]=u,y=f-i,j=g-o,x=p*j-y*m;r+=x,n+=(p+y)*x,s+=(m+j)*x,c<e[0]&&(e[0]=c),c>e[1]&&(e[1]=c),h<e[2]&&(e[2]=h),h>e[3]&&(e[3]=h)}return r>0&&(r*=-1),r?(r*=.5,[n/(6*r)+i,s/(6*r)+o,r]):null}function b(t){const{hasZ:e,totalSize:n}=t;if(0===n)return null;const s=[],r=[],i=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const e=S(N(t),t.hasZ,i);e&&r.push(e)}if(r.sort((t,n)=>{let s=t[2]-n[2];return 0===s&&e&&(s=t[4]-n[4]),s}),r.length&&(s[0]=r[0][0],s[1]=r[0][1],e&&(s[2]=r[0][3]),(s[0]<i[0]||s[0]>i[1]||s[1]<i[2]||s[1]>i[3]||e&&(s[2]<i[4]||s[2]>i[5]))&&(s.length=0)),!s.length){t.reset(),t.nextPath();const n=t.pathSize?function(t){const{hasZ:e}=t,n=e?[0,0,0]:[0,0],s=e?[0,0,0]:[0,0];let r=0,i=0,o=0,l=0;if(t.nextPoint()){let a=t.x,u=t.y,c=t.z;for(;t.nextPoint();){const h=t.x,p=t.y,m=t.z;n[0]=a,n[1]=u,s[0]=h,s[1]=p,e&&(n[2]=c,s[2]=m);const y=g(n,s);if(y){r+=y;const t=f(n,s);i+=y*t[0],o+=y*t[1],e&&t.length>2&&(l+=y*t[2])}a=h,u=p,c=m}}return r>0?e?[i/r,o/r,l/r]:[i/r,o/r]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}(t):null;if(!n)return null;s[0]=n[0],s[1]=n[1],e&&n.length>2&&(s[2]=n[2])}return s}function v(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<1e-6){const e=b(t);return e?[e[0],e[1]]:null}const n=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const s=[t.x,t.y];for(t.reset();t.nextPath();)z(n,s,t);return n[0]*=1/e,n[1]*=1/e,n[0]+=s[0],n[1]+=s[1],n}const T=1/3;function z(t,e,n){if(!t||!n||n.pathSize<3)return null;n.nextPoint();const s=n.x,r=n.y;n.nextPoint();let i,o=n.x-s,l=n.y-r,a=0,u=0;for(;n.nextPoint();)a=n.x-s,u=n.y-r,i=.5*T*(a*l-u*o),t[0]+=i*(o+a),t[1]+=i*(l+u),o=a,l=u;const c=n.getCurrentRingArea(),h=[s,r];return h[0]-=e[0],h[1]-=e[1],h[0]*=c,h[1]*=c,t[0]+=h[0],t[1]+=h[1],t}var A;function E(t){return!Array.isArray(t[0])}let O=A=class extends h{static fromExtent(t){const e=t.clone().normalize(),{spatialReference:n}=t;let s=!1,r=!1;for(const t of e)t.hasZ&&(s=!0),t.hasM&&(r=!0);const i={rings:e.map(t=>{const e=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]];if(s&&t.hasZ){const n=t.zmin+.5*(t.zmax-t.zmin);for(let t=0;t<e.length;t++)e[t].push(n)}if(r&&t.hasM){const n=t.mmin+.5*(t.mmax-t.mmin);for(let t=0;t<e.length;t++)e[t].push(n)}return e}),spatialReference:n};return s&&(i.hasZ=!0),r&&(i.hasM=!0),new A(i)}constructor(t){super(function(t){if(!t)return;let{rings:e,hasM:n,hasZ:s,spatialReference:r}=t;var i;switch(e??=[],i=e,"number"==typeof i[0]?.[0]&&(e=[e]),e[0]?.[0]?.length){case 4:s??=!0,n??=!0;break;case 3:s??=!0!==n,n??=!s;break;default:s??=!1,n??=!1}return r??=m.WGS84,{...t,hasM:n,hasZ:s,rings:e,spatialReference:r}}(t)),this.curveRings=void 0,this.rings=[],this.type="polygon"}get cache(){return this.commitProperty("curveRings"),this.commitProperty("hasM"),this.commitProperty("hasZ"),this.commitProperty("rings"),this.commitProperty("spatialReference"),{}}get centroid(){const t=R(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new p;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}writeCurveRings(t,n){n.curveRings=e(t)}get extent(){const t=j(this),{spatialReference:e}=this;return t?new a({...t,spatialReference:e}):null}get isSelfIntersecting(){return s(r.getLogger(this),"isSelfIntersecting",{replacement:"Please use simplifyOperator.isSimple() instead.",version:"4.33",warnOnce:!0}),u(this.rings)}writeRings(t,n){n.rings=e(this.rings)}addRing(t){if(!t)return;const e=this.rings,n=e.length;if(E(t)){const s=[];for(let e=0,n=t.length;e<n;e++)s[e]=t[e].toArray();e[n]=s}else e[n]=t.slice();return this.notifyChange("rings"),this}clone(){const t=new A;return t.spatialReference=this.spatialReference,t.rings=e(this.rings),t.curveRings=e(this.curveRings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(null==t)return!1;const e=this.spatialReference,s=t.spatialReference;if(null!=e!=(null!=s))return!1;if(null!=e&&null!=s&&!e.equals(s))return!1;if(this.rings.length!==t.rings.length)return!1;const r=([t,e,n,s],[r,i,o,l])=>t===r&&e===i&&(null==n&&null==o||n===o)&&(null==s&&null==l||s===l);for(let e=0;e<this.rings.length;e++){const s=this.rings[e],i=t.rings[e];if(!n(s,i,r))return!1}return!0}contains(t){if(!t)return!1;const e=x(t,this.spatialReference);return c(this,null!=e?e:t)}isClockwise(t){const e=E(t)?t.map(t=>this.hasZ?this.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y]):t;return y(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const n=this.rings[t][e],s=this.hasZ,r=this.hasM;return s&&!r?new p(n[0],n[1],n[2],void 0,this.spatialReference):r&&!s?new p(n[0],n[1],void 0,n[2],this.spatialReference):s&&r?new p(n[0],n[1],n[2],n[3],this.spatialReference):new p(n[0],n[1],this.spatialReference)}insertPoint(t,e,n){return this._validateInputs(t,e,!0)?(I(this,n),Array.isArray(n)||(n=n.toArray()),this.rings[t].splice(e,0,n),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const n=new p(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),n}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],n=this.spatialReference,s=e.map(t=>new p(t,n));return this.notifyChange("rings"),s}setPoint(t,e,n){return this._validateInputs(t,e)?(I(this,n),Array.isArray(n)||(n=n.toArray()),this.rings[t][e]=n,this.notifyChange("rings"),this):this}_validateInputs(t,e,n=!1){if(null==t||t<0||t>=this.rings.length)return!1;if(null!=e){const s=this.rings[t];if(n&&(e<0||e>s.length))return!1;if(!n&&(e<0||e>=s.length))return!1}return!0}toJSON(t){return this.write({},t)}};t([i({readOnly:!0})],O.prototype,"cache",null),t([i({readOnly:!0})],O.prototype,"centroid",null),t([i({json:{write:!0,origins:{"portal-item":{write:!1},"web-map":{write:!1},"web-scene":{write:!1}}}})],O.prototype,"curveRings",void 0),t([l("curveRings")],O.prototype,"writeCurveRings",null),t([i({readOnly:!0})],O.prototype,"extent",null),t([i({readOnly:!0})],O.prototype,"isSelfIntersecting",null),t([i({type:[[[Number]]],json:{write:{isRequired:!0}}})],O.prototype,"rings",void 0),t([l("rings")],O.prototype,"writeRings",null),O=A=t([o("esri.geometry.Polygon")],O);const Z=O;O.prototype.toJSON.isDefaultToJSON=!0;export{d as a,N as b,k as c,b as d,Z as default,P as e,R as p,w as r,v as w};
