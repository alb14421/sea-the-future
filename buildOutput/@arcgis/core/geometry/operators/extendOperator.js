/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{a as t,H as e,G as s,t as r,J as n}from"../../chunks/Point2D.js";import{Envelope2D as o}from"../../chunks/Envelope2D.js";import{c as i,P as m,A as c,B as a}from"../../chunks/Envelope.js";import{S as p,ax as u}from"../../chunks/ProjectionTransformation.js";import{getSpatialReference as h,fromPolyline as l,fromSpatialReference as g,toPolyline as j}from"../../chunks/apiConverter.js";import"../../chunks/Transformation2D.js";import"../../chunks/SimpleGeometryCursor.js";import"../../chunks/tslib.es6.js";import"../../chunks/OperatorDefinitions.js";import"../Extent.js";import"../../chunks/string.js";import"../../chunks/object.js";import"../../core/lang.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/Warning.js";import"../Geometry.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../chunks/events.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/reader.js";import"../SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/writer.js";import"../Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../support/webMercatorUtils.js";import"../Multipoint.js";import"../../chunks/zmUtils.js";import"../Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../Polyline.js";import"../../chunks/jsonConverter.js";function d(t,e){return{m_path:t,m_pointIndex:e}}const k=new class{getOperatorType(){return 10007}supportsCurves(){return!1}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}execute(h,l,g,j,k){return function(h,l,g,j){if(h.isEmpty()||l.isEmpty())return null;if(8&j&&16&j)return null;2&j&&4&j&&t("");const k=new o,f=new o;return h.queryEnvelope(k),l.queryEnvelope(f),k.mergeEnvelope2D(f),function(t,o,i,h){e(t),e(o);let l,g=!1;const j=t.querySegmentIterator(),k=o.querySegmentIterator();let f=0;const y=new p,P=new m({vd:t.getDescription()}),S=new m({vd:t.getDescription()}),x=[],E=[];for(function(t,e,s){const r=[],o=[],i=t.querySegmentIterator();for(;i.nextPath();){i.resetToFirstSegment();const t=i.nextSegment().getStartXY(),e=i.getPathIndex(),s=i.getStartPointIndex();r.push(t),o.push(d(e,s)),i.resetToLastSegment();const n=i.previousSegment().getEndXY(),m=i.getPathIndex(),c=i.getEndPointIndex();r.push(n),o.push(d(m,c))}const m=new c(0);for(let t=0;t<r.length;t++)m.add(t);const p={userSort(t,e,s){s.sort(t,e,(t,e)=>r[t].compare(r[e]))},getValue:t=>r[t].y};(new a).sort(m,0,m.size(),p);for(let t=0;t<m.size()-1;t++){const e=r[m.read(t)];if(e.equals(r[m.read(t+1)])){do{const e=o[m.read(t)];s.push(e),t++}while(t<m.size()&&e.equals(r[m.read(t)]));t--}}n(e,s.length,0);for(let t=0;t<s.length;t++)e[t]=t;e.sort((t,e)=>{const r=s[t],n=s[e];return r.m_path<n.m_path?-1:r.m_path>n.m_path?1:r.m_pointIndex<n.m_pointIndex?-1:1})}(t,x,E);j.nextPath();){let e=!0,n=0;for(;2!==n;){if(0===n)j.nextSegment().getGeometryType()!==s.enumLine&&r(""),n++;else{if(j.resetToLastSegment(),j.previousSegment().getGeometryType()!==s.enumLine&&r(""),g&&e){const s=j.getPathIndex();l.addSegmentsFromPath(t,s,0,t.getSegmentCountPath(s),!0),e=!1}n++}let o=!1;if(f<E.length){const t=E[x[f]],e=j.getPathIndex();if(t.m_path===e){const e=1===n?j.getStartPointIndex():j.getEndPointIndex();t.m_pointIndex===e&&(o=!0,f++)}}if(1===n){if(8&h)continue}else if(16&h)continue;if(!o){1===n?j.previousSegment():j.nextSegment();const o=1===n?j.nextSegment():j.previousSegment(),m=o,c=m.calculateLength2D();k.resetToFirstPath();let a=!1,p=Number.NaN;for(;k.nextPath();){for(;k.hasNextSegment();){const t=k.nextSegment();t.getGeometryType()!==s.enumLine&&r("");const e=t,{bIntersect:o,t1:h,t2:l}=u(m,e);if(o){const t=e.calculateLength2D();if(l*t>=-i&&(1-l)*t>=-i)if(1===n){if(h*c<=-i)(Number.isNaN(p)||h>p)&&(p=h);else if(h*c<=i){p=Number.NaN,a=!0;break}}else if((1-h)*c<=-i)(Number.isNaN(p)||h<p)&&(p=h);else if((1-h)*c<=i){p=Number.NaN,a=!0;break}}}if(a)break}if(!Number.isNaN(p)){if(!g){l=t.createInstance();for(let e=0;e<j.getPathIndex();e++)l.addPath(t,e,!0)}if(1===n){o.queryCoord(p,P);const s=j.getPathIndex();if(2&h?t.getPointByVal(t.getPathStart(s),S):4&h&&S.setEmpty(),1&h||(y.create(o.getGeometryType()),o.copyTo(y.get()),y.get().setEnd(P),y.get().reverse(),l.addSegment(y.get(),!0),e=!1),l.addSegmentsFromPath(t,s,0,t.getSegmentCountPath(s),e),1&h){const t=l.getPathStart(s);l.setPointByVal(t,P)}if(2&h||4&h){const t=l.getPathStart(s),e=P.getXY();S.setXY(e),l.setPointByVal(t,S)}g=!0,e=!1}else{const s=j.getPathIndex();if(e&&(l.addSegmentsFromPath(t,s,0,t.getSegmentCountPath(s),!0),e=!1),2&h?t.getPointByVal(t.getPathEnd(s)-1,S):4&h&&S.setEmpty(),o.queryCoord(p,P),1&h){const t=l.getPathEnd(s);l.setPointByVal(t-1,P)}else y.create(o.getGeometryType()),o.copyTo(y.get()),y.get().setEnd(P),l.addSegment(y.get(),!1);if(2&h||4&h){const t=l.getPathEnd(s),e=P.getXY();S.setXY(e),l.setPointByVal(t-1,S)}g=!0}}}}}return g?l:null}(h,l,i(g,k,!0).total(),j)}(h,l,g,j)}};function f(t,e,s){let r=0;s&&(s.relocateEnds&&(r|=1),s.keepEndAttributes&&(r|=2),s.noEndAttributes&&(r|=4),s.noExtendAtFrom&&(r|=8),s.noExtendAtTo&&(r|=16));const n=h(t),o=k.execute(l(t),l(e),g(n),r,null);return o?j(o,n):null}const y=k.supportsCurves();export{f as execute,y as supportsCurves};
