/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{i as t}from"../../core/lang.js";import{S as e,G as s}from"../../chunks/SimpleGeometryCursor.js";import{p as r,v as o,G as n,P as i,r as c}from"../../chunks/Point2D.js";import{b5 as m,M as u}from"../../chunks/ProjectionTransformation.js";import{Envelope2D as p}from"../../chunks/Envelope2D.js";import{c as a,e as j}from"../../chunks/Envelope.js";import{getSpatialReference as l,toGeometry as h,fromSpatialReference as k,fromGeometry as d}from"../../chunks/apiConverter.js";import"../../chunks/Transformation2D.js";import"../../chunks/tslib.es6.js";import"../../chunks/OperatorDefinitions.js";import"../Extent.js";import"../../chunks/string.js";import"../../chunks/object.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../core/Error.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/Warning.js";import"../Geometry.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../chunks/events.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/reader.js";import"../SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/writer.js";import"../Point.js";import"../../core/accessorSupport/decorators/cast.js";import"../support/webMercatorUtils.js";import"../Multipoint.js";import"../../chunks/zmUtils.js";import"../Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../Polyline.js";import"../../chunks/jsonConverter.js";function g(t,e,s,r){const o=t.getImpl().getAttributeStreamRef(0),n=t.getPointCount(),i=e.getXY(),m=t.createInstance(),u=j(s),a=new p;if(t.queryEnvelope(a),a.inflateCoords(u,u),a.contains(i)){const s=u*u;let r=!1;const p=c(n,!1);for(let t=0;t<n;t++){const e=o.read(2*t),n=o.read(2*t+1),c=e-i.x,m=n-i.y;c*c+m*m<=s&&(r=!0,p[t]=!0)}if(r)for(let e=0;e<n;e++)p[e]||m.addPoints(t,e,e+1);else m.addPoints(t,0,n),m.add(e)}else m.addPoints(t,0,n),m.add(e);return m}class f extends s{constructor(t,e,s,r){super(),this.m_progressTracker=r,this.m_index=-1,this.m_inputGeoms=t,this.m_spatialReference=s,this.m_rightGeom=e.next(),this.m_bEmpty=!this.m_rightGeom,o(this.m_rightGeom)}tock(){return!0}getRank(){return 1}next(){if(this.m_bEmpty)return null;const t=this.m_inputGeoms.next();return t?(o(t),this.m_index=this.m_inputGeoms.getGeometryID(),function(t,e,s,r){const o=t.getDimension(),c=e.getDimension();if(o!==c)return o>c?t:e;if(t.isEmpty())return e;if(e.isEmpty())return t;const l=new p,h=new p,k=new p;t.queryEnvelope(l),e.queryEnvelope(h),k.setCoords({env2D:l}),k.mergeEnvelope2D(h);const d=a(s,k,!0),f=t.getGeometryType(),y=e.getGeometryType();return f===n.enumPoint&&y===n.enumPoint?function(t,e,s){const r=j(s),o=r*r,n=t.getXY(),c=e.getXY(),m=new u({vd:t.getDescription()});return i.sqrDistance(n,c)>o&&(m.add(t),m.add(e)),m}(t,e,d):f===n.enumPoint&&y===n.enumMultiPoint?g(e,t,d):f===n.enumMultiPoint&&y===n.enumPoint?g(t,e,d):m(t,e,s,r)}(t,this.m_rightGeom,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}}const y=new class{getOperatorType(){return 10003}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,r){return new f(t,e,s,r)}execute(t,s,o,n){const i=new e([t]),c=new e([s]),m=this.executeMany(i,c,o,n).next();return m||r("null output"),m}};function x(t,e){const s=l(t);return h(function(t,e,s){return y.execute(t,e,s,null)}(d(t),d(e),k(s)),s)}function _(s,r){const o=s.map(d),n=l(s);return function(t,s,r){const o=y.executeMany(new e(t),new e([s]),r,null);return Array.from(o)}(o,d(r),k(n)).map(t=>h(t,n)).filter(t)}const P=y.supportsCurves(),b=Object.freeze(Object.defineProperty({__proto__:null,execute:x,executeMany:_,supportsCurves:P},Symbol.toStringTag,{value:"Module"}));export{x as execute,_ as executeMany,b as s,P as supportsCurves};
