/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../intl.js";import o from"../../core/Accessor.js";import{i as e}from"../../core/lang.js";import{EventedAccessor as n}from"../../core/Evented.js";import{m as i}from"../../chunks/handleUtils.js";import{watch as s,initial as r}from"../../core/reactiveUtils.js";import{property as a}from"../../core/accessorSupport/decorators/property.js";import{cast as p}from"../../core/accessorSupport/decorators/cast.js";import{subclass as d}from"../../core/accessorSupport/decorators/subclass.js";import{s as c}from"../../chunks/modeUtils.js";import{b as l}from"../../chunks/domUtils.js";import{a as m}from"../../chunks/widgetUtils.js";import{a as h,o as u}from"../../chunks/locale.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/object.js";import"../../chunks/constants.js";import"../../chunks/datetime.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/messages.js";import"../../core/Error.js";import"../../core/promiseUtils.js";import"../../chunks/events.js";import"../../chunks/maybe.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/MapUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/assets.js";import"../../core/Handles.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/ensureType.js";import"../../chunks/Warning.js";const f="esri-component";let g=class extends o{constructor(){super(...arguments),this.widget=null}destroy(){this.node=null,this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(t){this._set("id",t)}set node(t){const o=this._get("node");t!==o&&(t&&t.classList.add(f),o&&o.classList.remove(f),this._set("node",t))}castNode(t){return this.widget?.destroy(),t?"string"==typeof t||function(t){return t&&"nodeType"in t}(t)?(this._set("widget",null),l(t)):(function(t){return t&&"function"==typeof t.render}(t)&&!t.domNode&&(t.domNode=document.createElement("div")),this._set("widget",t),t.domNode):(this._set("widget",null),null)}};t([a()],g.prototype,"id",null),t([a()],g.prototype,"node",null),t([p("node")],g.prototype,"castNode",null),t([a({readOnly:!0})],g.prototype,"widget",void 0),g=t([d("esri.views.ui.Component")],g);const _=g,y={left:0,top:0,bottom:0,right:0},j={bottom:30,top:15,right:15,left:15},k="esri-ui",C={ui:k,corner:`${k}-corner`,innerContainer:`${k}-inner-container`,manualContainer:`${k}-manual-container`,cornerContainer:`${k}-corner-container`,topLeft:`${k}-top-left`,topRight:`${k}-top-right`,bottomLeft:`${k}-bottom-left`,bottomRight:`${k}-bottom-right`};function v(t){return 0===t?"0":`${t}px`}function b(t){const o="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return null!==o&&o!==Object.prototype||!("component"in t||"index"in t||"position"in t)?null:t}function w(t,{top:o,bottom:e,left:n,right:i}){t.style.top=o,t.style.bottom=e,t.style.left=n,t.style.right=i}let N=class extends n{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=h(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&w(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&w(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([s(()=>[this.view?.padding,this.container],this._applyViewPadding,r),s(()=>this.padding,this._applyUIPadding,r),s(()=>[this.container,this._locale],([t,o])=>{t&&t.setAttribute("lang",o)},r),u(t=>{this._locale=t})])}destroy(){this.removeAllHandles(),this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear(),this.view=null,this._set("view",null)}set container(t){const o=this._get("container");t!==o&&(t&&(t.classList.add(C.ui),c(t),this._attachContainers(t)),o&&(o.classList.remove(C.ui),w(o,{top:"",bottom:"",left:"",right:""}),o.textContent=""),this._set("container",t))}get height(){const t=this.view?.height??0;if(0===t)return t;const o=this._getViewPadding(),{top:e,bottom:n}=o;return Math.max(t-e-n,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:{...j,...t}}get width(){const t=this.view?.width??0;if(0===t)return t;const o=this._getViewPadding(),{left:e,right:n}=o;return Math.max(t-e-n,0)}add(t,o){let e,n,i;if(Array.isArray(t))return void t.forEach(t=>this.add(t,o));const s=b(t);s&&({index:e,position:o,component:t,key:n}=s),o&&"object"==typeof o&&({index:e,key:n,position:o,internal:i}=o),!t||o&&!this._isValidPosition(o)||this._add(t,o,e??this._getNumComponentsAtPosition(o),n,i)}remove(t,o){if(!t)return;if(Array.isArray(t))return t.map(t=>this.remove(t,o));const e=this._find(t);if(e){const t=this._componentMap.get(e);if(!t||t.key!==o)return;const n=this._components.indexOf(e),i=e.node.parentNode;return i?.removeChild(e.node),this._componentMap.delete(e),e.widget?.removeHandlesReference(this._removeWidgetHandleKey),this._components.forEach(o=>{const e=this._componentMap.get(o);e&&e.position===t.position&&e.index>t.index&&e.index--}),this._components.splice(n,1)[0]}}empty(t,o={removeInternal:!1}){if(Array.isArray(t)){for(const e of t)this.empty(e,o);return}const e=this._positionNameToContainerLookup[t??"manual"],n=Array.prototype.slice.call(e.children).map(t=>this._findByNode(t)).filter(t=>null!=t&&(!this._componentMap.get(t)?.internal||o.removeInternal));for(const t of n)this.remove(t)}move(t,o){if(Array.isArray(t)&&t.forEach(t=>this.move(t,o)),!t)return;let e;const n=b(t)||b(o);if(n&&(e=n.index,o=n.position,t=n.component||t),o&&!this._isValidPosition(o))return;const i=this.remove(t);i&&this.add(i,{position:o,index:e})}find(t){if(!t)return null;const o=this._findById(t);return o&&(o.widget||o.node)}getComponents(t,o={includeInternal:!1}){return t?Array.isArray(t)?t.flatMap(t=>this._getComponentsAtPosition(t,o)):this._getComponentsAtPosition(t,o):this._components.filter(t=>o.includeInternal||!this._componentMap.get(t)?.internal).map(({widget:t,node:o})=>t??o)}getPosition(t){for(const o in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[o].contains(t))return o;return null}_add(t,e,n,s,r){t instanceof _||(t=new _({node:t}));const{widget:a}=t;null!=a&&a instanceof o&&a.addHandles(i(()=>{queueMicrotask(()=>this.remove(t))}),this._removeWidgetHandleKey),this._components.some(t=>this._componentMap.get(t)?.position===e&&this._componentMap.get(t)?.index===n)&&this._components.forEach(t=>{const o=this._componentMap.get(t);o&&o.position===e&&o.index>=n&&o.index++}),this._place({component:t,position:e,index:n}),this._components.push(t),this._componentMap.set(t,{key:s,position:e,internal:r,index:n})}_find(t){return t?t instanceof _?this._findByComponent(t):"string"==typeof t?this._findById(t):"domNode"in t?this._findByNode(t.domNode):this._findByNode(t):null}_getViewPadding(){return this.view?.padding??y}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(C.innerContainer,C.cornerContainer);const o=document.createElement("div");o.classList.add(C.innerContainer,C.manualContainer);const e=document.createElement("div");e.classList.add(C.topLeft,C.corner),t.appendChild(e);const n=document.createElement("div");n.classList.add(C.topRight,C.corner),t.appendChild(n);const i=document.createElement("div");i.classList.add(C.bottomLeft,C.corner),t.appendChild(i);const s=document.createElement("div");s.classList.add(C.bottomRight,C.corner),t.appendChild(s),this._innerContainer=t,this._manualContainer=o;const r=m();this._cornerNameToContainerLookup={"top-left":e,"top-right":n,"bottom-left":i,"bottom-right":s,"top-leading":r?n:e,"top-trailing":r?e:n,"bottom-leading":r?s:i,"bottom-trailing":r?i:s},this._positionNameToContainerLookup={manual:o,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const o=t.position??"manual",{component:e,index:n}=t,i=this._positionNameToContainerLookup[o],s=null!=n&&n>-1;var r;if((r=e.widget)&&!r._started&&"function"==typeof r.postMixInProperties&&"function"==typeof r.buildRendering&&"function"==typeof r.postCreate&&"function"==typeof r.startup&&e.widget.startup(),!s)return void i.appendChild(e.node);const a=Array.from(i.children);if(0!==a.length){for(const t of a){const o=this._findByNode(t);if(o&&n<(this._componentMap.get(o)?.index??0))return void t.parentNode?.insertBefore(e.node,t)}i.appendChild(e.node)}else i.appendChild(e.node)}_toPixelPosition(t){return{top:v(t.top),left:v(t.left),right:v(t.right),bottom:v(t.bottom)}}_findByComponent(t){return this._components.find(o=>o===t)??null}_findById(t){return this._components.find(({id:o})=>o===t)??null}_findByNode(t){return t?this._components.find(({node:o})=>o===t):null}_getComponentsAtPosition(t,o){const n=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(n.children).map(t=>this._findByNode(t)).filter(e).filter(t=>o.includeInternal||!this._componentMap.get(t)?.internal).map(({widget:t,node:o})=>t??o)}_getNumComponentsAtPosition(t){const o=this._positionNameToContainerLookup[t];return o?.children.length??0}};t([a()],N.prototype,"_locale",void 0),t([a()],N.prototype,"container",null),t([a()],N.prototype,"height",null),t([a({value:j})],N.prototype,"padding",null),t([p("padding")],N.prototype,"castPadding",null),t([a()],N.prototype,"view",void 0),t([a()],N.prototype,"width",null),N=t([d("esri.views.ui.UI")],N);const P=N;export{_ as C,P as default};
