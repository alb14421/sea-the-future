/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{EventedAccessor as e}from"../../core/Evented.js";import{a as n}from"../../chunks/events.js";import{d as i}from"../../chunks/maybe.js";import{watch as o,when as s,syncAndInitial as r,initial as l,sync as a}from"../../core/reactiveUtils.js";import{i as c,c as u}from"../../chunks/screenUtils.js";import{property as d}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/Logger.js";import{subclass as p}from"../../core/accessorSupport/decorators/subclass.js";import{U as h}from"../../chunks/UpdatingHandles.js";import{s as m}from"../../chunks/modeUtils.js";import"../../core/Error.js";import f from"../../widgets/Widget.js";import{c as v,a as g}from"../../chunks/widgetUtils.js";import{t as _,a as y}from"../../chunks/jsxFactory.js";import{p as k}from"../../chunks/a11yUtils.js";import{m as b}from"../../chunks/memoize.js";import{throwIfNotAbortError as j,throwIfAborted as x,after as w}from"../../core/promiseUtils.js";import{waitAnimationFrame as C,waitTick as T}from"../../core/scheduling.js";import{u as M}from"../../chunks/unitFormatUtils.js";import{ad as I,ae as E,af as D}from"../../chunks/unitUtils.js";import{g as P}from"../../chunks/getDefaultUnitForView.js";import{t as $}from"../../chunks/keybindings.js";import{C as S}from"../../chunks/Cyclical.js";import{j as U,a as O,f as L,k as A,b as V,d as R}from"../../chunks/quantityFormatUtils.js";import{t as F,e as z,a as H}from"../../chunks/quantityUtils.js";import{isLoaded as X,fromLatitudeLongitude as Y,fromLongitude as B,fromLatitude as K}from"../../geometry/coordinateFormatter.js";import{f as N,p as q}from"../../chunks/number.js";import{a as W}from"../../chunks/angularMeasurementUtils.js";import{l as G}from"../../chunks/componentsUtils.js";import{m as Q}from"../../chunks/messageBundle.js";import{d as Z}from"../../chunks/directionModeIcons.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/Warning.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/constants.js";import"../../chunks/datetime.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Promise.js";import"../../chunks/uuid.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/mathUtils.js";import"../../chunks/pe.js";import"../../portal/Portal.js";import"../../core/JSONSupport.js";import"../../core/Loadable.js";import"../../chunks/reader.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../chunks/InputManager.js";import"../../chunks/Queue.js";import"../../chunks/SimpleObservable.js";import"../../chunks/signal.js";import"../../chunks/vec2.js";import"../../chunks/common.js";import"../../chunks/vec2f64.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/projectVectorToVector.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectPointToVector.js";import"../../chunks/projectionUtils.js";import"../../chunks/projectXYZToVector.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../chunks/dehydratedPoint.js";import"../../geometry/support/geodesicUtils.js";const J="esri-tooltip",tt=`${J}-content`,et=`${J}-content--input`,nt=`${J}-content__header`,it=`${J}-content__header__spacer`,ot=`${J}-content__header__actions`,st=`${J}-draw-header-actions`,rt=`${J}-table`,lt=`${J}-help-message`,at=`${J}-help-message__text`,ct=`${J}-help-message__icon`,ut=`${J}-field`,dt={base:ut,inputMode:`${ut}--input`,title:`${ut}__title`,value:`${ut}__value`};let pt=class extends f{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return _("div",{class:this.classes({[dt.base]:!0,[dt.inputMode]:"input"===this.mode})},_("div",{class:dt.title,key:"title"},this.title),_("div",{class:dt.value,key:"value"},this.value))}};t([d()],pt.prototype,"hidden",void 0),t([d()],pt.prototype,"mode",void 0),t([d()],pt.prototype,"title",void 0),t([d()],pt.prototype,"value",void 0),pt=t([p("esri.views.interactive.tooltip.components.TooltipField")],pt);const ht={base:`${J}-value-by-value`};let mt=class extends f{constructor(){super(...arguments),this.divider="×"}render(){return _("div",{class:ht.base},_("span",null,this.left),_("span",null,this.divider),_("span",null,this.right))}};function ft(t,e){return{angleRelative:vt,direction:gt,directionRelative:_t,directionRelativeBilateral:yt,latitudeDecimalDegrees:bt,longitudeDecimalDegrees:kt,area:(n,i)=>V(t,n,i??e.area),length:(n,i,o)=>L(t,n,i??e.length,o),lengthRelative:(n,i)=>A(t,n,i??e.length),totalLength:(n,i)=>L(t,n,i??e.length),verticalLength:(n,i)=>O(t,n,i??e.verticalLength),verticalLengthRelative:(n,i)=>U(t,n,i??e.verticalLength),percentage:Tt,scalar:It,scale:Mt}}function vt(t){return N(t,{signDisplay:"exceptZero",...Et(1)})}function gt(t){return R(t,t.rotationType,1)}function _t(t){const e=W(t);return N(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...Et(1)})}function yt(t){return R(t,t.rotationType,1)}function kt(t){return wt(t,Ft)}function bt(t){return wt(t,zt)}function jt(t){return Ct(t,Ft)}function xt(t){return Ct(t,zt)}function wt(t,e){return R(F(t,"degrees"),"geographic",6,e,!1)}function Ct(t,e){const n=e.normalize(F(t,"degrees").value,void 0,!1);return It(z(n),6)}function Tt(t){return N(t.value,{style:"percent"})}function Mt(t){return N(t,{style:"percent",maximumFractionDigits:0})}function It(t,e){return N(t.value,Et(e))}function Et(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function Dt({createQuantity:t,sanitize:e}){return(n,i)=>{if(null==n)return null;e&&(n=e(n));const o=q(n);return null==o?null:t(o,i)}}function Pt(t){return t.replaceAll(/[*^~°º]/g,"")}t([d()],mt.prototype,"left",void 0),t([d()],mt.prototype,"divider",void 0),t([d()],mt.prototype,"right",void 0),mt=t([p("esri.views.interactive.tooltip.components.ValueByValue")],mt);const $t=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return""!==t.decimal&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},St=[];for(const t of[",","\\|","\\s+"])for(const e of["\\.",",",""])for(const n of["",",","\\."," ","\\s+"])t!==e&&t!==n&&e!==n&&St.push({separator:t,decimal:e,thousands:n,pattern:$t({decimal:e,thousands:n,separator:t})});function Ut(t){for(const{decimal:e,thousands:n,pattern:i}of St){i.lastIndex=0;const o=t.match(i);if(!o)continue;const s=q(Ot(o[1],e,n)),r=q(Ot(o[2],e,n));if(null!=s&&null!=r)return{x:z(s),y:z(r)}}return null}function Ot(t,e,n){let i=t.replaceAll(/[\s+]/g,"");return""!==n&&(i=i.replaceAll(n,"")),""!==e&&(i=i.replaceAll(e,".")),i}function Lt(t){if(!t||null!=q(t)||!X())return null;const e=Y(t),n=Rt(e?.latitude),i=Rt(e?.longitude);return null!=i&&null!=n?{latitude:n,longitude:i}:null}function At(t){return Rt(B(t))}function Vt(t){return Rt(K(t))}function Rt(t){return null!=t?H(t,"degrees","geographic"):null}const Ft=new S(-180,180),zt=new S(-90,90),Ht=Symbol("dragHandles");let Xt=class extends f{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=b(ft),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&"calcite-button"!==e?.tagName?.toLowerCase()&&(this.removeHandles(Ht),t.preventDefault(),t.stopPropagation(),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([n(e,"pointermove",({clientX:t,clientY:e})=>{this.tooltip.onDrag(t,e)}),n(e,["pointerup","pointercancel"],n=>{this.removeHandles(Ht),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()}),n(e,"touchstart",t=>t.preventDefault())],Ht))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),"commit-and-exit"===e)return void this.exitInputMode();if("commit-on-blur"===e)return;const n=this._getFocusableElements(),i=n.length,o=n.indexOf(t);if(-1===o)return void this.exitInputMode();const s=((o+("commit-and-next"===e?1:-1))%i+i)%i;Yt(n.at(s))},this._onKeyDown=t=>{switch(t.code){case $.next:return this._onNextKey(t);case $.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=P(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:M(t,e,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,i=P(this.tooltip.view),o=n.length??i,s=n.verticalLength??i,r=n.area??i;return{length:e(D(o)),verticalLength:e(E(s)),area:e(I(r)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,n=this._renderedActions,i=this._renderedHelpMessage,o=e.length>0,s=o||!!i,r="input"===this.mode;return _("div",{class:v(tt,r&&et),onkeydown:this._onKeyDown,tabIndex:-1},r&&s&&t.header?_("div",{class:nt,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},_("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?_(y,null,_("div",{class:it,key:"spacer"}),_("div",{class:ot,key:"actions"},n)):null):null,o?_("div",{class:rt,key:"content"},...e):null,i)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return G({button:()=>import("../../chunks/index6.js"),icon:()=>import("../../chunks/index.js"),input:()=>import("../../chunks/index10.js")})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(t){j(t)}}async exitInputMode({focusOnView:t=!0}={}){try{const{container:e,info:n}=this;n.clearInputValues();const i=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),i instanceof HTMLElement&&i.focus()}catch(t){j(t)}}_onNextKey(t){const e=this._getFocusableElements(),n=e.at(0),i=e.at(-1);n&&i&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),Yt(i)):document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),Yt(n)))}get _renderedContent(){return Bt(this._renderContent())}get _renderedActions(){return Bt(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const n=t.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const i=t.tooltips.helpMessageIcon??"information";return _("div",{class:lt,key:"help-message"},i?_("calcite-icon",{class:ct,icon:i,scale:"s"}):null,_("div",{class:at},n))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(null==t)return null;const n="3d"===e?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[n]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),x(e);const n=this._getFocusableInputs(),i=t?n.find(e=>e.getAttribute("data-field-name")===t):n.at(0);await Yt(i)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=t,await T(),this.destroyed||(this.renderNow(),await T(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||k())return void await n();this.autoRenderingEnabled=!1;const i=this._transitionInfo={transition:document.startViewTransition(async()=>{this.destroyed||i!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())}),mode:t};try{await i.transition.finished}finally{i===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===t().length;)await w(Kt);await C()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${st}`);return[...Array.from(t?.querySelectorAll(`.${ot} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function Yt(t){await(t?.setFocus())}function Bt(t){return(Array.isArray(t)?t:[t]).flat(10).filter(t=>!!t)}t([Q("esri/core/t9n/Units"),d()],Xt.prototype,"_messagesUnits",void 0),t([Q("esri/views/interactive/tooltip/t9n/Tooltip"),d()],Xt.prototype,"_messagesTooltip",void 0),t([d()],Xt.prototype,"info",void 0),t([d()],Xt.prototype,"tooltip",void 0),t([d()],Xt.prototype,"_mode",void 0),t([d()],Xt.prototype,"mode",null),t([d()],Xt.prototype,"_displayUnits",null),t([d()],Xt.prototype,"_inputUnitInfos",null),t([d()],Xt.prototype,"_formatters",null),t([d()],Xt.prototype,"fieldContext",null),t([d()],Xt.prototype,"_renderedContent",null),t([d()],Xt.prototype,"_renderedActions",null),t([d()],Xt.prototype,"_renderedHelpMessage",null),t([d()],Xt.prototype,"_defaultHelpMessage",null),Xt=t([p("esri.views.interactive.tooltip.content.TooltipContent")],Xt);const Kt=20;let Nt=class extends Xt{_renderContent(){const{area:t,radius:e,xSize:n,ySize:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return _(y,null,o.radius&&null!=e?_(pt,{title:s.radius,value:r.length(e)}):null,o.size&&null!=n&&null!=i?_(pt,{title:s.size,value:_(mt,{left:r.length(n),right:r.length(i)})}):null,o.area?_(pt,{title:s.area,value:r.area(t)}):null)}};Nt=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Nt);const qt=`${J}-editable-field`,Wt={base:qt,inputMode:`${qt}--input`,feedbackMode:`${qt}--feedback`,readOnly:`${qt}--read-only`,locked:`${qt}--locked`,title:`${qt}__title`,value:`${qt}__value`,valueContent:`${qt}__value__content`,valueContentReadOnly:`${qt}__value__content--read-only`,lockIcon:`${qt}__lock-icon`,input:`${qt}__input`,inputWrapper:`${qt}__input-wrapper`,inputMessage:`${qt}__input-message`,inputSuffix:`${qt}__input-suffix`,button:`${qt}__button`},Gt="lock";let Qt=class extends f{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===$.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case $.commit:return this.field.onCommit("commit-and-exit",e,this.context);case $.next:{t.preventDefault(),t.stopPropagation();const n=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.currentTarget.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),C().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");e&&null!=this.field.parse(e,this.context)&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{("historyUndo"===t.inputType||"historyRedo"===t.inputType)&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(o(()=>this._rawDisplayValue,()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return G({button:()=>import("../../chunks/index6.js"),icon:()=>import("../../chunks/index.js"),input:()=>import("../../chunks/index10.js"),"input-message":()=>import("../../chunks/index38.js")})}render(){const{field:t,mode:e}=this,n="input"===e,{locked:i,readOnly:o}=t;return _("div",{class:this.classes({[Wt.base]:!0,[Wt.feedbackMode]:"feedback"===e,[Wt.inputMode]:"input"===e,[Wt.locked]:i,[Wt.readOnly]:o})},_("div",{class:Wt.title,key:"title"},this._title),_("div",{class:Wt.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Zt}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}get _messages(){return this.context?.messages.sketch??{}}_renderValueFeedbackMode(){return _(y,null,_("div",{class:Wt.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?_("calcite-icon",{class:Wt.lockIcon,icon:Gt,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return _("div",{class:this.classes(Wt.valueContent,Wt.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,e=this._messages,{name:n,invalid:i}=t;return _(y,null,_("div",{class:Wt.inputWrapper,key:"value-input"},_("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:Wt.input,"data-field-name":n,"data-testid":`tooltip-field-${n}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??Zt,onCalciteInputInput:this._onInput}),i?_("calcite-input-message",{class:Wt.inputMessage,scale:"s",status:"invalid"},e.invalidValue):null),_("div",{class:Wt.inputSuffix,key:"suffix"},this._suffix),this._renderedLockButton)}get _renderedLockButton(){const{name:t,locked:e,lockable:n}=this.field;if(!n)return _("div",{key:"no-lock-button"});const i=this._messages,o=e?i.unlockConstraint:i.lockConstraint;return _("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:Wt.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:e?Gt:"unlock",key:"lock-button",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o})}};t([d()],Qt.prototype,"field",void 0),t([d()],Qt.prototype,"context",void 0),t([d()],Qt.prototype,"mode",void 0),t([d()],Qt.prototype,"_input",void 0),t([d()],Qt.prototype,"_lock",void 0),t([d()],Qt.prototype,"_formattedValue",null),t([d()],Qt.prototype,"_rawDisplayValue",null),t([d()],Qt.prototype,"_suffix",null),t([d()],Qt.prototype,"_title",null),t([d()],Qt.prototype,"_messages",null),t([d()],Qt.prototype,"_renderedLockButton",null),Qt=t([p("esri.views.interactive.tooltip.components.TooltipEditableField")],Qt);const Zt="—";function Jt(t){const e=t.fields.filter(t=>!0===t?.visible);return 0===e.length?null:_(y,null,e.map(e=>_(Qt,{context:t.context,field:e,key:e.id,mode:t.mode})))}let te=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return _(Jt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};te=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],te);let ee=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{elevation:i,visibleElements:o}=e;return _(Jt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?i:void 0],mode:n})}};ee=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],ee);let ne=class extends f{constructor(t){super(t),this.visibleElements={}}render(){return _("div",{class:st},this._isElementVisible("direction")?_(ie,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return G({button:()=>import("../../chunks/index6.js"),dropdown:()=>import("../../chunks/index7.js"),"dropdown-item":()=>import("../../chunks/index8.js"),"dropdown-group":()=>import("../../chunks/index9.js")})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function ie(t){const{directionMode:e}=t.sketchOptions.values,n=t.messages?.sketch,i=n?.directionModeSelect?.title,o="absolute",s="relative";return _("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:e=>{const n=e.currentTarget.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=n??"absolute"}},_("calcite-button",{alignment:"end",appearance:"transparent",iconStart:Z[e],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),_("calcite-dropdown-group",{selectionMode:"single"},_("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-relative",iconStart:Z.relative,key:"relative",selected:e===s},n?.directionModeSelect?.relative),_("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-absolute",iconStart:Z.absolute,key:"absolute",selected:e===o},n?.directionModeSelect?.absolute)))}t([Q("esri/views/interactive/tooltip/t9n/Tooltip"),d()],ne.prototype,"messages",void 0),t([d()],ne.prototype,"sketchOptions",void 0),t([d()],ne.prototype,"visibleElements",void 0),ne=t([p("esri.views.interactive.tooltip.components.DrawHeaderActions")],ne);let oe=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return _(Jt,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.area?e.area:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return _(ne,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};oe=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],oe);let se=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return _(Jt,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.totalLength?e.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return _(ne,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};se=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],se);let re=class extends Xt{_renderContent(){const{area:t,xSize:e,ySize:n,visibleElements:i}=this.info,o=this._messagesTooltip.sketch,s=this._formatters;return _(y,null,i.size&&null!=e&&null!=n?_(pt,{title:o.size,value:_(mt,{left:s.length(e),right:s.length(n)})}):null,i.area?_(pt,{title:o.area,value:s.area(t)}):null)}};re=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],re);let le=class extends Xt{_renderContent(){const{angle:t,visibleElements:e}=this.info,n=this._messagesTooltip.sketch;return _(y,null,e.rotation?_(pt,{title:n.rotation,value:this._formatters.angleRelative(t)}):null)}};le=t([p("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],le);let ae=class extends Xt{_renderContent(){const t=this.info,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return _(y,null,e.size?_(pt,{title:n.size,value:_(mt,{left:i.length(t.xSize),right:i.length(t.ySize)})}):null,e.scale?_(pt,{title:n.scale,value:_(mt,{left:i.scale(t.xScale),right:i.scale(t.yScale)})}):null)}};ae=t([p("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],ae);let ce=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return _(Jt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0],mode:n})}};ce=t([p("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],ce);let ue=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return _(Jt,{context:t,fields:[i.distance?e.distance:void 0,i.area?e.area:void 0,i.totalLength?e.totalLength:void 0],mode:n})}};ue=t([p("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],ue);let de=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return _(Jt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.area&&"polygon"===e.geometryType?e.area:null,i.totalLength&&"polyline"===e.geometryType?e.totalLength:null],mode:n})}};de=t([p("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],de);let pe=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return _(Jt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};pe=t([p("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],pe);let he=class extends Xt{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return _(Jt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.size?e.size:void 0],mode:n})}};he=t([p("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],he);let me=class extends Xt{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return _(y,null,e.distance?_(pt,{title:n.distance,value:i.length(t.distance)}):null)}};me=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslate")],me);let fe=class extends Xt{_renderContent(){const{distance:t,elevation:e,area:n,totalLength:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return _(y,null,o.distance?_(pt,{title:s.distance,value:r.length(t)}):null,o.elevation&&null!=e?.actual?_(pt,{title:s.elevation,value:r.verticalLength(e.actual)}):null,o.area&&null!=n?_(pt,{title:s.area,value:r.area(n)}):null,o.totalLength&&null!=i?_(pt,{title:s.totalLength,value:r.length(i)}):null)}};fe=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],fe);let ve=class extends Xt{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return _(y,null,e.distance?_(pt,{title:n.distance,value:i.length(t.distance)}):null)}};ve=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],ve);let ge=class extends Xt{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch;return _(y,null,e.distance?_(pt,{title:n.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};ge=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],ge);const _e={base:`${J}`,ltr:`${J}--ltr`,rtl:`${J}--rtl`,debug:`${J}--debug`};let ye=class extends e{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._updatingHandles=new h,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([o(()=>this.view.overlay?.surface,e=>{t.remove(),e?.appendChild(t),this._rtl=g(e)},r),o(()=>this.info,(e,n)=>{if(null!=this.content&&null!=e&&null!=n&&e.type===n.type)this.content.info=e;else{i(this.content);const n=function(t,e){if(null==e)return null;const n=document.createElement("div");switch(e.type){case"draw-point":case"draw-multipoint":return new ee({tooltip:t,info:e,container:n});case"draw-polygon":return new oe({tooltip:t,info:e,container:n});case"draw-polyline":return new se({tooltip:t,info:e,container:n});case"draw-mesh":return new te({tooltip:t,info:e,container:n});case"draw-rectangle":return new re({tooltip:t,info:e,container:n});case"draw-circle":return new Nt({tooltip:t,info:e,container:n});case"extent-rotate":return new le({tooltip:t,info:e,container:n});case"extent-scale":return new ae({tooltip:t,info:e,container:n});case"move-point":return new ce({tooltip:t,info:e,container:n});case"selected-vertex":return new de({tooltip:t,info:e,container:n});case"transform-point":return new he({tooltip:t,info:e,container:n});case"transform-mesh":return new pe({tooltip:t,info:e,container:n});case"translate":return new me({tooltip:t,info:e,container:n});case"translate-vertex":return new fe({tooltip:t,info:e,container:n});case"translate-z":return new ge({tooltip:t,info:e,container:n});case"translate-xy":return new ve({tooltip:t,info:e,container:n});case"reshape-edge-offset":return new ue({tooltip:t,info:e,container:n})}}(this,e);n?(this.content=n,n.container&&t.appendChild(n.container),this.exitInputMode()):this.content=null}},r),o(()=>({container:this.outerContainer,style:this._outerContainerStyle}),({container:t,style:e})=>{Object.assign(t.style,e)},l),o(()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug}),({outerContainer:t,placement:e,effectiveOffset:n,rtl:i,debug:o})=>{const{classList:s}=t;s.add(_e.base),s.toggle(_e.rtl,i),s.toggle(_e.ltr,!i),s.toggle(_e.debug,o),this.outerContainer.style.setProperty("--offset",`${n}px`),m(t),function({classList:t},e){ke.forEach(e=>t.remove(e)),t.add(be(e))}(t,e)},l),s(()=>"feedback"===this.mode,()=>{this.position=null,this._clearOverride("effectivePlacement")},a),n(this.outerContainer,"paste",t=>{this.emit("paste",t)}),n(this.outerContainer,["focusin","focusout"],()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1})])}destroy(){this.info=null,this.content=i(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??"bottom-end"}get updating(){return this._updatingHandles.updating}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=c(t),null!=t&&null!=this.content?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,n=this.position=c(e),{effectivePlacement:i}=this;this._override("effectivePlacement",i),await this._updatingHandles.addPromise(this.content?.enterInputMode(t,()=>{n&&(this.position=function(t,e,n,i){if(!t||!i.container)return e;const o=t.getBoundingClientRect(),{left:s,top:r}=i.container.getBoundingClientRect();let{x:l,y:a}=e;const c=o.left-s-n;c<0&&(l-=c);const d=o.right-s+n-i.width;d>0&&(l-=d);const p=o.top-r-n;p<0&&(a-=p);const h=o.bottom-r+n-i.height;return h>0&&(a-=h),u(l,a)}(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))}))}async exitInputMode(t){await this._updatingHandles.addPromise(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const n=t-this._prevXY[0],i=e-this._prevXY[1];this._prevXY=[t,e];const{position:o}=this;if(o){const{view:s}=this,r=t-s.position[0],l=e-s.position[1];if(r<0||r>s.width||l<0||l>s.height-16)return;this.position=u(o.x+n,o.y+i)}}onDragEnd(){this._prevXY=[0,0]}};t([d({nonNullable:!0})],ye.prototype,"view",void 0),t([d()],ye.prototype,"info",void 0),t([d()],ye.prototype,"options",void 0),t([d()],ye.prototype,"position",void 0),t([d()],ye.prototype,"content",void 0),t([d({readOnly:!0})],ye.prototype,"mode",null),t([d()],ye.prototype,"_focused",void 0),t([d({readOnly:!0})],ye.prototype,"focused",null),t([d({readOnly:!0})],ye.prototype,"outerContainer",void 0),t([d({readOnly:!0})],ye.prototype,"contentContainer",null),t([d({readOnly:!0})],ye.prototype,"effectivePlacement",null),t([d()],ye.prototype,"debug",void 0),t([d()],ye.prototype,"updating",null),t([d()],ye.prototype,"_lastPosition",void 0),t([d()],ye.prototype,"_screenPoint",null),t([d()],ye.prototype,"_rtl",void 0),t([d()],ye.prototype,"_effectiveOffset",null),t([d()],ye.prototype,"_outerContainerStyle",null),ye=t([p("esri.views.interactive.Tooltip")],ye);const ke=["top","bottom","leading","trailing"].flatMap(t=>[be(`${t}-start`),be(t),be(`${t}-end`)]);function be(t){return`${_e.base}--${t}`}const je=ye;export{Ut as a,At as b,xt as c,Vt as d,je as default,Rt as e,jt as f,Dt as m,Lt as p,Pt as s};
