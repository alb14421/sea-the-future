/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../../Camera.js";import{r as t,g as n,e as s,c as r,l as i,h as o}from"../../chunks/mathUtils.js";import{c as a}from"../../chunks/mat4f64.js";import{e as c,u,i as l,h as p,j as m,d as h,l as f,n as d,c as g,t as j,a as y,k as M,y as k,v as x,x as b,m as v,C as _}from"../../chunks/vec3.js";import{c as R,f as w,Z as T,b as E}from"../../chunks/vec3f64.js";import A from"../../geometry/Point.js";import S from"../../geometry/SpatialReference.js";import{c as C}from"../../chunks/computeTranslationToOriginAndRotation.js";import{p as I}from"../../chunks/projectBuffer.js";import{p as P}from"../../chunks/projectPointToVector.js";import{p as U}from"../../chunks/projectVectorToVector.js";import{U as F,m as H}from"../../chunks/unitUtils.js";import{A as N}from"../../chunks/aaBoundingRect.js";import O from"./webgl/RenderCamera.js";import{I as L}from"../../chunks/Intersector2.js";import{B as q,r as G,a as z,A as D}from"../../chunks/mat4.js";import{c as B,a as W,f as V}from"../../chunks/vec2f64.js";import Q from"../../geometry/Extent.js";import Y from"../../geometry/Polygon.js";import{i as Z}from"../../chunks/coordsUtils.js";import{w as J}from"../../chunks/vec2.js";import{w as X,c as K,b as $}from"../../chunks/ray.js";import{w as ee,c as te,f as ne}from"../../chunks/lineSegment.js";import{e as se,f as re,c as ie,j as oe,x as ae,g as ce}from"../../chunks/plane.js";import{C as ue,b as le}from"../../chunks/Cyclical.js";import{s as pe,g as me}from"../../chunks/vec4.js";import{c as he}from"../../chunks/vec4f64.js";import{g as fe}from"../../chunks/common.js";import{k as de,b as ge,l as je,m as ye}from"../../chunks/sphere.js";import{geographicToWebMercator as Me}from"../../geometry/support/webMercatorUtils.js";import{e as ke,k as xe,j as be,l as ve,b as _e,m as Re,n as we,d as Te,p as Ee}from"../../chunks/frustum.js";import{a as Ae}from"../../chunks/earthUtils.js";import{a as Se}from"../../chunks/mathUtils2.js";import"../../chunks/tslib.es6.js";import"../../CameraLayout.js";import"../../core/Clonable.js";import"../../core/Accessor.js";import"../../core/lang.js";import"../../core/Handles.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/Warning.js";import"../../core/Error.js";import"../../chunks/get.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../chunks/events.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../core/JSONSupport.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../geometry/Geometry.js";import"../../chunks/jsonMap.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectionUtils.js";import"../../chunks/SimpleObservable.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polyline.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/projectXYZToVector.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../chunks/dehydratedPoint.js";import"../../chunks/screenUtils.js";import"../../chunks/vector.js";import"../../chunks/mat3f64.js";import"../../chunks/quatf64.js";import"../../chunks/mat3.js";import"../../chunks/HUDIntersectorResult.js";import"../../chunks/orientedBoundingBox.js";import"../../chunks/quat.js";import"../../chunks/spatialReferenceEllipsoidUtils.js";class Ce{constructor(e=1/0,t=-1/0){this.near=e,this.far=t}set(e,t){this.near=e,this.far=t}union(e){null!=e&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}equals(e){return this.near===e.near&&this.far===e.far}static{this.zero=new Ce(0,0)}static{this.infinite=new Ce}}function Ie(e,t,n,s){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,Oe,s)&&N(n,Oe)}function Pe(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function Ue(e,t,n,s){const r=e.state.camera.clone();t&&n&&s&&(r.eye=t,r.center=n,r.up=s),function(e,t,n){let s=He[e.viewingMode];s||(s=new L(e.state.viewingMode),s.options.backfacesTerrain=!e.state.isGlobal,s.options.invisibleTerrain=!0,He[e.viewingMode]=s);const{isGlobal:r}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,s,n)||Fe(e,t.origin,n))||!(!e.renderCoordsHelper.intersectManifold(t,0,n)||Fe(e,t.origin,n))||!!r&&function(e,t,n){const s=h(e.origin,e.origin)-n*n,r=s>0?Math.sqrt(s)/3:1;return l(t,e.direction,r/f(e.direction)),m(t,t,e.origin),!0}(t,n,F(e.spatialReference).radius)}(e,r.ray,Le)||c(Le,r.center);const i=e.state.constraints,o=i.minimumPoiDistance;if(u(r.eye,Le)<o){const t=i.collision.enabled;c(qe,r.viewForward),l(qe,qe,o),t?r.eye=p(Oe,Le,qe):m(Le,r.eye,qe);const n=e.renderCoordsHelper,s=n.getAltitude(r.eye),a=i.collision.elevationMargin;t&&s<a&&(p(qe,Le,r.eye),r.eye=n.setAltitude(Oe,a,r.eye),m(Le,r.eye,qe))}return r.center=Le,r}function Fe(e,t,n){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const s=Pe(e,t),r=e.stateManager.constraintsManager.nearFarHeuristic;let i=Ge.get(e);void 0===i&&(i=new O,Ge.set(e,i)),i.eye=t,i.center=n;const{far:o}=r.compute(i,e.renderDataExtent,Ce.infinite,s),a=o*o;return u(t,n)>a}let He={};function Ne(){He={}}const Oe=R(),Le=R(),qe=R(),Ge=new WeakMap;function ze(e,t,n,s){const r=function(e,t){const n=0===t||2===t?0:1,s=e[t],r=0===t||1===t?1:-1,i=0===n?1:0;return(e,t,o)=>{if(t[n]<s&&o[n]<s)return 1===r?0:1;if(t[n]>s&&o[n]>s)return 1===r?1:0;const a=(o[i]-t[i])/(o[n]-t[n]),c=t[i]+a*(s-t[n]);return e[n]=s,e[i]=c,(t[n]<s?1:-1)*r>0?2:3}}(n,s);if(e.length=0,t.length){1===r(Be,t[0],t[0])&&De(e,t[0]);for(let n=0;n<t.length;n++){const s=t[n===t.length-1?0:n+1];switch(r(Be,t[n],s)){case 1:De(e,s);break;case 3:De(e,W(Be));break;case 2:De(e,W(Be)),De(e,s)}}}}function De(e,t){0!==e.length&&J(e.at(-1),t)||e.push(t)}const Be=B(),We=R(),Ve=R();function Qe(){return{direction:R(),up:R()}}function Ye(e,s,r,i,o){let a=d(We,e),u=h(a,i);const m=u>0;u=Math.abs(u),u>.99&&(u=Math.abs(h(s,i)),u<.99?(c(a,s),m&&l(a,a,-1)):a=null);let j=0;if(a){l(Ve,i,h(i,a)),p(a,a,Ve);const e=h(a,o)/(f(a)*f(o));g(Ve,a,o),j=(h(Ve,i)>0?1:-1)*t(n(e))}const y=t(n(-h(i,e)/f(e)));return r?(r.heading=j,r.tilt=y,r):{heading:j,tilt:y}}function Ze(e,t,n,s){p(Je,n,t),se(s,ee(t,Je),e)||e===n||c(e,n)}const Je=R(),Xe=w(0,1,0),Ke=w(0,0,1),$e=a(),et=R(),tt=R();function nt(e,t,n,r=Qe()){const{direction:i,up:o}=r;return q($e,-s(t)),G($e,$e,s(n)),j(i,Ke,$e),l(i,i,-1),j(o,Xe,$e),r}function st(e,t,n,s,r){const i=t.lines[11].direction,o=(r-n.getAltitude(s))/i[2];y(e,s,i,o)}const rt=R(),it=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,n,s){return Ye(t,n,s,Ke,Xe)},eyeForCenterWithHeadingTilt:function(e,t,n,s){const r=nt(0,n,s),i=R();return l(i,r.direction,-t),m(i,i,e),{up:r.up,eye:i,heading:n,tilt:s}},eyeTiltToLookAtTilt:function(e){return s(e)},headingTiltToDirectionUp:nt,lookAtTiltToEyeTilt:function(e){return t(e)},toArea:function(e,t){const n=e.frustum,{renderCoordsHelper:s}=e,r=s.getAltitude(t),i=e.spatialReference,o=e.state.camera.eye,a=[],c=n.planes[5];for(let e=0;e<4;e++){const t=n.lines[e];s.intersectInfiniteManifold(X(t.origin,t.direction),r,rt)||st(rt,n,s,t.endpoint,r),Ze(rt,o,rt,c),a.push(V(rt[0],rt[1]))}return function(e,t,n){const s=e.map(e=>(M(rt,e[0],e[1],0),t.fromRenderCoords(rt,rt,n),[rt[0],rt[1]]));return s.length<=2?new Y({spatialReference:n}):(s.push(s[0].slice()),Z(s)||s.reverse(),new Y({rings:[s],spatialReference:n}))}(function(e,t){const n=[],s=[];return ze(n,e,t,0),ze(s,n,t,1),ze(n,s,t,2),ze(s,n,t,3),s}(a,s.extent),s,i)},toExtent:function(e,t,n,s,r){const i=e.renderSpatialReference,o=e.spatialReference??t.spatialReference;return P(t,et,i),P(t,tt,i),et[0]-=n/2,tt[0]+=n/2,et[1]-=s/2,tt[1]+=s/2,U(et,i,et,o),U(tt,i,tt,o),r?(r.xmin=et[0],r.ymin=et[1],r.xmax=tt[0],r.ymax=tt[1],r.spatialReference=o):r=new Q(et[0],et[1],tt[0],tt[1],o),r}},Symbol.toStringTag,{value:"Module"}));class ot{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=ke(),this._points=xe(),this.lines=new Array(12),this._origin=R(),this._direction=R(),this._altitude=null;for(let e=0;e<12;e++)this.lines[e]={origin:null,direction:R(),endpoint:null}}update(e){be(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),c(this._origin,e.eye),c(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)c(this._points[t],e[t]);ve(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return _e(this.frustum,e)}intersectsRay(e){return Re(this.frustum,e)}intersectsLineSegment(e,t){return we(this.frustum,e,t)}intersectsPoint(e){return Te(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const n=t+4;at(this.lines[t],e[t],e[n]),at(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),at(this.lines[t+8],e[n],3===t?e[4]:e[n+1])}}static{this.planePointIndices=Ee}static{this.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]]}}function at(e,t,n){e.origin=t,e.endpoint=n,k(e.direction,t,n)}function ct(e){return r((e-ut)/(lt-ut),0,1)}const ut=1e5,lt=1e6,pt=1e4,mt=w(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),ht=w(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6))),ft=3996e-9,dt=w(parseFloat(Number(mt[0]+ht[0]).toFixed(6)),parseFloat(Number(mt[1]+ht[1]).toFixed(6)),parseFloat(Number(mt[2]+ht[2]).toFixed(6)));function gt(e,t,n){return 1===e?new yt(t,n):new jt(t,n)}class jt{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=F(t),this._unitInMeters=H(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,n,s){const{eye:o,center:a}=e;let c=o[2]*this._unitInMeters;const u=c,l=c-s,m=this._elevationProvider?.visibleElevationBounds;m&&(c=l>=0?u-this._unitInMeters*m.min:this._unitInMeters*m.max-u),t??=new Q({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});const f={x:t.xmax-t.xmin,y:t.ymax-t.ymin,z:4*Math.max(t.xmax-t.xmin,t.ymax-t.ymin)},g=Math.max(f.x,f.y,f.z);p(Et,a,o),Tt[0]=Et[0]>0?t.xmax:t.xmin,Tt[1]=Et[1]>0?t.ymax:t.ymin,Tt[2]=Et[2]>0?g/2:-g/2,p(Tt,Tt,o),d(Et,Et);const j=1.1*h(Tt,Et)*this._unitInMeters,y=Math.sqrt(c*(c+2*this._referenceEllipsoid.radius)),M=Math.max(t.xmax-t.xmin,t.ymax-t.ymin),k=M*Rt*this._unitInMeters,x=M*wt*this._unitInMeters,b=r((c-x)/(k-x),0,1)**3,v=Math.min(i(y,j,b),y)*Math.max(Math.log(Math.abs(l)),1);return Mt(Math.min(v,Math.max(34064e4,g))/this._unitInMeters,bt,this._unitInMeters,At)}}class yt{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=F(t)}compute(e,t,s,o){const{eye:a}=e,c=f(a),u=c-this._referenceEllipsoid.radius,m=this._referenceEllipsoid.radius+Math.min(0,o),g=Math.abs(u-o),j=Math.max(g,Math.abs(u)),y=this._elevationProvider?.visibleElevationBounds.max??0,M=ct(j),k=Math.sqrt(j*(j+2*m)),x=c+this._referenceEllipsoid.radius,b=1.2*i(k,x,M),v=(Math.log(j)-kt)/(xt-kt);Mt(b,r(bt-v*(bt-vt),vt,bt),1,At);const _=this._referenceEllipsoid.radius+y,R=this._referenceEllipsoid.radius+this._referenceEllipsoid.atmosphereHeight,w=Math.max(_,R),T=c-w;if(M>0&&T>_t){const t=d(Tt,l(Tt,e.eye,-1)),r=d(Et,e.viewForward),o=n(h(t,r)),a=.5*e.fovY,c=Math.cos(a);let u=Ce.infinite.near;if(o<=a)u=T*c;else{const t=d(Tt,e.viewUp),n=Math.tan(a),s=l(Tt,t,n),i=d(Tt,p(Tt,r,s)),o=$(e.eye,i,Ct),m=de(St,w);if(je(m,o,Tt)){const t=p(Tt,Tt,e.eye);u=f(t)*c}}const m=.99*Math.min(s.near,u);if(m<Ce.infinite.near&&m>At.near){const e=i(At.near,m,M);At.near=e}}return At}}function Mt(e,t,n,s){const r=_t/n,i=e/t;return i>r?(s.far=e,s.near=i):(s.near=r,s.far=s.near*t),s}const kt=7.983,xt=16.994,bt=2e4,vt=100,_t=2,Rt=.001,wt=1e-4,Tt=R(),Et=R(),At={near:0,far:0},St=ge(),Ct=K();function It(e,t,s){e.worldUpAtPosition(t,Pt),p(Ut,s,t);const r=f(Ut);return 0===r?0:n(h(Ut,Pt)/r)}const Pt=R(),Ut=R(),Ft=w(0,0,1),Ht=d(R(),w(1,1,1)),Nt=new ue(-180,180),Ot=a(),Lt=R(),qt=R();function Gt(e,t,n,r=Qe()){g(Lt,e,Ft),0===h(Lt,Lt)&&g(Lt,e,Ht),z(Ot,-s(t),e),D(Ot,Ot,-s(n),Lt);const{up:i,direction:o}=r;return g(i,Lt,e),d(i,i),j(i,i,Ot),d(o,e),x(o,o),j(o,o,Ot),r}function zt(e){const t=e[1];e[1]=-e[2],e[2]=t}function Dt(e,t){const n=Gt(t,e.heading,e.tilt);return e.up=n.up,e}function Bt(e,t){const n=[],s=[],r=fe();for(let i=0;i<e.length;i++){const o=e[i],a=i===e.length-1?e[0]:e[i+1],c=ne(o,a,Kt),u=ae(t,c.origin,c.vector,0,Jt);switch(u){case 2:n.push(o);break;case 3:s.push(o);break;case 0:case 1:{const[e,i,a]=0===u?[1,n,s]:[-1,s,n],c=ce(t),l=y(R(),Jt,c,e*r),p=y(R(),Jt,c,e*-r);i.push(o),i.push(l),a.push(p)}}}const i=[];return n.length&&i.push(n),s.length&&i.push(s),i}const Wt={minCurvature:s(5),maxCurvature:s(50),minSamples:1,maxSamples:6},Vt=w(1,0,0),Qt=w(0,1,0),Yt=R(),Zt=R(),Jt=R(),Xt=ge(),Kt=te(),$t=he(),en=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(e,t,n,s){const r=Lt,i=qt;return d(r,e),g(qt,r,Ft),0===h(qt,qt)&&g(qt,r,Ht),g(i,qt,r),Ye(t,n,s,r,i)},eyeForCenterWithHeadingTilt:function(e,t,n,r){const i={eye:R(),up:null,tilt:r,heading:n},a=Lt;a[0]=e[0],a[1]=e[2],a[2]=-e[1];const c=t,u=s(n),p=s(r),m=Math.sin(u),h=Math.cos(u),d=Math.sin(p),g=Math.cos(p),j=f(a);let y;if(Math.abs(p)<1e-8)y=c+j;else{const e=j/d,t=o(c/e),n=Math.PI-p-t;y=e*Math.sin(n)}const M=g*c,k=c*c*(d*d),x=h*h*k,b=y-M,v=b*b,_=x*(x+v-a[1]*a[1]);if(_<0)return l(i.eye,a,y/j),i.tilt=0,Dt(i,e);const w=Math.sqrt(_),T=a[1]*b,E=x+v;let A;if(A=h>0?-w+T:w+T,Math.abs(E)<1e-8)return j<1e-8?(i.eye[0]=0,i.eye[1]=0,i.eye[2]=c):l(i.eye,a,y/j),i.tilt=0,zt(i.eye),Dt(i,e);i.eye[1]=A/E;const S=m*m*k,C=d*c,I=h*C*i.eye[1],P=i.eye[1]*i.eye[1],U=1-P,F=Math.sqrt(U),H=x*P+S-2*I*F*b+U*v;return Math.abs(H)<1e-8?(l(i.eye,a,y/j),i.tilt=0,zt(i.eye),Dt(i,e)):(i.eye[0]=(U*(y*a[0]-M*a[0])-C*F*(a[0]*i.eye[1]*h+a[2]*m))/H,i.eye[2]=(U*(y*a[2]-M*a[2])-C*F*(a[2]*i.eye[1]*h-a[0]*m))/H,l(i.eye,i.eye,y),zt(i.eye),Dt(i,e))},eyeTiltToLookAtTilt:function(e,t,n){const r=s(e),i=f(t);return o(n/(i/Math.sin(r)))+r},headingTiltToDirectionUp:Gt,lookAtTiltToEyeTilt:function(e,n,s){const r=f(n),i=Math.sqrt(s*s+r*r-2*s*r*Math.cos(Math.PI-e)),a=o(s/(i/Math.sin(e)));return t(e-a)},toArea:function(e,t){const{renderCoordsHelper:n}=e,s=e.state.camera.clone(),o=new ot(n);s.near=_t,o.update(s);const a=n.getAltitude(t),c=e.spatialReference,u=n.referenceEllipsoid.radius,l=s.eye,p=1+b(l,t)/(u+a),m=Math.sqrt(p*p-1),{minCurvature:h,maxCurvature:f,minSamples:d,maxSamples:g}=Wt,j=function(e){const{renderCoordsHelper:t,state:{camera:n}}=e,{center:s,eye:r}=n,i=Math.abs(t.getAltitude(s)),o=Math.abs(Math.PI/2-It(t,s,r));return de(Xt,t.referenceEllipsoid.radius+i),ye(Xt,o,n.distance,n.fovY)}(e),y=r((m-h)/(f-h),0,1),M=Math.round(i(d,g,y)),k=s.aboveGround,x=o.planes[5],R=[],w=re(T,Vt,ie()),A=re(T,Qt,ie());pe($t,0,0,0,0);const S=e=>{};for(let e=0;e<4;e++){const t=1===e&&!k||3===e&&k?1-j:0,s=1===e&&k||3===e&&!k?j:1,r=o.lines[e],c=o.lines[3===e?0:e+1];for(let o=0;o<M;o++){const u=o/M,p=0===o?0:i(t,s,1===e?1-(1-u)**2:3===e?u**2:u),m=v(Zt,r.origin,c.origin,p),h=Se(r.direction,c.direction,p,Yt);n.intersectManifoldClosestSilhouette(X(m,h),a,Jt),Ze(Jt,l,Jt,x),R.push(E(Jt)),0!==R.length&&S(_(R.at(-1),Jt));const f=(oe(w,Jt)?1:0)|(oe(A,Jt)?2:0);$t[f]=1}}R.length>2&&_(R[0],R.at(-1));const C=function(e,t,n){const s=2*fe();return e.map(e=>{const r=[];let i=!1;for(const o of e)t.fromRenderCoords(o,Jt,n),Math.abs(o[0])<s&&Math.abs(o[1])<s?(r.push([null,Jt[1]]),r.push([null,Jt[1]]),i=!0):r.push([Jt[0],Jt[1]]);if(i)for(let e=0;e<r.length;e++){const t=r[e];if(null!=t[0])continue;const n=r[e+1],s=r.at(0===e?-1:e-1);t[0]=s[0],e++;const i=r.at(e===r.length-1?0:e+1);n[0]=i[0]}return r.push(r[0]),Z(r)||r.reverse(),r})}(me($t)>1?function(e,t){const n=[];for(const s of e)n.push(...Bt(s,t));return n}(Bt(R,w),A):[R],n,c);return new Y({rings:C,spatialReference:c})},toExtent:function(e,n,r,i,o){let a,c,u,l;const p=n.latitude,m=F(e.spatialReference).radius,h=n.longitude,f=Ae(p,r,m)/2;a=h-f,c=h+f;const d=s(p),g=(1+Math.sin(d))/(1-Math.sin(d)),j=(g+1)*Math.tan(i/m/2),y=j*j;function M(e){const t=Math.PI/2;return(e=le.normalize(e,-t))>t&&(e=Math.PI-e),e}if(u=1.5*Math.PI-2*Math.atan(.5*(j+Math.sqrt(4*g+y))),l=u+i/m,u=M(u),l=M(l),l<u){const e=l;l=u,u=e}if(u=Math.max(t(u),-90),l=Math.min(t(l),90),c=Nt.monotonic(a,c),c-a>180){const e=(c-a-180)/2;a+=e,c-=e}const k=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:S.WGS84;return o?(o.xmin=a,o.ymin=u,o.xmax=c,o.ymax=l,o.spatialReference=k):o=new Q(a,u,c,l,k),e.spatialReference&&e.spatialReference.isWebMercator&&Me(o,!1,o),o}},Symbol.toStringTag,{value:"Module"}));function tn({state:e}){return e.isGlobal?en:it}function nn(e,t,n,s,r){return tn(e).directionToHeadingTilt(t,n,s,r)}const sn={OPAQUE:"opaque-color",TRANSPARENT:"transparent-color",COMPOSITE:"composite-color",FINAL:"final-color"},rn={SSAO:"ssao",LASERLINES:"laserline-color",ANTIALIASING:"aa-color",HIGHLIGHTS:"highlight-color",MAGNIFIER:"magnifier-color",OCCLUDED:"occluded-color",VIEWSHED:"viewshed-color",OPAQUE_TERRAIN:"opaque-terrain-color",OPAQUE_ENVIRONMENT:"opaque-environment-color",TRANSPARENT_ENVIRONMENT:"transparent-environment-color",FOCUSAREA:"focusarea",FOCUSAREA_COLOR:"focusarea-color"};function on(e,t,n,s,r,i,o){return s=s||e.spatialReference,I(t,s,n,r,e.renderCoordsHelper.spatialReference,i,o)?r:null}function an(e,t,n,s,r,i,o){return i=i||e.spatialReference,I(t,e.renderCoordsHelper.spatialReference,n,s,i,r,o)?s:null}function cn(e,t,n,s){return s||(s=a()),n=n||e.spatialReference,C(n,t,s,e.renderCoordsHelper.spatialReference)?s:null}function un(n,s,r){const i=n.renderSpatialReference,o=nn(n,s.eye,s.viewForward,s.up,mn);let a=n.spatialReference;return U(s.eye,i,pn,a)||(a=S.WGS84,U(s.eye,i,pn,a)),null==r?r=new e(new A(pn,a),o.heading,o.tilt,t(s.fov)):(r.position.x=pn[0],r.position.y=pn[1],r.position.z=pn[2],r.position.spatialReference=a,r.heading=o.heading,r.tilt=o.tilt,r.fov=t(s.fov)),r.layout.row=s.row,r.layout.rows=s.rows,r.layout.column=s.column,r.layout.columns=s.columns,r}function ln(e,t){if(!t)return null;const n=e.renderSpatialReference,r=tn(e).headingTiltToDirectionUp,i=R();if(!P(t.position,i,n))return null;const o=r(i,t.heading,t.tilt);l(o.direction,o.direction,e.state.camera.distance),m(o.direction,o.direction,i);const a=Ue(e,i,o.direction,o.up);return a.fov=s(t.fov),a.row=t.layout.row,a.rows=t.layout.rows,a.column=t.layout.column,a.columns=t.layout.columns,a}const pn=R(),mn={heading:0,tilt:0};export{Ce as D,ot as F,rn as InternalRenderCategory,sn as RenderCategory,Qe as a,It as b,Ue as c,nn as d,Ie as e,gt as f,un as fromRenderCamera,an as fromRenderCoordinates,mt as g,dt as h,ft as i,pt as j,ct as k,ut as l,_t as m,Ne as n,cn as renderCoordinateTransformAt,Pe as s,ln as toRenderCamera,on as toRenderCoordinates,tn as v};
