/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import e from"../Viewpoint.js";import s from"../core/Collection.js";import{C as i}from"../chunks/CollectionFlattener.js";import r from"../core/Error.js";import{h as o}from"../core/lang.js";import{L as n}from"../chunks/Logger.js";import{d as a}from"../chunks/maybe.js";import{watch as p,syncAndInitial as l}from"../core/reactiveUtils.js";import{initialize as m}from"../core/workers/workers.js";import{property as h}from"../core/accessorSupport/decorators/property.js";import{cast as u}from"../core/accessorSupport/decorators/cast.js";import{subclass as c}from"../core/accessorSupport/decorators/subclass.js";import{b as d}from"../chunks/ensureType.js";import g from"../geometry/Polygon.js";import{isLoadedOrLoadFor as j}from"../chunks/projectionUtils.js";import y from"../layers/support/TileInfo.js";import{BreakpointsOwner as f}from"./BreakpointsOwner.js";import{DOMContainer as k}from"./DOMContainer.js";import{PopupView as w}from"./PopupView.js";import b from"./View.js";import{a as M,V,c as S,A as v}from"../chunks/ManagedCanvas.js";import{T as C,h as U,l as L}from"../chunks/hitTestUtils.js";import{T}from"../chunks/TileStrategy.js";import"../chunks/TileKey2.js";import{e as D}from"../chunks/viewpointUtils.js";import{c as R}from"../chunks/util.js";import{c as x}from"../chunks/clippingUtils.js";import{g as _,s as O}from"../chunks/highlightOptionsUtils.js";import{encodeData as P,getFormatAndQuality as I,encode as A,getMaximumResolutionScale as E}from"../chunks/screenshotUtils.js";import{T as z}from"../chunks/Timeline.js";import G from"./navigation/Navigation.js";import F from"./navigation/NavigationActionMap.js";import q from"./support/HighlightOptions.js";import{c as N}from"../chunks/WebGLRequirements.js";import B from"./ui/DefaultUI.js";import{R as W}from"../chunks/RenderingContextOptions.js";import{i as H}from"../chunks/utils11.js";import Z from"../webmap/background/ColorBackground.js";import"../Camera.js";import"../CameraLayout.js";import"../core/Clonable.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/Lifecycle.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../core/promiseUtils.js";import"../chunks/events.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/MapUtils.js";import"../chunks/Warning.js";import"../chunks/Cyclical.js";import"../chunks/mathUtils.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/jsonMap.js";import"../chunks/pe.js";import"../chunks/assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polyline.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/coordsUtils.js";import"../chunks/typeUtils.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../intl.js";import"../chunks/date.js";import"../chunks/locale.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../chunks/vec3f64.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../layers/support/LOD.js";import"../chunks/TileKey.js";import"../chunks/domUtils.js";import"../chunks/UpdatingHandles.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/asyncUtils.js";import"../chunks/InputManager.js";import"../chunks/signal.js";import"../Map.js";import"../Basemap.js";import"../chunks/collectionUtils.js";import"../core/Loadable.js";import"../core/Promise.js";import"../chunks/loadAll.js";import"../portal/Portal.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/basemapDefinitions.js";import"../support/BasemapStyle.js";import"../chunks/writeUtils.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../Ground.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/enumeration.js";import"../chunks/groundInstanceUtils.js";import"../chunks/opacityUtils.js";import"../effects/FocusAreas.js";import"../effects/FocusArea.js";import"../chunks/uuid.js";import"../chunks/persistable.js";import"../chunks/MD5.js";import"../chunks/multiOriginJSONSupportUtils.js";import"../chunks/resourceExtension.js";import"../effects/FocusAreaOutline.js";import"../chunks/PolygonCollection.js";import"../chunks/editableLayers.js";import"../chunks/basemapEnsureType.js";import"../chunks/basemapUtils.js";import"../chunks/utils5.js";import"../chunks/screenUtils.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/collectionUtils2.js";import"../support/LayersMixin.js";import"../layers/Layer.js";import"../core/Identifiable.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../support/TablesMixin.js";import"../chunks/GraphicsCollection.js";import"../Graphic.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../geometry/HeightModelInfo.js";import"../chunks/timeZoneUtils.js";import"./BasemapView.js";import"./Magnifier.js";import"../chunks/SelectionManager.js";import"../chunks/ReactiveMap.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../chunks/selectionUtils.js";import"./Theme.js";import"../chunks/ViewEvents.js";import"../chunks/keybindings.js";import"../chunks/screenUtils2.js";import"../chunks/HighlightDefaults.js";import"./input/Input.js";import"./input/gamepad/GamepadSettings.js";import"./input/gamepad/GamepadInputDevice.js";import"../chunks/heightModelInfoUtils.js";import"../chunks/projectionUtils2.js";import"../chunks/Scheduler.js";import"../chunks/debugFlags.js";import"../chunks/vec2.js";import"../chunks/a11yUtils.js";import"./ViewAnimation.js";import"../chunks/Animation.js";import"../chunks/vec3.js";import"../chunks/easing.js";import"../chunks/unitBezier.js";import"../chunks/vec2f64.js";import"./2d/ViewState.js";import"../chunks/mat2d.js";import"../chunks/mat2df32.js";import"../chunks/mat2df64.js";import"../chunks/mat3.js";import"../chunks/mat3f32.js";import"../chunks/vec2f32.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils9.js";import"../chunks/utils10.js";import"../chunks/rbush.js";import"../chunks/quickselect.js";import"../chunks/Tile.js";import"../chunks/arcadeUtils.js";import"../chunks/ScheduledQueueProcessor.js";import"../chunks/definitions.js";import"../chunks/Texture.js";import"../chunks/enums.js";import"../chunks/imageUtils.js";import"./navigation/gamepad/GamepadSettings.js";import"../chunks/capabilities2.js";import"./ui/UI.js";import"../chunks/modeUtils.js";import"../chunks/widgetUtils.js";import"../widgets/Attribution.js";import"../widgets/Widget.js";import"../chunks/componentsUtils.js";import"../chunks/jsxWidgetSupport.js";import"../widgets/Attribution/AttributionViewModel.js";import"../chunks/globalCss.js";import"../chunks/accessibleHandler.js";import"../chunks/messageBundle.js";import"../chunks/jsxFactory.js";import"../widgets/Compass.js";import"../widgets/Compass/CompassViewModel.js";import"../chunks/utils24.js";import"../widgets/support/GoTo.js";import"../chunks/goToUtils.js";import"../widgets/NavigationToggle.js";import"../widgets/NavigationToggle/NavigationToggleViewModel.js";import"../widgets/Zoom.js";import"../widgets/Zoom/ZoomViewModel.js";import"../chunks/Version2.js";import"../chunks/Version.js";const $={flipY:!0,premultipliedAlpha:!0};function Q(t,e){const s=function(t,e,s,i){t.ignorePadding&&(i={left:0,right:0,top:0,bottom:0});let r=null;null!=t.width&&null!=t.height?r=[t.width,t.height]:null==t.width&&null!=t.height?r=[t.height,t.height]:null!=t.width&&null==t.height?r=[t.width,t.width]:null==t.width&&null==t.height&&(r=null);const o=s[0]-(i.left+i.right),n=s[1]-(i.top+i.bottom);let a,p,l=t.area||{x:0,y:0,width:o,height:n};if(r){const t=o/n,e=r[0]/r[1];if(e>t){const t=l.width/e;l={x:l.x,y:Math.round(l.y+(l.height-t)/2),width:l.width,height:Math.round(t)}}else{const t=l.height*e;l={x:Math.round(l.x+(l.width-t)/2),y:l.y,width:Math.round(t),height:l.height}}}else r=[l.width,l.height];return r[0]>l.width?(a=Math.min(r[0]/l.width,e),p=r[0]/l.width/a):(a=1,p=r[0]/l.width),{cropArea:{x:Math.round((l.x+i.left)*a),y:Math.round((l.y+i.top)*a),width:Math.round(l.width*a),height:Math.round(l.height*a)},outputScale:p,resolutionScale:a}}(e||{},(i=t.stage,r=t.size,Math.min(4,E(r,Math.min(4096,i.context.parameters.maxTextureSize)))),t.size,t.padding);var i,r;const o=function(t={},e){if(!t.layers)return;const s=[];return t.layers.forEach(t=>{const i=e.find(e=>e.layer.id===t.id);i?.container&&s.push(i.container)}),s}(e,t.allLayerViews);return t.stage.takeScreenshot(s,o,t.backgroundColor,e?.rotation)}let J=class extends B{constructor(t){super(t),this.components=["attribution","zoom"]}};t([h()],J.prototype,"components",void 0),J=t([c("esri.views.ui.2d.DefaultUI2D")],J);const K=J;let Y,X,tt,et,st,it,rt,ot=class extends(M(V(f(w(k(b)))))){get timeZone(){return super.timeZone}set timeZone(t){super.timeZone=t}constructor(t){super(t),this._magnifierView=null,this._gridView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new i({getCollections:()=>[this.basemapView?.baseLayerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.graphicsView=null,this.labelManager=null,this.navigation=new G({actionMap:new F({dragTertiary:"none"})}),this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.floors=new s,this.grid=null,this.map=null,this.spatialReferenceLocked=!1,this.timeline=new z,this.type="2d",this.view2dType=null,this.ui=new K,this.test={takeScreenshot:async t=>async function(t,e){const s=await Q(t,e);return P(s,$)}(this._getScreenshotView(t),t)},this.padding={top:0,right:0,bottom:0,left:0},m()}destroy(){this.layerViewManager.clear(),this._set("preconditionsReady",!1),this.frameTask=a(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new C(this.featuresTilingScheme)}get constraintsInfo(){const t=this.defaultsFromMap?.tileInfo,e=this.spatialReference;return{lods:t?.spatialReference?.equals(e)?t.lods:null,spatialReference:e}}get initialExtentRequired(){if(!this.stateManager)return!1;const{scale:t,constraints:e,center:s,viewpoint:i,extent:r}=this;let o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties?.viewpoint||r||(e?.effectiveLODs||(o=-1),s&&(0!==t||-1!==o)||null!=i?.targetGeometry&&("extent"===i.targetGeometry.type||i.scale)))}get defaultsFromMapSettings(){return{required:{extent:!1,heightModelInfo:!1,tileInfo:!0},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get scheduler(){return this.frameTask.scheduler}get typeSpecificPreconditionsReady(){const t=this._getDefaultViewpoint();if(!t)return!1;const e=t.targetGeometry,s=this.spatialReference;return j(e.spatialReference,s)}get background(){return H(this.map)?this.map.initialViewProperties.background:null}set background(t){this._override("background",t)}get center(){return this.stateManager?.center??null}set center(t){this.stateManager.center=t}get constraints(){return super.constraints}set constraints(t){super.constraints=t}get highlightOptions(){return _(this)}set highlightOptions(t){O(this,t)}get padding(){return this.stateManager?.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}get rendering(){return this.stage?.renderRequested??!1}get resizeAlign(){return super.resizeAlign}set resizeAlign(t){super.resizeAlign=t}get resolution(){return this.stateManager.resolution??0}get rotation(){return super.rotation}set rotation(t){super.rotation=t}get scale(){return this.stateManager?.scale??0}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get spatialReference(){return super.spatialReference}set spatialReference(t){super.spatialReference=t}get tileInfo(){return this.featuresTilingScheme?.tileInfo}get updating(){const t=!(!this.magnifier.visible||null===this.magnifier.position||!this._magnifierView?.updatingHandles.updating),e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||!0===this.layerViewManager.updating||!0===this.labelManager.updating||!0===this.graphicsView.updating||this.allLayerViews.some(t=>!t.destroyed&&!("layerViews"in t)&&!0===t.updating)||t);if(o("esri-2d-log-updating")){const s=this.allLayerViews.reduce((t,e)=>({...t,[`${e.layer.id}(${e.layer.type})`]:!e.destroyed&&!("layerViews"in e)&&e.updating}),{});console.log(`Updating MapView: ${e}\n-> Null LayerViewManager: ${!this.layerViewManager}\n-> Null LabelManager: ${!this.labelManager}\n-> Null GraphicsView: ${!this.graphicsView}\n-> layerViewManager.updating: ${this.layerViewManager?.updating}\n-> labelManager.updating: ${this.labelManager?.updating}\n-> graphicsView.updating: ${this.graphicsView?.updating}\n-> allLayerViews: ${JSON.stringify(s)}\n-> updatingMagnifier: ${t}\n`)}return e}get viewpoint(){return super.viewpoint}set viewpoint(t){super.viewpoint=t}get visibleArea(){const t=this.stateManager.visibleArea;return t?new g({rings:[t.map(t=>[t[0],t[1]])],spatialReference:this.spatialReference}):t}get zoom(){return this.stateManager.zoom??-1}set zoom(t){this.stateManager.zoom=t}get navigating(){return this.mapViewNavigation?.interacting??!1}async hitTest(t,e){return U(this,t,e)}async takeScreenshot(t){return async function(t,e){const s=await Q(t,e),{format:i,quality:r}=I(e?.format,e?.quality);return A(s,{format:i,quality:r},$)}(this._getScreenshotView(t),t)}toScreen(t,e){return this.stateManager.toScreen(t,e)}whenLayerView(t){return super.whenLayerView(t)}graphicChanged(t){this.graphicsView&&this.graphicsView.graphicUpdateHandler(t)}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&"initialViewProperties"in this.map&&this.map.initialViewProperties.spatialReference||this.defaultsFromMap?.spatialReference||null}getDefaultTimeZone(){return H(this.map)?this.map.initialViewProperties.timeZone:null}getDefaultTimeExtent(){return H(this.map)?this.map.initialViewProperties.timeExtent:null}hasLayerViewModule(t){return L.hasLayerViewModule(t)}importLayerView(t){return L.importLayerView(t)}pixelSizeAt(){return this.ready?this.resolution:(n.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(t){const e=this.toMap(t),s=await this.hitTest(t),i=this.allLayerViews.toArray().filter(s=>s.clips.every(s=>x(this,s,t,e))).reverse(),r=new globalThis.Map(i.map(t=>[t.layer.uid,t])),o=[];let n=0,a=0;for(;n<s.results.length||a<i.length;){const t=s.results.at(n);if(t&&"graphic"!==t.type){++n;continue}const p=r.get((t?.layer??t?.graphic.layer)?.uid);if((!t||p)&&a<i.length&&i.at(a)!==p){const t=i.at(a);"fetchPopupFeaturesAtLocation"in t&&o.push({mapPoint:e,layerView:t}),++a}else t&&(o.push({graphic:t.graphic,layerView:p}),++n)}return{hits:o,location:e}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let t=N(this.type);if(o("safari")&&o("safari")<9&&(t=new r("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:o("safari")})),null!=t){n.getLogger(this).warn("#validate()",t.message);const e=document.createElement("div");e.setAttribute("style","display: flex; flex-direction: column; gap: 8px; padding: 20px; height: 100%; justify-content: center; color: black; background: white; font-family: sans-serif;");const s=document.createElement("div");s.innerHTML="Unable to display map. WebGL2 support is required.",s.setAttribute("style","font-size: 24px; font-weight: bold;");const i=document.createElement("div");i.innerHTML="Ensure that your browser and hardware meet the minimum requirements.",i.setAttribute("style","font-size: 18px;");const r=document.createElement("a");throw r.innerHTML="https://esriurl.com/systemRequirements",r.target="_blank",r.setAttribute("style","font-size: 18px;"),r.href="https://esriurl.com/systemRequirements",e.appendChild(s),e.appendChild(i),e.appendChild(r),this.surface.appendChild(e),t}}loadAsyncDependencies(){return async function(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:s,MapViewNavigation:i,MagnifierView2D:r,GridView2D:o,Stage:n}]=await Promise.all([import("../chunks/webglDeps.js"),import("../chunks/mapViewDeps.js")]);X=t,tt=e,et=s,st=i,it=r,rt=o,Y=n}()}_getDefaultViewpoint(){const{constraints:t,initialExtent:s,map:i,padding:r,size:o}=this;if(!t)return null;const n=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,a=this.stateManager.getUserStartupOptions(this.size),p=n?.viewpoint,l=p?.targetGeometry?.extent??s,m=l?.center,h=p?.rotation??0,u=p?.scale||l&&D(l,[o[0]-r.left-r.right,o[1]-r.top-r.bottom]),c=a.center??m,d=a.rotation??h,g=a.scale??u;return c&&g?new e({targetGeometry:c,scale:g,rotation:d}):null}_startup(){this.timeline.begin("MapView Startup");const t=this._getDefaultViewpoint();this.stateManager.startup(t,this.size,this.spatialReference,this.defaultsFromMap.extent?.center),this.graphics.owner=this;const e=new S(this.surface),s=new Y(this.surface,{canvas:this.renderCanvas,contextOptions:new W(this.deactivatedWebGLExtensions,this.debugWebGLExtensions),renderingOptions:this.renderingOptions,timeline:this.timeline},e);this.stage=s,this._magnifierView=new it,this._magnifierView.magnifier=this.magnifier,this._gridView=new rt;const i=new et({view:this});this._set("labelManager",i);const r=new v({view:this});this._set("animationManager",r);const o=new st({view:this,animationManager:r});this._set("mapViewNavigation",o),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),s.on("webgl-error",t=>this.fatalError=t.error),p(()=>this.stationary,t=>s.stationary=t,l),p(()=>this.background,t=>{s.backgroundColor=t?.color,this._magnifierView.backgroundColor=t?.color},l),p(()=>this.magnifier,t=>this._magnifierView.magnifier=t,l),p(()=>this.grid,t=>this._gridView.grid=t,l),p(()=>this.renderingOptions,t=>s.renderingOptions=t,l),p(()=>this.highlights.items.map(t=>({name:t.name,options:{fillColor:t.color,haloColor:t.haloColor,fillOpacity:t.fillOpacity,haloOpacity:t.haloOpacity,haloWidth:t.haloWidth,haloBlur:t.haloBlur}})),()=>{s.highlightGradient=R(s.highlightGradient,this.highlights.items)},l),p(()=>this.state.id,()=>s.state=this.state,l)],"map-view"),this._updateStageChildren();const n=this._resolveWhenReady;this._resolveWhenReady=[],n.forEach(t=>t(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._gridView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._gridView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(t=>{this.stage.addChild(t.container)});const t=this.graphicsView;this.stage.addChild(t.container),this.stage.addChild(this._magnifierView),this.stage.addChild(this._gridView)}_setupSpatialReferenceDependentProperties(){const t=new T(y.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",t);const e=new X({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new tt(t)});this._set("graphicsView",e)}_destroySpatialReferenceDependentProperties(){const t=this.graphicsView;this._set("graphicsView",null),t.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(t){const{allLayerViews:e,padding:s,size:i,stage:r}=this;return{allLayerViews:e,backgroundColor:t?.ignoreBackground?null:this.background?.color,padding:s,size:i,stage:r}}_spatialReferenceChanged(t){if(this.ready){this.frameTask.stop();for(const t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(t),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}static{this.type="2d"}};t([h({constructOnly:!0})],ot.prototype,"deactivatedWebGLExtensions",void 0),t([h({constructOnly:!0})],ot.prototype,"debugWebGLExtensions",void 0),t([h({readOnly:!0})],ot.prototype,"featuresTilingScheme",void 0),t([h({readOnly:!0})],ot.prototype,"graphicsTileStore",null),t([h()],ot.prototype,"graphicsView",void 0),t([h()],ot.prototype,"constraintsInfo",null),t([h()],ot.prototype,"initialExtentRequired",null),t([h()],ot.prototype,"labelManager",void 0),t([h({type:G,nonNullable:!0})],ot.prototype,"navigation",void 0),t([h({constructOnly:!0})],ot.prototype,"renderCanvas",void 0),t([h()],ot.prototype,"renderingOptions",void 0),t([h({constructOnly:!0})],ot.prototype,"supersampleScreenshotsEnabled",void 0),t([h({readOnly:!0})],ot.prototype,"supportsGround",void 0),t([h()],ot.prototype,"defaultsFromMapSettings",null),t([h({readOnly:!0})],ot.prototype,"typeSpecificPreconditionsReady",null),t([h({type:Z})],ot.prototype,"background",null),t([h()],ot.prototype,"center",null),t([h({type:s})],ot.prototype,"floors",void 0),t([h()],ot.prototype,"grid",void 0),t([h({type:q})],ot.prototype,"highlightOptions",null),t([h()],ot.prototype,"map",void 0),t([h()],ot.prototype,"padding",null),t([h({readOnly:!0})],ot.prototype,"rendering",null),t([h({readOnly:!0})],ot.prototype,"resolution",null),t([h()],ot.prototype,"scale",null),t([h({constructOnly:!0})],ot.prototype,"spatialReferenceLocked",void 0),t([h({readOnly:!0})],ot.prototype,"tileInfo",null),t([h({type:z,readOnly:!0})],ot.prototype,"timeline",void 0),t([h({readOnly:!0})],ot.prototype,"type",void 0),t([h({readOnly:!0})],ot.prototype,"updating",null),t([h({readOnly:!0})],ot.prototype,"view2dType",void 0),t([h({readOnly:!0})],ot.prototype,"visibleArea",null),t([h()],ot.prototype,"zoom",null),t([h({readOnly:!0})],ot.prototype,"navigating",null),t([h(),u(t=>t instanceof B?t:d(K,t))],ot.prototype,"ui",void 0),ot=t([c("esri.views.View2D")],ot);const nt=ot;export{nt as default};
