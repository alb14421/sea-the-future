/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{L as e}from"../chunks/Logger.js";import{ignoreAbortErrors as o,after as s}from"../core/promiseUtils.js";import{watch as i,on as r,initial as n,whenOnce as p}from"../core/reactiveUtils.js";import{waitAnimationFrame as l}from"../core/scheduling.js";import{s as a}from"../chunks/string.js";import{property as m}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{subclass as u}from"../core/accessorSupport/decorators/subclass.js";import c from"../support/actions/ActionButton.js";import h from"./Features.js";import d from"./Widget.js";import j from"./Features/FeaturesViewModel.js";import g from"./Popup/PopupViewModel.js";import k from"../core/Accessor.js";import{g as y}from"../chunks/globalCss.js";import{a as b}from"../chunks/widgetUtils.js";import{m as f}from"../chunks/messageBundle.js";import{v}from"../chunks/vmEvent.js";import{t as w}from"../chunks/jsxFactory.js";import"../config.js";import"../chunks/object.js";import"../chunks/handleUtils.js";import"../core/Error.js";import"../chunks/events.js";import"../chunks/maybe.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/throttle.js";import"../chunks/geometryUtils2.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/scaleUtils.js";import"../chunks/mathUtils.js";import"../chunks/actionUtils.js";import"../chunks/componentsUtils.js";import"./Feature.js";import"./Attachments.js";import"../chunks/unitFormatUtils.js";import"../chunks/Cyclical.js";import"../chunks/quantityUtils.js";import"./Attachments/AttachmentsViewModel.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"../chunks/featureUtils.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../chunks/utils7.js";import"../chunks/basemapUtils.js";import"../chunks/utils5.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/basemapDefinitions.js";import"../chunks/timeZoneUtils.js";import"../chunks/attachmentUtils.js";import"../chunks/legacyIcon.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"./Feature/FeatureViewModel.js";import"../chunks/asyncUtils.js";import"../chunks/executeQueryJSON.js";import"../chunks/utils9.js";import"../chunks/query.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils10.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/memoryEstimations.js";import"../chunks/OptimizedGeometry.js";import"../chunks/OptimizedFeature.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../rest/support/RelationshipQuery.js";import"../chunks/arcadeFeatureUtils.js";import"../chunks/shared2.js";import"../chunks/TimeOnly.js";import"../chunks/enum.js";import"../chunks/UnknownTimeZone.js";import"../layers/FeatureLayer.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/layerContainerType.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../chunks/formUtils.js";import"../form/elements/AttachmentElement.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../chunks/Input.js";import"../form/elements/inputs/attachments/AudioInput.js";import"../chunks/utils2.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../form/elements/RelationshipElement.js";import"../form/elements/TextElement.js";import"../form/elements/UtilityNetworkAssociationsElement.js";import"../graphic/FeatureGraphicOrigin.js";import"../graphic/GraphicOrigin.js";import"../chunks/isFeatureGraphicOrigin.js";import"../layers/Layer.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils2.js";import"../chunks/parser.js";import"../layers/mixins/CustomParametersMixin.js";import"../layers/mixins/DisplayFilteredLayer.js";import"../layers/support/DisplayFilterInfo.js";import"../layers/support/DisplayFilter.js";import"../chunks/displayFilterUtils.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/ElevationInfo.js";import"../symbols/support/FeatureExpressionInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../tables/AttributeTableTemplate.js";import"../tables/elements/AttributeTableGroupElement.js";import"../tables/elements/AttributeTableAttachmentElement.js";import"../tables/elements/AttributeTableElement.js";import"../tables/elements/AttributeTableFieldElement.js";import"../tables/elements/AttributeTableRelationshipElement.js";import"../chunks/featureLayerUtils.js";import"../chunks/featureQueryAll.js";import"../renderers/SimpleRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../chunks/RendererLegendOptions.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../rest/support/NormalizationBinParametersMixin.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../chunks/multiLayerServiceUtils.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../chunks/infoFor3D.js";import"../layers/support/Subtype.js";import"../chunks/portalItemUtils.js";import"../chunks/projectionUtils.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/typeUtils3.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/support/ClassBreakInfo.js";import"../renderers/DictionaryRenderer.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/DictionaryScriptEvaluator.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../chunks/ArcadeExpression.js";import"../chunks/utils6.js";import"../chunks/defaultCIMValues.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../layers/mixins/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/support/OrderByInfo.js";import"../layers/mixins/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../layers/support/TimeInfo.js";import"../time/TimeInterval.js";import"../layers/mixins/TrackableLayer.js";import"../layers/support/TrackInfo.js";import"../layers/support/TrackPartInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/TitleCreator.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../chunks/streamLayerUtils.js";import"../chunks/FeatureRelationshipViewModel.js";import"../chunks/featureFormUtils.js";import"../chunks/dateUtils.js";import"../chunks/formUtils2.js";import"../chunks/FeatureUtilityNetworkAssociationsViewModel.js";import"../chunks/ReactiveMap.js";import"../rest/networks/support/NetworkElement.js";import"../chunks/getFeatureTitle.js";import"../chunks/FeatureUtilityNetworkAssociations.js";import"../chunks/Heading.js";import"./support/widget.js";import"../chunks/accessibleHandler.js";import"../chunks/modeUtils.js";import"../chunks/uriUtils.js";import"../chunks/a11yUtils.js";import"../renderers/support/utils.js";import"../chunks/numberUtils.js";import"../chunks/utils8.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/gfxUtils.js";import"../chunks/colorRampUtils2.js";import"../chunks/utils17.js";import"../chunks/Spinner.js";import"../chunks/SpinnerViewModel.js";import"../chunks/AnchorElementViewModel.js";import"../chunks/css2.js";import"../chunks/actions.js";import"../chunks/ReactiveSet.js";import"../chunks/LayerConstants.js";import"../symbols/support/symbolUtils.js";import"../chunks/renderUtils.js";import"../chunks/colorUtils2.js";import"../chunks/svgUtils.js";import"../chunks/mat2df32.js";import"../chunks/mat2d.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";import"../chunks/layerViewUtils.js";import"./support/GoTo.js";import"../chunks/goToUtils.js";const _="esri-popup",M=`${_}--is-docked`,C={base:_,baseHidden:`${_}--hidden`,main:`${_}__main-container`,shadow:`${_}--shadow`,isDocked:M,isDockedTopLeft:`${M}-top-left`,isDockedTopCenter:`${M}-top-center`,isDockedTopRight:`${M}-top-right`,isDockedBottomLeft:`${M}-bottom-left`,isDockedBottomCenter:`${M}-bottom-center`,isDockedBottomRight:`${M}-bottom-right`,alignTopCenter:`${_}--aligned-top-center`,alignBottomCenter:`${_}--aligned-bottom-center`,alignTopLeft:`${_}--aligned-top-left`,alignBottomLeft:`${_}--aligned-bottom-left`,alignTopRight:`${_}--aligned-top-right`,alignBottomRight:`${_}--aligned-bottom-right`,pointer:`${_}__pointer`,pointerDirection:`${_}__pointer-direction`};let U=class extends k{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureMenuHeading=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};t([m({type:Boolean,nonNullable:!0})],U.prototype,"actionBar",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"closeButton",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"collapseButton",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"featureMenuHeading",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"featureNavigation",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"featureListLayerTitle",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"heading",void 0),t([m({type:Boolean,nonNullable:!0})],U.prototype,"spinner",void 0),U=t([u("esri.widgets.Popup.PopupVisibleElements")],U);const E={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let D=class extends d{constructor(t,e){super(t,e),this._dockAction=new c({id:"popup-dock-action"}),this._featuresWidget=new h({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this._focusAbortController=null,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new g,this.visibleElements=new U}initialize(){this.addHandles([i(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),n),i(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),n),i(()=>this.dockOptions,t=>{const{_dockAction:e}=this,o=this._featuresWidget.headerActions;o.remove(e),t.buttonEnabled&&o.add(e)},n),i(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),i(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),i(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),i(()=>this.viewModel?.view?.size,(t,e)=>this._updateDockEnabledForViewSize(t,e)),i(()=>this.viewModel?.view,(t,e)=>this._viewChange(t,e)),i(()=>this.viewModel?.view?.ready,(t,e)=>this._viewReadyChange(t??!1,e??!1)),i(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,n),i(()=>this._featureNavigationTop,t=>this._featuresWidget.featureNavigationTop=t,n),i(()=>this.headingLevel,t=>this._featuresWidget.headingLevel=t,n),i(()=>this.visibleElements.actionBar,t=>this._featuresWidget.visibleElements.actionBar=!!t,n),i(()=>this.visibleElements.closeButton,t=>this._featuresWidget.visibleElements.closeButton=!!t,n),i(()=>this.visibleElements.collapseButton,t=>this._featuresWidget.visibleElements.collapseButton=!!t,n),i(()=>this.visibleElements.heading,t=>this._featuresWidget.visibleElements.heading=!!t,n),i(()=>this.visibleElements.spinner,t=>this._featuresWidget.visibleElements.spinner=!!t,n),i(()=>this.visibleElements.featureNavigation,t=>this._featuresWidget.visibleElements.featureNavigation=!!t,n),i(()=>this.visibleElements.featureMenuHeading,t=>this._featuresWidget.visibleElements.featureMenuHeading=!!t,n),i(()=>this.visibleElements.featureListLayerTitle,t=>this._featuresWidget.visibleElements.featureListLayerTitle=!!t,n),r(()=>this._featuresWidget,"trigger-header-action",t=>{t.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){this._dockAction.destroy(),this._featuresWidget&&(this._featuresWidget.viewModel=new j,this._featuresWidget.destroy()),this._focusAbortController?.abort()}get _featureNavigationTop(){const{currentAlignment:t,currentDockPosition:e}=this;return"bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===e||"top-center"===e||"top-right"===e}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(t){this.viewModel.autoCloseEnabled=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get content(){return this.viewModel.content}set content(t){this.viewModel.content=t}get collapsed(){return this._featuresWidget.collapsed}set collapsed(t){this._featuresWidget.collapsed=t}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||E}set dockOptions(t){const e={...E},o=this.viewModel?.view?.breakpoints,s={};o&&(s.width=o.xsmall,s.height=o.xsmall);const i={...e,...t},r={...e.breakpoint,...s},{breakpoint:n}=i;"object"==typeof n?i.breakpoint={...r,...n}:n&&(i.breakpoint=r),this._set("dockOptions",i),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(t){this.viewModel.featureMenuOpen=t}get features(){return this.viewModel.features}set features(t){this.viewModel.features=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(t){this.viewModel.highlightEnabled=t}get icon(){return"popup"}set icon(t){this._overrideIfSome("icon",t)}get initialDisplayMode(){return this.viewModel.initialDisplayMode}set initialDisplayMode(t){this.viewModel.initialDisplayMode=t}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get promises(){return this.viewModel.promises}set promises(t){this.viewModel.promises=t}get selectedFeature(){return this.viewModel.selectedFeature}get selectedDrillInFeature(){return this._featuresWidget.selectedDrillInFeature??null}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(t){this.viewModel.selectedFeatureIndex=t}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(t){this.viewModel.updateLocationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}blur(){const{active:t}=this.viewModel;t||e.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||e.getLogger(this).warn("Popup can only be focused when currently active."),this._handleFocus()}next(){return this.viewModel.next()}open(t){const e=!!t&&!!t.featureMenuOpen,o={collapsed:!!t&&!!t.collapsed,featureMenuOpen:e};this.set(o),this.viewModel.open(t),t?.shouldFocus&&this._handleFocus(!0)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){return this.viewModel.triggerAction(t)}render(){const{dockEnabled:t,currentAlignment:e,currentDockPosition:o}=this,{active:s,screenLocation:i}=this.viewModel,r=s&&t,n=s&&!t,p=this.selectedFeature?.layer?.title,l=this.selectedFeature?.layer?.id,m={[C.alignTopCenter]:"top-center"===e,[C.alignBottomCenter]:"bottom-center"===e,[C.alignTopLeft]:"top-left"===e,[C.alignBottomLeft]:"bottom-left"===e,[C.alignTopRight]:"top-right"===e,[C.alignBottomRight]:"bottom-right"===e,[C.isDocked]:r,[C.shadow]:n,[C.isDockedTopLeft]:"top-left"===o,[C.isDockedTopCenter]:"top-center"===o,[C.isDockedTopRight]:"top-right"===o,[C.isDockedBottomLeft]:"bottom-left"===o,[C.isDockedBottomCenter]:"bottom-center"===o,[C.isDockedBottomRight]:"bottom-right"===o};return w("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,"aria-hidden":(!s).toString(),"aria-label":a(this.title??""),"aria-modal":"false",bind:this,class:this.classes(C.base,m,{[C.baseHidden]:!i&&!t}),"data-layer-id":l,"data-layer-title":p,role:"dialog"},s?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:w("div",{class:C.pointer,key:"popup-pointer",role:"presentation"},w("div",{class:this.classes(C.pointerDirection,C.shadow)}))}_renderMainContainer(){const{dockEnabled:t}=this,e={[C.shadow]:t};return w("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(C.main,y.widget,e)},this._featuresWidget.render())}_getAnimationDurationMS(){const{_containerNode:t}=this;return t?1e3*parseFloat(window.getComputedStyle(t).animationDuration):200}async _handleFocus(t=!1){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;t&&await p(()=>!0===this.viewModel?.active,{signal:e}),await o(l(e)),await o(s(this._getAnimationDurationMS(),e)),this._featuresWidget.focus()}_isOutsideView(t){const{popupHeight:e,popupWidth:o,screenLocation:s,side:i,view:r}=t;if(isNaN(o)||isNaN(e)||!r||!s)return!1;const n=r.padding;return"right"===i&&s.x+o/2>r.width-n.right||"left"===i&&s.x-o/2<n.left||"top"===i&&s.y-e<n.top||"bottom"===i&&s.y+e>r.height-n.bottom}_calculateAutoAlignment(t){if("auto"!==t)return t;const{_pointerOffsetInPx:e,_containerNode:o,_mainContainerNode:s,viewModel:i}=this,{screenLocation:r,view:n}=i;if(null==r||!n||!o)return"top-center";function p(t){return parseInt(t.replaceAll(/[^-\d.]/g,""),10)}const l=s?window.getComputedStyle(s,null):null,a=l?p(l.getPropertyValue("max-height")):0,m=l?p(l.getPropertyValue("height")):0,{height:u,width:c}=o.getBoundingClientRect(),h=c+e,d=Math.max(u,a,m)+e,j=this._isOutsideView({popupHeight:d,popupWidth:h,screenLocation:r,side:"right",view:n}),g=this._isOutsideView({popupHeight:d,popupWidth:h,screenLocation:r,side:"left",view:n}),k=this._isOutsideView({popupHeight:d,popupWidth:h,screenLocation:r,side:"top",view:n}),y=this._isOutsideView({popupHeight:d,popupWidth:h,screenLocation:r,side:"bottom",view:n});return g?k?"bottom-right":"top-right":j?k?"bottom-left":"top-left":k?y?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return"function"==typeof t?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e,_containerNode:o}=this;return!e&&this.viewModel.active&&o?this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t))):null}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return b(this.container)&&e.reverse(),t?.replace(/leading/gi,e[0]).replaceAll(/trailing/gi,e[1])}_callDockPosition(t){return"function"==typeof t?t.call(this):t}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(t){if("auto"!==t)return t;const e=this.viewModel?.view,o=b(this.container)?"top-left":"top-right";if(!e)return o;const s=e.padding||{left:0,right:0},i=e.width-s.left-s.right,{breakpoints:r}=e;return r&&i<=r.xsmall?"bottom-center":o}_getDockIcon(){const t=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(t){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(t){this._mainContainerNode=t}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!this._containerNode)return;const{screenLocation:e}=this.viewModel,{width:o}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(e,o);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:o}=this;return"top-left"===e||"bottom-left"===e||"top-right"===e||"bottom-right"===e?t+o:t}_calculateAlignmentPosition(t,e,o,s){const{currentAlignment:i,_pointerOffsetInPx:r}=this;if(!o)return;const{padding:n}=o,p=s/2,l=o.height-e,a=o.width-t;return"bottom-center"===i?{top:e+r-n.top,left:t-p-n.left}:"top-left"===i?{bottom:l+r-n.bottom,right:a+r-n.right}:"bottom-left"===i?{top:e+r-n.top,right:a+r-n.right}:"top-right"===i?{bottom:l+r-n.bottom,left:t+r-n.left}:"bottom-right"===i?{top:e+r-n.top,left:t+r-n.left}:"top-center"===i?{bottom:l+r-n.bottom,left:t-p-n.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:o,view:s}=this;if(!s)return;if(o)return{left:"",top:"",right:"",bottom:""};if(null==t||!e)return;const i=this._calculateFullWidth(e),r=this._calculateAlignmentPosition(t.x,t.y,s,i);return r?{top:void 0!==r.top?`${r.top}px`:"auto",left:void 0!==r.left?`${r.left}px`:"auto",bottom:void 0!==r.bottom?`${r.bottom}px`:"auto",right:void 0!==r.right?`${r.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){t?this._wireUpView():e&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,o){const[s,i]=t,[r,n]=e,{width:p=0,height:l=0}=o??{};return s<=p&&r>p||s>p&&r<=p||i<=l&&n>l||i>l&&n<=l}_updateDockEnabledForViewSize(t,e){if(!t||!e)return;const o=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},s=o.left+o.right,i=o.top+o.bottom,r=[],n=[];r[0]=t[0]-s,r[1]=t[1]-i,n[0]=e[0]-s,n[1]=e[1]-i;const{dockOptions:p}=this,l=p.breakpoint;this._dockingThresholdCrossed(r,n,l)&&this._setDockEnabledForViewSize(p),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;if(!e)return;const o=e.active&&!t;e.screenLocationEnabled=o}_shouldDockAtCurrentViewSize(t){const e=t.breakpoint,o=this.viewModel?.view?.ui;if(!o)return!1;const{width:s,height:i}=o;if(isNaN(s)||isNaN(i))return!1;if(!e)return!1;const r=e.hasOwnProperty("width")&&s<=(e.width??0),n=e.hasOwnProperty("height")&&i<=(e.height??0);return r||n}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}};t([m()],D.prototype,"_containerNode",void 0),t([m({readOnly:!0})],D.prototype,"_featureNavigationTop",null),t([m()],D.prototype,"actions",null),t([m({readOnly:!0})],D.prototype,"active",null),t([m()],D.prototype,"alignment",void 0),t([m()],D.prototype,"autoCloseEnabled",null),t([m()],D.prototype,"defaultPopupTemplateEnabled",null),t([m()],D.prototype,"content",null),t([m()],D.prototype,"collapsed",null),t([m({readOnly:!0})],D.prototype,"currentAlignment",null),t([m({readOnly:!0})],D.prototype,"currentDockPosition",null),t([m()],D.prototype,"dockOptions",null),t([m()],D.prototype,"dockEnabled",void 0),t([m({readOnly:!0})],D.prototype,"featureCount",null),t([m()],D.prototype,"featureMenuOpen",null),t([m()],D.prototype,"features",null),t([m()],D.prototype,"goToOverride",null),t([m()],D.prototype,"headingLevel",void 0),t([m()],D.prototype,"highlightEnabled",null),t([m()],D.prototype,"icon",null),t([m()],D.prototype,"initialDisplayMode",null),t([m()],D.prototype,"location",null),t([m()],D.prototype,"label",null),t([m(),f("esri/widgets/Popup/t9n/Popup")],D.prototype,"messages",void 0),t([m()],D.prototype,"promises",null),t([m({readOnly:!0})],D.prototype,"selectedFeature",null),t([m({readOnly:!0})],D.prototype,"selectedDrillInFeature",null),t([m()],D.prototype,"selectedFeatureIndex",null),t([m({readOnly:!0})],D.prototype,"selectedFeatureWidget",null),t([m()],D.prototype,"title",null),t([m()],D.prototype,"updateLocationEnabled",null),t([m()],D.prototype,"view",null),t([m({type:g}),v(["triggerAction","trigger-action"])],D.prototype,"viewModel",void 0),t([m()],D.prototype,"visible",null),t([m({type:U,nonNullable:!0})],D.prototype,"visibleElements",void 0),D=t([u("esri.widgets.Popup")],D);const S=D;export{S as default};
