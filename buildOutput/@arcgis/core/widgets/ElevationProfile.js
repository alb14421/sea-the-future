/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{c as e}from"../chunks/asyncUtils.js";import{d as s,a as i}from"../chunks/maybe.js";import{m as o}from"../chunks/memoize.js";import{throwIfAborted as r,createAbortError as n}from"../core/promiseUtils.js";import{watch as a,initial as l}from"../core/reactiveUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import m from"./Widget.js";import h from"./ElevationProfile/ElevationProfileViewModel.js";import u from"../core/Accessor.js";import"../intl.js";import{t as d}from"../chunks/throttle.js";import{f as j,m as k}from"../chunks/unitFormatUtils.js";import{n as g,g as y}from"./ElevationProfile/ElevationProfileLine.js";import{l as v}from"../chunks/componentsUtils.js";import"../chunks/widgetUtils.js";import{m as _}from"../chunks/messageBundle.js";import{t as b,a as f}from"../chunks/jsxFactory.js";import{s as C}from"../chunks/substitute.js";import{U as S}from"../chunks/UnitSelect.js";import{g as U}from"../chunks/globalCss.js";import"../chunks/handleUtils.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/events.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/messages.js";import"../chunks/locale.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/getDefaultUnitForView.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../chunks/groundInstanceUtils.js";import"../chunks/vec4f64.js";import"../chunks/ScheduledQueueProcessor.js";import"../chunks/Queue.js";import"../chunks/ReactiveMap.js";import"../chunks/signal.js";import"../chunks/Scheduler.js";import"../chunks/debugFlags.js";import"../chunks/vec2.js";import"../chunks/common.js";import"../chunks/vec3.js";import"../chunks/projectionUtils.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../geometry/support/geodesicUtils.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery.js";import"../layers/support/ElevationSampler.js";import"../chunks/ElevationTile.js";import"../chunks/ElevationSamplerData.js";import"../chunks/TileKey.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/ray.js";import"../chunks/mat3.js";import"../chunks/mat3f64.js";import"../chunks/vector.js";import"../chunks/mat4f64.js";import"../chunks/quatf64.js";import"../chunks/vec2f64.js";import"../chunks/hitTest.js";import"../chunks/projectVectorToVector.js";import"../chunks/projectPointToVector.js";import"../chunks/dehydratedPoint.js";import"../chunks/LayerConstants.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../chunks/debugFlags2.js";import"../chunks/ElevationProvider.js";import"../chunks/dehydratedFeatureUtils.js";import"../chunks/Intersector2.js";import"../views/3d/webgl/RenderCamera.js";import"../chunks/mat4.js";import"../chunks/vec4.js";import"../chunks/frustum.js";import"../chunks/plane.js";import"../chunks/mathUtils2.js";import"../chunks/HUDIntersectorResult.js";import"../chunks/sphere.js";import"../chunks/orientedBoundingBox.js";import"../chunks/quat.js";import"../chunks/spatialReferenceEllipsoidUtils.js";import"../chunks/computeTranslationToOriginAndRotation.js";import"../chunks/intersectorUtilsConversions.js";import"../chunks/Intersector.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../layers/Layer.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../layers/mixins/BlendLayer.js";import"../chunks/layerContainerType.js";import"../chunks/jsonUtils2.js";import"../chunks/parser.js";import"../chunks/utils5.js";import"../layers/mixins/ScaleRangeLayer.js";import"../symbols/support/ElevationInfo.js";import"../symbols/support/FeatureExpressionInfo.js";import"../chunks/InputManager.js";import"./Sketch/SketchViewModel.js";import"../chunks/UpdatingHandles.js";import"../chunks/isSupportedObject.js";import"../chunks/layerUtils2.js";import"../chunks/editableLayers.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../chunks/SketchOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SketchTooltipVisibleElements.js";import"../views/interactive/sketch/SketchValueOptions.js";import"../chunks/SnappingManager.js";import"../chunks/normalizedPoint.js";import"../chunks/Settings.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/constraints.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../chunks/utils11.js";import"../chunks/Version2.js";import"../chunks/Version.js";import"../chunks/geometry2dUtils.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/geodesicLengthMeasurementUtils.js";import"../chunks/quantityUtils.js";import"../geometry/operators/geodeticLengthOperator.js";import"../chunks/geodeticCurveType.js";import"../chunks/geodesicMeasurementUtils.js";import"../chunks/automaticAreaMeasurementUtils.js";import"../chunks/geodesicAreaMeasurementUtils.js";import"../chunks/earcut.js";import"../chunks/triangle.js";import"../chunks/lineSegment.js";import"../chunks/automaticLengthMeasurementUtils.js";import"../chunks/HighlightDefaults.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/screenUtils2.js";import"../chunks/sketchUtils.js";import"../chunks/Cyclical.js";const w="esri-elevation-profile",x={base:`${w}`,refined:`${w}--refined`,mainContainer:`${w}__main-container`,promptContainer:`${w}__prompt-container`,header:`${w}__header`,zoomOutButton:`${w}__zoom-out-button`,clearButton:`${w}__clear-button`,actionButton:`${w}__action-button`,sketchButton:`${w}__sketch-button`,sketchCancelButton:`${w}__sketch-cancel-button`,sketchDoneButton:`${w}__sketch-done-button`,selectButton:`${w}__select-button`,selectCancelButton:`${w}__select-cancel-button`,chartContainer:`${w}__chart-container`,chartSpinner:`${w}__chart-spinner`,chartSpinnerVisible:`${w}__chart-spinner--visible`,chartSpinnerSmall:`${w}__chart-spinner--small`,footer:`${w}__footer`},E="esri-elevation-profile-legend-item",P={base:E,disabled:`${E}--disabled`,expanded:`${E}--expanded`,colorIndicator:`${E}__color-indicator`,header:`${E}__header`,content:`${E}__content`,collapseToggle:`${E}__collapse-toggle`,label:`${E}__label`,checkbox:`${E}__checkbox`},M="esri-elevation-profile-statistics",B={base:M,statistic:`${M}__statistic`,statisticLabel:`${M}__statistic__label`,statisticValue:`${M}__statistic__value`,slopeValue:`${M}__slope-value`},L="esri-elevation-profile-settings",I={base:`${L}`,popoverContent:`${L}__popover-content`,uniformChartScalingLabel:`${L}__uniform-scaling-label`,uniformChartScalingCheckbox:`${L}__uniform-scaling-checkbox`};let T=class extends u{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([c()],T.prototype,"legend",void 0),t([c()],T.prototype,"chart",void 0),t([c()],T.prototype,"clearButton",void 0),t([c()],T.prototype,"settingsButton",void 0),t([c()],T.prototype,"sketchButton",void 0),t([c()],T.prototype,"selectButton",void 0),t([c()],T.prototype,"unitSelector",void 0),t([c()],T.prototype,"uniformChartScalingToggle",void 0),T=t([p("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],T);const D=T;let V=class extends m{constructor(t,e){super(t,e),this._updateLayout=t=>{const e=t.parentElement,s=t.style.display;e?.removeChild(t),document.body.appendChild(t),t.style.display="block";let i=80;for(const e of t.childNodes)e instanceof HTMLElement&&(i=Math.max(i,e.offsetWidth));document.body.removeChild(t),e?.appendChild(t),t.style.display=s,t.style.setProperty("--max-width",`${i}px`)},this._updateLayoutThrottled=d(this._updateLayout,100)}loadDependencies(){return v({icon:()=>import("../chunks/index.js")})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return b("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:B.base},this._renderStatistics())}_renderStatistics(){const t=this._messages?.statistics;return t?[this._renderDistanceStatistic("maxDistance",t.maxDistance),this._renderElevationStatistic("elevationGain",t.gain),this._renderElevationStatistic("elevationLoss",t.loss),this._renderElevationStatistic("minElevation",t.minElevation),this._renderElevationStatistic("maxElevation",t.maxElevation),this._renderElevationStatistic("avgElevation",t.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",t.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",t.avgSlope)]:[]}_renderDistanceStatistic(t,e){const s=y().formatPrecision,i=this._renderValue(t,t=>{const e=this.effectiveUnits.distance;return j(this._messagesUnits,t,e,s)});return this._renderStatistic(e,i)}_renderElevationStatistic(t,e){const s=y().formatPrecision,i=this._renderValue(t,t=>{const e=this.effectiveUnits.elevation;return j(this._messagesUnits,t,e,s)});return this._renderStatistic(e,i)}_renderSlopeStatistic(t,e,s){const i=y().formatPrecision,o=b("div",{class:B.slopeValue,key:"slope-up"},b("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(t,t=>k(t,"degrees","geographic","geographic",i)),b("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(e,t=>k(t,"degrees","geographic","geographic",i)));return this._renderStatistic(s,o)}_renderStatistic(t,e){return b("div",{class:B.statistic},b("label",{class:B.statisticLabel},t),b("div",{class:B.statisticValue},e))}_renderValue(t,e){const s=this.line,i=1===s.progress?s.statistics:null,o=i?.[t];return null!=o?e(o):g}};function O(t,{profiles:e}){const s=t.title;if(null!=s)return s;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([c()],V.prototype,"effectiveUnits",void 0),t([c()],V.prototype,"line",void 0),t([c(),_("esri/widgets/ElevationProfile/t9n/ElevationProfile")],V.prototype,"_messages",void 0),t([c(),_("esri/core/t9n/Units")],V.prototype,"_messagesUnits",void 0),V=t([p("esri.widgets.ElevationProfile.components.Statistics")],V);let $=class extends m{constructor(t,e){super(t,e),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return v({action:()=>import("../chunks/index5.js"),checkbox:()=>import("../chunks/index21.js"),label:()=>import("../chunks/index2.js")})}initialize(){this._statistics=new V(this._statisticsProps),this.addHandles(a(()=>this._statisticsProps,t=>this._statistics.set(t)))}destroy(){this._statistics=s(this._statistics)}render(){const t=this.expanded;return b("div",{class:this.classes(P.base,{[P.disabled]:this.disabled,[P.expanded]:t}),key:this},this._renderColorIndicator(),b("div",{class:P.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t?b("div",{class:P.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return b("div",{class:P.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:t,messages:e}=this,s=t?e.hideDetails:e.showDetails;return b("calcite-action",{appearance:"transparent",bind:this,class:P.collapseToggle,"data-testid":"legend-toggle",icon:t?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:s,title:s})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:s,messages:i}=this;return b("calcite-label",{class:P.label,disabled:s,key:`label-${t.id}`,layout:"inline"},e?this._renderCheckbox():null,O(t,i))}_renderCheckbox(){const{disabled:t,line:e,messages:s}=this,i=e.visible,o=i?s.hideProfile:s.showProfile,r=C(o,{name:O(e,s)});return b("calcite-checkbox",{checked:i,class:P.checkbox,disabled:t,title:r,onCalciteCheckboxChange:()=>e.toggleVisibility()})}};t([c()],$.prototype,"checkboxVisible",void 0),t([c()],$.prototype,"disabled",null),t([c({nonNullable:!0})],$.prototype,"effectiveUnits",void 0),t([c()],$.prototype,"expanded",void 0),t([c({nonNullable:!0})],$.prototype,"line",void 0),t([c()],$.prototype,"messages",void 0),t([c()],$.prototype,"onExpandedToggle",void 0),t([c()],$.prototype,"_statistics",void 0),$=t([p("esri.widgets.ElevationProfile.components.LegendItem")],$);let F=class extends m{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:t,messages:e,effectiveUnits:s,_expandedLine:i}=this;return b("div",{class:"esri-elevation-profile-legend"},t.map(o=>b($,{checkboxVisible:t.length>1,effectiveUnits:s,expanded:o===i,line:o,messages:e,onExpandedToggle:()=>this._onExpandedToggle(o)})))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t}};t([c()],F.prototype,"effectiveUnits",void 0),t([c()],F.prototype,"messages",void 0),t([c()],F.prototype,"profiles",void 0),t([c()],F.prototype,"_expandedLine",void 0),F=t([p("esri.widgets.ElevationProfile.components.Legend")],F);let R=class extends m{constructor(){super(...arguments),this.messages=null,this._popoverIsOpen=!1,this._referenceElement=null,this._onUniformChartScalingChange=t=>{this.onUniformChartScalingChange(t.currentTarget.checked)}}loadDependencies(){return v({action:()=>import("../chunks/index5.js"),checkbox:()=>import("../chunks/index21.js"),label:()=>import("../chunks/index2.js"),popover:()=>import("../chunks/index26.js").then(t=>t.i)})}render(){const{id:t,messages:e,visibleElements:s}=this,{unitSelector:i,uniformChartScalingToggle:o}=s;if(!e||!i&&!o)return b("div",{key:`${t}-empty`});const r=this._popoverIsOpen?e.hideSettings:e.showSettings;return b("div",{class:I.base,key:this},b("calcite-action",{afterCreate:t=>{this._referenceElement=t},appearance:"transparent","data-testid":"settings-button",icon:"gear",scale:"s",text:r,title:r}),this._referenceElement?b("calcite-popover",{autoClose:!0,label:r,placement:"bottom-end",referenceElement:this._referenceElement,onCalcitePopoverClose:()=>{this._popoverIsOpen=!1},onCalcitePopoverOpen:()=>{this._popoverIsOpen=!0}},this._renderPopoverContent()):null)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return b("div",{class:I.popoverContent},t?this._renderUnitSelector():null,e?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:t}=this;return b(S,{key:"unit-selector-label",options:this.unitOptions,selectLabel:t?.unitSelectLabel??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:t}=this,e=this.uniformChartScaling;return b("calcite-label",{class:I.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},b("calcite-checkbox",{checked:e,class:I.uniformChartScalingCheckbox,title:t?.[e?"uniformChartScalingDisable":"uniformChartScalingEnable"]??"",onCalciteCheckboxChange:this._onUniformChartScalingChange}),t?.uniformChartScalingLabel)}};t([c()],R.prototype,"messages",void 0),t([c()],R.prototype,"onUniformChartScalingChange",void 0),t([c()],R.prototype,"onUnitChange",void 0),t([c()],R.prototype,"uniformChartScaling",void 0),t([c()],R.prototype,"unit",void 0),t([c()],R.prototype,"unitOptions",void 0),t([c()],R.prototype,"visibleElements",void 0),t([c()],R.prototype,"_popoverIsOpen",void 0),t([c()],R.prototype,"_referenceElement",void 0),R=t([p("esri.widgets.ElevationProfile.components.SettingsButton")],R);const A=[{type:"select"},{type:"sketch"}],z={none:null,"no-valid-input":"noProfile","no-visible-profiles":"noProfile","refined-but-no-chart-data":"noProfile","too-complex":"tooComplex","unknown-error":"unknown","invalid-geometry":"invalidGeometry","invalid-elevation-info":"invalidElevationInfo"};let N=class extends m{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new D,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=o((t,e,s,i)=>({chart:t,data:e,stationary:s,messages:i})),this._onZoomOutButtonClick=()=>{this._chart?.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},t?.viewModel||(this._defaultViewModel=new h({view:t?.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return v({action:()=>import("../chunks/index5.js"),button:()=>import("../chunks/index6.js"),loader:()=>import("../chunks/index28.js")})}postInitialize(){this.addHandles([a(()=>({container:this._chartContainer}),({container:t})=>{this._destroyChart(),null!=t&&this._initializeChart(t)},l),a(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),l)])}destroy(){this._destroyChart(),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get input(){return this.viewModel.input}set input(t){this.viewModel.input=t}get profiles(){return this.viewModel.profiles}set profiles(t){this.viewModel.profiles=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get icon(){return"altitude"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get test(){return{chart:this._chart}}get _selectButtonVisible(){return!0===this.visibleElements.selectButton&&this.viewModel.selectAvailable}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,null==t||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:t,visible:e}=this;return b("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[x.base]:e,[U.widget]:e,[U.panel]:e,[U.widgetDisabled]:e&&"disabled"===t.state,[x.refined]:1===t.progress}),key:this},b("div",{bind:this,key:"content-wrapper"},e?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case"ready":case"disabled":return this._renderContentForReadyState();case"selecting":return this._renderContentForSelectingState();case"creating":return this._renderContentForCreatingState();case"selected":return this._renderContentForSelectedState();case"created":return this._renderContentForCreatedState()}}_renderContentForReadyState(){const{messages:t,visibleElements:e,_selectButtonVisible:s}=this,{sketchButton:i}=e;let o;return o=i&&s?t.readyPrompt:i?t.readyPromptCreateOnly:s?t.readyPromptSelectOnly:t.errors?.noProfile,this._renderContent({prompt:o,chart:!1,actions:A})}_renderContentForSelectingState(){const{view:t}=this;if(null==t)return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:"select-cancel"}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(null==t)return null;const s=e.hasVertices?[{type:"sketch-cancel"},{type:"sketch-done",disabled:!e.tool.interaction.canStopCreating}]:[{type:"select"},{type:"sketch",disabled:!0}];if("no-valid-input"===e.errorState){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:s,prompt:e})}const i=this._getErrorMessage();return i?this._renderContent({chart:!1,actions:s,prompt:i}):this._renderContent({chart:!0,actions:s})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:A,prompt:t}):this._renderContent({chart:!0,actions:A})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:A,prompt:t}):this._renderContent({chart:!0,actions:A})}_getErrorMessage(){const t=z[this.viewModel.errorState];return t?this.messages?.errors?.[t]:null}_renderContent(t){const e=null!=t.prompt?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),{viewModel:s}=this,i=null!=s.input;return b(f,null,b("header",{class:x.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&i?this._renderClearButton():null,this.visibleElements.settingsButton?b(R,{messages:this.messages,uniformChartScaling:s.uniformChartScaling,unit:s.unit,unitOptions:s.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:t=>s.uniformChartScaling=t,onUnitChange:t=>s.unit=t}):null),b("div",{class:x.mainContainer,key:"main-container"},e),this.visibleElements.legend?b(F,{effectiveUnits:s.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(t))}_renderZoomOutButton(){const t=this.messages.zoomOut;return b("calcite-action",{appearance:"transparent",class:x.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:t,title:t})}_renderClearButton(){const t=this.messages.clearProfile;return b("calcite-action",{appearance:"transparent",class:x.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:t,title:t})}_renderPrompt(t){return[b("div",{bind:this,class:x.promptContainer,key:"prompt-container"},b("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return b("div",{class:x.chartContainer,key:"empty-chart-container"});const{chartData:t,progress:e}=this.viewModel,s=this._chartIsRefined||this._canRenderChart(),i=null!=t&&e<1;return s?b(f,null,this._renderSpinner({size:s?"small":"large",visible:i}),b("div",{afterCreate:this._onChartContainerUpdate,afterRemoved:this._onChartContainerRemoved,afterUpdate:this._onChartContainerUpdate,bind:this,class:x.chartContainer,key:"chart-container"})):b(f,null,this._renderSpinner({size:"large",visible:i}),b("div",{class:x.chartContainer,key:"chart-container-empty"}))}_renderSpinner(t){const e="small"===t.size,s=t.visible??!0;return b("calcite-loader",{class:this.classes(x.chartSpinner,e&&x.chartSpinnerSmall,s&&x.chartSpinnerVisible),"data-testid":"chart-spinner",inline:e,key:"spinner",label:"",scale:"s"})}_canRenderChart(){const t=this.viewModel.chartData;if(null==t)return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:s}of t.lines)e+=null!=s?s.length:0;return t.refined||e<=y().largeChartSamples}_renderActions({actions:t}){const e=t.map(t=>{switch(t.type){case"sketch":return this.visibleElements.sketchButton&&this._renderAction({action:t,className:x.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case"sketch-cancel":return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:x.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case"sketch-done":return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:x.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case"select":return this._selectButtonVisible&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:x.selectButton,label:this.messages.selectButtonLabel,primary:!1});case"select-cancel":return this._selectButtonVisible&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:x.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}}).filter(Boolean);return e.length?b("footer",{class:x.footer,key:"footer"},e):null}_renderAction({action:t,className:e,label:s,onClick:i,primary:o}){return b("calcite-button",{appearance:o?"solid":"outline-fill",bind:this,class:this.classes(x.actionButton,e),disabled:t.disabled,key:`action-${t.type}`,onclick:i},s)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(t){const{data:e,chart:s,messages:i,stationary:o}=t;null!=s&&null!=i&&o&&this._canRenderChart()&&(s.update(t),this._chartIsRefined=null!=e&&e.refined)}_onChartContainerUpdate(t){this._chartContainer=t}_onChartContainerRemoved(t){this._chartContainer===t&&(this._chartContainer=null)}_initializeChart(t){i(this._chartInitTask),this._chartInitTask=e(async e=>{const{createChart:i}=await import("../chunks/chartUtils.js");r(e);const o=await i({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}});if(e.aborted)throw s(o),n();this._chart=o,this._updateChart(this._chartUpdateParams)})}_destroyChart(){this._chartInitTask=i(this._chartInitTask),this._chart=s(this._chart),this._chartIsRefined=!1}};t([c({type:h})],N.prototype,"viewModel",void 0),t([c()],N.prototype,"view",null),t([c()],N.prototype,"input",null),t([c()],N.prototype,"profiles",null),t([c()],N.prototype,"unitOptions",null),t([c()],N.prototype,"unit",null),t([c({type:D,nonNullable:!0})],N.prototype,"visibleElements",void 0),t([c()],N.prototype,"icon",null),t([c()],N.prototype,"label",null),t([c()],N.prototype,"visible",null),t([c(),_("esri/widgets/ElevationProfile/t9n/ElevationProfile")],N.prototype,"messages",void 0),t([c(),_("esri/t9n/common")],N.prototype,"messagesCommon",void 0),t([c(),_("esri/core/t9n/Units")],N.prototype,"messagesUnits",void 0),t([c()],N.prototype,"_chartContainer",void 0),t([c()],N.prototype,"_chart",void 0),t([c()],N.prototype,"_chartInitTask",void 0),t([c()],N.prototype,"_chartIsRefined",void 0),t([c()],N.prototype,"_zoomOutButtonVisible",void 0),t([c()],N.prototype,"_selectButtonVisible",null),t([c()],N.prototype,"_chartUpdateParams",null),t([c()],N.prototype,"_chartMessages",null),t([c()],N.prototype,"_profilesArray",null),N=t([p("esri.widgets.ElevationProfile")],N);const G=N;export{G as default,O as g};
