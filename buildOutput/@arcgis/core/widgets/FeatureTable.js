/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{i as t}from"../core/lang.js";import{watch as s,on as i,sync as o,initial as l}from"../core/reactiveUtils.js";import{r as n}from"../chunks/sanitizerUtils.js";import{n as r}from"../chunks/unitFormatUtils.js";import{property as a}from"../core/accessorSupport/decorators/property.js";import"../chunks/Logger.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import{isLayerFromCatalog as c}from"../layers/catalog/catalogUtils.js";import{c as m,k as h,a as d}from"../chunks/layerUtils.js";import u from"../tables/AttributeTableTemplate.js";import b from"./Widget.js";import{i as g,a as y}from"../chunks/attachmentUtils.js";import{l as w,P as v}from"../chunks/Prompt.js";import f from"../core/Accessor.js";import j from"./FeatureTable/FeatureTableViewModel.js";import{i as S}from"../chunks/columnUtils.js";import{l as k,i as M,a as C,g as _}from"../chunks/tableUtils.js";import{l as T}from"../chunks/componentsUtils.js";import{g as A}from"../chunks/globalCss.js";import{g as I}from"../chunks/iconUtils.js";import{s as E,d as V}from"../chunks/widgetUtils.js";import{m as R}from"../chunks/messageBundle.js";import{v as x}from"../chunks/vmEvent.js";import{t as D}from"../chunks/jsxFactory.js";import{s as P}from"../chunks/substitute.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../chunks/string.js";import"../core/promiseUtils.js";import"../chunks/events.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/MapUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/Cyclical.js";import"../chunks/mathUtils.js";import"../chunks/quantityUtils.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../core/Collection.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/JSONSupport.js";import"../tables/elements/AttributeTableGroupElement.js";import"../tables/elements/AttributeTableAttachmentElement.js";import"../core/Clonable.js";import"../tables/elements/AttributeTableElement.js";import"../tables/elements/AttributeTableFieldElement.js";import"../tables/elements/AttributeTableRelationshipElement.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/Heading.js";import"../chunks/collectionUtils.js";import"../chunks/throttle.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../support/popupUtils.js";import"../PopupTemplate.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/HighlightDefaults.js";import"../chunks/layerViewUtils.js";import"../chunks/selectionUtils.js";import"./FeatureTable/ActionColumn.js";import"./FeatureTable/Grid/Column.js";import"../chunks/uriUtils.js";import"./FeatureTable/AttachmentsColumn.js";import"../chunks/ReactiveMap.js";import"./FeatureTable/FieldColumn.js";import"../chunks/editableLayers.js";import"../chunks/featureLayerUtils.js";import"../chunks/asyncUtils.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../chunks/featureQueryAll.js";import"../rest/support/Query.js";import"../geometry/Point.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../renderers/SimpleRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../chunks/opacityUtils.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../chunks/screenUtils.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/lengthUtils.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../chunks/RendererLegendOptions.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/NormalizationBinParametersMixin.js";import"../rest/support/RelationshipQuery.js";import"../chunks/utils7.js";import"../chunks/basemapUtils.js";import"../chunks/utils5.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/basemapDefinitions.js";import"../chunks/timeZoneUtils.js";import"./FeatureForm/FieldInput.js";import"../chunks/featureUtils.js";import"./FeatureForm/EditableInput.js";import"./FeatureForm/InputBase.js";import"../chunks/featureFormUtils.js";import"../chunks/formUtils.js";import"../form/elements/AttachmentElement.js";import"../form/elements/Element.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../chunks/Input.js";import"../form/elements/inputs/attachments/AudioInput.js";import"../chunks/utils2.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../form/elements/RelationshipElement.js";import"../form/elements/TextElement.js";import"../form/elements/UtilityNetworkAssociationsElement.js";import"../chunks/dateUtils.js";import"../chunks/formUtils2.js";import"./FeatureTable/Grid/EditorColumn.js";import"./FeatureTable/RelationshipColumn.js";import"./FeatureTable/Grid/GroupColumn.js";import"./FeatureTable/support/AttachmentsColumnTemplate.js";import"./FeatureTable/support/ColumnTemplateBase.js";import"./FeatureTable/support/AttachmentsViewOptions.js";import"./FeatureTable/support/FieldColumnTemplate.js";import"./FeatureTable/support/EditableColumnTemplateMixin.js";import"./FeatureTable/support/RelationshipColumnTemplate.js";import"./FeatureTable/support/TableTemplate.js";import"./FeatureTable/support/ColumnTemplate.js";import"./FeatureTable/support/GroupColumnTemplate.js";import"../chunks/templateUtils.js";import"../chunks/goToUtils.js";let U=class extends f{constructor(e){super(e),this.sortAscending=!0,this.sortDescending=!0}};e([a({type:Boolean,nonNullable:!0})],U.prototype,"sortAscending",void 0),e([a({type:Boolean,nonNullable:!0})],U.prototype,"sortDescending",void 0),U=e([p("esri.widgets.FeatureTable.ColumnMenuVisibleElements")],U);const F=U;let L=class extends f{constructor(e){super(e),this.clearSelection=!0,this.deleteSelection=!0,this.exportSelectionToCSV=!0,this.refreshData=!0,this.selectedRecordsShowAllToggle=!0,this.selectedRecordsShowSelectedToggle=!0,this.toggleColumns=!0,this.zoomToSelection=!0}};e([a({type:Boolean,nonNullable:!0})],L.prototype,"clearSelection",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"deleteSelection",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"exportSelectionToCSV",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"refreshData",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"selectedRecordsShowAllToggle",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"selectedRecordsShowSelectedToggle",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"toggleColumns",void 0),e([a({type:Boolean,nonNullable:!0})],L.prototype,"zoomToSelection",void 0),L=e([p("esri.widgets.FeatureTable.TableMenuVisibleElements")],L);const O=L;let z=class extends f{constructor(e){super(e),this.columnDescriptions=!0,this.columnMenus=!0,this.columnMenuItems=new F,this.close=!1,this.header=!0,this.layerDropdown=!1,this.layerDropdownIcons=!0,this.menu=!0,this.menuItems=new O,this.progress=!0,this.selectionColumn=!0,this.tooltips=!0}};e([a({type:Boolean,nonNullable:!0})],z.prototype,"columnDescriptions",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"columnMenus",void 0),e([a({type:F,nonNullable:!0})],z.prototype,"columnMenuItems",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"close",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"header",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"layerDropdown",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"layerDropdownIcons",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"menu",void 0),e([a({type:O,nonNullable:!0})],z.prototype,"menuItems",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"progress",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"selectionColumn",void 0),e([a({type:Boolean,nonNullable:!0})],z.prototype,"tooltips",void 0),z=e([p("esri.widgets.FeatureTable.VisibleElements")],z);const B=z;var N;const $="esri-feature-table",G=`${$}__attachments-view`,H={base:$,content:`${$}__content`,menuPopover:`${$}__menu-popover`,layerDropdownMenu:`${$}__layer-switcher-menu`,tableContainer:`${$}__table-container`,tableContainerWithAttachments:`${$}__table-container--attachments`,tableNavigation:`${$}__table-navigation`,attachmentsView:G,attachmentsViewContent:`${G}__content`,attachmentsViewDropArea:`${G}__drop-area`,attachmentsViewIcon:`${G}__icon`,attachmentsViewInformation:`${G}__information`,attachmentsViewList:`${G}__list`,attachmentsViewListFileSize:`${G}__list__filesize`,attachmentsViewListItemDelete:`${G}__list-item--delete`,attachmentsViewListThumbnail:`${G}__list__thumbnail`,expanded:`${$}__expanded`,collapsed:`${$}__collapsed`},Z="chevron-right",Q="trash";let q=N=class extends b{constructor(e,t){super(e,t),this._attachmentsInput=null,this._columnVisibilityActions=new Map,this.attachmentsList=null,this.description=null,this.disabled=!1,this.menuConfig=null,this.navigationScale="m",this.title=null,this.viewModel=new j,this.visibleElements=new B,this._showDeletePrompt=this._showDeletePrompt.bind(this),this._onDeleteSelectionClick=this._onDeleteSelectionClick.bind(this)}initialize(){this.addHandles([s(()=>[this.isQueryingOrSyncing,this.editingEnabled],()=>this.scheduleRender()),s(()=>[this._effectiveVisibleElements,this._effectiveVisibleElements.columnDescriptions,this._effectiveVisibleElements.columnMenus,this._effectiveVisibleElements.columnMenuItems,this.columns.length],()=>{this.columns.forEach(e=>e.visibleElements=this._effectiveVisibleElements),this.refreshCellContent()},o),s(()=>this._effectiveVisibleElements.selectionColumn,e=>{this.grid&&(this.grid.selectionColumnEnabled=e)},l),i(()=>this.viewModel,"show-related-table",e=>this._onShowRelatedTable(e)),s(()=>this.editingEnabled,()=>{const{attachmentsViewOptions:e}=this;this.clearPrompt(),e&&(e.form?.reset(),e.candidates=null)})])}loadDependencies(){return Promise.all([T({action:()=>import("../chunks/index5.js"),alert:()=>import("../chunks/index65.js"),button:()=>import("../chunks/index6.js"),chip:()=>import("../chunks/index35.js"),dropdown:()=>import("../chunks/index7.js"),"dropdown-group":()=>import("../chunks/index9.js"),"dropdown-item":()=>import("../chunks/index8.js"),icon:()=>import("../chunks/index.js"),label:()=>import("../chunks/index2.js"),list:()=>import("../chunks/index19.js"),"list-item":()=>import("../chunks/index18.js"),pagination:()=>import("../chunks/index50.js"),panel:()=>import("../chunks/index25.js").then(e=>e.i),popover:()=>import("../chunks/index26.js").then(e=>e.i),progress:()=>import("../chunks/index60.js"),switch:()=>import("../chunks/index3.js"),tooltip:()=>import("../chunks/index4.js")}),w(),k()])}destroy(){this.drainRelatedTables(),this.clearPrompt()}get _effectiveDescription(){const{description:e}=this;return null!=e?n.sanitize("function"==typeof e?e():e):void 0}get _effectiveLayers(){const{layer:e,layers:t}=this,s=t?.length?t.filter(M):[],i=s.length?s:[...this._viewLayers];return e&&!i.includes(e)&&i.push(e),i}get _effectiveTitle(){const{layer:e,messages:t,state:s,highlightIds:i,title:o,size:l}=this;if(o)return n.sanitize("function"==typeof o?o():o);if(!e)return t.noLayer;switch(s){case"disabled":return t.errorLayer;case"ready":case"loading":return t.loading;case"error":return t.errorData}return P(t.header,{title:n.sanitize(e.title),count:l,selected:i.length})}get _effectiveVisibleElements(){return this.visibleElementsOverride??this.visibleElements}get _filteredTables(){const e=this.relatedTables.toArray(),t=1===e.length;return this.allRelatedTablesVisible?e:t?[e[0]]:this._shouldShowAttachmentsView?e.slice(-1):e.slice(-2)}get _hasAttachmentsViewError(){return null!=this.attachmentsViewOptions.error}get _hasCustomMenuItems(){return!!this.menuConfig?.items?.length}get _hasDefaultMenuItems(){return!!(this._showClearSelectionAction||this._showDeleteSelectionAction||this._showExportSelectionToCSVAction||this._showRefreshDataAction||this._showZoomToSelectionAction||this._showSelectedRecordsShowSelectedAction||this._showSelectedRecordsShowAllAction||this._showColumnsVisibilityAction)}get _shouldShowGrid(){return this.allRelatedTablesVisible||1===this.relatedTables.length&&!this._shouldShowAttachmentsView}get _shouldShowMenu(){const{header:e,menu:t}=this._effectiveVisibleElements;return!(!e||!t||!this._hasDefaultMenuItems&&!this._hasCustomMenuItems)}get _shouldShowAttachmentsView(){return!(null==this.attachmentsViewOptions.objectId&&!this.relatedTables.some(e=>null!=e.attachmentsViewOptions.objectId))}get _showClearSelectionAction(){return!(!this.highlightIds.length||!this._effectiveVisibleElements.menuItems?.clearSelection||this.relatedTables.length||this._shouldShowAttachmentsView)}get _showColumnsVisibilityAction(){const{header:e,menu:t,menuItems:s}=this._effectiveVisibleElements;return!(!(e&&t&&s?.toggleColumns)||this.showRelatedTableCallback||this.allRelatedTablesVisible||this._shouldShowAttachmentsView)}get _showDeleteSelectionAction(){return!(!(this.editingEnabled&&this.highlightIds.length&&this._effectiveVisibleElements.menuItems?.deleteSelection&&this.layer?.capabilities?.operations?.supportsDelete)||this.relatedTables.length||this._shouldShowAttachmentsView)}get _showExportSelectionToCSVAction(){return!(!(this._effectiveVisibleElements.menuItems.exportSelectionToCSV&&this.layer&&this.highlightIds.length)||this.relatedTables.length)}get _showLayerDropdown(){return!(!this._effectiveLayers.length||!this._effectiveVisibleElements.layerDropdown)}get _shouldShowNavigationBar(){const e=!!this.relatedTable||this._shouldShowAttachmentsView;return!this.tableParent&&e}get _showRefreshDataAction(){return!!this._effectiveVisibleElements.menuItems?.refreshData}get _showSelectedRecordsShowSelectedAction(){const e=this.objectIds.length,t=this.highlightIds.length;return!(!t||!this._effectiveVisibleElements.menuItems?.selectedRecordsShowSelectedToggle||e&&t===e||this.relatedTables.length||this._shouldShowAttachmentsView)}get _showSelectedRecordsShowAllAction(){return!(!this._effectiveVisibleElements.menuItems?.selectedRecordsShowAllToggle||!this.objectIds.length||this.relatedTables.length)}get _showZoomToSelectionAction(){return!(!this.view||!this.highlightIds.length||this.effectiveTable.layer?.isTable||!this._effectiveVisibleElements.menuItems?.zoomToSelection)}get _viewLayers(){const e=this.view?.map;if(!e)return[];const t=new Set,s=e=>{!M(e)||d(e)||t.has(e)||"sublayer"===e.type&&!e.capabilities?.operations?.supportsQuery||(e.load(),t.add(e))},i=e=>{c(e)||"catalog-footprint"===e.type||(m(e)?(e.load(),e.layers?.forEach(s),e.tables?.forEach(s)):h(e)?(e.loadAll(),e.allSublayers?.forEach(s),e.subtables?.forEach(s)):d(e)?(e.loadAll(),e.sublayers?.forEach(s)):s(e))};return e.allLayers.forEach(i),e.allTables.forEach(i),[...t.values()]}get grid(){return this.viewModel.grid}get actionColumn(){return this.viewModel.actionColumn}get actionColumnConfig(){return this.viewModel.actionColumnConfig}set actionColumnConfig(e){this.viewModel.actionColumnConfig=e}get activeFilters(){return this.viewModel.activeFilters}get activeSortOrders(){return this.viewModel.activeSortOrders}get allColumns(){return this.viewModel.allColumns}get allRelatedTablesVisible(){return this.viewModel.allRelatedTablesVisible}get allVisibleColumns(){return this.viewModel.allVisibleColumns}get attachmentsColumns(){return this.viewModel.attachmentsColumns}get attachmentsEnabled(){return this.viewModel.attachmentsEnabled}set attachmentsEnabled(e){this.viewModel.attachmentsEnabled=e}get attachmentsViewOptions(){return this.viewModel.attachmentsViewOptions}set attachmentsViewOptions(e){this.viewModel.attachmentsViewOptions=e}get attributeTableTemplate(){return this.viewModel.attributeTableTemplate}set attributeTableTemplate(e){this.viewModel.attributeTableTemplate=e}get autoRefreshEnabled(){return this.viewModel.autoRefreshEnabled}set autoRefreshEnabled(e){this.viewModel.autoRefreshEnabled=e}get clearPrompt(){return this.viewModel.clearPrompt}set clearPrompt(e){this.viewModel.clearPrompt=e}get columnPerformanceModeEnabled(){return this.viewModel.columnPerformanceModeEnabled}set columnPerformanceModeEnabled(e){this.viewModel.columnPerformanceModeEnabled=e}get columnReorderingEnabled(){return this.viewModel.columnReorderingEnabled}set columnReorderingEnabled(e){this.viewModel.columnReorderingEnabled=e}get columns(){return this.viewModel.columns}get definitionExpression(){return this.viewModel.definitionExpression}set definitionExpression(e){this.viewModel.definitionExpression=e}set container(e){super.container=e}get editingEnabled(){return this.viewModel.editingEnabled}set editingEnabled(e){this.viewModel.editingEnabled=e}get effectiveSize(){return this.viewModel.effectiveSize}get effectiveTable(){return this.relatedTable||this}get fieldColumns(){return this.viewModel.fieldColumns}get filterGeometry(){return this.viewModel.filterGeometry}set filterGeometry(e){this.viewModel.filterGeometry=e}get filterBySelectionEnabled(){return this.viewModel.filterBySelectionEnabled}set filterBySelectionEnabled(e){this.viewModel.filterBySelectionEnabled=e}get groupColumns(){return this.viewModel.groupColumns}get hiddenFields(){return this.viewModel.hiddenFields}set hiddenFields(e){this.viewModel.hiddenFields=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get highlightIds(){return this.viewModel.highlightIds}set highlightIds(e){this.viewModel.highlightIds=e}get icon(){return"table"}set icon(e){this._overrideIfSome("icon",e)}get initialSize(){return this.viewModel.initialSize}set initialSize(e){this.viewModel.initialSize=e}get isQueryingOrSyncing(){return this.viewModel.isQueryingOrSyncing}get isSyncingAttachments(){return this.viewModel.isSyncingAttachments}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get layerView(){return this.viewModel.layerView}get maxSize(){return this.viewModel.maxSize}set maxSize(e){this.viewModel.maxSize=e}get messages(){return this.viewModel.messages}set messages(e){this.viewModel.messages=e}get messagesCommon(){return this.viewModel.messagesCommon}set messagesCommon(e){this.viewModel.messagesCommon=e}get messagesUnits(){return this.viewModel.messagesUnits}set messagesUnits(e){this.viewModel.messagesUnits=e}get messagesURIUtils(){return this.viewModel.messagesURIUtils}set messagesURIUtils(e){this.viewModel.messagesURIUtils=e}get multipleSelectionEnabled(){return this.viewModel.multipleSelectionEnabled}set multipleSelectionEnabled(e){this.viewModel.multipleSelectionEnabled=e}get multiSortEnabled(){return this.viewModel.multiSortEnabled}set multiSortEnabled(e){this.viewModel.multiSortEnabled=e}get multipleSortPriority(){return this.viewModel.multipleSortPriority}set multipleSortPriority(e){this.viewModel.multipleSortPriority=e}get noDataMessage(){return this.viewModel.noDataMessage}set noDataMessage(e){this.viewModel.noDataMessage=e}get objectIds(){return this.viewModel.objectIds}set objectIds(e){this.viewModel.objectIds=e}get outFields(){return this.viewModel.outFields}set outFields(e){this.viewModel.outFields=e}get pageCount(){return this.viewModel.pageCount}get pageIndex(){return this.viewModel.pageIndex}set pageIndex(e){this.viewModel.pageIndex=e}get pageSize(){return this.viewModel.pageSize}set pageSize(e){this.viewModel.pageSize=e}get paginationEnabled(){return this.viewModel.paginationEnabled}set paginationEnabled(e){this.viewModel.paginationEnabled=e}get prompt(){return this.viewModel.prompt}set prompt(e){this.viewModel.prompt=e}get relatedRecordsEnabled(){return this.viewModel.relatedRecordsEnabled}set relatedRecordsEnabled(e){this.viewModel.relatedRecordsEnabled=e}get relatedTable(){return this.viewModel.relatedTable}get relatedTables(){return this.viewModel.relatedTables}set relatedTables(e){this.viewModel.relatedTables=e}get relationship(){return this.viewModel.relationship}get relationshipColumnConfigs(){return this.viewModel.relationshipColumnConfigs}set relationshipColumnConfigs(e){this.viewModel.relationshipColumnConfigs=e}get relationshipColumns(){return this.viewModel.relationshipColumns}get relationshipConfig(){return this.viewModel.relationshipConfig}set relationshipConfig(e){this.viewModel.relationshipConfig=e}get relationshipInfos(){return this.viewModel.relationshipInfos}get returnGeometryEnabled(){return this.viewModel.returnGeometryEnabled}set returnGeometryEnabled(e){this.viewModel.returnGeometryEnabled=e}get returnMEnabled(){return this.viewModel.returnMEnabled}set returnMEnabled(e){this.viewModel.returnMEnabled=e}get returnZEnabled(){return this.viewModel.returnZEnabled}set returnZEnabled(e){this.viewModel.returnZEnabled=e}get rowHighlightIds(){return this.viewModel.rowHighlightIds}set rowHighlightIds(e){this.viewModel.rowHighlightIds=e}get selectionSource(){return this.viewModel.selectionSource}set selectionSource(e){this.viewModel.selectionSource=e}get showAllRelatedTables(){return this.viewModel.showAllRelatedTables}set showAllRelatedTables(e){this.viewModel.showAllRelatedTables=e}get showPrompt(){return this.viewModel.showPrompt}set showPrompt(e){this.viewModel.showPrompt=e}get showRelatedTableCallback(){return this.viewModel.showRelatedTableCallback}set showRelatedTableCallback(e){this.viewModel.showRelatedTableCallback=e}get size(){return this.viewModel.size}get state(){return this.viewModel.state}get supportsAddAttachments(){return this.viewModel.supportsAddAttachments}get supportsAttachments(){return this.viewModel.supportsAttachments}get supportsDeleteAttachments(){return this.viewModel.supportsDeleteAttachments}get supportsResizeAttachments(){return this.viewModel.supportsResizeAttachments}get supportsUpdateAttachments(){return this.viewModel.supportsUpdateAttachments}get syncTemplateOnChangesEnabled(){return this.viewModel.syncTemplateOnChangesEnabled}set syncTemplateOnChangesEnabled(e){this.viewModel.syncTemplateOnChangesEnabled=e}get tableController(){return this.viewModel.tableController}set tableController(e){this.viewModel.tableController=e}get tableParent(){return this.viewModel.tableParent}set tableParent(e){this.viewModel.tableParent=e}get tableTemplate(){return this.viewModel.tableTemplate}set tableTemplate(e){this.viewModel.tableTemplate=e}get tableTemplateOverride(){return this.viewModel.tableTemplateOverride}set tableTemplateOverride(e){this.viewModel.tableTemplateOverride=e}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visibleColumns(){return this.viewModel.visibleColumns}get visibleElementsOverride(){const{attachmentsViewOptions:e,relatedTable:t,tableController:s,visibleElements:i}=this,{columnDescriptions:o,columnMenus:l,tooltips:n}=i,r=null!=e.objectId;if(t)return new B({columnDescriptions:o,columnMenus:l,tooltips:n,close:i.close,header:i.header,layerDropdown:i.layerDropdown,layerDropdownIcons:i.layerDropdownIcons,menu:i.menu,menuItems:i.menuItems,progress:i.progress,selectionColumn:!1,columnMenuItems:new F({sortAscending:!1,sortDescending:!1})});if(s){const e=s.relatedTable===this,t=s.allRelatedTablesVisible,a=e&&i.selectionColumn&&!t&&!r,p=e&&!t&&!r;return new B({columnDescriptions:o,columnMenus:l,tooltips:n,selectionColumn:a,close:!1,header:!1,layerDropdown:!1,menu:!1,progress:!1,columnMenuItems:new F({sortAscending:p,sortDescending:p})})}return r?new B({columnDescriptions:o,columnMenus:l,tooltips:n,close:i.close,header:i.header,layerDropdown:i.layerDropdown,layerDropdownIcons:i.layerDropdownIcons,menu:i.menu,menuItems:i.menuItems,progress:i.progress,selectionColumn:!1,columnMenuItems:new F({sortAscending:!1,sortDescending:!1})}):null}clearSelectionFilter(){this.viewModel.clearSelectionFilter()}async deleteAttachments(e,t,s){null!=e&&t?.length&&(s?this._showDeleteAttachmentPrompt(e,t):await this.viewModel.deleteAttachments(e,t))}deleteSelection(e){return this.highlightIds.length?e?(this._showDeletePrompt(),this.scheduleRender(),Promise.resolve()):this.viewModel.deleteSelection():Promise.resolve()}async downloadAttachmentById(e,t){return this.viewModel.downloadAttachmentById(e,t)}drainRelatedTables(){this.viewModel.drainRelatedTables()}exportSelectionToCSV(e){return this.viewModel.exportSelectionToCSV(e)}filterBySelection(){this.viewModel.filterBySelection()}findColumn(e){return this.viewModel.findColumn(e)}goToPage(e){this.viewModel.goToPage(e)}hideColumn(e){this.grid?.hideColumn(e)}nextPage(){this.viewModel.nextPage()}previousPage(){this.viewModel.previousPage()}async refresh(){await this.viewModel.refresh()}refreshCellContent(){this.viewModel.refreshCellContent()}async saveAttachmentsViewForm(){await this.viewModel.saveAttachmentsViewForm()}showAllColumns(){this.viewModel.showAllColumns()}showColumn(e){this.grid?.showColumn(e)}sortColumn(e,t){this.viewModel.sortColumn(e,t)}scrollLeft(){this.viewModel.scrollLeft()}scrollToBottom(){this.viewModel.scrollToBottom()}scrollToIndex(e){this.viewModel.scrollToIndex(e)}scrollToRow(e){this.viewModel.scrollToRow(e)}scrollToTop(){this.viewModel.scrollToTop()}toggleColumnVisibility(e){this.viewModel.toggleColumnVisibility(e)}zoomToSelection(){this.effectiveTable.viewModel.zoomToSelection()}render(){const{_effectiveVisibleElements:e,isQueryingOrSyncing:t,menuConfig:s,state:i}=this;return D("div",{bind:this,class:this.classes(H.base,A.widget)},D("calcite-panel",{bind:this,class:H.content,closable:e.close,description:this._effectiveDescription,disabled:this.disabled||"disabled"===i&&!this._effectiveLayers?.length,heading:e.header?this._effectiveTitle:void 0,loading:"loading"===i,menuOpen:!!s?.open,overlayPositioning:"fixed",onCalcitePanelClose:e=>{e.currentTarget.closed=!1,this.emit("close")}},e.progress?D("calcite-progress",{type:t?"indeterminate":"determinate"}):null,this._showLayerDropdown?this._renderLayerDropdown():null,this._renderColumnVisibilityAction(),this._renderHeaderMenuActions(),this._renderNavigationBar(),this._renderTables(),this._renderError()),this._renderColumnVisibilityPopover(),this._renderPrompt())}_renderTables(){const{grid:e,relatedTables:t}=this,s=this.classes(H.tableContainer);if(t.length){const i=this.classes(H.base,this.allRelatedTablesVisible?H.expanded:H.collapsed,this._shouldShowAttachmentsView?H.tableContainerWithAttachments:void 0);return D("div",{class:s},D("calcite-panel",{overlayPositioning:"fixed"},D("div",null,[this._shouldShowGrid?D("div",{class:i},e?.render(),this._renderPagination()):void 0,...this._filteredTables.map(e=>{const s=t.indexOf(e);return D("div",{class:i,key:`related-${s}`},e.render())}),,])))}return null!=this.attachmentsViewOptions.objectId?D("div",{class:s},D("calcite-panel",{overlayPositioning:"fixed"},D("div",null,[D("div",{class:this.classes(H.base,H.collapsed)},e?.render(),this._renderPagination()),this._renderAttachmentsView()]))):[D("div",{class:s},e?.render()),this._renderPagination()]}_renderPagination(){if(this.paginationEnabled)return D("calcite-pagination",{pageSize:1,startItem:this.pageIndex+1,totalItems:this.pageCount,onCalcitePaginationChange:e=>this.goToPage(e.currentTarget.startItem-1)})}_renderError(){const{messages:e}=this;return D("calcite-alert",{autoClose:!0,autoCloseDuration:"fast",icon:"exclamation-mark-triangle",kind:"danger",label:e.errorOccured,open:this._hasAttachmentsViewError,slot:"alerts",onCalciteAlertClose:()=>{this.attachmentsViewOptions.error=null}},D("span",{slot:"message"},e.errorOccured))}_renderPrompt(){return this.prompt?D(v,{...this.prompt,headingLevel:2}):void 0}_showDeletePrompt(){const{messages:e,messagesCommon:t}=this,s=P(e.deleteSelectionCount,{count:this.highlightIds.length});this.showPrompt({title:s,message:e.deleteRecordsRemoved,context:"danger",actions:{primary:{label:t.delete,action:this._onDeleteSelectionClick},secondary:{label:e.keepRecords,action:()=>this.clearPrompt()}}})}_showDeleteAttachmentPrompt(e,t){const{messages:s,messagesCommon:i}=this,o=P(s.deleteAttachmentCount,{count:t.length});this.showPrompt({title:o,message:s.deleteAttachmentConfirmation,context:"danger",actions:{primary:{label:i.delete,action:async()=>{try{await this.deleteAttachments(e,t,!1)}finally{this.clearPrompt()}}},secondary:{label:i.cancel,action:()=>this.clearPrompt()}}})}async _onDeleteSelectionClick(){try{await this.viewModel.deleteSelection()}finally{this.clearPrompt()}}_renderHeaderMenuAction(e){const{disabled:t,hidden:s,icon:i,text:o,clickFunction:l}=e;if(!s)return D("calcite-action",{disabled:t??this.menuConfig?.disabled,icon:i??void 0,key:o,onclick:()=>l(),slot:"header-menu-actions",text:o,textEnabled:!0,title:o})}_renderHeaderMenuActions(){return this._shouldShowMenu?[this._renderDefaultHeaderMenuActions(),this._renderCustomHeaderMenuActions()]:[]}_renderDefaultHeaderMenuActions(){if(!this._hasDefaultMenuItems)return[];const{messages:e}=this;return[this._showRefreshDataAction&&{icon:"refresh",text:e.refreshData,clickFunction:()=>this.refresh()},this._showDeleteSelectionAction&&{icon:Q,text:e.deleteSelection,clickFunction:()=>this.deleteSelection(!0)},this._showClearSelectionAction&&{icon:"clear-selection",text:e.clearSelection,clickFunction:()=>this.highlightIds?.removeAll()},this._showZoomToSelectionAction&&{icon:"zoom-to-object",text:e.zoomToSelection,clickFunction:()=>this.zoomToSelection()},this._showSelectedRecordsShowSelectedAction&&{icon:"selection-filter",text:e.showSelected,clickFunction:()=>{const{objectIds:e}=this;e.removeAll(),e.addMany(this.highlightIds.toArray())}},this._showSelectedRecordsShowAllAction&&{icon:"selection-x",text:e.showAllRecords,clickFunction:()=>this.objectIds.removeAll()},this._showExportSelectionToCSVAction&&{icon:"file-csv",text:e.exportSelectionCSV,clickFunction:()=>this.exportSelectionToCSV()}].filter(t).map(e=>e&&this._renderHeaderMenuAction(e))}_renderCustomHeaderMenuActions(){return this.menuConfig?.items?.map(({disabled:e,hidden:t,icon:s,label:i,clickFunction:o})=>this._renderHeaderMenuAction({hidden:"function"==typeof t?t():t,icon:s,text:i,disabled:e,clickFunction:e=>o(e)}))??[]}_renderColumnVisibilityAction(){if(!this._showColumnsVisibilityAction)return[];const{_columnVisibilityActions:e,effectiveTable:t,id:s}=this,i=this.messages.toggleColumns;return D("calcite-action",{afterCreate:t=>e.set(s,t),afterRemoved:()=>e.delete(s),appearance:"transparent",bind:this,disabled:t.menuConfig?.disabled,icon:"show-column",id:`${s}__toggle-columns-action`,slot:"header-actions-end",text:i},this._effectiveVisibleElements.tooltips?D("calcite-tooltip",{closeOnClick:!0,overlayPositioning:"fixed",placement:"bottom-end",slot:"tooltip"},i):null)}_renderColumnVisibilityPopover(){if(!this._showColumnsVisibilityAction||this.effectiveTable.menuConfig?.disabled)return;const{effectiveTable:e}=this,t=this.messages.toggleColumns;return D("calcite-popover",{autoClose:!0,class:H.menuPopover,label:t,overlayPositioning:"fixed",placement:"top-end",pointerDisabled:!0,referenceElement:this._columnVisibilityActions.get(this.id)},D("calcite-list",{displayMode:"nested",filterEnabled:!0,filterPlaceholder:t,label:t,selectionMode:"multiple"},e.columns.toArray().map(t=>{const s=S(t)?t.columns?.map(t=>this._renderColumnListItem({column:t,table:e,ignoreSelect:!0})):void 0;return this._renderColumnListItem({column:t,table:e,items:s})})))}_renderColumnListItem(e){const{column:t,table:s,items:i,ignoreSelect:o}=e,{effectiveLabel:l,fieldName:n,hidden:r}=t;return D("calcite-list-item",{expanded:!(!i?.length||r)||void 0,key:`toggle-columns__item-${n}`,label:l,selected:!r,value:n,onCalciteListItemSelect:e=>{o&&e.stopPropagation(),s.toggleColumnVisibility(e.currentTarget.value)}},i)}_renderLayerDropdown(){const e=this.messages.selectALayer;return D("div",{class:H.layerDropdownMenu,key:`${this.id}-layerDropdown`,slot:"header-actions-start"},D("calcite-dropdown",{bind:this,maxItems:5,overlayPositioning:"fixed",placement:"bottom-start"},D("calcite-action",{icon:"layers",slot:"trigger",text:e,title:e}),D("calcite-dropdown-group",{selectionMode:"single"},this._effectiveLayers.map((e,t)=>this._renderLayerDropdownItem(e,t))??null)))}_renderLayerDropdownItem(e,t){const s=this.visibleElements.layerDropdownIcons;return D("calcite-dropdown-item",{iconStart:s?I(e):void 0,key:`dropdown-item-${t}`,label:e.title??"",selected:e===this.layer,value:e.id,onCalciteDropdownItemSelect:()=>{this.layer=e}},e.title)}_onRelatedNavigationItemClick(e){this.viewModel.drainRelatedTablesAboveIndex(e)}_collapseRelatedTable(e){this.viewModel.collapseRelatedTable(this.effectiveTable,e)}_onShowRelatedTable(e){this.showRelatedTableCallback||(this._collapseRelatedTable(e),this._createRelatedTable(e))}async _createRelatedTable(e){const{editingEnabled:t,effectiveTable:s,paginationEnabled:i,pageSize:o,view:l,viewModel:n}=this,{layer:r,objectId:a,relatedLayer:p,relationshipId:c}=e;await r.load();const m=this.attachmentsEnabled&&C(r),h=new N({layer:r,attachmentsEnabled:m,editingEnabled:t,paginationEnabled:i,pageSize:o,relatedRecordsEnabled:!0,relationshipConfig:{objectId:a,relatedLayer:p,relationshipId:c},relationshipColumnConfigs:_(r,c),tableController:this,tableParent:s,view:l,showRelatedTableCallback:e=>n.emit("show-related-table",e)});this.relatedTables.add(h),this.scheduleRender()}_renderAttachmentsView(){const{attachmentInfos:e,mode:t,objectId:s}=this.attachmentsViewOptions;return"file"!==t&&e.length&&null!=s?this._renderAttachmentsViewList():this._renderAttachmentsViewFilePane()}_renderAttachmentsViewFilePane(){const{attachmentsViewOptions:e,isSyncingAttachments:t,supportsAddAttachments:s,messages:i,messagesUnits:o}=this,{attachmentId:l,attachmentInfos:n,candidates:a,objectId:p}=e,c=n.find(e=>e.id===l),m=n.length,h=a?.length,d=c?D("calcite-label",{alignment:"center",key:"replace-file-node",scale:"l"},i.replaceFile):void 0,u=h?void 0:D("calcite-label",{alignment:"center",key:"message-node",scale:"m"},s?null==p?i.noFeature:i.dragAndDropToUpload:i.editingRestricted),b=Array.from(a??[]).pop(),g=b?D("calcite-label",{key:"filename-node"},b.name):void 0,y=s&&null!=p,w=y&&h,v=D("input",{afterCreate:E,afterRemoved:V,afterUpdate:E,bind:this,"data-node-ref":"_attachmentsInput",files:a,hidden:!0,name:"attachment",onchange:e=>this._onAttachmentsViewCandidateChange(e),type:"file"}),f=y?D("calcite-button",{appearance:"outline-fill",bind:this,disabled:t,iconStart:"folder-open",key:"select-node",loading:!1,onclick:()=>{this._attachmentsInput&&(this._attachmentsInput.value="",this._attachmentsInput.click())},width:"full"},i.selectFile):void 0,j=w?D("calcite-button",{appearance:"outline-fill",bind:this,disabled:t,iconStart:"save",key:"save-node",loading:t,onclick:()=>{this.saveAttachmentsViewForm()},width:"full"},c?i.updateAttachment:i.addAttachment):void 0,S=m||h?D("calcite-button",{appearance:"transparent",bind:this,disabled:t,key:"cancel-node",onclick:()=>{this._attachmentsInput&&(this._attachmentsInput.value=""),e.reset(),e.attachmentInfos?.length&&(e.mode="list")},width:"full"},this.messagesCommon.cancel):void 0;return[D("div",{class:H.attachmentsView,key:"attachments-view"},D("div",{class:H.attachmentsViewContent,key:"attachments-view-content"},D("div",{bind:this,class:H.attachmentsViewDropArea,ondragover:e=>e.preventDefault(),ondrop:this._onAttachmentsViewDrop},D("calcite-icon",{class:H.attachmentsViewIcon,icon:"upload",scale:"l"}),d,u,D("form",{afterCreate:t=>e.form=t,afterRemoved:()=>e.form=null,bind:this,key:"attachments-form"},D("fieldset",null,g,v,f,j,S)))),null!=p&&null!=c?D("div",{class:H.attachmentsViewInformation,key:"information"},this._renderAttachmentsViewThumbnail(c,200),D("label",{key:"file-label"},i.fileName),D("span",{key:"file-span"},c.name),D("label",{key:"size-label"},i.size),D("span",{key:"size-span"},r(o,c.size??0))):void 0)]}_renderAttachmentsViewList(){const{attachmentsViewOptions:e,isSyncingAttachments:t,messages:s,messagesUnits:i,supportsDeleteAttachments:o,supportsUpdateAttachments:l}=this,{attachmentInfos:n,objectId:a}=e;return D("calcite-list",{afterCreate:E,afterRemoved:V,afterUpdate:E,bind:this,class:H.attachmentsViewList,"data-node-ref":"attachmentsList",key:`attachments-list-${a}`,label:s?.attachments,loading:t,ondragover:e=>e.preventDefault(),ondrop:this._onAttachmentsViewDrop,selectionMode:"multiple",onCalciteListChange:()=>this.scheduleRender()},...n?.map(t=>{const{id:n,name:p,size:c,url:m}=t,h=r(i,c??0);return D("calcite-list-item",{afterRemoved:()=>this.scheduleRender(),key:`attachment-${n}`,label:p,value:n},this._renderAttachmentsViewListThumbnail(t),D("span",{class:H.attachmentsViewListFileSize,slot:"actions-end",title:h},h),D("calcite-action",{appearance:"transparent",icon:"download-to",key:`download-attachment-${n}`,label:`${p}`,onclick:e=>{e.preventDefault(),this.downloadAttachmentById(a??-1,n)},slot:"actions-end",text:s.downloadAttachment,title:s.downloadAttachment}),l&&null!=a?D("calcite-action",{appearance:"transparent",disabled:!l,icon:"replace-image",key:`replace-attachment-${n}`,label:`${p}`,onclick:()=>{e.mode="file",e.attachmentId=n},slot:"actions-end",text:s.updateAttachment,title:s.updateAttachment}):void 0,D("calcite-action",{appearance:"transparent",icon:"launch",key:`launch-attachment-${n}`,label:`${p}`,onclick:()=>{m&&window.open(m,"_blank")},slot:"actions-end",text:s.viewAttachment,title:s.viewAttachment}),o&&null!=a?D("calcite-action",{appearance:"transparent",class:H.attachmentsViewListItemDelete,disabled:!o,icon:Q,key:`delete-attachment-${n}`,label:`${p}`,onclick:()=>{this.deleteAttachments(a,[n],!0)},slot:"actions-end",text:s.deleteAttachment,title:s.deleteAttachment}):void 0)}))}_renderAttachmentsViewListThumbnail(e){return D("div",{class:H.attachmentsViewListThumbnail,slot:"content-start"},D("a",{href:e.url??"",rel:"noreferrer",target:"_blank"},this._renderAttachmentsViewThumbnail(e)))}_renderAttachmentsViewThumbnail(e,t=64){const{contentType:s,name:i,size:o,url:l}=e,n=`${l}${l?.includes("?")?"&":"?"}w=${t}&s=${o}`;return this.supportsResizeAttachments&&g(s)?D("img",{alt:i,key:`thumbnail-image-${i}`,src:n,title:i}):D("calcite-icon",{icon:y(s),key:`thumbnail-icon-${i}`,scale:"l",textLabel:i,title:i})}_onAttachmentsViewCandidateChange({target:e}){this.attachmentsViewOptions.candidates=e?.files}_onAttachmentsViewDrop(e){e.preventDefault(),(this.supportsAddAttachments||this.supportsUpdateAttachments)&&this.attachmentsViewOptions.set({mode:"file",candidates:e.dataTransfer?.files})}_renderNavigationBar(){const{effectiveTable:e,messages:t,messagesCommon:s,navigationScale:i,relatedTable:o,relatedTables:l}=this;if(!this._shouldShowNavigationBar)return;const{attachmentsList:n,attachmentsViewOptions:r,layer:a,supportsAddAttachments:p,supportsDeleteAttachments:c}=e;if(!a)return;const{attachmentInfos:m,objectId:h}=r,d=null!=h,u=m.length,b=n?.selectedItems?.length??0,g=`${a.objectIdField}: ${h}`,y=P(t.selectedCount,{count:b}),w=P(t.attachmentsCount,{count:u}),v=d?D("calcite-action",{bind:this,icon:Z,iconFlipRtl:!0,key:"navigation-feature",onclick:()=>e.scrollToRow(h),scale:i,text:g,textEnabled:!0,title:g}):void 0,f=d?D("calcite-action",{icon:Z,iconFlipRtl:!0,key:"navigation-attachments-label",label:w,onclick:()=>{u>0&&(r.mode="list")},scale:i,text:w,textEnabled:!0,title:w}):void 0,j=d?D("calcite-chip",{closable:!0,closed:0===b,key:"navigation-chip",kind:"inverse",label:y,scale:i,selected:!0,title:y,value:"selected",onCalciteChipClose:()=>n?.selectedItems?.forEach(e=>e.selected=!1)},y):void 0,S=o?D("calcite-label",{layout:"inline",scale:i},t.showAllTables,D("calcite-switch",{checked:this.allRelatedTablesVisible,scale:i,onCalciteSwitchChange:e=>this.showAllRelatedTables=!!e.currentTarget.checked})):void 0,k=d&&"list"===r.mode&&null!=h&&b&&c?D("calcite-action",{icon:Q,iconFlipRtl:!0,key:"attachments-trash-all",onclick:()=>{e.deleteAttachments(h,n?.selectedItems?.map(e=>e.value)??[],!0)},scale:i,text:s.delete,textEnabled:!0,title:P(t.deleteAttachmentCount,{count:b})}):void 0,M=d&&"list"===r.mode&&p?D("calcite-action",{bind:this,icon:"plus",iconFlipRtl:!0,key:"attachments-add",onclick:()=>{r.attachmentId=null,r.mode="file"},scale:i,text:t.addAttachment,textEnabled:!0,title:t.addAttachment}):void 0;return D("div",{class:H.tableNavigation,key:"table-nav"},D("calcite-action",{icon:"move-up",iconFlipRtl:!0,key:"go-back",onclick:()=>{o&&this.drainRelatedTables(),e.attachmentsViewOptions.objectId=null},scale:i,text:this.layer?.title??"",textEnabled:!1,title:o?t.exitRelatedRecords:t.exitAttachments}),l.toArray().map((e,t)=>this._renderRelatedTableNavigationAction(e,t)),v,f,D("div",null,j,S,k,M))}_renderRelatedTableNavigationAction(e,t){const s=this._getLabelForRelatedTableNavigationAction(e);return D("calcite-action",{icon:Z,iconFlipRtl:!0,key:t,onclick:()=>this._onRelatedNavigationItemClick(t),scale:this.navigationScale,text:s,textEnabled:!0,title:e.layer?.title||""})}_getLabelForRelatedTableNavigationAction(e){const t=e.layer?.title;if(!t)return"";const{relatedTables:s}=this;return s.length<=1?t:s.indexOf(e)!==s.length-1&&t.length>20?`${t.slice(0,20)}...`:t}};e([a()],q.prototype,"_attachmentsInput",void 0),e([a()],q.prototype,"_columnVisibilityActions",void 0),e([a()],q.prototype,"_effectiveDescription",null),e([a()],q.prototype,"_effectiveLayers",null),e([a()],q.prototype,"_effectiveTitle",null),e([a()],q.prototype,"_effectiveVisibleElements",null),e([a()],q.prototype,"_filteredTables",null),e([a()],q.prototype,"_hasAttachmentsViewError",null),e([a()],q.prototype,"_hasCustomMenuItems",null),e([a()],q.prototype,"_hasDefaultMenuItems",null),e([a()],q.prototype,"_shouldShowGrid",null),e([a()],q.prototype,"_shouldShowMenu",null),e([a()],q.prototype,"_shouldShowAttachmentsView",null),e([a()],q.prototype,"_showClearSelectionAction",null),e([a()],q.prototype,"_showColumnsVisibilityAction",null),e([a()],q.prototype,"_showDeleteSelectionAction",null),e([a()],q.prototype,"_showExportSelectionToCSVAction",null),e([a()],q.prototype,"_showLayerDropdown",null),e([a()],q.prototype,"_shouldShowNavigationBar",null),e([a()],q.prototype,"_showRefreshDataAction",null),e([a()],q.prototype,"_showSelectedRecordsShowSelectedAction",null),e([a()],q.prototype,"_showSelectedRecordsShowAllAction",null),e([a()],q.prototype,"_showZoomToSelectionAction",null),e([a()],q.prototype,"_viewLayers",null),e([a()],q.prototype,"attachmentsList",void 0),e([a({readOnly:!0})],q.prototype,"grid",null),e([a()],q.prototype,"actionColumn",null),e([a()],q.prototype,"actionColumnConfig",null),e([a({readOnly:!0})],q.prototype,"activeFilters",null),e([a({readOnly:!0})],q.prototype,"activeSortOrders",null),e([a()],q.prototype,"allColumns",null),e([a({readOnly:!0})],q.prototype,"allRelatedTablesVisible",null),e([a()],q.prototype,"allVisibleColumns",null),e([a()],q.prototype,"attachmentsColumns",null),e([a()],q.prototype,"attachmentsEnabled",null),e([a()],q.prototype,"attachmentsViewOptions",null),e([a({type:u})],q.prototype,"attributeTableTemplate",null),e([a()],q.prototype,"autoRefreshEnabled",null),e([a()],q.prototype,"clearPrompt",null),e([a()],q.prototype,"columnPerformanceModeEnabled",null),e([a()],q.prototype,"columnReorderingEnabled",null),e([a({readOnly:!0})],q.prototype,"columns",null),e([a()],q.prototype,"definitionExpression",null),e([a()],q.prototype,"description",void 0),e([a()],q.prototype,"disabled",void 0),e([a()],q.prototype,"editingEnabled",null),e([a()],q.prototype,"effectiveSize",null),e([a()],q.prototype,"effectiveTable",null),e([a()],q.prototype,"fieldColumns",null),e([a()],q.prototype,"filterGeometry",null),e([a()],q.prototype,"filterBySelectionEnabled",null),e([a()],q.prototype,"groupColumns",null),e([a()],q.prototype,"hiddenFields",null),e([a()],q.prototype,"highlightEnabled",null),e([a()],q.prototype,"highlightIds",null),e([a()],q.prototype,"icon",null),e([a()],q.prototype,"initialSize",null),e([a()],q.prototype,"isQueryingOrSyncing",null),e([a()],q.prototype,"isSyncingAttachments",null),e([a()],q.prototype,"label",null),e([a()],q.prototype,"layer",null),e([a()],q.prototype,"layers",null),e([a()],q.prototype,"layerView",null),e([a()],q.prototype,"maxSize",null),e([a(),R("esri/widgets/FeatureTable/t9n/FeatureTable")],q.prototype,"messages",null),e([a(),R("esri/t9n/common")],q.prototype,"messagesCommon",null),e([a(),R("esri/core/t9n/Units")],q.prototype,"messagesUnits",null),e([a(),R("esri/widgets/support/t9n/uriUtils")],q.prototype,"messagesURIUtils",null),e([a()],q.prototype,"menuConfig",void 0),e([a()],q.prototype,"multipleSelectionEnabled",null),e([a()],q.prototype,"multiSortEnabled",null),e([a()],q.prototype,"multipleSortPriority",null),e([a()],q.prototype,"navigationScale",void 0),e([a()],q.prototype,"noDataMessage",null),e([a()],q.prototype,"objectIds",null),e([a()],q.prototype,"outFields",null),e([a()],q.prototype,"pageCount",null),e([a()],q.prototype,"pageIndex",null),e([a()],q.prototype,"pageSize",null),e([a()],q.prototype,"paginationEnabled",null),e([a()],q.prototype,"prompt",null),e([a()],q.prototype,"relatedRecordsEnabled",null),e([a()],q.prototype,"relatedTable",null),e([a()],q.prototype,"relatedTables",null),e([a()],q.prototype,"relationship",null),e([a()],q.prototype,"relationshipColumnConfigs",null),e([a()],q.prototype,"relationshipColumns",null),e([a()],q.prototype,"relationshipConfig",null),e([a()],q.prototype,"relationshipInfos",null),e([a()],q.prototype,"returnGeometryEnabled",null),e([a()],q.prototype,"returnMEnabled",null),e([a()],q.prototype,"returnZEnabled",null),e([a()],q.prototype,"rowHighlightIds",null),e([a()],q.prototype,"selectionSource",null),e([a()],q.prototype,"showAllRelatedTables",null),e([a()],q.prototype,"showPrompt",null),e([a()],q.prototype,"showRelatedTableCallback",null),e([a()],q.prototype,"size",null),e([a({readOnly:!0})],q.prototype,"state",null),e([a()],q.prototype,"supportsAddAttachments",null),e([a()],q.prototype,"supportsAttachments",null),e([a()],q.prototype,"supportsDeleteAttachments",null),e([a()],q.prototype,"supportsResizeAttachments",null),e([a()],q.prototype,"supportsUpdateAttachments",null),e([a()],q.prototype,"syncTemplateOnChangesEnabled",null),e([a({constructOnly:!0})],q.prototype,"tableController",null),e([a({constructOnly:!0})],q.prototype,"tableParent",null),e([a()],q.prototype,"tableTemplate",null),e([a()],q.prototype,"tableTemplateOverride",null),e([a()],q.prototype,"title",void 0),e([a()],q.prototype,"timeExtent",null),e([a()],q.prototype,"timeZone",null),e([a()],q.prototype,"view",null),e([a({type:j}),x(["cell-click","cell-dblclick","cell-pointerover","cell-pointerout","cell-keydown","column-reorder","show-related-table"])],q.prototype,"viewModel",void 0),e([a()],q.prototype,"visibleColumns",null),e([a({type:B,nonNullable:!0})],q.prototype,"visibleElements",void 0),e([a({type:B})],q.prototype,"visibleElementsOverride",null),q=N=e([p("esri.widgets.FeatureTable")],q);const W=q;export{W as default};
