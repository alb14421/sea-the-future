/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as i}from"../../chunks/tslib.es6.js";import t from"../../core/Accessor.js";import s from"../../core/Collection.js";import{watch as e,initial as r}from"../../core/reactiveUtils.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/Logger.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import{C as l}from"../../chunks/ClipRect.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../chunks/object.js";import"../../chunks/events.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../core/Evented.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/Warning.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/jsonUtils.js";import"../../core/JSONSupport.js";const p={left:0,right:0,top:0,bottom:0};let a=class extends t{constructor(i){super(i),this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new s,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new s,this.view=null}initialize(){this.addHandles([e(()=>[this.view,this.view?.ready,this.position,this.direction],()=>this._clipLayers(),r),e(()=>this.leadingLayers.toArray(),()=>this._clipLeadingLayers(),r),e(()=>this.trailingLayers.toArray(),()=>this._clipTrailingLayers(),r)])}destroy(){this._removeExistingClips()}get position(){return 25}set position(i){const{precision:t,min:s,max:e}=this;this._set("position",function(i,t){const s=10**t;return Math.round(i*s)/s}(Math.max(Math.min(i,e),s),t))}get state(){return this.view?.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:i}=this;i.forEach(i=>this._clipLayer({layer:i,type:"leading"}))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:i}=this;i.forEach(i=>this._clipLayer({layer:i,type:"trailing"}))}async _getLayerView(i){const{view:t}=this;if(!i||!t)return null;const s=await t.whenLayerView(i);return"clips"in s?s:null}_getVerticalClipRect(i){const{position:t}=this;return"leading"===i?new l({...p,bottom:100-t+"%"}):"trailing"===i?new l({...p,top:`${t}%`}):null}_getHorizontalClipRect(i){const{position:t}=this;return"leading"===i?new l({...p,right:100-t+"%"}):"trailing"===i?new l({...p,left:`${t}%`}):null}_getClipRect(i){const{direction:t}=this;return"vertical"===t?this._getVerticalClipRect(i):"horizontal"===t?this._getHorizontalClipRect(i):null}async _clipLayer(i){const{_leadingClips:t,_trailingClips:s}=this,{layer:e,type:r}=i,o="trailing"===r?s:"leading"===r?t:null,n=await this._getLayerView(e);if(!(n&&"clips"in n&&o&&n.hasOwnProperty("clips")))return;const l=o.get(n);l&&n.clips.remove(l);const p=this._getClipRect(r);p&&(o.set(n,p),n.clips.add(p))}_removeClips(i){const{_leadingClips:t,_trailingClips:s}=this,e="trailing"===i?s:"leading"===i?t:null;e&&(e.forEach((i,t)=>{t&&t.hasOwnProperty("clips")&&t.clips.remove(i)}),e.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};i([o()],a.prototype,"direction",void 0),i([o({type:s,nonNullable:!0})],a.prototype,"leadingLayers",void 0),i([o({readOnly:!0})],a.prototype,"max",void 0),i([o({readOnly:!0})],a.prototype,"min",void 0),i([o()],a.prototype,"position",null),i([o()],a.prototype,"precision",void 0),i([o({readOnly:!0})],a.prototype,"state",null),i([o()],a.prototype,"step",void 0),i([o()],a.prototype,"stepMultiplier",void 0),i([o({type:s,nonNullable:!0})],a.prototype,"trailingLayers",void 0),i([o()],a.prototype,"view",void 0),a=i([n("esri.widgets.Swipe.SwipeViewModel")],a);const c=a;export{c as default};
