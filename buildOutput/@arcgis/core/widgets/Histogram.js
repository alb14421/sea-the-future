/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../intl.js";import{property as e}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import i from"./Widget.js";import r from"./Histogram/HistogramViewModel.js";import{g as n}from"../chunks/globalCss.js";import{o as a}from"../chunks/widgetUtils.js";import{m as o}from"../chunks/messageBundle.js";import{t as l}from"../chunks/jsxFactory.js";import{s as u}from"../chunks/substitute.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/messages.js";import"../core/Error.js";import"../core/promiseUtils.js";import"../chunks/events.js";import"../chunks/maybe.js";import"../request.js";import"../config.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/MapUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../chunks/ensureType.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/string.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/Warning.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";import"../core/Promise.js";import"../core/reactiveUtils.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/componentsUtils.js";import"../chunks/jsxWidgetSupport.js";var c;const h="esri-histogram",d={base:h,horizontalLayout:`${h}--horizontal`,verticalLayout:`${h}--vertical`,content:`${h}__content`,svg:`${h}__svg`,bar:`${h}__bar`,bars:`${h}__bars`,label:`${h}__label`,dataLines:`${h}__data-lines`,dataLinesSubgroup:`${h}__data-lines-subgroup`,dataLine:`${h}__data-line`,averageLabel:`${h}__average-label`,averageDataLine:`${h}__average-data-line`,averageSymbol:`${h}__average-symbol`};let p=c=class extends i{constructor(t,e){super(t,e),this._bgFillId=`${this.id}-bg-fill`,this._containerNode=null,this._containerDimensions={width:0,height:0},this._defaultBarColor="#d8d8d8",this.barCreatedFunction=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.dataLineUpdatedFunction=null,this.messages=null,this.viewModel=new r}get average(){return this.viewModel.average}set average(t){this.viewModel.average=t}get bins(){return this.viewModel.bins}set bins(t){this.viewModel.bins=t}get icon(){return"graph-histogram"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(t){this.viewModel.labelFormatFunction=t}set layout(t){"vertical"!==t&&(t="horizontal"),this._set("layout",t)}get max(){return this.viewModel.max}set max(t){this.viewModel.max=t}get min(){return this.viewModel.min}set min(t){this.viewModel.min=t}get state(){return this.viewModel.state}static fromHistogramResult(t){const{bins:e,maxValue:s,minValue:i}=t;return new c({bins:e,max:s,min:i})}render(){const{label:t,layout:e,state:s}=this,i=this.classes(d.base,n.widget,"horizontal"===e?d.horizontalLayout:d.verticalLayout,"disabled"===s?n.disabled:null);return l("div",{afterCreate:this._afterContainerNodeCreate,"aria-label":t,bind:this,class:i},"ready"===s?this._renderContent():null)}_renderContent(){if(!this._containerNode)return;const t=this._bgFillId,e=`clip-path: url(#${t})`;return l("div",{class:d.content},l("svg",{class:d.svg,xmlns:"http://www.w3.org/2000/svg"},l("defs",null,this._renderFillDefinition(t)),l("g",{style:e},this._renderBarsGroup()),this._renderLinesGroup()))}_renderBarsGroup(){return l("g",{class:this.classes(d.bars)},this._renderBars())}_renderBars(){const{layout:t,viewModel:{binRange:e,range:s}}=this;if(!e||!s)return;const i=e/s,{width:r,height:n}=this._containerDimensions;if(0===n&&0===r)return;if(0===n&&0!==r)return void this.scheduleRender();const[a,o]="vertical"===t?[n*i,r]:[n,r*i];return this._getBarDimensions(a,o).map(([t,e],s)=>this._renderBar(s,t,e))}_renderBar(t,e,s){const{bins:i,layout:r,max:n,messages:a,viewModel:{range:o}}=this;if(!i||null==n)return;const{width:c,height:h}=this._containerDimensions,p=i.slice()[t],{count:m,maxValue:g,minValue:b}=p,_=n-g,[v,j]="vertical"===r?[0,_*(h/o)]:[c-s-_*(c/o),h-e],L=u(a.barLabel,{count:m,maxValue:g,minValue:b});return l("rect",{afterCreate:this._afterBarCreate,"aria-label":L,bind:this,class:d.bar,"data-index":t,fill:this._defaultBarColor,height:e,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:s,x:v,y:j})}_renderLinesGroup(){return l("g",{class:this.classes(d.dataLines)},this._renderAverageLine(),this._renderCustomLines())}_renderAverageLine(){const{average:t}=this;if(null==t)return;const e=[l("tspan",{class:this.classes(d.averageSymbol)},"xÌ„ "),l("tspan",{class:this.classes(d.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(t,"average"):t)];return l("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(d.dataLinesSubgroup)},l("title",{key:"title"},t),this._renderLine(t,this.classes(d.averageDataLine)),this._renderLabel({label:e,value:t}))}_renderCustomLines(){if(this.dataLines?.length)return this.dataLines.map((t,e)=>this._renderLineSubgroup(t,e))}_renderLineSubgroup(t,e){const{value:s}=t;return l("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(d.dataLinesSubgroup),"data-index":e},l("title",{key:"title"},s),this._renderLine(s),this._renderLabel(t))}_renderLine(t,e){const[s,i,r,n]=this._getLinePosition(t);return l("line",{class:this.classes(d.dataLine,e),"shape-rendering":"crispEdges",x1:s,x2:i,y1:r,y2:n})}_renderLabel(t,e){const{label:s,value:i}=t,[r,n]=this._getLabelPosition(i);return l("text",{class:this.classes(d.label,e),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:r,y:n-2},s??"")}_renderFillDefinition(t){const{width:e,height:s}=this._containerDimensions;return l("clipPath",{id:t},l("rect",{height:s,width:e,x:"0",y:"0"}))}_afterContainerNodeCreate(t){this._containerNode=t,this.addHandles(a(t,t=>{const{width:e,height:s}=t.contentRect;this._containerDimensions={width:e,height:s}}))}_getIndexFromElement(t){const e=t.dataset?.index,s=t.getAttribute("data-index");return null!=e?parseInt(e,10):null!=s?parseInt(s,10):null}_afterBarCreate(t){if(this.barCreatedFunction){const e=this._getIndexFromElement(t)??-1;this.barCreatedFunction(e,t)}}_afterLinesSubgroupCreate(t){if(this.dataLineCreatedFunction){const e=this._getIndexFromElement(t),s=t.childNodes[1],i=t.childNodes[2]?t.childNodes[2]:null;this.dataLineCreatedFunction(s,i,e)}}_afterLinesSubgroupUpdate(t){if(this.dataLineUpdatedFunction){const e=this._getIndexFromElement(t),s=t.childNodes[1],i=t.childNodes[2]?t.childNodes[2]:null;this.dataLineUpdatedFunction(s,i,e)}}_getBarDimensions(t,e){const{bins:s,layout:i}=this,r=s?s.map(t=>t.count):[],n=Math.max.apply(Math,r);return r.map(s=>"vertical"===i?[t/r.length,0!==n?s/n*e:0]:[0!==n?s/n*t:0,e/r.length])}_getLinePosition(t){const{layout:e,min:s,viewModel:{range:i}}=this;if(null==s)return[0,0,0,0];const r=Math.round((t-s)/i*100)/100,{width:n,height:a}=this._containerDimensions,[o,l]=[r*n||1,a-r*a||1];return"vertical"===e?[0,"100%",l,l]:[o,o,"100%",0]}_getLabelPosition(t){const{layout:e,min:s,viewModel:{range:i}}=this;if(null==s)return[0,0];const r=Math.round((t-s)/i*100)/100,{width:n,height:a}=this._containerDimensions;return"vertical"===e?[n,a-r*a]:[0,r*n]}};t([e()],p.prototype,"_bgFillId",void 0),t([e()],p.prototype,"_containerNode",void 0),t([e()],p.prototype,"_containerDimensions",void 0),t([e()],p.prototype,"_defaultBarColor",void 0),t([e()],p.prototype,"average",null),t([e()],p.prototype,"barCreatedFunction",void 0),t([e()],p.prototype,"dataLines",void 0),t([e()],p.prototype,"dataLineCreatedFunction",void 0),t([e()],p.prototype,"dataLineUpdatedFunction",void 0),t([e()],p.prototype,"icon",null),t([e()],p.prototype,"label",null),t([e()],p.prototype,"labelFormatFunction",null),t([e({value:"horizontal"})],p.prototype,"layout",null),t([e()],p.prototype,"max",null),t([e(),o("esri/widgets/Histogram/t9n/Histogram")],p.prototype,"messages",void 0),t([e()],p.prototype,"min",null),t([e({readOnly:!0})],p.prototype,"state",null),t([e({type:r})],p.prototype,"viewModel",void 0),p=c=t([s("esri.widgets.Histogram")],p);const m=p;export{m as default};
