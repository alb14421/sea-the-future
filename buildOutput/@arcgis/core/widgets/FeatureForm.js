/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{i as t}from"../core/lang.js";import{L as s}from"../chunks/Logger.js";import{createResolver as i}from"../core/promiseUtils.js";import{R as o}from"../chunks/ReactiveMap.js";import{watch as r,initial as n,whenOnce as a}from"../core/reactiveUtils.js";import{property as l}from"../core/accessorSupport/decorators/property.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import{isIntegerField as m}from"../layers/support/fieldUtils.js";import{a as u,v as d}from"../chunks/layerUtils.js";import{c}from"../chunks/guards.js";import h from"./Widget.js";import{P as y}from"../chunks/Prompt.js";import{isRelatableFeatureSupportedLayer as j}from"../chunks/featureUtils.js";import{d as b,b as f,e as g,f as v,h as _,j as k,k as C,i as F,l as w,m as I,n as R,o as x,s as L}from"../chunks/featureFormUtils.js";import S from"./FeatureForm/FeatureFormViewModel.js";import O from"../core/Accessor.js";import{l as M}from"../chunks/componentsUtils.js";import{g as T,a as U,k as D,p as A,h as N,n as V,f as E,e as P}from"../chunks/dateUtils.js";import{g as $}from"../chunks/globalCss.js";import{H as B,i as G}from"../chunks/Heading.js";import{b as H}from"../chunks/widgetUtils.js";import{m as Z}from"../chunks/messageBundle.js";import{v as W}from"../chunks/vmEvent.js";import{t as q}from"../chunks/jsxFactory.js";import{s as K}from"../chunks/substitute.js";import{f as z}from"../chunks/number.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../chunks/string.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/MapUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../chunks/events.js";import"../chunks/maybe.js";import"../chunks/tracking.js";import"../chunks/utils.js";import"../chunks/SimpleObservable.js";import"../chunks/ObservableBase.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/Lifecycle.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../core/sql.js";import"../core/Collection.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/shared.js";import"../layers/catalog/catalogUtils.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/iconUtils.js";import"../chunks/utils7.js";import"../chunks/basemapUtils.js";import"../chunks/utils5.js";import"../chunks/colorUtils.js";import"../chunks/screenUtils.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/basemapDefinitions.js";import"../chunks/timeZoneUtils.js";import"../chunks/formUtils.js";import"../form/elements/AttachmentElement.js";import"../form/elements/Element.js";import"../core/JSONSupport.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/Input.js";import"../core/Clonable.js";import"../form/elements/inputs/attachments/AudioInput.js";import"../chunks/utils2.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../chunks/enumeration.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../form/elements/RelationshipElement.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../form/elements/TextElement.js";import"../form/elements/UtilityNetworkAssociationsElement.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../chunks/formUtils2.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/mathUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/UpdatingHandles.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../chunks/LayerContingentValuesCache.js";import"../layers/support/Subtype.js";import"../chunks/editableLayers.js";import"./FeatureForm/FieldInput.js";import"./FeatureForm/EditableInput.js";import"./FeatureForm/InputBase.js";import"./FeatureForm/GroupInput.js";import"./FeatureForm/RelationshipInput.js";import"../chunks/FeatureRelationshipViewModel.js";import"../rest/support/RelationshipQuery.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"./FeatureForm/TextElementInput.js";import"../chunks/ReactiveSet.js";import"../arcade.js";import"../chunks/TimeOnly.js";import"../chunks/enum.js";import"../chunks/UnknownTimeZone.js";import"../chunks/arcadeEnvironment.js";import"../chunks/ImmutableArray.js";import"../layers/FeatureLayer.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/layerContainerType.js";import"../graphic/FeatureGraphicOrigin.js";import"../graphic/GraphicOrigin.js";import"../chunks/isFeatureGraphicOrigin.js";import"../layers/Layer.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils2.js";import"../chunks/parser.js";import"../layers/mixins/CustomParametersMixin.js";import"../layers/mixins/DisplayFilteredLayer.js";import"../layers/support/DisplayFilterInfo.js";import"../chunks/scaleUtils.js";import"../layers/support/DisplayFilter.js";import"../chunks/displayFilterUtils.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../rest/support/Query.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties.js";import"../symbols/support/ElevationInfo.js";import"../symbols/support/FeatureExpressionInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../tables/AttributeTableTemplate.js";import"../tables/elements/AttributeTableGroupElement.js";import"../tables/elements/AttributeTableAttachmentElement.js";import"../tables/elements/AttributeTableElement.js";import"../tables/elements/AttributeTableFieldElement.js";import"../tables/elements/AttributeTableRelationshipElement.js";import"../chunks/featureLayerUtils.js";import"../chunks/asyncUtils.js";import"../chunks/featureQueryAll.js";import"../renderers/SimpleRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../chunks/RendererLegendOptions.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/NormalizationBinParametersMixin.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../chunks/multiLayerServiceUtils.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../chunks/infoFor3D.js";import"../chunks/portalItemUtils.js";import"../chunks/projectionUtils.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/typeUtils3.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/support/ClassBreakInfo.js";import"../renderers/DictionaryRenderer.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/DictionaryScriptEvaluator.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../chunks/ArcadeExpression.js";import"../chunks/utils6.js";import"../chunks/defaultCIMValues.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../layers/mixins/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/support/OrderByInfo.js";import"../layers/mixins/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../layers/support/TimeInfo.js";import"../time/TimeInterval.js";import"../layers/mixins/TrackableLayer.js";import"../layers/support/TrackInfo.js";import"../layers/support/TrackPartInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/TitleCreator.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";const Q="esri-feature-form",J=`${Q}__group`,X=`${Q}__input`,Y=`${Q}__related-records`,ee={base:Q,form:`${Q}__form`,formHeader:`${Q}__form-header`,label:`${Q}__label`,labelTextContent:`${Q}__label-text-content`,fieldInput:`${X}`,inputRadio:`${X}--radio`,inputRadioGroup:`${X}--radio-group`,inputRadioLabel:`${X}--radio-label`,inputDisabled:`${X}--disabled`,inputSwitch:`${X}--switch`,centeredButton:`${Q}__centered-button`,description:`${Q}__description-text`,listObserver:`${Q}__list-observer`,relatedRecordsHeader:`${Y}_header`,relatedRecordsLabel:`${Y}_label`,relatedRecordsList:`${Y}_list`,dateInputContainer:`${Q}__date-input-container`,textElement:`${Q}__text-element`,group:J,groupSequential:`${J}--sequential`,groupActive:`${J}--active`,disabledNotice:`${Q}__disabled-notice`};let te=class extends O{constructor(e){super(e),this.associationDetails=!0,this.readOnlyNotice=!0}};e([l({type:Boolean,nonNullable:!0})],te.prototype,"associationDetails",void 0),e([l({type:Boolean,nonNullable:!0})],te.prototype,"readOnlyNotice",void 0),te=e([p("esri.widgets.FeatureForm.VisibleElements")],te);const se=te,ie="data-field-name";let oe=class extends h{constructor(e,t){super(e,t),this._associationsWidgetsMap=new o,this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(e=>{e.length&&e[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this._featureFormUNAssociationList=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new S,this.visibleElements=new se,this._onShowAllRelatedRecordsClick=e=>{const{feature:t,callbacks:s}=this;t&&s?.showAllRelatedRecords&&s.showAllRelatedRecords({parentFeature:t,relationshipId:e})},this._onAddRelatedRecordsClick=(e,t,s)=>{const{feature:i,callbacks:o}=this;let r=s;if(i&&o?.addRelatedRecord){if(u(s)&&e.activeCategory){const t=e.activeCategory.value,i=s.findSublayerForSubtypeCode(t);i&&j(i)&&(r=i)}o.addRelatedRecord({parentFeature:i,relatedLayer:r,relationshipId:t})}},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this),this._afterGroupCreate=this._afterGroupCreate.bind(this)}initialize(){this.addHandles([r(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),a(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=e?.name||null,this._attemptFocusOnNextRender=!0})}),r(()=>[this._featureFormUNAssociationList,this.visibleElements.associationDetails],([e,t])=>{e&&(e.visibleElements.associationDetails=t)},n),r(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(e=>this._inputsWithChanges.add(e)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),r(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange()),r(()=>this.viewModel.activeAssociationInput,e=>{e&&this._featureFormUNAssociationList&&(this._featureFormUNAssociationList.associationInput=e,this._featureFormUNAssociationList.viewModel=e.viewModel)}),r(()=>this.viewModel.inputs.filter(_),async e=>{this._featureFormUNAssociationList||await this._setUpUtilityNetworkAssociationList();for(const t of e)this._associationsWidgetsMap.has(t)||this._associationsWidgetsMap.set(t,await this._makeAssociationsWidget(t))})])}loadDependencies(){return M({block:()=>import("../chunks/index29.js"),button:()=>import("../chunks/index6.js"),chip:()=>import("../chunks/index35.js"),combobox:()=>import("../chunks/index30.js"),"combobox-item":()=>import("../chunks/index31.js"),"combobox-item-group":()=>import("../chunks/index45.js"),icon:()=>import("../chunks/index.js"),input:()=>import("../chunks/index10.js"),"input-date-picker":()=>import("../chunks/index13.js"),"input-message":()=>import("../chunks/index38.js"),"input-number":()=>import("../chunks/index34.js"),"input-time-picker":()=>import("../chunks/index14.js"),"input-time-zone":()=>import("../chunks/index40.js"),label:()=>import("../chunks/index2.js"),list:()=>import("../chunks/index19.js"),"list-item":()=>import("../chunks/index18.js"),loader:()=>import("../chunks/index28.js"),notice:()=>import("../chunks/index20.js"),"radio-button":()=>import("../chunks/index23.js"),"radio-button-group":()=>import("../chunks/index24.js"),switch:()=>import("../chunks/index3.js"),"text-area":()=>import("../chunks/index46.js")})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const{callbacks:e}=this;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _utilityNetworkAssociationsEnabled(){const{callbacks:e}=this;return!(!e?.viewAssociatedLayers||!e.viewAssociatedFeatures)}get _subtypes(){return d(this.layer)}get associationId(){return this.viewModel.associationId}set associationId(e){this.viewModel.associationId=e}get associatedLayer(){return this.viewModel.associatedLayer}set associatedLayer(e){this.viewModel.associatedLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get callbacks(){return this.viewModel.callbacks}set callbacks(e){this.viewModel.callbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{this._prompt?.cancel?.(),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return q("div",{class:this.classes(ee.base,$.widget,$.panel)},"ready"===e?this._renderForm():null)}_renderForm(){return q("div",null,q("form",{class:ee.form,inert:!!this._prompt,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderReadOnlyNotice(),this._renderHeader(),this._renderContent()),this._prompt?q(y,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderReadOnlyNotice(){const{disabled:e,messages:t}=this;if(e&&this.visibleElements.readOnlyNotice)return q("calcite-notice",{class:ee.disabledNotice,icon:"read-only-non-editable",kind:"brand",open:!0,scale:"s",width:"full"},q("div",{slot:"message"},t.disabledForm))}_renderHeader(){const e=this.viewModel,{formTitle:t,formDescription:s}=e;if(!e.formHeaderVisible)return;const i=null!=t&&q(B,{key:"title",level:this.headingLevel},t),o=null!=s&&q("p",{class:ee.description,key:"description"},s);return q("div",{class:ee.formHeader},i,o)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.activeAssociationInput?this._renderFeatureFormUtilityNetworkAssociationList():e.inputs.filter(t).filter(e=>e.visible).map(e=>this._renderInput(e))}_renderInput(e){return b(e)?this._renderGroup(e):f(e)?this._renderLabeledField(e):g(e)?this._renderRelationshipInput(e):v(e)?this._renderTextElementInput(e):_(e)?this._renderUtilityNetworkAssociationsElementInput(e):void 0}_renderFeatureFormUtilityNetworkAssociationList(){return this._featureFormUNAssociationList?.render()}_selectAssociatedLayer(e){const{feature:t,callbacks:s}=this;t&&s?.viewAssociatedFeatures&&s.viewAssociatedFeatures({associatedLayer:e.layer})}async _selectAssociatedFeature(e){const{feature:t,callbacks:s}=this;t&&s?.selectAssociatedFeature&&await s.selectAssociatedFeature({parentFeature:t,...e})}_onAddAssociation(e){const{feature:t,callbacks:s}=this;t&&s?.addAssociation&&s.addAssociation(e)}async _setUpUtilityNetworkAssociationList(){if(!this._featureFormUNAssociationList){const e=(await import("../chunks/FeatureFormUtilityNetworkAssociationList.js")).default;this._featureFormUNAssociationList=new e({onSelectLayer:this._selectAssociatedLayer.bind(this),onSelectFeature:this._selectAssociatedFeature.bind(this),onAddAssociation:this._onAddAssociation.bind(this)})}}async _makeAssociationsWidget(e){return new(0,(await import("../chunks/FeatureUtilityNetworkAssociations.js").then(e=>e.b)).default)({onSelectAssociationType:({viewModel:t,listType:s})=>{t.activeAssociationType=s;const{feature:i,callbacks:o}=this;i&&o?.viewAssociatedLayers&&o.viewAssociatedLayers({associationId:e.uid})},viewModel:e.associationsViewModel})}_renderUtilityNetworkAssociationsElementInput(e){if(this._utilityNetworkAssociationsEnabled)return this._associationsWidgetsMap.get(e)?.render()}_renderDescriptionOrEmpty(e,t){return null==e?null:q("div",{class:this.classes(ee.description),id:t},e)}_renderGroup(e){const{formTemplate:t,headingLevel:s}=this,{description:i,id:o,inputs:r,label:n,open:a}=e,l=r.filter(e=>e.visible),p=this.viewModel.findField(this._focusedFieldName),m=p?.group===e,u="sequential"===this.groupDisplay;return q("calcite-block",{afterCreate:this._afterGroupCreate,class:this.classes(ee.group,u?ee.groupSequential:null,m?ee.groupActive:null),collapsible:!0,"data-group":e,description:i||void 0,expanded:a,heading:n??"",headingLevel:t?.title?G(s):s,id:o,key:o,onCalciteBlockToggle:({currentTarget:t})=>this._onGroupToggle(t,e)},l.map(e=>this._renderInput(e)))}_getFocusableInput(e,t){const s=k(this.viewModel.inputs);let i;if("backward"===e&&s.reverse(),t)if(b(t)){const e=t.inputs.find(e=>e.visible);i=e?s.indexOf(e):0}else{let o;if(C(t)&&!t.group.open){const s=t.group.inputs.filter(f);o="forward"===e?s[s.length-1]:s[0]}else o=t;i=s.indexOf(o)+1}else i=0;for(let e=i;e<s.length;e++){const t=s[e];if(t.visible&&f(t)){if(this.disabled&&t.inputType&&("switch"===t.inputType||"radio-buttons"===t.inputType))continue;return t}}return null}_renderLabeledField(e){const{dataType:t,feature:s,label:i,layer:o,required:r}=e,n={"aria-label":r?K(this.messages.requiredFieldLabel,{name:i}):i,class:ee.label,key:`${o.id}-${s.uid}-${e.name}`},a=[q("div",{class:ee.labelTextContent,key:"labelTextContainer"},i,r?q("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==t?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===t&&"coded-value"!==e.domain?.type?q("label",{...n},a):q("calcite-label",{...n},a)}_renderFieldInput(e){const{dataType:t,domain:s,inputType:i,name:o}=e,r=this.getCommonInputProps(e);if("coded-value"===s?.type){const t=this.viewModel.getFieldValueOptionsForField(o,this.messages.empty);return"switch"!==i||e.hasInvalidSwitchValue?"radio-buttons"===i?this._renderRadioButtonComponents(e,t.flat(),r):this._renderComboBoxComponent(e,t,r):this._renderSwitchComponent(e,r)}return"datetime-picker"===i||"date"===t?this._renderDateComponents(e,r):"number"===t?this._renderNumberComponent(e,r):this._renderStringComponent(e,r)}_renderStringComponent(e,t){return"text-area"===e.inputType?t.readOnly?q("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:e=>this._saveValueFromComponent(e.currentTarget)}):q("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:e=>this._saveValueFromComponent(e.currentTarget)}):q("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:e=>this._saveValueFromComponent(e.currentTarget)})}_renderNumberComponent(e,t){const s=m(e.field),i=s&&""!==t.value?Math.round(parseFloat(t.value)).toString():t.value;return q("calcite-input-number",{...t,integer:s,loading:e.updating,type:"number",value:i,onCalciteInputNumberInput:e=>this._saveValueFromComponent(e.currentTarget)})}_renderDateComponents(e,t){const{field:s}=e;switch(s.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,T(s,t.value,{timeZone:this.timeZone,...U(s)}))}}_renderDateOnlyFieldComponent(e,t){const{range:s,valid:i,value:o}=e,{class:r,key:n,readOnly:a}=t,{rawMax:l,rawMin:p}=s;return q("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:r,"data-date-part":"date","data-field-name":t[ie],key:`${n}-date-input`,max:c(l)?l:void 0,min:c(p)?p:void 0,numberingSystem:D,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,value:null!=o?`${o}`:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{valid:s,value:i}=e,{class:o,key:r,readOnly:n}=t;return q("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:o,"data-date-part":"time","data-field-name":t[ie],key:`${r}-time-input`,numberingSystem:D,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:n,step:e.timeStep,value:null!=i?`${i}`:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{name:s,range:i,timeZone:o,valid:r,value:n}=e,{class:a,key:l,readOnly:p}=t,{rawMax:m,rawMin:u}=i,d={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,numberingSystem:D,overlayPositioning:"fixed",readOnly:p,[ie]:s,onfocus:this._onComponentFocus},c=A(m,o),h=A(u,o),y=A(n,o);return q("div",{class:ee.dateInputContainer,key:`${l}-date-time-container`},q("calcite-input-date-picker",{...d,class:a,"data-date-part":"date",key:`${l}-date-input`,max:c?.date??void 0,min:h?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:y.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),q("calcite-input-time-picker",{...d,class:a,"data-date-part":"time",key:`${l}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:e.timeStep,value:y.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),e.includeTimeOffset?q("calcite-input-time-zone",{...d,class:a,"data-date-part":"timeZone",disabled:p,key:`${l}-timezone-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:y.timeZoneOffset??"0",onCalciteInputTimeZoneChange:e=>this._saveValueFromDateComponent(e.currentTarget)}):null)}_renderDateFieldComponents(e,t){const{includeTime:s,name:i,valid:o,value:r}=e,{class:n,key:a,max:l,min:p,readOnly:m}=t,{timeZone:u}=this,d={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:D,overlayPositioning:"fixed",readOnly:m,[ie]:i,onfocus:this._onComponentFocus},c=N(r,u),h=N(l,u),y=N(p,u);return q("div",{class:ee.dateInputContainer,key:`${a}-date-time-container`},q("calcite-input-date-picker",{...d,class:n,"data-date-part":"date",key:`${a}-date-input`,max:h?.date??void 0,min:y?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:c.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),s?q("calcite-input-time-picker",{...d,class:n,"data-date-part":"time",key:`${a}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:1,value:c.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}):null)}_renderReadOnlyComponent(e,t){const s=this.getCommonInputProps(e);return q("calcite-input",{...s,class:this.classes(ee.fieldInput,ee.inputDisabled),readOnly:!0,type:"text",value:null!=t?`${t}`:s.value})}_renderComboBoxComponent(e,t,s){const{value:i,name:o}=e,{viewModel:r,_inputsWithChanges:n}=this,a="INSERT"===r.editType,l=n.has(o),p=null==i&&(!a||l),m=a&&e.showNoValueOptionEnabled&&!l?()=>{}:s.onblur;return q("calcite-combobox",{...s,allowCustomValues:!1,clearDisabled:!0,onblur:m,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:t})=>{p&&0===t.selectedItems.length?this._ignoreDeselectionOfNoValueOption(t):e.isSubtypeField&&0===t.selectedItems.length?t.value=`${e.value}`:this._saveValueFromComponent(t)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:s,name:i}=e,{messages:o,messagesTemplates:r,viewModel:n,_inputsWithChanges:a}=this,[l,p,m]=t.map(e=>e.map(({name:e,value:t})=>q("calcite-combobox-item",{key:`#${t}`,selected:s===t,textLabel:e,value:`${t}`}))),u=[];p.length>0&&u.push(q("calcite-combobox-item-group",{key:"other",label:r.other},p)),m.length>0&&u.push(q("calcite-combobox-item-group",{key:"unsupported",label:o.subtypes.unsupportedDomainGroupTitle},m)),u.length>0?u.unshift(q("calcite-combobox-item-group",{key:"recommended",label:o.recommended},l)):u.push(...l);const d="INSERT"===n.editType,c=a.has(i),h=null==s&&(!d||c);return e.showNoValueOptionEnabled&&u.unshift(q("calcite-combobox-item",{key:"empty-option",selected:h,textLabel:e.showNoValueLabel||o.empty,value:""})),u}_renderRadioButtonComponents(e,t,s){const{name:i,value:o}=e,r=t.map(({name:e,value:t})=>this._renderRadioButtonComponent({key:e,label:e,name:i,value:t,selected:t===o,props:s}));if(e.showNoValueOptionEnabled){const t="",n=e.showNoValueLabel||this.messages.empty,a=o===t||null===o;r.unshift(this._renderRadioButtonComponent({key:"empty-option",label:n,name:i,value:t,selected:a,props:s}))}return q("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:ee.inputRadioGroup,"data-field-name":s[ie],key:`${s.key}-radio-group`,layout:"vertical",name:s.key,required:s.required},r)}_renderSwitchComponent(e,t){const{value:s}=e,i=!!F(e.element,"switch")&&s===e.element.input.onValue;return q("calcite-switch",{...t,checked:i,class:ee.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:e=>this._saveValueFromComponent(e.currentTarget)})}_renderRadioButtonComponent({key:e,name:t,value:s,selected:i,label:o,props:r}){return q("calcite-label",{class:ee.inputRadioLabel,key:e,layout:"inline"},q("calcite-radio-button",{...r,afterCreate:void 0,afterUpdate:void 0,checked:i,class:ee.inputRadio,disabled:r.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:s,onCalciteRadioButtonChange:({currentTarget:e})=>{e.checked&&this._saveValueFromComponent(e)}}),o)}_renderAuxiliaryText(e){const t=e.name,s=this._inputsWithChanges.has(t)&&!e.submittable?w(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=s?q("calcite-input-message",{icon:!0,status:"invalid"},s):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?q("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){if(!e.showAllActionVisible||!this.callbacks?.showAllRelatedRecords)return;const t=this.messages;return q("calcite-list-item",{description:K(t.totalCount,{count:e.featureCount}),key:"show-all-related-features",label:t.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(e.relationshipId)},q("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:s,relatedLayer:i,editable:o}=e,{messages:r,callbacks:n,disabled:a}=this,l=!o||a;if(t&&n?.addRelatedRecord&&i&&!l)return q("calcite-button",{alignment:"center",appearance:"outline-fill",class:ee.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${s}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(e,s,i)},round:!0,scale:"s",width:"full"},e.relatedLayerIsTable?r.addRecord:r.addFeature)}_renderRelatedRecordListItem(e,t,s){const{feature:i,description:o,title:r}=e,{feature:n,callbacks:a}=this,{highlightHelper:l}=this.viewModel,p=l?()=>l.add(i):void 0,m=l?()=>l.remove(i):void 0;return q("calcite-list-item",{bind:this,description:o,key:`${t}-${i.uid}`,label:r,onmouseenter:p,onmouseleave:m,value:r,onCalciteListItemSelect:()=>{l?.removeAll(),a?.editRelatedRecord&&n&&a.editRelatedRecord({parentFeature:n,relationshipId:t,relatedFeature:i,readOnly:s})}},q("calcite-icon",{icon:I(i),slot:"content-start"}),q("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled)return;const{relationshipId:t,activeCategory:s}=e,i=s?null:this._renderDescriptionOrEmpty(e.description);return q("calcite-label",{class:this.classes(ee.label,ee.relatedRecordsLabel),key:`relationship-${t}-container`},q("div",null,this._renderRelatedRecordsHeaderContainer(e),i,this._renderRelationshipInputContent(e)),this._renderAddRelatedRecordButton(e))}_renderRelationshipInputContent(e){return e.featureCount>0?this._renderRelatedRecordsList(e):e.activeCategory&&0===e.featureCount?this._renderNoRelatedRecordsNotice():e.allCategories?.length?this._renderCategoryList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0}_renderCategoryList(e){return q("calcite-list",{displayMode:"flat",label:this.messages.relatedRecordsList,loading:e.updating},e.categories?.map(t=>this._renderCategory(e,t)),this._renderShowAllCategoriesListItem(e))}_renderCategory(e,t){const{count:s,name:i,value:o}=t,r=z(s);return q("calcite-list-item",{key:`${i}-${o}`,label:i,onCalciteListItemSelect:()=>this._selectCategory(e,t)},q("calcite-chip",{label:r,scale:"s",slot:"content-end"},r),q("calcite-icon",{flipRtl:!0,icon:"chevron-left",scale:"s",slot:"content-end"}))}_selectCategory(e,t){this.relationshipId=e.relationshipId,e.activeCategory=t}_renderShowAllCategoriesListItem(e){if(!e.showAllCategoriesVisible)return;const t=this.messages;return q("calcite-list-item",{description:K(t.totalCount,{count:e.allCategories?.length??0}),key:"show-all-categories",label:t.showAll,value:!0,onCalciteListItemSelect:()=>e.showAllEnabled=!0},q("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderRelatedRecordsHeaderContainer(e){const t=e.updating||!e.loaded;return q("div",{class:ee.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},q("span",null,e.label),t?q("calcite-loader",{inline:!0,key:"loader",label:this.messagesCommon?.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t,editable:s}=e,{disabled:i}=this,o=!s||i;return q("calcite-list",{class:ee.relatedRecordsList,label:this.messages?.relatedRecordsList},e.relatedFeatureInfos.map(e=>this._renderRelatedRecordListItem(e,t,o)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){const{messages:t}=this,s=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,i=e.relationship?.keyField,o=this.viewModel.findField(i),r=e.layer?.fieldsIndex.get(i),n=o?.label||r?.alias||i,a=K(s,{relatedLayerName:e.relatedLayer?.title,originKeyField:n});return q("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},q("div",{slot:"message"},a))}_renderNoRelatedRecordsNotice(){return q("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},q("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return q("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:ee.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return q("div",{class:ee.textElement,"data-testid":`text-element-${e.label}`,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:s,hint:i,label:o,maxLength:r,minLength:n,name:a,range:{max:l,min:p},required:m,valid:u,value:d}=e,c=this._inputsWithChanges.has(a),h=!s||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":u?"false":"true",class:this.classes(ee.fieldInput,h?ee.inputDisabled:null),status:c&&!u?"invalid":"idle",key:a,label:o,max:null!=l?l:void 0,min:null!=p?p:void 0,maxLength:r>-1?r:void 0,minLength:n>-1?n:void 0,placeholder:i??void 0,readOnly:h,required:m,value:null==d?"":`${d}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[ie]:a}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(ie))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),s=e.dataset.datePart,i=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&null!=e.value&&null!=t.value){const s=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=N(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=A(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}s.unobserve(e)});s.observe(e)}if(null!=i)switch(s){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(t.name,{[s]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);R(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,s=e.querySelector("calcite-radio-button"),i=t||s;i&&this._afterComponentCreateOrUpdate(i)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,s=this._getFieldInputFromHTMLElement(e),i=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&i===s&&(this._attemptFocusOnNextRender=!1,C(s)&&(s.group.open=!0),H(e))}async _afterGroupCreate(e){const t=this.viewModel.findGroup(e.id),s=this.viewModel.findField(this._focusedFieldName);s&&t&&x(s,t)&&(!s.editable||this.disabled)&&(await e.componentOnReady(),this._attemptFocusOnNextRender=!0,this.scheduleRender())}_onComponentFocus(e){const t=e.target,s=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=s.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,"readOnly"in t&&t.readOnly||this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,s=this._getFieldInputFromHTMLElement(e),i=s.field.type,{name:o,range:r}=s,n=this._dateComponentMap.get(o);if(!n)return;let a=this.viewModel.getValue(o),l=null;"date-only"===i?l=Array.isArray(e.value)?e.value[0]:e.value:"time-only"===i?(a=V(a),l=V(e.value)):l="timestamp-offset"===i?null!=e.value?E({dateComponent:n.date,timeComponent:n.time,timeZoneComponent:n.timeZone,oldValue:a,defaultTimeZone:t}):null:null!=e.value?P({oldValue:a,dateComponent:n.date,timeComponent:n.time,timeZone:t,max:r.max,min:r.min}):null,null!==l&&e.value?a!==l&&this._updateFieldValue(o,l):this._updateFieldValue(o,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),s=this._parseValue(e),i=t.value;t.isSubtypeField&&L(this.layer,i,s)?this._pendingSubtypeChoice||s===i||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,s)):this._updateFieldValue(t.name,s)}async _handleSubtypeChoice(e,t){const{value:s,name:o}=e,{messages:r,viewModel:n,messagesCommon:a,_subtypes:l}=this;if(this._updateFieldValue(o,t),!l?.length)return;const p=l.find(e=>e.code===t),m=l.find(e=>e.code===s)?.name??`${s}`;if(!p)return;const u=i();n.pendingSubtypeChoice=u;let d="update-fields";const c=[{label:r.subtypes.useDefaultValuesOption,value:"update-fields"},{label:r.subtypes.keepCurrentValuesOption,value:"keep-existing"}],h={context:"info",title:r.subtypes.changeWarningTitle,message:K(r.subtypes.changeWarning,{originalType:m,newType:p.name}),radios:c,defaultRadioSelection:"update-fields",onRadioSelection:e=>d=e,actions:{primary:{label:a.apply,action:()=>u.resolve(d),type:"positive"},secondary:{label:a.cancel,type:"neutral",action:()=>u.resolve("undo")}},cancel:()=>u.reject()};try{switch(this.showPrompt(h),await u.promise){case"update-fields":n.applySubtypeDefaults(p),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,s)}}finally{n.pendingSubtypeChoice=null,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const s=this._getFieldInputFromHTMLElement(t);"Enter"===e&&C(s)&&!s.group.open&&(s.group.open=!0)}_updateFieldValue(e,t){const s=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),s!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([e,t])=>null!=t));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),s=e.value;return F(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==s||""===s?null:"number"===t.dataType?"-0"===s||"-0."===s||"-0,"===s?s:parseFloat(s):"date"===t.field.type?parseFloat(s):s}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:i}=e;0===i.length&&t&&"selected"in t?t.selected=!0:s.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){e.expanded?(t.open=!0,this._focusedFieldName=this._getFocusableInput("forward",t)?.name||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach(e=>{e!==t&&(e.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e?.incrementPage()}_syncGroupInputStates(){if("sequential"!==this.groupDisplay)return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(e=>e.open);0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach(e=>e.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};e([l()],oe.prototype,"_listObserverNode",void 0),e([l()],oe.prototype,"_relatedRecordsEnabled",null),e([l()],oe.prototype,"_utilityNetworkAssociationsEnabled",null),e([l()],oe.prototype,"_prompt",void 0),e([l()],oe.prototype,"_subtypes",null),e([l()],oe.prototype,"associationId",null),e([l()],oe.prototype,"associatedLayer",null),e([l()],oe.prototype,"disabled",null),e([l()],oe.prototype,"feature",null),e([l()],oe.prototype,"_featureFormUNAssociationList",void 0),e([l()],oe.prototype,"formTemplate",null),e([l()],oe.prototype,"groupDisplay",void 0),e([l()],oe.prototype,"headingLevel",void 0),e([l()],oe.prototype,"icon",null),e([l()],oe.prototype,"label",null),e([l()],oe.prototype,"layer",null),e([l()],oe.prototype,"map",null),e([l(),Z("esri/widgets/FeatureForm/t9n/FeatureForm")],oe.prototype,"messages",void 0),e([l(),Z("esri/t9n/common")],oe.prototype,"messagesCommon",void 0),e([l(),Z("esri/widgets/Feature/t9n/Feature")],oe.prototype,"messagesFeature",void 0),e([l(),Z("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],oe.prototype,"messagesTemplates",void 0),e([l()],oe.prototype,"callbacks",null),e([l()],oe.prototype,"relationshipId",null),e([l()],oe.prototype,"spatialReference",null),e([l()],oe.prototype,"strict",null),e([l()],oe.prototype,"timeZone",null),e([l()],oe.prototype,"showPrompt",null),e([l()],oe.prototype,"clearPrompt",null),e([l(),W(["value-change","submit"])],oe.prototype,"viewModel",void 0),e([l({type:se,nonNullable:!0})],oe.prototype,"visibleElements",void 0),e([l()],oe.prototype,"test",null),oe=e([p("esri.widgets.FeatureForm")],oe);const re=oe;export{re as default};
