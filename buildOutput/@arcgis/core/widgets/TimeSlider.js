/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{e,q as i}from"../core/lang.js";import{watch as s,initial as r}from"../core/reactiveUtils.js";import{t as a,o as n}from"../chunks/timeUtils.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../chunks/Logger.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import{f as m,c as u}from"../chunks/date.js";import{u as c,s as d}from"../chunks/constants.js";import p from"../time/TimeInterval.js";import h from"./Slider.js";import v from"./Widget.js";import{l as f}from"../chunks/componentsUtils.js";import{g as k}from"../chunks/globalCss.js";import{o as j}from"../chunks/widgetUtils.js";import{m as y}from"../chunks/messageBundle.js";import{v as x}from"../chunks/vmEvent.js";import{t as g}from"../chunks/jsxFactory.js";import{g as _}from"../chunks/modeUtils.js";import b from"./TimeSlider/TimeSliderViewModel.js";import"../chunks/events.js";import"../chunks/handleUtils.js";import"../chunks/maybe.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/datetime.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../chunks/jsonMap.js";import"../chunks/locale.js";import"../core/Clonable.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/JSONSupport.js";import"../chunks/enumeration.js";import"../intl.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/css.js";import"./Slider/SliderViewModel.js";import"../chunks/domUtils.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../time/TimeExtent.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/Widgets.js";import"../webdoc/widgets/TimeSlider.js";const w="esri-time-slider",E={timeSlider:`${w}`,actions:`${w}__actions`,hasActions:`${w}--has-actions`,max:`${w}__max`,maxDate:`${w}__max-date`,maxTime:`${w}__max-time`,min:`${w}__min`,minDate:`${w}__min-date`,minTime:`${w}__min-time`,next:`${w}__next`,play:`${w}__play`,playbackControls:`${w}__playback-controls`,previous:`${w}__previous`,slider:`${w}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",timeExtent:`${w}__time-extent`,timeExtentEndDate:`${w}__time-extent-end-date`,timeExtentEndGroup:`${w}__time-extent-end-group`,timeExtentEndTime:`${w}__time-extent-end-time`,timeExtentSeparator:`${w}__time-extent-separator`,timeExtentStartDate:`${w}__time-extent-start-date`,timeExtentStartGroup:`${w}__time-extent-start-group`,timeExtentStartTime:`${w}__time-extent-start-time`,timeSliderDisabled:`${w}--disabled`,timeSliderLayout:`${w}__layout--`,timeSliderMode:`${w}__mode--`,timeSliderOutOfBounds:`${w}--out-of-bounds`,timeSliderRow:`${w}__row`,warning:`${w}__warning`,warningIcon:`${w}__warning-icon`,warningLabel:`${w}__warning-label`},S=[{minor:{value:100,unit:"milliseconds"},major:{value:1,unit:"seconds"},format:{second:"numeric"}},{minor:{value:500,unit:"milliseconds"},major:{value:5,unit:"seconds"},format:{second:"numeric"}},{minor:{value:1,unit:"seconds"},major:{value:20,unit:"seconds"},format:{minute:"numeric",second:"numeric"}},{minor:{value:2,unit:"seconds"},major:{value:30,unit:"seconds"},format:{minute:"numeric",second:"numeric"}},{minor:{value:10,unit:"seconds"},major:{value:1,unit:"minutes"},format:{minute:"numeric"}},{minor:{value:15,unit:"seconds"},major:{value:5,unit:"minutes"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:1,unit:"minutes"},major:{value:20,unit:"minutes"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:5,unit:"minutes"},major:{value:2,unit:"hours"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:15,unit:"minutes"},major:{value:6,unit:"hours"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:1,unit:"hours"},major:{value:1,unit:"days"},format:{day:"numeric",month:"short"}},{minor:{value:6,unit:"hours"},major:{value:1,unit:"weeks"},format:{day:"numeric",month:"short"}},{minor:{value:1,unit:"days"},major:{value:1,unit:"months"},format:{month:"long"}},{minor:{value:2,unit:"days"},major:{value:1,unit:"months"},format:{month:"short"}},{minor:{value:3,unit:"days"},major:{value:1,unit:"months"},format:{month:"short"}},{minor:{value:4,unit:"days"},major:{value:3,unit:"months"},format:{month:"short",year:"numeric"}},{minor:{value:1,unit:"weeks"},major:{value:1,unit:"years"},format:{year:"numeric"}},{minor:{value:1,unit:"months"},major:{value:1,unit:"years"},format:{year:"numeric"}},{minor:{value:2,unit:"months"},major:{value:2,unit:"years"},format:{year:"numeric"}},{minor:{value:1,unit:"years"},major:{value:1,unit:"decades"},format:{year:"numeric"}},{minor:{value:2,unit:"years"},major:{value:5,unit:"decades"},format:{year:"numeric"}},{minor:{value:5,unit:"decades"},major:{value:10,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:1,unit:"centuries"},major:{value:10,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:2,unit:"centuries"},major:{value:20,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:5,unit:"centuries"},major:{value:50,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:10,unit:"centuries"},major:{value:100,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:20,unit:"centuries"},major:{value:200,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:50,unit:"centuries"},major:{value:500,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:100,unit:"centuries"},major:{value:1e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:200,unit:"centuries"},major:{value:1e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:500,unit:"centuries"},major:{value:5e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:1e3,unit:"centuries"},major:{value:1e4,unit:"centuries"},format:{era:"short",year:"numeric"}}];function T(t){return g("div",{class:E.warning},g("calcite-icon",{class:E.warningIcon,icon:"exclamation-mark-triangle"}),g("calcite-label",{alignment:"center",class:E.warningLabel,scale:"s"},t))}let M=class extends v{constructor(t,e){super(t,e),this._allLayouts=["auto","compact","wide"],this._ignoreNextSliderUpdate=!1,this._slider=new h({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.labelFormatFunction=null,this.messages=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new b}initialize(){this.addHandles([s(()=>this._slider.values,t=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const e=this.viewModel.valuesToTimeExtent(t);this.timeExtent?e?this.timeExtent.equals(e)||(this.timeExtent=e):this.timeExtent=null:e&&(this.timeExtent=e)}),s(()=>this.effectiveStops,()=>this._updateSliderSteps(),r)])}loadDependencies(){return f({action:()=>import("../chunks/index5.js"),"action-menu":()=>import("../chunks/index17.js").then(t=>t.i),button:()=>import("../chunks/index6.js"),icon:()=>import("../chunks/index.js"),label:()=>import("../chunks/index2.js")})}destroy(){this._slider.destroy(),this._tickFormat=null}get _dateFormat(){return this._getIntlOptions("short-date")}get _timeFormat(){return this._getIntlOptions("long-time")}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(t){this.viewModel.fullTimeExtent=t}get icon(){return"clock"}set icon(t){this._overrideIfSome("icon",t)}get interactive(){return!(this.disabled||"disabled"===this.viewModel.state||this.timeZone===c)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}set layout(t){this._set("layout",this._allLayouts.includes(t)?t:"auto")}get loop(){return this.viewModel.loop}set loop(t){this.viewModel.loop=t}get mode(){return this.viewModel.mode}set mode(t){this.viewModel.mode=t}get playRate(){return this.viewModel.playRate}set playRate(t){this.viewModel.playRate=t}get stops(){return this.viewModel.stops}set stops(t){this.viewModel.stops=t}get tickFormats(){const{timeZone:t}=this;return S.map(({minor:e,major:i,format:s})=>({minor:new p(e),major:new p(i),format:{...s,timeZone:t}}))}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(t){this.viewModel.timeExtent=t}get timeZone(){return this.viewModel.view?.timeZone??d}set timeZone(t){this._overrideIfSome("timeZone",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){const{_slider:t,actions:i,domNode:s,effectiveStops:r,fullTimeExtent:a,interactive:n,messages:o,mode:l,tickConfigs:u,timeExtent:c,timeVisible:d,viewModel:{state:p,timeExtentValues:h}}=this;if(a){const{start:e,end:i}=a;if(e&&i){const s=e.getTime(),r=i.getTime(),a=t.min!==s||t.max!==r;if(a&&(t.min=s,t.max=r),u)t.tickConfigs!==u&&(t.tickConfigs=u);else{const e=(r-s)/(t.trackElement?.offsetWidth||400),i=this.tickFormats.find(({minor:t})=>t.toMilliseconds()>3*e)??this.tickFormats.at(-1),n=i&&this._tickFormat!==i;if(n&&(this._tickFormat=i),a||n){const e={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(t,e)=>{e?.classList.add(E.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(t,e)=>{e?.classList.add(E.sliderMajorTick)},labelFormatFunction:t=>m(t,i.format)};t.tickConfigs=[e,s]}}}}const v=!this.fullTimeExtent?.start||!this.fullTimeExtent.end||!this.timeExtent||this.timeExtent.isAllTime||this.timeExtent.isEmpty||this.timeExtent.start&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||this.timeExtent.end&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(v)switch(this._ignoreNextSliderUpdate=!0,l){case"time-window":t.values=[t.min,t.max];break;case"instant":case"cumulative-from-end":t.values=[t.min];break;case"cumulative-from-start":t.values=[t.max]}else h?e(t.values,h)||(t.values=h):t.values=null;t.disabled=!n;const f=v||!n||!r?.length,y="auto"===this.layout?s.clientWidth<858?"compact":"wide":this.layout,x=g("calcite-button",{appearance:"transparent",bind:this,class:E.play,disabled:f,iconStart:"playing"===p?"pause":"play",kind:"neutral",label:"playing"===p?o.control.stop:o.control.play,onclick:this._playOrStopClick,scale:"wide"===y?"l":"m",width:"full"}),b=this.labelFormatFunction?g("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:E.timeExtentStartDate,"data-date":c?[c.start,c.end]:null,"data-layout":y,"data-type":"extent",key:E.timeExtentStartDate}):!c||c.isAllTime?T(o.noTimeExtent):c.isEmpty?T(o.emptyTimeExtent):[c?.start&&g("div",{class:E.timeExtentStartGroup,key:E.timeExtentStartGroup},g("calcite-label",{alignment:"center",class:E.timeExtentStartDate,key:E.timeExtentStartDate,scale:"s"},this._formatDate(c.start)),d?g("calcite-label",{alignment:"center",class:E.timeExtentStartTime,key:E.timeExtentStartTime,scale:"s"},this._formatTime(c.start)):null),c.start&&c.end&&c.start.getTime()!==c.end.getTime()&&g("div",{class:E.timeExtentSeparator,key:E.timeExtentSeparator}),c?.end&&(!c.start||c.start.getTime()!==c.end.getTime())&&g("div",{class:E.timeExtentEndGroup,key:E.timeExtentEndGroup},g("calcite-label",{alignment:"center",class:E.timeExtentEndDate,key:E.timeExtentEndDate,scale:"s"},this._formatDate(c.end)),d?g("calcite-label",{alignment:"center",class:E.timeExtentEndTime,key:E.timeExtentEndTime,scale:"s"},this._formatTime(c.end)):null)],w=g("div",{class:E.timeExtent},b),S=this.labelFormatFunction?g("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:E.minDate,"data-date":a?.start,"data-layout":y,"data-type":"min",key:E.minDate}):a?.start&&[g("calcite-label",{class:E.minDate,key:E.minDate,scale:"s"},this._formatDate(a.start)),d&&g("calcite-label",{class:E.minTime,key:E.minTime,scale:"s"},this._formatTime(a.start))],M=g("div",{class:E.min},S),$=g("div",{class:E.slider},t.render()),F=this.labelFormatFunction?g("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:E.maxDate,"data-date":a?.end,"data-layout":y,"data-type":"max",key:E.maxDate}):a?.end&&[g("calcite-label",{class:E.maxDate,key:E.maxDate,scale:"s"},this._formatDate(a.end)),d&&g("calcite-label",{class:E.maxTime,key:E.maxTime,scale:"s"},this._formatTime(a.end))],D=g("div",{class:E.max},F),C=g("calcite-button",{appearance:"transparent",bind:this,class:E.previous,disabled:f||"playing"===p,iconStart:"reverse",kind:"neutral",label:o.pagination.previous,onclick:this._previousClick,scale:"wide"===y?"l":"m",width:"full"}),U=g("calcite-button",{appearance:"transparent",bind:this,class:E.next,disabled:f||"playing"===p,iconStart:"forward",kind:"neutral",label:o.pagination.next,onclick:this._nextClick,scale:"wide"===y?"l":"m",width:"full"}),L=i?.length>0,O=L&&g("calcite-action-menu",{class:E.actions,label:o.options},i.toArray().map(t=>g("calcite-action",{bind:this,icon:t.icon,id:t.id,onclick:()=>this.viewModel.triggerAction(t),text:t.title,textEnabled:!0})));return g("div",{afterCreate:t=>{this.addHandles(j(t,()=>this.scheduleRender()))},"aria-label":o.widgetLabel,class:this.classes(E.timeSlider,k.widget,`${E.timeSliderMode}${l}`,`${E.timeSliderLayout}${y}`,!n&&E.timeSliderDisabled,v&&E.timeSliderOutOfBounds,L&&E.hasActions,_())},"wide"===y&&g("div",{class:E.timeSliderRow},g("div",{class:E.playbackControls},[x,w,M,$,D,C,U]),O),"compact"===y&&[g("div",{class:E.timeSliderRow,key:"time-slider-row-1"},[w,O]),g("div",{class:E.timeSliderRow,key:"time-slider-row-2"},[$]),g("div",{class:E.timeSliderRow,key:"time-slider-row-3"},[M,C,x,U,D])])}updateWebDocument(t){this.viewModel?.updateWebDocument(t)}_createLabel(t){if(!this.labelFormatFunction)return;const e=t.getAttribute("data-type"),i=t.getAttribute("data-layout"),s=t["data-date"];this.labelFormatFunction(s,e,t,i)}_formatDate(t){return m(t,this._dateFormat)}_formatTime(t){return m(t,this._timeFormat)}_getIntlOptions(t){const{timeZone:e}=this;return{...u(t),timeZone:e}}_getTickPositions(t){const{fullTimeExtent:e}=this;if(!e?.start||!e.end)return[];const{start:i,end:s}=e,r=[],{value:o,unit:l}=t;let m=a(i,l,this.timeZone);for(;m.getTime()<=s.getTime();)m.getTime()>=i.getTime()&&r.push(m.getTime()),m=n(m,o,l,this.timeZone);return r}_updateSliderSteps(){this._slider.steps=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map(t=>t.getTime()):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:i(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};t([o()],M.prototype,"_dateFormat",null),t([o()],M.prototype,"_timeFormat",null),t([o()],M.prototype,"actions",null),t([o()],M.prototype,"disabled",void 0),t([o()],M.prototype,"effectiveStops",null),t([o()],M.prototype,"fullTimeExtent",null),t([o()],M.prototype,"icon",null),t([o({readOnly:!0})],M.prototype,"interactive",null),t([o()],M.prototype,"label",null),t([o()],M.prototype,"labelFormatFunction",void 0),t([o({value:"auto"})],M.prototype,"layout",null),t([o()],M.prototype,"loop",null),t([o(),y("esri/widgets/TimeSlider/t9n/TimeSlider")],M.prototype,"messages",void 0),t([o()],M.prototype,"mode",null),t([o()],M.prototype,"playRate",null),t([o()],M.prototype,"stops",null),t([o()],M.prototype,"tickConfigs",void 0),t([o()],M.prototype,"tickFormats",null),t([o()],M.prototype,"timeExtent",null),t([o({nonNullable:!0})],M.prototype,"timeVisible",void 0),t([o()],M.prototype,"timeZone",null),t([o()],M.prototype,"view",null),t([o({type:b}),x("trigger-action")],M.prototype,"viewModel",void 0),M=t([l("esri.widgets.TimeSlider")],M);const $=M;export{$ as default};
