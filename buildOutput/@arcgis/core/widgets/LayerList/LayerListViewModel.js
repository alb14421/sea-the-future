/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as s}from"../../chunks/tslib.es6.js";import t from"../../core/Collection.js";import{EventedAccessor as e}from"../../core/Evented.js";import{watch as i,initial as o}from"../../core/reactiveUtils.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/Logger.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import{i as n}from"../../chunks/utils23.js";import l from"./ListItem.js";import{g as c,f as m}from"../../chunks/layerListUtils.js";import"../../chunks/watch.js";import"../../chunks/ObjectPool.js";import"../../chunks/handleUtils.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../chunks/object.js";import"../../chunks/events.js";import"../../chunks/maybe.js";import"../../chunks/SetUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/ObservableBase.js";import"../../chunks/jsonUtils.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/metadata.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/Warning.js";import"../../core/Identifiable.js";import"../../core/accessorSupport/decorators/cast.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"./ListItemPanel.js";import"../Widget.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/constants.js";import"../../chunks/datetime.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Promise.js";import"../../chunks/uuid.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../../chunks/componentsUtils.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/widgetUtils.js";import"../support/widget.js";import"../../chunks/accessibleHandler.js";import"../../chunks/messageBundle.js";import"../../chunks/vmEvent.js";import"../../chunks/jsxFactory.js";import"../../chunks/modeUtils.js";const p="view-layers",h="map-layers",d="layer-views",u="layer-list-mode",j=t.ofType(l);let k=class extends e{constructor(s){super(s),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new j,this.view=null}initialize(){this.addHandles([i(()=>!0===this.view?.ready,()=>this._viewHandles(),o),i(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),i(()=>n(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],"view")}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:s}=this;return s?.ready?"ready":s?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(s=>s.children).length}triggerAction(s,t){s&&!s.disabled&&this.emit("trigger-action",{action:s,item:t})}moveListItem(s,t,e,i){const o=s?.layer;if(!o||"subtype-sublayer"===o.type||"sublayer"===o.type)return;const r=this.view?.map?.layers,a=t?c(t):r,n=e?c(e):r;if(!a||!n)return;const{operationalItems:l}=this,m=t?.children||l,p=e?.children||l,h=n.length-i;s.parent=e||null,m.remove(s),a.remove(o),p.includes(s)||p.add(s,h),n.includes(o)||n.add(o,h),this._compileList()}_createLayerViewHandles(s){this.removeHandles(d),this._compileList(),s&&this.addHandles(s.on("change",()=>this._compileList()),d)}_createMapLayerHandles(s){this.removeHandles(h),this._compileList(),s&&this.addHandles(s.on("change",()=>this._compileList()),h)}_createListItem(s){const{view:t,listItemCreatedFunction:e,checkPublishStatusEnabled:i,listModeDisabled:o}=this;return new l({checkPublishStatusEnabled:i,listModeDisabled:o,layer:s,listItemCreatedFunction:e,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(s){return s?this.listModeDisabled?s:s.filter(s=>"hide"!==m(s)):void 0}_watchLayersListMode(s){this.removeHandles(u),s&&!this.listModeDisabled&&this.addHandles(i(()=>s.filter(s=>"listMode"in s).map(s=>s.listMode).toArray(),()=>this._compileList()),u)}_compileList(){const s=this.view?.map?.layers,t=n(this.view)&&!this.view.inGeographicLayout?s?.filter(({type:s})=>"link-chart"===s):s;this._watchLayersListMode(t);const e=this._getViewableLayers(t);e?.length?(this._createNewItems(e),this._removeItems(e),this._sortItems(e)):this._removeAllItems()}_createNewItems(s){const{operationalItems:t}=this;s.forEach(s=>{t.some(t=>t.layer===s)||t.add(this._createListItem(s))})}_removeItems(s){const{operationalItems:t}=this,e=[];t.forEach(t=>{t&&s&&s.includes(t.layer)||e.push(t)}),t.destroyMany(e)}_sortItems(s){const{operationalItems:t}=this;t.sort((t,e)=>{const i=s.indexOf(t.layer),o=s.indexOf(e.layer);return i>o?-1:i<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:s}=this;this.removeHandles([h,d,p]),s?.ready?this.addHandles([i(()=>this.view?.map?.allLayers,s=>this._createMapLayerHandles(s),o),i(()=>this.view?.allLayerViews,s=>this._createLayerViewHandles(s),o)],p):this._removeAllItems()}};s([r()],k.prototype,"checkPublishStatusEnabled",void 0),s([r()],k.prototype,"listItemCreatedFunction",void 0),s([r({nonNullable:!0})],k.prototype,"listModeDisabled",void 0),s([r({type:j})],k.prototype,"operationalItems",void 0),s([r({readOnly:!0})],k.prototype,"state",null),s([r()],k.prototype,"totalItems",null),s([r()],k.prototype,"view",void 0),k=s([a("esri.widgets.LayerList.LayerListViewModel")],k);const y=k;export{y as default};
