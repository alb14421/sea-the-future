/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import{i as t}from"../core/lang.js";import{h as o}from"../chunks/handleUtils.js";import{L as s}from"../chunks/Logger.js";import{d as i,r}from"../chunks/maybe.js";import{ignoreAbortErrors as n}from"../core/promiseUtils.js";import{watch as l,when as a,syncAndInitial as p}from"../core/reactiveUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import{subclass as u}from"../core/accessorSupport/decorators/subclass.js";import m from"../views/interactive/sketch/SketchValueOptions.js";import h from"./Widget.js";import d from"./Sketch/SketchViewModel.js";import{V as g}from"../chunks/VisibleElements.js";import{o as y}from"../chunks/widgetUtils.js";import{t as v,a as j}from"../chunks/jsxFactory.js";import{l as b}from"../chunks/componentsUtils.js";import{m as k}from"../chunks/messageBundle.js";import f from"../core/Accessor.js";import _ from"../core/Collection.js";import w,{S as C}from"./support/SelectionToolbar.js";import{S as M,a as S}from"../chunks/SketchTooltipControls.js";import T from"./support/SnappingControls.js";import{v as O}from"../chunks/vmEvent.js";import{s as L}from"../chunks/substitute.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../chunks/string.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/MapUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/events.js";import"../chunks/assets.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/UpdatingHandles.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../chunks/projectionUtils.js";import"../chunks/SimpleObservable.js";import"../chunks/vec3f64.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/SpatialReference.js";import"../core/JSONSupport.js";import"../chunks/writer.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Point.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../geometry/Polyline.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../chunks/shared.js";import"../geometry/support/jsonUtils.js";import"../chunks/typeUtils.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../layers/Layer.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../layers/mixins/BlendLayer.js";import"../chunks/layerContainerType.js";import"../chunks/jsonUtils2.js";import"../chunks/parser.js";import"../chunks/utils5.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../layers/mixins/ScaleRangeLayer.js";import"../symbols/support/ElevationInfo.js";import"../symbols/support/FeatureExpressionInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../chunks/isSupportedObject.js";import"../chunks/elevationInfoUtils.js";import"../chunks/layerUtils2.js";import"../chunks/editableLayers.js";import"../chunks/InputManager.js";import"../chunks/Queue.js";import"../chunks/signal.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../chunks/SketchOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SketchTooltipVisibleElements.js";import"../chunks/SnappingManager.js";import"../chunks/asyncUtils.js";import"../chunks/normalizedPoint.js";import"../chunks/dehydratedPoint.js";import"../chunks/Settings.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/constraints.js";import"../chunks/vec3.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../chunks/utils11.js";import"../chunks/Version2.js";import"../chunks/Version.js";import"../chunks/vec2.js";import"../chunks/vec2f64.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../geometry/support/geodesicUtils.js";import"../chunks/plane.js";import"../chunks/vector.js";import"../chunks/mat3f64.js";import"../chunks/mat4f64.js";import"../chunks/quatf64.js";import"../chunks/mathUtils2.js";import"../chunks/sphere.js";import"../chunks/ray.js";import"../chunks/mat3.js";import"../chunks/geometry2dUtils.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/geodesicLengthMeasurementUtils.js";import"../chunks/quantityUtils.js";import"../chunks/projectVectorToVector.js";import"../chunks/projectPointToVector.js";import"../chunks/spatialReferenceEllipsoidUtils.js";import"../geometry/operators/geodeticLengthOperator.js";import"../chunks/geodeticCurveType.js";import"../chunks/geodesicMeasurementUtils.js";import"../chunks/automaticAreaMeasurementUtils.js";import"../chunks/geodesicAreaMeasurementUtils.js";import"../chunks/earcut.js";import"../chunks/triangle.js";import"../chunks/lineSegment.js";import"../chunks/automaticLengthMeasurementUtils.js";import"../chunks/HighlightDefaults.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/screenUtils2.js";import"../chunks/sketchUtils.js";import"../chunks/globalCss.js";import"./support/SelectionToolbar/SelectionToolbarViewModel.js";import"../chunks/layerViewUtils.js";import"../chunks/SelectionOperation.js";import"./support/Selector2D/selectorUtils.js";import"../chunks/drapedUtils.js";import"../chunks/directionModeIcons.js";import"../chunks/LabeledSwitch.js";import"./support/SnappingControls/SnappingControlsViewModel.js";import"../chunks/layerListUtils.js";import"./LayerList/LayerListViewModel.js";import"../chunks/utils23.js";import"./LayerList/ListItem.js";import"./LayerList/ListItemPanel.js";import"./support/widget.js";import"../chunks/accessibleHandler.js";import"../chunks/modeUtils.js";import"../chunks/VisibleElements2.js";const U={s:32,m:48,l:64},E={horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}},x={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function P(e,t){return e.vnodeSelector===t?[e]:e.children?.flatMap(e=>P(e,t))??[]}const I=t=>{const o=t;let s=class extends o{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(e){const t=this._get("measurementManager");e!==t&&(t&&t.managedElements.remove(this),this._set("measurementManager",e),e?.managedElements.add(this))}set budgetedLength(e){this.budgetedLength!==e&&(this._set("budgetedLength",e),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(e=>P(e,"calcite-action"))??[]}get activeChildElement(){const e=this.actionChildren.find(e=>!0===e.properties?.active);return e?(this._set("lastActiveKey",e.properties?.key),e):this.lastActiveKey?this.actionChildren.find(e=>e.properties?.key===this.lastActiveKey):void 0}_handleClick(e){e?.dataset&&"dataset"in e&&e.dataset.actionKey&&(this.lastActiveKey=e.dataset.actionKey)}};return e([c()],s.prototype,"priority",void 0),e([c()],s.prototype,"measurementManager",null),e([c()],s.prototype,"budgetedLength",null),e([c()],s.prototype,"actionChildren",null),e([c()],s.prototype,"activeChildElement",null),e([c()],s.prototype,"scale",void 0),e([c()],s.prototype,"slot",void 0),e([c()],s.prototype,"lastActiveKey",void 0),e([c()],s.prototype,"layout",void 0),s=e([u("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],s),s},R=Symbol("on-resize-handle-key");let D=class extends(I(h)){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return["horizontal"===this.layout?this._measuredWidth:this._measuredHeight]}render(){return v("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(y(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),R)},afterRemoved:()=>this.removeHandles(R)},this.children)}};e([c()],D.prototype,"_measuredWidth",void 0),e([c()],D.prototype,"_measuredHeight",void 0),e([c()],D.prototype,"lengthOptions",null),e([c()],D.prototype,"_measuredElement",void 0),D=e([u("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],D);let A=class extends(I(h)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return b({action:()=>import("../chunks/index5.js"),"action-group":()=>import("../chunks/index16.js").then(e=>e.i),"action-menu":()=>import("../chunks/index17.js").then(e=>e.i)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?1+U[t]*Math.min(e.length,2):1+U[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:o,allowCollapse:s,priority:i}=this,r=[o];if(e.length<=2||!s||i<1)return r;for(let s=1;s<e.length-1;s++)r.push(o+U[t]*s);return r}render(){if(!this.actionChildren.length)return v(j,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:o,layout:s,slot:i,scale:r}=this,n=Math.floor(e/U[r]),l=[],a=[];if(n>=t.length)l.push(...t);else{const e=o??l.at(0);if(l.push(...t.slice(0,n-1)),a.push(...t.slice(n-1)),e&&a.includes(e)){const[t]=a.splice(a.indexOf(e),1),o=l.pop();l.push(t),o&&a.unshift(o)}}return v("calcite-action-group",{key:"overflow-button-group",layout:s,onclick:e=>this._handleClick(e.target),slot:i},l.map(e=>this._renderManagedAction(e)),a.length>0?v("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},v("calcite-action",{icon:x.overflow,key:"split-button-dropdown-trigger",scale:r,slot:"trigger",text:this.messagesCommon.more}),a.map(e=>this._renderManagedAction(e))):void 0)}_renderManagedAction(e){return v("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};e([c()],A.prototype,"allowCollapse",void 0),e([c()],A.prototype,"minimumLength",null),e([c(),k("esri/t9n/common")],A.prototype,"messagesCommon",void 0),e([c()],A.prototype,"lengthOptions",null),A=e([u("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],A);let z=class extends f{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new _,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:o}=this;let s=0;for(const t of o){const o=t.lengthOptions[0];e.set(t,o),s+=o}for(const i of o)for(;s<t;){const o=e.get(i);if(!o)break;const r=i.lengthOptions.find(e=>e>o);if(!r)break;const n=s-o+r;if(n>t)break;e.set(i,r),s=n}for(const[t,o]of e)t.budgetedLength=o}_measure(){const e=this.measuredElement;this.availableLength=e?"horizontal"===this.layout?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};e([c()],z.prototype,"measuredElement",void 0),e([c()],z.prototype,"managedElements",void 0),e([c()],z.prototype,"_sortedElements",null),e([c()],z.prototype,"availableLength",void 0),e([c()],z.prototype,"layout",void 0),z=e([u("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],z);let B=class extends(I(h)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return b({action:()=>import("../chunks/index5.js"),"action-group":()=>import("../chunks/index16.js").then(e=>e.i),"action-menu":()=>import("../chunks/index17.js").then(e=>e.i)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const e=this.actionChildren;return e.length?1===e.length?U[this.scale]+1:this.allowCollapse?U[this.scale]+E[this.layout][this.scale]+1:U[this.scale]*e.length+1:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:o,scale:s,priority:i,allowCollapse:r}=this;if(e.length<2||i<0||!r)return[t];const n=1+U[s]*e.length;return[1+U[s]+E[o][s],n]}render(){if(!this.actionChildren.length)return v(j,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:o,layout:s,slot:i,allowCollapse:r}=this,n=!r||e.length<2||o>t;return v("calcite-action-group",{key:"split-button-group",layout:s,onclick:e=>this._handleClick(e.target),slot:i},n?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:o,scale:s,messagesCommon:i}=this,r=e??o.at(0);if(!r)return;const n=o.filter(e=>e!==r);return[this._renderManagedAction(r),v("calcite-action-menu",{key:"split-button-dropdown",label:i.more,overlayPositioning:"fixed",placement:"horizontal"===t?"bottom-end":"right-end"},v("calcite-action",{class:`esri-split-button--split-part--${t}--${this.scale}`,compact:"horizontal"===t,icon:x.splitButton[t],key:"split-button-dropdown-trigger",scale:s,slot:"trigger",text:i.more}),n?.map(e=>this._renderManagedAction(e)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){return v("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}};e([c()],B.prototype,"minimumLength",null),e([c()],B.prototype,"allowCollapse",void 0),e([c()],B.prototype,"lengthOptions",null),e([c(),k("esri/t9n/common")],B.prototype,"messagesCommon",void 0),B=e([u("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],B);const V="esri-responsive-toolbar",G={rulerBase:`${V}__ruler`,rulerBarHorizontal:`${V}__ruler--bar`,rulerBarVertical:`${V}__ruler--bar--vertical`,rulerPadVertical:`${V}__ruler--pad--vertical`,rulerPadHorizontal:`${V}__ruler--pad--horizontal`,bar:`${V}__bar`,barHorizontal:`${V}__bar--horizontal`,barVertical:`${V}__bar--vertical`,pad:`${V}__pad`,padVertical:`${V}__pad--vertical`,padHorizontal:`${V}__pad--horizontal`};let H=class extends h{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new z,this._managedWidgets=new Map}loadDependencies(){return b({"action-bar":()=>import("../chunks/index15.js")})}destroy(){this._measurementManager=i(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}get _barClasses(){const e="docked"===this.barStyle,t="vertical"===this.layout;return{[G.barHorizontal]:e&&!t,[G.barVertical]:e&&t,[G.bar]:e,[G.padHorizontal]:!e&&!t,[G.padVertical]:!e&&t,[G.pad]:!e}}render(){const{layout:e,scale:t,barStyle:o}=this,s={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},i="docked"===o?"vertical"===e?G.rulerBarVertical:G.rulerBarHorizontal:"horizontal"===e?G.rulerPadHorizontal:G.rulerPadVertical;return v("div",null,v("div",{afterCreate:e=>{this._measurementManager?.connect(e)},class:this.classes(G.rulerBase,i)}),v("calcite-action-bar",{...s,classes:this._barClasses,floating:"docked"!==o,overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(e=>void 0!==e.properties?.key&&"group-kind"in e.properties),o=new Set,s=e.map(e=>{const t=e.properties,s=t.key;o.add(s);const i="docked"===this.barStyle?t.slot??void 0:void 0,r=t.priority??0,n=t["group-kind"]??"overflow-group",l=t["allow-collapse"]??!0,a=this._managedWidgets.get(s);if(a)return a.children=e.children,a.priority=r,"allowCollapse"in a&&(a.allowCollapse=l),a.slot=i,a.layout=this.layout,a.scale=this.scale,a.measurementManager=this._measurementManager,a;const p={scale:this.scale,priority:r,measurementManager:this._measurementManager,children:e.children,slot:i,layout:this.layout};switch(n){case"split-button":{const e=new B({...p,allowCollapse:l});return this._managedWidgets.set(s,e),e}case"overflow-group":{const e=new A({...p,allowCollapse:l});return this._managedWidgets.set(s,e),e}case"measured-content":{const e=new D({...p});return this._managedWidgets.set(s,e),e}}}).filter(t);return Array.from(this._managedWidgets.keys()).filter(e=>!o.has(e)).forEach(e=>{this._managedWidgets.get(e)?.destroy(),this._managedWidgets.delete(e)}),this._measurementManager?.allocate(),s.map(e=>e.render())}};e([c()],H.prototype,"scale",void 0),e([c({value:"horizontal"})],H.prototype,"layout",null),e([c()],H.prototype,"barStyle",void 0),e([c()],H.prototype,"_measurementManager",void 0),e([c()],H.prototype,"_managedWidgets",void 0),e([c()],H.prototype,"_barClasses",null),H=e([u("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],H);const $="esri-sketch",F={base:$,vertical:`${$}--vertical`,docked:`${$}-bar`,floating:`${$}-pad`,chipHorizontal:`${$}__selection-count-chip--horizontal`,chipVertical:`${$}__selection-count-chip--vertical`,chipVerticalSmall:`${$}__selection-count-chip--vertical--s`,popoverWrapper:`${$}__popover-wrapper`},W={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let K=class extends h{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.groupAllowCollapseOptions=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new g,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new d({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,s="2d"===t?.type,i=new w({persistSelection:!1,visibleElements:new C({chip:!1,pan:!1,pointTool:!1,lassoTool:s,rectangleTool:s}),view:t,sources:e?[e]:null,scale:this.scale});this.addHandles([l(()=>this.viewModel,e=>{this._viewModelHandlesGroup=r(this._viewModelHandlesGroup),e&&(this._viewModelHandlesGroup=o([e.on("create",()=>this.scheduleRender()),e.on("update",()=>this.scheduleRender()),e.on("delete",e=>this.emit("delete",e)),e.on("undo",()=>this.scheduleRender()),e.on("redo",()=>this.scheduleRender()),l(()=>e.layer,e=>{this._selectionToolbar&&(this._selectionToolbar.sources=e?[e]:null)}),l(()=>e.view,e=>{this._selectionToolbar&&(this._selectionToolbar.view=e)}),l(()=>e.state,()=>this.notifyChange("state"))]))},p),a(()=>i.activeOperation,()=>this.viewModel.cancel()),i.on("complete",e=>this._onSelectionOperationComplete(e)),l(()=>{const{view:e,visibleElements:{selectionTools:t}}=this;return{lassoTool:"3d"!==e?.type&&!!t?.["lasso-selection"],rectangleTool:"3d"!==e?.type&&!!t?.["rectangle-selection"]}},e=>{Object.assign(i.visibleElements,e)},p)]),this._selectionToolbar=i}loadDependencies(){return b({action:()=>import("../chunks/index5.js"),chip:()=>import("../chunks/index35.js"),popover:()=>import("../chunks/index26.js").then(e=>e.i)})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=r(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeOperation;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:o,activeCreateToolDrawMode:s}=this.viewModel;return"polygon"===o&&"freehand"===s&&t?.includes("freehandPolygon")?"freehandPolygon":"polyline"===o&&"freehand"===s&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeOperation?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&i(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:o}=this,s=e?.filter(e=>!!o.createTools?.[e]);return"3d"===t?.type?s?.filter(e=>"multipoint"!==e):s}create(e,t,o){const s=o?.createOptions??t;return this._activeCustomToolOptions=o,n(this.viewModel.create(e,s))}update(e,t){return n(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:o}=this,s=this.customActions?.filter(e=>"selection-toolbar"===e.position);return v("div",null,v("div",{classes:{[F.base]:!0,[F.floating]:"floating"===e,[F.docked]:"docked"===e,[F.vertical]:"vertical"===t}},v(H,{barStyle:e,layout:t,scale:o},this._renderSelectionSetItemGroupInline(),v("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionTools")??!0,"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??0},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),s?.map(e=>this._renderToolbarItem(e))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:o,viewModel:s,visibleElements:i}=this;if(!this._calcitePopoverReferenceElement)return;const r={directionModePicker:i.directionModePicker,labelsToggle:i.labelsToggle,tooltipsToggle:i.tooltipsToggle},n="horizontal"===this.layout?"top"===this._relativeLocation?"bottom-end":"top-end":"right-end";return v("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:n,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:e=>this._remeasurePopoverSizes(e.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},v("div",{class:F.popoverWrapper},Object.values(r).includes(!0)?v(M,{sketchOptions:s.sketchOptions,viewType:o?.type,visibleElements:new S(r)}):void 0,i.snappingControls&&o&&t?v(T,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:o,visibleElements:i.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if("separate"!==this.contextualToolLocation)return;const e=this._renderSelectionSetItemGroup();return e?.length?v(H,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return"separate"===this.contextualToolLocation?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return v("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("undoRedo")??!0,"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??10,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],o=[];this.customActions?.forEach(t=>{"settings-before"===t.position?o.push(t):"settings-after"===t.position&&e.push(t)});const s=[...o.map(e=>this._renderToolbarItem(e)),this._renderSettingsMenuButton(),...e.map(e=>this._renderToolbarItem(e))].filter(t);if(s.length)return v("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("settings")??!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??1e3,slot:"actions-end"},s)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e="inline-end"===this.contextualToolLocation?"actions-end":void 0,t=this.customActions?.filter(e=>"before-selection-set"===e.position),o=this.customActions?.filter(e=>"after-selection-set"===e.position),s=this.groupCollapsePriorities?.get("selectionSet")??100;return[v("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:s,slot:e},this._renderFeatureCountChip()),v("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionSet")??!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:s,slot:e},t?.map(e=>this._renderToolbarItem(e)),this._renderDuplicateButton(),this._renderDeleteButton(),o?.map(e=>this._renderToolbarItem(e)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:"ready"===t})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(e=>this._renderBuiltInCreateToolItem(e))??[],t=this.customToolOptions?.flatMap(e=>this._renderCustomToolItem(e))??[];return v("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("createTools")??!0,"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??100},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:W[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:o,id:s,updateGraphics:{length:i}}=this,r=L(t.selectedCount,{count:i}),n="s"===o?99:999,l=i>n?L(t.selectedCountTruncated,{truncated:n}):i,a="s"===o&&"vertical"===e,p=a?`${s}-selection-chip-small`:`${s}-selection-chip`;return[a?v("span",{classes:{[F.chipVertical]:!0,[F.chipVerticalSmall]:"s"===this.scale},id:p,tabIndex:0,title:r},l):v("calcite-chip",{appearance:"outline",class:"horizontal"===e?F.chipHorizontal:F.chipVertical,id:p,kind:"brand",label:r,scale:"l"===o?"m":"s",tabIndex:0,title:"vertical"===e?r:void 0},"vertical"===e?l:r)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:o,disabled:s,onclick:i,active:r,flipRTL:n,afterCreate:l,afterUpdate:a,afterRemoved:p}){const c=`${this.id}-${e}`;return[v("calcite-action",{active:r,afterCreate:l,afterRemoved:p,afterUpdate:a,bind:this,"data-testid":e,disabled:s||"disabled"===this.state,icon:o,iconFlipRtl:n??!1,id:c,key:e,onclick:i,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,o=this?.view?.container?.getBoundingClientRect(),s=t?.style;if(!(t&&o&&s&&this.view?.container?.contains(t)))return;const i=this._calcitePopoverReferenceElement;if(!i)return;const{bottom:r,top:n}=i.getBoundingClientRect();if("horizontal"===this.layout){const e=r<o.height/2;e!==("top"===this._relativeLocation)&&(this._relativeLocation=e?"top":"bottom"),e?(s?.setProperty("--sketch-view-height-offset",r-o.top+"px"),s?.setProperty("--sketch-view-margin-offset","30px")):(s?.setProperty("--sketch-view-height-offset",o.bottom-n+"px"),s?.setProperty("--sketch-view-margin-offset","15px"))}else"vertical"===this.layout&&(s.setProperty("--sketch-view-height-offset","15px"),s.setProperty("--sketch-view-margin-offset","15px"));const l=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;s.setProperty("--sketch-popover-header-offset",`${l}px`)}catch(e){s.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",e)}}_activateCreateTool(e,t,o){const s=this._activeCustomToolOptions;if(o||s){if(o?.toolKey===s?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,o)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;"transform"!==t&&"reshape"!==t||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:o}=e;if(!e.aborted&&o.length){const e=t.tool,s=o.length>1&&"reshape"===e?"transform":e;this.update(o,{...t,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};e([c()],K.prototype,"_activeCustomToolOptions",void 0),e([c()],K.prototype,"activeTool",null),e([c({readOnly:!0})],K.prototype,"activeTooltip",null),e([c({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter(e=>t.has(e))}})],K.prototype,"availableCreateTools",void 0),e([c({readOnly:!0})],K.prototype,"createGraphic",null),e([c()],K.prototype,"creationMode",null),e([c()],K.prototype,"customToolOptions",void 0),e([c()],K.prototype,"customActions",void 0),e([c()],K.prototype,"defaultCreateOptions",null),e([c()],K.prototype,"defaultUpdateOptions",null),e([c()],K.prototype,"icon",null),e([c()],K.prototype,"label",null),e([c()],K.prototype,"labelOptions",null),e([c()],K.prototype,"layer",null),e([c({type:["horizontal","vertical"],value:"horizontal"})],K.prototype,"layout",null),e([c({value:"m"})],K.prototype,"scale",null),e([c()],K.prototype,"toolbarKind",void 0),e([c()],K.prototype,"contextualToolLocation",void 0),e([c()],K.prototype,"groupCollapsePriorities",void 0),e([c()],K.prototype,"groupAllowCollapseOptions",void 0),e([c(),k("esri/widgets/Sketch/t9n/Sketch")],K.prototype,"messages",void 0),e([c(),k("esri/t9n/common")],K.prototype,"messagesCommon",void 0),e([c()],K.prototype,"snappingOptions",null),e([c()],K.prototype,"state",null),e([c()],K.prototype,"tooltipOptions",null),e([c({readOnly:!0})],K.prototype,"updateGraphics",null),e([c({type:m,nonNullable:!0})],K.prototype,"valueOptions",null),e([c()],K.prototype,"view",null),e([c({type:d}),O(["create","update","undo","redo"])],K.prototype,"viewModel",null),e([c({type:g,nonNullable:!0})],K.prototype,"visibleElements",void 0),e([c()],K.prototype,"_effectiveAvailableCreateTools",null),e([c()],K.prototype,"_defaultViewModel",void 0),e([c()],K.prototype,"_calcitePopoverReferenceElement",void 0),e([c()],K.prototype,"_relativeLocation",void 0),e([c()],K.prototype,"_popoverOpen",void 0),K=e([u("esri.widgets.Sketch")],K);const N=K;export{N as default};
