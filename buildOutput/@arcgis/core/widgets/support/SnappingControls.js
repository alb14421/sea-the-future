/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{i as t}from"../../core/lang.js";import{c as s}from"../../chunks/asyncUtils.js";import{d as i}from"../../chunks/maybe.js";import{watch as n}from"../../core/reactiveUtils.js";import{g as l}from"../../chunks/watch.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/Logger.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import a from"../Widget.js";import{l as p}from"../../chunks/componentsUtils.js";import{g as d}from"../../chunks/globalCss.js";import{l as c,L as g}from"../../chunks/LabeledSwitch.js";import{b as h}from"../../chunks/widgetUtils.js";import{m as u}from"../../chunks/messageBundle.js";import{t as m}from"../../chunks/jsxFactory.js";import b,{i as y}from"./SnappingControls/SnappingControlsViewModel.js";import k from"../../core/Accessor.js";import{V as _}from"../../chunks/VisibleElements2.js";import"../../core/promiseUtils.js";import"../../chunks/handleUtils.js";import"../../core/Error.js";import"../../chunks/object.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/events.js";import"../../chunks/ObjectPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SetUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/metadata.js";import"../../chunks/Warning.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/constants.js";import"../../chunks/datetime.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Evented.js";import"../../core/Handles.js";import"../../chunks/ObservableBase.js";import"../../core/Promise.js";import"../../chunks/uuid.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../../chunks/jsxWidgetSupport.js";import"../../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../../core/Collection.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../views/interactive/snapping/SnappingOptions.js";import"../../chunks/Settings.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../core/JSONSupport.js";import"../../chunks/layerListUtils.js";import"../LayerList/LayerListViewModel.js";import"../../chunks/utils23.js";import"../LayerList/ListItem.js";import"../../core/Identifiable.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../LayerList/ListItemPanel.js";import"./widget.js";import"../../chunks/accessibleHandler.js";import"../../chunks/vmEvent.js";import"../../chunks/modeUtils.js";let j=class extends k{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new _({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};e([o({type:Boolean,nonNullable:!0})],j.prototype,"enabledToggle",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"featureEnabledToggle",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"gridEnabledToggle",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"header",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"layerList",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"gridControls",void 0),e([o({type:_,nonNullable:!0})],j.prototype,"gridControlsElements",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"layerListToggleLayersButton",void 0),e([o({type:Boolean,nonNullable:!0})],j.prototype,"selfEnabledToggle",void 0),j=e([r("esri.widgets.support.SnappingControls.VisibleElements")],j);const L=j,v="esri-snapping-controls",w={base:v,container:`${v}__container`,toggleBlock:`${v}__toggle-block`,layerListBlock:`${v}__layer-list-block`,layerList:`${v}__layer-list`,layerListFilter:`${v}__layer-list__filter`,layerListButton:`${v}__layer-list__button`,layerListItem:`${v}__layer-list__item`,layerListGroup:`${v}__layer-list__group`,nestedContainer:`${v}__nested-container`};let f=class extends a{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new L,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._gridEnabledSwitchChange=e=>{this.snappingOptions.gridEnabled=e,e&&this._startLoadGrid()},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),h(e.target)};const{snappingOptions:s,view:i,viewModel:n}=e;this.viewModel=n??(this._defaultViewModel=new b({snappingOptions:s,view:i}))}normalizeCtorArgs(e){const{snappingOptions:t,view:s,viewModel:i,...n}=e;return n}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=i(this._defaultViewModel))}loadDependencies(){return Promise.all([p({block:()=>import("../../chunks/index29.js"),button:()=>import("../../chunks/index6.js"),input:()=>import("../../chunks/index10.js"),list:()=>import("../../chunks/index19.js"),"list-item":()=>import("../../chunks/index18.js"),checkbox:()=>import("../../chunks/index21.js"),loader:()=>import("../../chunks/index28.js")}),c()])}initialize(){this.addHandles(n(()=>"2d"===this.view?.type&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=i(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return m("div",{"aria-label":e,class:this.classes(w.base,d.widget)},m("div",{class:w.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),"2d"===this.view?.type&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:s}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&"2d"===s?.type?this._renderGridEnabledToggle():null].filter(t),n=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?m("div",{class:w.nestedContainer},i):null].filter(t);return 0===n.length?null:m("calcite-block",{class:w.toggleBlock,expanded:!0,heading:e.header?this.label:"",key:"toggle-block",label:this.label},n)}_renderEnabledToggle(){return m(g,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return m(g,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return m(g,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return m(g,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,s=t.layerListViewModel.operationalItems.length>9?m("calcite-input",{class:w.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")}}):null,i=this._secondaryElementsDisabled,n=this.layerListOpen&&!i,l=t.layerListViewModel.operationalItems?.find(e=>!!e.children.length);return m("calcite-block",{class:w.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,expanded:n,heading:e.snappingLayers,key:"list-block",onCalciteBlockToggle:e=>this.layerListOpen=e.currentTarget.expanded},s,this._renderToggleLayersButton(),m("calcite-list",{class:w.layerList,displayMode:l?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:s,snappingOptions:i,_openAndReady:n}=this,{gridEnabled:l,enabled:o}=i;(n||"2d"===e?.type&&e.grid)&&this._startLoadGrid();const r=this._gridLoadTask?.value,a=r&&"2d"===e?.type&&m(r,{snappingManager:s,snappingOptions:i,view:e,visibleElements:t.gridControlsElements});return m("calcite-block",{class:w.layerListBlock,collapsible:!0,disabled:!l||!o,expanded:n,heading:this.messages.gridOptionsHeading,key:"grid-block",onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},a??m("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}_startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&"2d"===this.view?.type&&(this._gridLoadTask=s(async()=>(await import("./GridControls.js")).default))}_renderLayerListItemCollection(e){const s=this._layerListFilter;return e.map(e=>{switch(s?y(e,s):null){case"children":{const t=e.children.filter(e=>!1!==y(e,s));return this._renderLayerListItemGroup(e,t)}case"self":case null:return this._renderLayerListItemOrGroup(e);case!1:return"self"===y(e.parent,s)?this._renderLayerListItemOrGroup(e):null}}).toArray().filter(t)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,s=e?t.disableAllLayers:t.enableAllLayers;return m("calcite-button",{appearance:"transparent",class:w.layerListButton,label:s,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},s)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,s=e.title||t,i=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],"enabled"!==e.enabled)};return m("calcite-list-item",{class:w.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:s,onCalciteListItemSelect:e=>{e.stopPropagation(),i()}},m("calcite-checkbox",{checked:"enabled"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:i}))}_renderLayerListItemGroup(e,t){const{messages:s}=this,{children:i,title:n}=e,o=n||s.untitledLayer,r=n&&""!==n?n:l(),a=!!t?.length,p=t??i,d=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,"enabled"!==e.enabled)},c=p?.find(e=>!!e.children.length);return m("calcite-list-item",{class:w.layerListGroup,expanded:a,key:r,label:o,onCalciteListItemSelect:e=>{e.stopPropagation(),d()}},m("calcite-checkbox",{checked:"enabled"===e.enabled,indeterminate:"indeterminate"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:d}),m("calcite-list",{displayMode:c?"nested":"flat",label:s?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(p)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};e([o()],f.prototype,"_defaultViewModel",void 0),e([o()],f.prototype,"_layerListFilter",void 0),e([o()],f.prototype,"_gridLoadTask",void 0),e([o()],f.prototype,"_openAndReady",null),e([o()],f.prototype,"label",null),e([o({type:Boolean,nonNullable:!0})],f.prototype,"layerListOpen",void 0),e([o({type:Boolean,nonNullable:!0})],f.prototype,"gridOptionsOpen",void 0),e([o(),u("esri/widgets/support/SnappingControls/t9n/SnappingControls")],f.prototype,"messages",void 0),e([o(),u("esri/t9n/common")],f.prototype,"messagesCommon",void 0),e([o()],f.prototype,"snappingOptions",null),e([o()],f.prototype,"snappingManager",void 0),e([o()],f.prototype,"view",null),e([o()],f.prototype,"viewModel",null),e([o({type:L,nonNullable:!0})],f.prototype,"visibleElements",void 0),e([o()],f.prototype,"_enabledToggleDisabled",null),e([o()],f.prototype,"_secondaryElementsDisabled",null),f=e([r("esri.widgets.support.SnappingControls")],f);const E=f;export{L as S,E as default};
