/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import{c as t}from"../../../core/Accessor.js";import{EventedAccessor as o}from"../../../core/Evented.js";import{h as s}from"../../../chunks/handleUtils.js";import{L as i}from"../../../chunks/Logger.js";import{r}from"../../../chunks/maybe.js";import{watch as n}from"../../../core/reactiveUtils.js";import{property as c}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/lang.js";import{subclass as a}from"../../../core/accessorSupport/decorators/subclass.js";import{c as p,d as l}from"../../../chunks/layerUtils.js";import{f as u}from"../../../chunks/layerUtils2.js";import{i as m}from"../../../chunks/layerViewUtils.js";import{S as h}from"../../../chunks/SelectionOperation.js";import"../../../core/Handles.js";import"../../../chunks/get.js";import"../../../chunks/utils.js";import"../../../chunks/Lifecycle.js";import"../../../chunks/metadata.js";import"../../../chunks/ObjectPool.js";import"../../../chunks/ObservableBase.js";import"../../../chunks/tracking.js";import"../../../chunks/watch.js";import"../../../core/scheduling.js";import"../../../chunks/nextTick.js";import"../../../chunks/PooledArray.js";import"../../../core/promiseUtils.js";import"../../../core/Error.js";import"../../../chunks/object.js";import"../../../chunks/events.js";import"../../../chunks/SetUtils.js";import"../../../chunks/SimpleTrackingTarget.js";import"../../../config.js";import"../../../chunks/string.js";import"../../../chunks/ensureType.js";import"../../../chunks/MapUtils.js";import"../../../chunks/Warning.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../chunks/jsonUtils.js";import"../../../request.js";import"../../../chunks/persistableUrlUtils.js";import"../../../core/Collection.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../layers/catalog/catalogUtils.js";import"../../../chunks/editableLayers.js";import"../../../chunks/asyncUtils.js";import"../../../chunks/screenUtils.js";import"../../../geometry/Point.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../chunks/reader.js";import"../../../chunks/writer.js";import"../../../geometry/Geometry.js";import"../../../core/JSONSupport.js";import"../../../geometry/SpatialReference.js";import"../../../chunks/unitUtils.js";import"../../../chunks/jsonMap.js";import"../../../chunks/pe.js";import"../../../chunks/assets.js";import"../../../geometry/support/webMercatorUtils.js";import"../../../geometry/Polygon.js";import"../../../geometry/Extent.js";import"../../../chunks/coordsUtils.js";import"../../../chunks/extentUtils.js";import"../../../chunks/boundsUtils.js";import"../../../chunks/aaBoundingRect.js";import"../../../chunks/mathUtils.js";import"../../../chunks/zmUtils.js";import"../../../chunks/keybindings.js";import"../../../chunks/InputManager.js";import"../../../chunks/Queue.js";import"../../../chunks/signal.js";import"../../../chunks/automaticLengthMeasurementUtils.js";import"../../../chunks/vec3f64.js";import"../../../chunks/geodesicLengthMeasurementUtils.js";import"../../../chunks/quantityUtils.js";import"../../../chunks/vec3.js";import"../../../chunks/common.js";import"../../../chunks/projectVectorToVector.js";import"../../../geometry/Multipoint.js";import"../../../geometry/Polyline.js";import"../../../chunks/projectBuffer.js";import"../../../chunks/geodesicConstants.js";import"../../../chunks/projectPointToVector.js";import"../../../chunks/projectionUtils.js";import"../../../chunks/projectXYZToVector.js";import"../../../geometry/support/GeographicTransformation.js";import"../../../geometry/support/GeographicTransformationStep.js";import"../../../chunks/zscale.js";import"../../../chunks/dehydratedPoint.js";import"../../../chunks/spatialReferenceEllipsoidUtils.js";import"../../../geometry/operators/geodeticLengthOperator.js";import"../../../chunks/geodeticCurveType.js";import"../../../geometry/support/geodesicUtils.js";import"../../../chunks/geodesicMeasurementUtils.js";import"../Selector2D/selectorUtils.js";import"../../../layers/support/fieldUtils.js";import"../../../core/sql.js";import"../../../chunks/guards.js";import"../../../chunks/datetime.js";import"../../../chunks/drapedUtils.js";let j=class extends o{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.continuousSelectionEnabled=!1,this.defaultLassoToolOptions={createTool:"polygon",mode:"hybrid",toolName:"lasso"},this.defaultOperationType="add",this.defaultPointToolOptions={createTool:"point",toolName:"point"},this.defaultRectangleToolOptions={createTool:"rectangle",toolName:"rectangle"},this.layerViewPreferenceEnabled=!0,this.persistSelection=!0,this.selectionManager=null,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selectOnComplete=!0,this.sources=null,this.toolConfigs=[]}initialize(){this.addHandles([n(()=>this.effectiveSources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this.activeOperation?.cancel(),this.activeOperation?.destroy(),this._operationHandlesGroup=r(this._operationHandlesGroup)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get effectiveSources(){const{layerViewPreferenceEnabled:e,sources:t,view:o}=this,s=t??this.effectiveSelectionManager?.sources;if(!s?.length)return[];const i=[];return s.forEach(t=>{if(m(t))i.push(t);else if(p(t)||l(t))(t.layers||[]).forEach(t=>{const s=o?u(o,t):void 0,r=e&&m(s)?s:t;i.push(r)});else if(e){const e=o?u(o,t):void 0,s=m(e)?e:t;i.push(s)}else i.push(t)}),i}get layers(){return t(i.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){t(i.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this.effectiveSources.length?"ready":"disabled"}activate(e){const{state:t}=this,o=e?.view||this.view,r=e?.sources||this.effectiveSources;if("disabled"===t||!o)return void i.getLogger(this).warn("Unable to start selection operation.");"active"===t&&this.cancel();const n=new CustomEvent("before-activate",{cancelable:!0,detail:{toolName:e?.toolName??null}});if(this.emit("before-activate",n),n.defaultPrevented)return;const c={type:this.defaultOperationType,persistSelection:this.persistSelection,returnFeatureTitleFields:this.returnFeatureTitleFields,returnGeometry:this.returnGeometry,selectOnComplete:this.selectOnComplete,selectionManager:this.effectiveSelectionManager,...e,sources:r,view:o},a=new h({...c});return this._operationHandlesGroup=s([a.on("selection-change",e=>this.emit("selection-change",e)),a.once("complete",e=>this._onOperationComplete(e,c))]),this._set("activeOperation",a),a}activateTool(e){this.cancel();const t=this._getToolOptions(e);if(t)return this.activate(t);i.getLogger(this).warn("Unable to activate tool: unable to determine options.")}cancel(){this.activeOperation?.cancel(),this._set("activeOperation",null)}toggleTool(e){const{activeOperation:t}=this;if(t){const o=t.toolName;if(this.cancel(),o===e)return}return this.activateTool(e)}_onOperationComplete(e,t){this._operationHandlesGroup=r(this._operationHandlesGroup),this.activeOperation?.destroy(),this._set("activeOperation",null),this.emit("complete",e),this.continuousSelectionEnabled&&!e.aborted&&this.activate(t)}_getToolOptions(e){return this.toolConfigs.find(t=>t.toolName===e)||("lasso"===e?this.defaultLassoToolOptions:"point"===e?this.defaultPointToolOptions:"rectangle"===e?this.defaultRectangleToolOptions:void 0)}};e([c({readOnly:!0})],j.prototype,"activeOperation",void 0),e([c()],j.prototype,"continuousSelectionEnabled",void 0),e([c()],j.prototype,"defaultLassoToolOptions",void 0),e([c()],j.prototype,"defaultOperationType",void 0),e([c()],j.prototype,"defaultPointToolOptions",void 0),e([c()],j.prototype,"defaultRectangleToolOptions",void 0),e([c()],j.prototype,"effectiveSelectionManager",null),e([c()],j.prototype,"effectiveSources",null),e([c()],j.prototype,"layers",null),e([c()],j.prototype,"layerViewPreferenceEnabled",void 0),e([c()],j.prototype,"persistSelection",void 0),e([c()],j.prototype,"selectionManager",void 0),e([c()],j.prototype,"returnFeatureTitleFields",void 0),e([c()],j.prototype,"returnGeometry",void 0),e([c()],j.prototype,"selectOnComplete",void 0),e([c()],j.prototype,"sources",void 0),e([c({readOnly:!0})],j.prototype,"state",null),e([c()],j.prototype,"toolConfigs",void 0),e([c()],j.prototype,"view",void 0),j=e([a("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],j);const d=j;export{d as default};
