/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import t from"../../core/Accessor.js";import{z as s}from"../../core/lang.js";import l from"../../core/Collection.js";import{r as a}from"../../chunks/collectionUtils.js";import{throwIfAborted as r,isAbortError as o}from"../../core/promiseUtils.js";import{property as n}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/Logger.js";import{subclass as i}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/Handles.js";import"../../chunks/maybe.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../core/Error.js";import"../../chunks/object.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/events.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../core/Evented.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/Warning.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/jsonUtils.js";function u(){let e=new AbortController;return async t=>{e.abort(),e=new AbortController;const s={signal:e.signal},l=t.toArray().map(e=>async function(e,t){await e.load(t),await e.loadAll(),r(t),e.summaryStatistics&&await e.summaryStatistics.load(t)}(e,s));await Promise.all(l),r(s)}}function h(e){const t={fieldValueMap:new Map,allowedValues:[]};for(const s of e){const e=s.fieldValueMap,l=t.fieldValueMap;e.forEach((e,s)=>{l.has(s)||(l.set(s,e),t.allowedValues.push(s))})}return t.allowedValues.sort((e,t)=>e-t),t}function d(e,t){return t.allowedValues.length>0?function(e,t){if(0===t.length)return e;if(e===1/0)return t[t.length-1];if(e===-1/0)return t[0];let s=t[0],l=Math.abs(s-e);for(const a of t){const t=Math.abs(a-e);t<l&&(s=a,l=t)}return s}(e,t.allowedValues):null}let c=class extends t{constructor(e){super(e),this.state="disabled",this._valueBeforeReady=null,this._domainInfo=h([]),this._loadLayers=u(),this.layers=new l}initialize(){this.addHandles(this.layers.on("change",()=>this._onLayersChange())),this._onLayersChange()}destroy(){this._set("state","disabled")}get enabled(){return this.allowedValues.length>0&&this._get("enabled")}set enabled(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}get value(){return("ready"===this.state?this._get("value"):this._valueBeforeReady)??0}set value(e){if("ready"!==this.state)return void(this._valueBeforeReady=e);if(e===this.value)return;const t=d(e,this);null!=t&&this._set("value",t)}get min(){return function(e){let t=null;for(const s of e)t=null!=t?Math.min(t,s):s;return t}(this.allowedValues)}get max(){return function(e){let t=null;for(const s of e)t=null!=t?Math.max(t,s):s;return t}(this.allowedValues)}get allowedValues(){return this._domainInfo.allowedValues}set allowedValues(e){null==e?this._clearOverride("allowedValues"):this._override("allowedValues",e);const t=d(this.value,this);null!=t&&(this.value=t)}get hasNext(){if(!this.enabled)return!0;const e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}get hasPrevious(){return!this.enabled||this._valueIndex>0}set layers(e){const t=this._get("layers");this._set("layers",a(e,t))}get filterExpressions(){return{solid:null,xRay:null}}get _valueIndex(){return s(this.allowedValues,this.value)}select(e){"ready"===this.state?null!=d(e,this)&&(this.enabled=!0,this.value=e):this._valueBeforeReady=e}clear(){"ready"===this.state?this.enabled=!1:this._valueBeforeReady=null}next(){const{state:e,allowedValues:t,enabled:s,hasNext:l,_valueIndex:a}=this;if("ready"===e||null==this._valueBeforeReady){if(0!==t.length)return s?void(l&&(this.value=t[a+1])):(this.enabled=!0,void(this.value=t[0]))}else this._valueBeforeReady++}previous(){const{state:e,allowedValues:t,enabled:s,hasPrevious:l,_valueIndex:a}=this;if("ready"===e||null==this._valueBeforeReady){if(0!==t.length)return s?void(l&&(this.value=t[a-1])):(this.enabled=!0,void(this.value=t[t.length-1]))}else this._valueBeforeReady++}getValueLabel(e){return 0===this.layers.length?null:this._domainInfo.fieldValueMap.get(e)??null}async _onLayersChange(){if(this._set("state","loading"),this._domainInfo=h([]),0!==this.layers.length)try{await this._loadLayers(this.layers),this._setup()}catch(e){o(e)||this._set("state","failed")}}};e([n({value:!1,nonNullable:!0})],c.prototype,"enabled",null),e([n({nonNullable:!0})],c.prototype,"value",null),e([n({readOnly:!0})],c.prototype,"min",null),e([n({readOnly:!0})],c.prototype,"max",null),e([n()],c.prototype,"allowedValues",null),e([n({readOnly:!0})],c.prototype,"hasNext",null),e([n({readOnly:!0})],c.prototype,"hasPrevious",null),e([n({type:l,nonNullable:!0})],c.prototype,"layers",null),e([n({nonNullable:!0})],c.prototype,"state",void 0),e([n()],c.prototype,"_valueBeforeReady",void 0),e([n({readOnly:!0})],c.prototype,"_valueIndex",null),e([n()],c.prototype,"_domainInfo",void 0),c=e([i("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],c);const p=c;export{u as c,p as default,h as g};
