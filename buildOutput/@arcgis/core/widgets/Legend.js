/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{on as s,watch as t,initial as i}from"../core/reactiveUtils.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{cast as o}from"../core/accessorSupport/decorators/cast.js";import"../core/lang.js";import{subclass as l}from"../core/accessorSupport/decorators/subclass.js";import n from"./Widget.js";import a from"./Legend/LegendViewModel.js";import"../intl.js";import"../chunks/Logger.js";import p from"../Color.js";import{f as c}from"../chunks/utils8.js";import{r as m}from"../chunks/svgUtils.js";import{s as d}from"../chunks/string.js";import{s as h}from"../chunks/substitute.js";import{f as y}from"../chunks/number.js";import{a as u}from"../chunks/widgetUtils.js";import{t as g}from"../chunks/jsxFactory.js";import{p as f}from"../chunks/screenUtils.js";import{c as v}from"../chunks/projector.js";import{a as b}from"../chunks/guards.js";import{renderColorRampPreviewHTML as j,r as L}from"../symbols/support/symbolUtils.js";import{H as k,i as w}from"../chunks/Heading.js";import{l as _}from"../chunks/componentsUtils.js";import{m as C}from"../chunks/messageBundle.js";import{g as $}from"../chunks/globalCss.js";import"../chunks/events.js";import"../chunks/handleUtils.js";import"../chunks/maybe.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../chunks/object.js";import"../config.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Accessor.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/messages.js";import"../chunks/locale.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../chunks/sanitizerUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/featureReductionUtils.js";import"./Legend/support/ActiveLayerInfo.js";import"../chunks/mathUtils.js";import"../core/sql.js";import"../chunks/EffectView.js";import"../chunks/parser.js";import"../chunks/colorUtils.js";import"../chunks/utils5.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../chunks/jsonUtils2.js";import"../chunks/displayFilterUtils.js";import"../chunks/ExportImageParameters.js";import"../chunks/scaleUtils.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../chunks/floorFilterUtils.js";import"../chunks/sublayerUtils.js";import"../layers/support/fieldUtils.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../chunks/pixelRangeUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/typeUtils3.js";import"../renderers/ClassBreaksRenderer.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../renderers/Renderer.js";import"../core/JSONSupport.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../core/Clonable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../chunks/opacityUtils.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../chunks/RendererLegendOptions.js";import"../renderers/DictionaryRenderer.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/DictionaryScriptEvaluator.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../chunks/UnknownTimeZone.js";import"../chunks/timeZoneUtils.js";import"../chunks/ArcadeExpression.js";import"../chunks/TimeOnly.js";import"../chunks/enum.js";import"../chunks/utils6.js";import"../chunks/defaultCIMValues.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../chunks/rendererConversion.js";import"../chunks/referenceSizeUtils.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/renderUtils.js";import"../chunks/colorUtils2.js";import"../chunks/colorRampUtils2.js";import"../chunks/utils17.js";import"../chunks/timeUtils.js";import"../chunks/numberUtils.js";import"../chunks/utils7.js";import"../chunks/basemapUtils.js";import"../chunks/basemapDefinitions.js";import"../renderers/support/utils.js";import"../chunks/asyncUtils.js";import"../chunks/gfxUtils.js";import"../chunks/sizeRampUtils.js";import"../smartMapping/renderers/support/spikeUtils.js";import"../chunks/previewCIMSymbol.js";import"../chunks/CIMSymbolHelper.js";import"../chunks/BidiEngine.js";import"../chunks/labelPoint.js";import"../chunks/OptimizedGeometry.js";import"../chunks/memoryEstimations.js";import"../chunks/GeometryUtils.js";import"../chunks/fontUtils.js";import"../chunks/rasterizingUtils.js";import"../chunks/floatRGBA.js";import"../chunks/definitions.js";import"../chunks/shapingUtils.js";import"../chunks/mat2d.js";import"../chunks/mat2df32.js";import"../chunks/vec2.js";import"../chunks/vec2f32.js";import"../chunks/Rect.js";import"../chunks/BoundingBox.js";import"../chunks/CIMSymbolRasterizer.js";import"../chunks/CIMResourceManager.js";import"../chunks/imageUtils.js";import"../chunks/OverrideHelper.js";import"../chunks/callExpressionWithFeature.js";import"../chunks/quantizationUtils.js";import"../chunks/modeUtils.js";import"./smartMapping/support/utils.js";import"../chunks/webStyleSymbolUtils.js";import"../chunks/devEnvironmentUtils.js";const R="esri-legend--card",E="esri-legend",I={base:R,stacked:`${E}--stacked`,carouselTitle:`${R}__carousel-title`,intervalSeparator:`${R}__interval-separator`,imageryLayerStretchedImage:`${R}__imagery-layer-image--stretched`,imageLabel:`${R}__image-label`,layerCaption:`${R}__layer-caption`,labelElement:`${R}__label-element`,layerRow:`${R}__layer-row`,labelCell:`${R}__label-cell`,message:`${R}__message`,rampLabel:`${R}__ramp-label`,section:`${R}__section`,serviceCaptionText:`${R}__service-caption-text`,serviceContent:`${R}__service-content`,service:`${R}__service`,groupLayer:`${R}__group-layer`,groupLayerChild:`${R}__group-layer-child`,symbol:`${R}__symbol`,sizeRampRow:`${R}__size-ramp-row`,symbolRow:`${R}__symbol-row`,symbolCell:`${R}__symbol-cell`,carousel:`${R}__carousel`,carouselItem:`${R}__carousel-item`,intervalSeparatorsContainer:`${R}__interval-separators-container`,relationshipLabelContainer:`${R}__relationship-label-container`,labelContainer:`${R}__label-container`,serviceCaptionContainer:`${R}__service-caption-container`,symbolContainer:`${R}__symbol-container`,colorRampContainer:`${R}__color-ramp-container`,sizeRampContainer:`${R}__size-ramp-container`,sizeRampPreview:`${R}__size-ramp-preview`,pieChartRampPreview:`${R}__pie-chart-ramp-preview`,sizeRampHorizontal:`${E}__size-ramp--horizontal`,rampLabelsContainer:`${E}__ramp-labels`,layerInfo:`${E}__layer-cell ${E}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};function x(e){e.appendChild(this)}function S(e,s,t){if(!s)return;if("number"==typeof s)return s;if("string"==typeof s)return d(s);if("value"in s||"unit"in s)return h(e.dotValue,s);if("colorName"in s&&"bandName"in s)return e[s.colorName]+": "+(e[s.bandName]||s.bandName);if("showCount"in s)return s.showCount?e.clusterCountTitle:void 0;let i=null;return function(e,s){return s}(0,t)?i=s.ratioPercentTotal?"showRatioPercentTotal":s.ratioPercent?"showRatioPercent":s.ratio?"showRatio":s.normField?"showNormField":s.field?"showField":null:z(0,t)&&(i=s.normField?"showNormField":s.normByPct?"showNormPct":s.field?"showField":null),i?h("showField"===i?"{field}":e[i],{field:s.field,normField:s.normField}):void 0}function z(e,s){return!s}function U(e,s){return!!(s&&"Stretched"===s&&"version"in e&&"number"==typeof e.version&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}function M(e,s,t){switch(s){case"heatmap-ramp":return t[e.label]||e.label;case"stretch-ramp":return function(e,s){return e.label?s[e.label]+": "+("string"==typeof e.value?e.value:y(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""}(e,t);default:return e.label}}function A(e,s){if(!e.title||"string"==typeof e.title)return e.title;const t="color-ramp"===e.type||"opacity-ramp"===e.type,i=e.title,r=S(s,i,t);return z(0,t)&&i.title?`${i.title} (${r})`:r}function V(e){return!(!e||"object"!=typeof e)}let P=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const e=this.legendElement.infos.slice().reverse();return g("div",{class:this.classes(I.layerRow,I.colorRampContainer)},this._renderRampLabel(e[0]),g("div",{class:I.symbolContainer},this._renderPreview(e),this._renderMiddleStopRampLabel(e)),this._renderRampLabel(e.at(-1)))}_renderPreview(e){const{opacity:s}=this,t="heatmap-ramp"===this.legendElement.type,i=e.length-1,r=i>2&&!t?25*i:100,o=r+20,l=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:e[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:r,height:25},fill:{type:"linear",x1:10,y1:0,x2:r+10,y2:0,colors:e.map((e,s)=>({color:e.color,offset:t&&"ratio"in e?e.ratio:s/i}))},stroke:{width:0}},{shape:{type:"path",path:`M${r+10} 0 L${o} 12.5 L${r+10} 25 Z`},fill:e[e.length-1].color,stroke:{width:0}}]],n=m(l,o,25),a={filter:c(this.effectList)??void 0,opacity:null==s?void 0:`${s}`};return g("div",{styles:a},n)}_renderMiddleStopRampLabel(e){const s=e.length%2!=0?e[e.length/2|0]:null;return s?g("div",{class:I.intervalSeparatorsContainer},g("div",{class:I.intervalSeparator},"|"),this._renderRampLabel(s)):null}_renderRampLabel(e){return g("div",{class:I.rampLabel},M(e,this.legendElement.type,this.messages))}};e([r()],P.prototype,"effectList",void 0),e([r()],P.prototype,"legendElement",void 0),e([r()],P.prototype,"messages",void 0),e([r()],P.prototype,"opacity",void 0),P=e([l("esri.widgets.Legend.styles.card.ColorRamp")],P);const T=window.devicePixelRatio,D="esri-spike-ramp",B={spikeRampContainer:`${D}__container`,spikeRampPreviewContainer:`${D}__preview-container`,spikeRampPreview:`${D}__preview`,spikeRampSymbolPreview:`${D}__symbol-preview`,spikeRampLines:`${D}__lines`,spikeRampLabelsContainer:`${D}__labels-container`,spikeRampLabel:`${D}__label`};function F(e){return 5!==e.infos.length?null:g("div",{class:B.spikeRampContainer},g("div",{class:B.spikeRampPreviewContainer},function(e){const[s,t,i]=O(e).map(({preview:e})=>{if(!e)return null;const s=e.cloneNode(!0);return s.classList.add(B.spikeRampSymbolPreview),s});return s&&t&&i?g("div",{class:B.spikeRampPreview},g("div",{afterCreate:x,bind:i}),g("div",{afterCreate:x,bind:t}),g("div",{afterCreate:x,bind:s})):null}(e),function(e){const[{width:s,height:t},{width:i},{width:r,height:o}]=O(e).map(({size:e})=>V(e)?{width:f(e.width),height:f(e.height)}:{width:0,height:0}),l=s+i+r+30,n=t,a=document.createElement("canvas");a.width=(l+10)*T,a.height=n*T,a.style.width=a.width/T+"px",a.style.height=a.height/T+"px";const p=a.getContext("2d");p.beginPath();const c=l-(s/2+10),m=l+8;p.moveTo(c*T,0*T),p.lineTo(m*T,0*T);const d=(l-8)/2,h=(t-o)/2,y=l+8,u=(t-o)/2;p.moveTo(d*T,h*T),p.lineTo(y*T,u*T);const v=r/2,b=n-o,j=l+8,L=n-o;return p.moveTo(v*T,b*T),p.lineTo(j*T,L*T),p.strokeStyle="#ddd",p.lineWidth=.5*T,p.stroke(),g("div",{afterCreate:x,bind:a,class:B.spikeRampLines})}(e)),function(e){const[{label:s,height:t},{label:i},{label:r,height:o}]=O(e).map(({label:e,size:s})=>({label:e,height:V(s)?f(s.height):0})),l=t-o,n={position:"absolute",top:l/2+"px"},a={position:"absolute",top:`${l}px`};return g("div",{class:B.spikeRampLabelsContainer},g("div",{class:B.spikeRampLabel,styles:{position:"absolute",top:"0"}},s),g("div",{class:B.spikeRampLabel,styles:n},i),g("div",{class:B.spikeRampLabel,styles:a},r))}(e))}function O(e){return e.infos.filter((e,s)=>s%2==0)}const N=window.devicePixelRatio;let H=class extends n{constructor(e,s){super(e,s),this.hasIndicators=!1,this.legendElement=null,this.opacity=1}render(){if("spike"===this.legendElement.theme)return g("div",{styles:{display:"flex",flex:"1",justifyContent:"center"}},F(this.legendElement));const{legendElement:e,hasIndicators:s,opacity:t}=this,i=e.infos,r=i.at(0),o=i.at(-1);if(!r||!o)return null;const{label:l,...n}=r,{label:a,...p}=o;let c=n.preview,m=p.preview;const d={"flex-direction":s?"column":"row-reverse"};if(!c||!m)return null;c=c.cloneNode(!0),c.style.display="flex",m=m.cloneNode(!0),m.style.display="flex";const h={opacity:`${t??""}`};return g("div",{class:this.classes(I.layerRow,{[I.sizeRampRow]:s})},g("div",{class:I.rampLabel},s?l:a),g("div",{class:I.sizeRampContainer,styles:d},g("div",{afterCreate:x,bind:c,class:I.sizeRampPreview,styles:h}),this._renderSizeRampLines(e),g("div",{afterCreate:x,bind:m,class:I.sizeRampPreview,styles:h})),g("div",{class:I.rampLabel},s?a:l))}_renderSizeRampLines(e){const s=e.infos,t=s.at(0),i=s.at(-1);if(!t||!i)return null;const r=t.symbol,o=this.hasIndicators,l=t.size&&"number"==typeof t.size?t.size:0,n=i.size&&"number"==typeof i.size?i.size:0,a=t.outlineSize||0,p=i.outlineSize||0,c=f(l+a)*N,m=f(n+p)*N,d=o?c:c+50*N,h=o?c/2+50*N:c,y=function(e){if(e){if(e.type.includes("3d")){if(!e.symbolLayers?.length)return;const s=e.symbolLayers.at(-1),t=s?.resource?.primitive;return"triangle"===t||"cone"===t||"tetrahedron"===t}return"triangle"===e.style}}(r),u=function(e){if(!e)return;if(e.type.includes("3d")){if(!e.symbolLayers?.length)return;const s=e.symbolLayers.at(-1),t=s.resource?.primitive;return"circle"===t||"cross"===t||"kite"===t||"sphere"===t||"cube"===t||"diamond"===t}const s=e.style;return"circle"===s||"diamond"===s||"cross"===s}(r),v=document.createElement("canvas");v.width=d,v.height=h,v.style.width=v.width/N+"px",v.style.height=v.height/N+"px";const b=v.getContext("2d");if(o){b.beginPath();const e=0,s=0,t=d/2-m/2,i=h;b.moveTo(e,s),b.lineTo(t,i);const r=d,o=0,l=d/2+m/2,n=h;b.moveTo(r,o),b.lineTo(l,n)}else{b.beginPath();const e=0,s=h/2-m/2,t=d,i=0;b.moveTo(e,s),b.lineTo(t,i);const r=0,o=h/2+m/2,l=d,n=h;b.moveTo(r,o),b.lineTo(l,n)}return b.strokeStyle="#ddd",b.stroke(),g("div",{afterCreate:x,bind:v,styles:o?{display:"flex",marginTop:`-${y?0:u?c/2:0}px`,marginBottom:`-${y?m:u?m/2:0}px`}:{display:"flex",marginRight:`-${y?0:u?c/2:0}px`,marginLeft:`-${y?0:u?m/2:0}px`}})}};e([r()],H.prototype,"hasIndicators",void 0),e([r()],H.prototype,"legendElement",void 0),e([r()],H.prototype,"messages",void 0),e([r()],H.prototype,"opacity",void 0),H=e([l("esri.widgets.Legend.styles.card.SizeRamp")],H);const q=v(),W="esri-univariate-above-and-below-ramp__symbol";function G(e="vertical"){const s="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?g("svg",{height:"4",width:"10"},g("line",{style:s,x1:"0",x2:"10",y1:"2",y2:"2"})):g("svg",{height:"10",width:"10"},g("line",{style:s,x1:"5",x2:"5",y1:"0",y2:"10"}))}function Z(e,s="vertical"){const t=document.createElement("div");return t.style.height="20px",t.className=W,null!=e&&(t.style.opacity=e.toString()),q.append(t,G.bind(null,s)),t}function J(e,s,t="vertical",i){e.infos.forEach((e,r)=>{if(i&&2===r)e.preview=Z(s,t);else{const s=(b(e.size)?f(e.size):0)+("horizontal"===t?20:10),i=e.preview,r="div"===i?.tagName.toLowerCase(),o=r?i:document.createElement("div");o.className=W,"horizontal"===t?o.style.width=`${s}px`:o.style.height=`${s}px`,!r&&i&&o.appendChild(i),e.preview=o}})}function Q(e,s="classic"){const t=e.infos,i=t.at(0),r=t.at(-1),o=b(i.size)?f(i.size):0,l=b(r.size)?f(r.size):0;return"classic"===s?(o+10)/2:(o-l)/2}function K(e,s){if(!e)return null;const t=e.infos.map(e=>e.color),i=j("full"===s.type?t:"above"===s.type?t.slice(0,3):t.slice(2,5),{width:s.width,height:s.height,align:s.rampAlignment,effectList:s.effectList,ariaLabel:s.ariaLabel});return i.className="esri-legend__color-ramp",null!=s.opacity&&(i.style.opacity=s.opacity.toString()),i}function X(e,s,t,i="vertical"){let r=0;const o=e.infos,l=Math.floor(o.length/2),n="full"===s||"above"===s?0:l,a="full"===s||"below"===s?o.length-1:l;for(let e=n;e<=a;e++)if(t&&e===l)r+="horizontal"===i?10:20;else{const s=o[e].size;r+=(b(s)?f(s):0)+("horizontal"===i?20:10)}return Math.round(r)}function Y(e,s,t,i="vertical"){const r=X(e,s,t,i),o=e.infos,l=Math.floor(o.length/2),n="full"===s||"above"===s?0:l,a="full"===s||"below"===s?o.length-1:l,p=b(o[n].size)?o[n].size:0,c=b(o[a].size)?o[a].size:0,m="full"===s?p+c:"above"===s?p:c,d=t?"vertical"===i?20:10:0,h="vertical"===i?10*("full"===s?2:1):20*("full"===s?2:1);return Math.round(r-(f(m)/2+d/2+h/2))}function ee(e,s,t="vertical"){const i=e.infos;let r=i.find(({type:e})=>"size-ramp"===e),o=i.find(({type:e})=>"color-ramp"===e);return r&&(r={...r},r.infos=[...r.infos],J(r,s,t,!0)),o&&(o={...o},o.infos=[...o.infos]),"horizontal"===t&&(r?.infos.reverse(),o?.infos.reverse()),{sizeRampElement:r,colorRampElement:o}}function se(e,s="vertical"){const t=e.infos;let i=t.find(({type:e})=>"size-ramp"===e),r=t.find(({type:e})=>"color-ramp"===e);return i&&(i={...i},i.infos=[...i.infos],J(i,null,s,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===s&&(i?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:i,colorRampElement:r}}const te={marginLeft:"3px"},ie={display:"table-cell",verticalAlign:"middle"},re={display:"flex",alignItems:"flex-start"};let oe=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:s,effectList:t,key:i}=this,{sizeRampElement:r,colorRampElement:o}=ee(e,s,"horizontal");if(!r)return null;const l=X(r,"full",!0,"horizontal"),n=Y(r,"above",!0,"horizontal"),a=Y(r,"below",!0,"horizontal"),p=this.messages?.previewColorRampAriaLabel,c=K(o,{width:n,height:12,rampAlignment:"horizontal",opacity:s,type:"above",effectList:t,ariaLabel:p}),m=K(o,{width:a,height:12,rampAlignment:"horizontal",opacity:s,type:"below",effectList:t,ariaLabel:p}),d=Q(r,"card"),h=r.infos.map(e=>e.label),y=h.length-1,f=h.map((e,s)=>0===s||s===y?g("div",{key:s},e):null),v={marginTop:"3px",display:"flex"};u(this.container)?v.marginRight=`${d}px`:v.marginLeft=`${d}px`;const b={width:`${l}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return g("div",{class:I.layerRow,key:`${i}-container`,styles:{display:"flex",flexDirection:"column"}},g("div",{class:this.classes(I.symbolContainer,I.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},r.infos.map((e,s)=>g("div",{afterCreate:x,bind:e.preview,class:I.symbol,key:s}))),c?g("div",{class:I.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:v},g("div",{afterCreate:x,bind:c}),g("div",{afterCreate:x,bind:m})):null,g("div",{class:I.layerInfo},g("div",{class:I.rampLabelsContainer,styles:b},f)))}};e([r()],oe.prototype,"effectList",void 0),e([r()],oe.prototype,"legendElement",void 0),e([r()],oe.prototype,"messages",void 0),e([r()],oe.prototype,"opacity",void 0),oe=e([l("esri.widgets.Legend.styles.card.UnivariateAboveAndBelowRamp")],oe);let le=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:s,effectList:t,key:i}=this,{sizeRampElement:r,colorRampElement:o}=se(e,"horizontal");if(!r)return null;const l=X(r,"full",!1,"horizontal"),n=K(o,{width:Y(r,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:s,type:"full",effectList:t,ariaLabel:this.messages?.previewColorRampAriaLabel}),a=Q(r,"card"),p=r.infos.length-1,c=r.infos.map((e,s)=>0===s||s===p?g("div",{key:s},e.label):null),m={marginTop:"3px",display:"flex"};u(this.container)?m.marginRight=`${a}px`:m.marginLeft=`${a}px`;const d={width:`${l}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return g("div",{class:I.layerRow,key:`${i}-container`,styles:{display:"flex",flexDirection:"column"}},g("div",{class:this.classes(I.symbolContainer,I.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},r.infos.map((e,s)=>g("div",{afterCreate:x,bind:e.preview,class:I.symbol,key:s}))),g("div",{class:I.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:m},g("div",{afterCreate:x,bind:n})),g("div",{class:I.layerInfo},g("div",{class:I.rampLabelsContainer,styles:d},c)))}};var ne;e([r()],le.prototype,"effectList",void 0),e([r()],le.prototype,"legendElement",void 0),e([r()],le.prototype,"messages",void 0),e([r()],le.prototype,"opacity",void 0),le=e([l("esri.widgets.Legend.styles.card.UnivariateColorSizeRamp")],le);let ae=ne=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.hasIndicators=!1,this.headingLevel=3,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),s=A(this.legendElement,this.messages),t=this.hasIndicators&&!this.isChild?g("div",null,g(k,{class:I.carouselTitle,level:this.headingLevel},this.activeLayerInfo.title),g(k,{class:I.layerCaption,level:w(this.headingLevel)},s)):s?g(k,{class:I.layerCaption,level:this.headingLevel},s):null;return g("section",{"aria-labelledby":this.key,class:I.section,id:`${this.key}-panel`,key:this.key,role:"tabpanel",tabIndex:0},t,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return g(H,{hasIndicators:this.hasIndicators,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return g(P,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return L(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return g("div",{afterCreate:x,bind:this.legendElement.preview,class:I.pieChartRampPreview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return g(oe,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return g(le,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const s=e.infos.map(s=>this._renderElementInfo(s,e.legendType)).filter(Boolean);if(!s.length)return null;const t=this.activeLayerInfo.legendElements.some(({type:e})=>"relationship-ramp"===e),i=s[0]?.properties?.classes?.[I.symbolRow],r={[I.labelContainer]:!i&&!t,[I.relationshipLabelContainer]:t};return g("div",{class:this.classes(r)},s)}_renderElementInfo(e,s){const{layer:t}=this,i="label"in e?e.label:null,r=`${this.key}-${i}`;if("type"in e&&e.type)return g(ne,{activeLayerInfo:this.activeLayerInfo,effectList:this.effectList,hasIndicators:this.hasIndicators,headingLevel:this.headingLevel,isChild:!0,key:r,layer:t,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const o=U(t,s),l=S(this.messages,i,!1)||"";if("src"in e&&e.src)return g("div",{class:I.layerRow,key:`${r}-row`},this._renderImage(e,t,o),g("div",{class:I.imageLabel},l));if("symbol"in e&&e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return g("div",{afterCreate:x,bind:e.preview,key:`${r}-row`});const s={[I.symbolCell]:this.hasIndicators};return g("div",{class:this.classes(I.layerRow,{[I.symbolRow]:this.hasIndicators}),key:`${r}-row`},g("div",{afterCreate:x,bind:e.preview,class:this.classes(s)}),g("div",{class:this.classes(I.imageLabel,{[I.labelCell]:this.hasIndicators})},l))}return g("div",{class:I.layerRow,key:`${r}-row`},g("div",{class:I.labelElement,styles:this._getBackgroundStyles(e)},l))}return null}_getBackgroundStyles(e){const s=e.symbol,t=s.color,i=!!t?.a,r="outline"in s?s.outline:null,o=!!r?.color?.a,l=new p(i&&t?[t.r,t.g,t.b,t.a*this.layer.opacity]:[255,255,255,0]),n=o&&r.color?new p([r.color.r,r.color.g,r.color.b,r.color.a*this.layer.opacity]):new p([255,255,255,0]),a=e.symbol.color?.isBright??!0,m=a?"black":"white",d=a?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return{background:i?l.toCss(!0):"none",color:m,textShadow:`-1px -1px 0 ${d},\n                  1px -1px 0 ${d},\n                  -1px 1px 0 ${d},\n                  1px 1px 0 ${d}`,border:o?`1px solid ${n.toCss(!0)}`:"none",filter:c(this.effectList)??void 0}}_renderImage(e,s,t){const{label:i,src:r,opacity:o}=e,l={[I.imageryLayerStretchedImage]:t,[I.symbol]:!t},n={opacity:`${o??s.opacity}`},a=S(this.messages,i,!1);return g("img",{alt:a,"aria-label":a,border:0,class:this.classes(l),height:e.height,src:r,styles:n,width:e.width})}};e([r()],ae.prototype,"activeLayerInfo",void 0),e([r()],ae.prototype,"effectList",void 0),e([r()],ae.prototype,"hasIndicators",void 0),e([r()],ae.prototype,"headingLevel",void 0),e([r()],ae.prototype,"isChild",void 0),e([r()],ae.prototype,"layer",void 0),e([r()],ae.prototype,"legendElement",void 0),e([r()],ae.prototype,"messages",void 0),ae=ne=e([l("esri.widgets.Legend.styles.card.LegendElement")],ae);let pe=class extends n{constructor(e,s){super(e,s),this._hasIndicators=!1,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}loadDependencies(){return _({carousel:()=>import("../chunks/index66.js"),"carousel-item":()=>import("../chunks/index67.js")})}render(){this._hasIndicators="auto"===this.layout&&this.view&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this._hasIndicators?this._renderCarousel():this._renderLayers(),s={[I.stacked]:this._hasIndicators};return g("div",{class:this.classes(I.base,s)},e||g("div",{class:I.message},this.messages.noLegend))}_renderCarousel(){const e=[],s=this.activeLayerInfos;if(s)for(const t of s)this._renderSections(t,e);return e?.length?g("calcite-carousel",{class:I.carousel,label:this.messages.carousel},e.map((s,t)=>g("calcite-carousel-item",{class:I.carouselItem,key:t,label:h(this.messagesCommon.pagination.pageText,{index:t+1,total:e.length})},s))):null}_renderLayers(){const e=this.activeLayerInfos,s=e?.toArray()?.map(e=>this._renderLegendForLayer(e)).filter(Boolean);return s?.length?s:null}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const s=e.children.toArray().map(this._renderLegendForLayer,this);return g("section",{class:this.classes(I.service,I.groupLayer),key:e.layer.uid},g("div",{class:I.serviceCaptionContainer},e.title),s)}return this._renderLegendElementsForLayer(e)}_renderLegendElementsForLayer(e){const s=e.legendElements?.filter(Boolean);if(!s?.length)return null;const t=s.map(s=>g(ae,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${s.type}`,layer:e.layer,legendElement:s,messages:this.messages})),i={[I.groupLayerChild]:!!e.parent};return g("section",{class:this.classes(I.service,i),key:e.layer.uid},g("div",{class:I.serviceCaptionContainer},g("div",{class:I.serviceCaptionText},e.title)),g("div",{class:I.serviceContent},t))}_renderSections(e,s){if(!e.ready)return;if(e.children.length)for(const t of e.children)this._renderSections(t,s);const t=e.legendElements;if(t?.length)for(const i of t){const t=g(ae,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${i.type}`,layer:e.layer,legendElement:i,messages:this.messages});t&&s.push(t)}}};e([r()],pe.prototype,"activeLayerInfos",void 0),e([r()],pe.prototype,"headingLevel",void 0),e([r()],pe.prototype,"layout",void 0),e([r(),C("esri/widgets/Legend/t9n/Legend")],pe.prototype,"messages",void 0),e([r(),C("esri/t9n/common")],pe.prototype,"messagesCommon",void 0),e([r({readOnly:!0})],pe.prototype,"type",void 0),e([r()],pe.prototype,"view",void 0),pe=e([l("esri.widgets.Legend.styles.card.CardView")],pe);const ce="esri-legend",me={service:`${ce}__service`,label:`${ce}__service-label`,layer:`${ce}__layer`,groupLayer:`${ce}__group-layer`,groupLayerChild:`${ce}__group-layer-child`,layerTable:`${ce}__layer-table`,layerTableSizeRamp:`${ce}__layer-table--size-ramp`,layerChildTable:`${ce}__layer-child-table`,layerCaption:`${ce}__layer-caption`,layerBody:`${ce}__layer-body`,layerRow:`${ce}__layer-row`,layerInfo:`${ce}__layer-cell ${ce}__layer-cell--info`,imageryLayerStretchedImage:`${ce}__imagery-layer-image--stretched`,imageryLayerInfoStretched:`${ce}__imagery-layer-info--stretched`,symbolContainer:`${ce}__layer-cell ${ce}__layer-cell--symbols`,symbol:`${ce}__symbol`,rampContainer:`${ce}__ramps`,sizeRamp:`${ce}__size-ramp`,colorRamp:`${ce}__color-ramp`,opacityRamp:`${ce}__opacity-ramp`,rampLabelsContainer:`${ce}__ramp-labels`,rampLabel:`${ce}__ramp-label`,message:`${ce}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};let de=class extends n{constructor(e,s){super(e,s),this.legendElement=null,this.opacity=1}get _preview(){const e=this.legendElement.preview;if(!e)return null;const s="opacity-ramp"===this.legendElement.type?me.opacityRamp:"";return e.className=`${me.colorRamp} ${s}`,null!=this.opacity&&(e.style.opacity=this.opacity.toString()),e}render(){const{legendElement:e,_preview:s}=this;if(!s)return null;const t={height:s.style.height};return g("div",{class:me.layerRow,key:`${this.key}-row`},g("div",{class:me.symbolContainer,styles:{width:"24px"}},g("div",{afterCreate:x,bind:s,class:me.rampContainer})),g("div",{class:me.layerInfo},g("div",{class:me.rampLabelsContainer,styles:t},e.infos.map((s,t)=>this._renderRampLabel(s,t,e.type)))))}_renderRampLabel(e,s,t){return g("div",{class:e.label?me.rampLabel:void 0,key:`${this.key}-stop-${e.label??s}-label`},M(e,t,this.messages))}};e([r()],de.prototype,"_preview",null),e([r()],de.prototype,"legendElement",void 0),e([r()],de.prototype,"messages",void 0),e([r()],de.prototype,"opacity",void 0),de=e([l("esri.widgets.Legend.styles.classic.ColorRamp")],de);let he=class extends n{constructor(e,s){super(e,s),this.legendElement=null}render(){const e=this.legendElement.infos.map(e=>this._renderRow(e)).filter(Boolean);return e.length?"spike"===this.legendElement.theme?F(this.legendElement):g("div",{class:me.layerBody},e):null}_renderRow(e){return e.preview?g("div",{class:me.layerRow,key:`${this.key}-${e.label}-row`},g("div",{class:this.classes(me.symbolContainer,me.sizeRamp)},g("div",{afterCreate:x,bind:e.preview,class:me.symbol})),g("div",{class:me.layerInfo},S(this.messages,e.label,!1)||"")):null}};e([r()],he.prototype,"legendElement",void 0),e([r()],he.prototype,"messages",void 0),he=e([l("esri.widgets.Legend.styles.classic.SizeRamp")],he);let ye=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:s,effectList:t,key:i}=this,{sizeRampElement:r,colorRampElement:o}=ee(e,s);if(!r)return null;const l=this.messages.previewColorRampAriaLabel,n=Y(r,"above",!0),a=Y(r,"below",!0),p=K(o,{width:12,height:n,rampAlignment:"vertical",opacity:s,type:"above",effectList:t,ariaLabel:l}),c=K(o,{width:12,height:a,rampAlignment:"vertical",opacity:s,type:"below",effectList:t,ariaLabel:l}),m=Q(r),d=r.infos.map(e=>e.label),h=d.map((e,s)=>{const t=2===s;return 0===s?g("div",{class:e?p?me.univariateAboveAndBelowLabel:me.rampLabel:void 0,key:`${i}-color-ramp-above-label-${e??s}`},e):t?g("div",null):null}),y=d.length-1,u=Math.floor(d.length/2),f=d.map((e,s)=>s===u||s===y?g("div",{class:e?p?me.univariateAboveAndBelowLabel:me.rampLabel:void 0,key:`${i}-color-ramp-below-label-${e??s}`},e):null),v={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${m}px`},j={height:`${n}px`},L={height:`${a}px`};return g("div",{key:`${i}-container`,styles:re},g("div",{class:me.layerBody},r.infos.map((e,s)=>g("div",{class:this.classes(me.layerRow,me.sizeRamp),key:`${i}-row-${s}`},g("div",{afterCreate:x,bind:e.preview,class:me.symbol,styles:v}),p||s%2!=0?null:g("div",{class:me.layerInfo},d[s])))),p?g("div",{styles:b},g("div",{styles:te},g("div",{styles:ie},g("div",{afterCreate:x,bind:p,class:me.rampContainer})),g("div",{styles:ie},g("div",{class:me.rampLabelsContainer,styles:j},h))),g("div",{styles:te},g("div",{styles:ie},g("div",{afterCreate:x,bind:c,class:me.rampContainer})),g("div",{styles:ie},g("div",{class:me.rampLabelsContainer,styles:L},f)))):null)}};e([r()],ye.prototype,"effectList",void 0),e([r()],ye.prototype,"legendElement",void 0),e([r()],ye.prototype,"messages",void 0),e([r()],ye.prototype,"opacity",void 0),ye=e([l("esri.widgets.Legend.styles.classic.UnivariateAboveAndBelowRamp")],ye);let ue=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:s,effectList:t,key:i}=this,{sizeRampElement:r,colorRampElement:o}=se(e);if(!r)return null;const l=Q(r),n=Y(r,"full",!1),a=K(o,{width:12,height:n,rampAlignment:"vertical",opacity:s,type:"full",effectList:t,ariaLabel:this.messages?.previewColorRampAriaLabel}),p=r.infos.length-1,c=r.infos.map((e,s)=>0===s||s===p?g("div",{class:e.label?o?me.univariateAboveAndBelowLabel:me.rampLabel:void 0,key:`${i}-color-ramp-label-${e.label??s}`},e.label):null),m={display:"table-cell",verticalAlign:"middle"},d={marginTop:`${l}px`},h={height:`${n}px`};return g("div",{key:`${i}-container`,styles:re},g("div",{class:me.layerBody},r.infos.map((e,s)=>g("div",{class:this.classes(me.layerRow,me.sizeRamp),key:`${i}-row-${s}`},g("div",{afterCreate:x,bind:e.preview,class:me.symbol,styles:m})))),g("div",{styles:d},g("div",{styles:te},g("div",{styles:ie},g("div",{afterCreate:x,bind:a,class:me.rampContainer})),g("div",{styles:ie},g("div",{class:me.rampLabelsContainer,styles:h},c)))))}};var ge;e([r()],ue.prototype,"effectList",void 0),e([r()],ue.prototype,"legendElement",void 0),e([r()],ue.prototype,"messages",void 0),e([r()],ue.prototype,"opacity",void 0),ue=e([l("esri.widgets.Legend.styles.classic.UnivariateColorSizeRamp")],ue);let fe=ge=class extends n{constructor(e,s){super(e,s),this.effectList=null,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),s=A(this.legendElement,this.messages),t=this.isChild?me.layerChildTable:me.layerTable,i=s?g("div",{class:me.layerCaption},s):null,r={[me.layerTableSizeRamp]:"size-ramp"===this.legendElement.type||!this.isChild};return g("section",{class:this.classes(t,r),key:`${this.key}-table`},i,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return g(he,{key:this.key,legendElement:this.legendElement,messages:this.messages});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return g(de,{key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return L(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return g("div",{afterCreate:x,bind:this.legendElement.preview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return g(ye,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return g(ue,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const s=e.infos.map(s=>this._renderElementInfo(s,e.legendType)).filter(Boolean);return s.length?g("div",{class:me.layerBody},s):null}_renderElementInfo(e,s){const{layer:t}=this,i="label"in e?e.label:null,r=`${this.key}-${i}`;if("type"in e&&e.type)return g(ge,{effectList:this.effectList,isChild:!0,key:r,layer:t,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const o=U(t,s),l={[me.imageryLayerInfoStretched]:o},n={[me.imageryLayerInfoStretched]:o};return g("div",{class:me.layerRow,key:`${r}-row`},g("div",{class:this.classes(me.symbolContainer,n)},this._renderPreview(e,o)),g("div",{class:this.classes(me.layerInfo,l)},S(this.messages,i,!1)||""))}_renderPreview(e,s){const{layer:t}=this;return"preview"in e&&e.preview?g("div",{afterCreate:x,bind:e.preview,class:me.symbol}):"src"in e&&e.src?this._renderImage(e,t,s):null}_renderImage(e,s,t){const{label:i,src:r,opacity:o}=e,l={[me.imageryLayerStretchedImage]:t,[me.symbol]:!t},n={opacity:`${o??s.opacity}`},a=S(this.messages,i,!1);return g("img",{alt:a,"aria-label":a,border:0,class:this.classes(l),height:e.height,src:r,styles:n,width:e.width})}};e([r()],fe.prototype,"effectList",void 0),e([r()],fe.prototype,"isChild",void 0),e([r()],fe.prototype,"layer",void 0),e([r()],fe.prototype,"legendElement",void 0),e([r()],fe.prototype,"messages",void 0),fe=ge=e([l("esri.widgets.Legend.styles.classic.LegendElement")],fe);const ve=`${ce}__`;let be=class extends n{constructor(e,s){super(e,s),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,s=e?.toArray().map(e=>this._renderLegendForLayer(e)).filter(Boolean);return s?.length?g("section",null,s):g("div",{class:me.message,key:"no-legend"},this.messages.noLegend)}_renderLegendForLayer(e,s){if(!e.ready)return null;const t=`${e.layer.uid}-version-${e.version}`,i=`${ve}${s?`${s}-`:""}${t}`,r=e.title?k({level:this.headingLevel,class:this.classes($.heading,me.label)},e.title):null;if(e.children.length){const s=e.children.toArray().map(e=>this._renderLegendForLayer(e,t));return g("section",{class:this.classes(me.service,me.groupLayer),key:i},r,s)}return this._renderLegendElementsForLayer(e,r,i)}_renderLegendElementsForLayer(e,s,t){const i=e.legendElements?.filter(Boolean);if(!i?.length)return null;const r=i.map(s=>g(fe,{effectList:e.effectList,isChild:!1,key:`${t}-${s.type}`,layer:e.layer,legendElement:s,messages:this.messages})),o={[me.groupLayerChild]:!!e.parent};return g("section",{class:this.classes(me.service,o),key:t},s,g("div",{class:me.layer},r))}};e([r()],be.prototype,"activeLayerInfos",void 0),e([r()],be.prototype,"headingLevel",void 0),e([r(),C("esri/widgets/Legend/t9n/Legend")],be.prototype,"messages",void 0),e([r({readOnly:!0})],be.prototype,"type",void 0),be=e([l("esri.widgets.Legend.styles.classic.ClassicView")],be);let je=class extends n{constructor(e,s){super(e,s),this.headingLevel=3,this.messages=null,this.viewModel=new a,this.style=new be}initialize(){this.addHandles([s(()=>this.view,"resize",()=>this.scheduleRender()),s(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),t(()=>this.headingLevel,e=>{const{style:s}=this;s&&(s.headingLevel=e)}),t(()=>this.style,(e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)},i)])}destroy(){this.style?.destroy()}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}set style(e){const s=this._get("style");e!==s&&s?.destroy(),this._set("style",e)}castStyle(e){if(e instanceof pe||e instanceof be)return e;if("string"==typeof e)return"card"===e?new pe:new be;if(e&&"string"==typeof e.type){const s={...e};return delete s.type,"card"===e.type?new pe(s):new be(s)}return new be}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return g("div",{class:this.classes("esri-legend",$.widget,this.style instanceof be?$.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach(e=>{this.removeHandles(`version_${e.layer.uid}`),this._renderOnActiveLayerInfoChange(e)}),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const r=t(()=>e.version,()=>this.scheduleRender());this.addHandles(r,`version_${e.layer.uid}`);const o=s(()=>e.children,"change",()=>e.children.forEach(e=>this._renderOnActiveLayerInfoChange(e)),i);this.addHandles(o,`version_${e.layer.uid}`),e.children.forEach(e=>this._renderOnActiveLayerInfoChange(e))}};e([r()],je.prototype,"activeLayerInfos",null),e([r()],je.prototype,"basemapLegendVisible",null),e([r()],je.prototype,"groundLegendVisible",null),e([r()],je.prototype,"headingLevel",void 0),e([r()],je.prototype,"hideLayersNotInCurrentView",null),e([r()],je.prototype,"keepCacheOnDestroy",null),e([r()],je.prototype,"respectLayerDefinitionExpression",null),e([r()],je.prototype,"respectLayerVisibility",null),e([r()],je.prototype,"icon",null),e([r()],je.prototype,"label",null),e([r()],je.prototype,"layerInfos",null),e([r(),C("esri/widgets/Legend/t9n/Legend")],je.prototype,"messages",void 0),e([r()],je.prototype,"style",null),e([o("style")],je.prototype,"castStyle",null),e([r()],je.prototype,"view",null),e([r()],je.prototype,"viewModel",void 0),je=e([l("esri.widgets.Legend")],je);const Le=je;export{Le as default};
