/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import e from"../../Graphic.js";import s from"../../core/Error.js";import{m as i,a as o}from"../../chunks/handleUtils.js";import{L as r}from"../../chunks/Logger.js";import{d as a,a as n}from"../../chunks/maybe.js";import{isAborted as l,debounce as p,createResolver as c,onAbort as m,createAbortError as u,throwIfAborted as d}from"../../core/promiseUtils.js";import{Q as h}from"../../chunks/Queue.js";import{watch as j,whenOnce as y,sync as k,when as f}from"../../core/reactiveUtils.js";import{l as w}from"../../chunks/SetUtils.js";import{property as g}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import{subclass as v}from"../../core/accessorSupport/decorators/subclass.js";import{i as b}from"../../chunks/editableLayers.js";import{i as F,b as S,a as M,F as C}from"../../chunks/layerUtils.js";import{createFeatureServices as I}from"../../rest/featureService/utils.js";import A from"../../views/draw/support/HighlightHelper.js";import{V as U}from"../../chunks/InputManager.js";import{S as _}from"../../chunks/SketchOptions.js";import{t as V}from"../../chunks/HighlightDefaults.js";import E from"./CreateFeaturesWorkflow.js";import W from"../../layers/GraphicsLayer.js";import{k as L}from"../../chunks/elevationInfoUtils.js";import{h as T}from"../../chunks/layerViewUtils.js";import P from"../../core/Accessor.js";import x from"./Edits.js";import{B as D,f as R,k as O,D as H,u as G,y as N,E as B,F as z,j as q,G as Z,m as Q,H as J}from"../../chunks/workflowUtils.js";import K from"./Workflow.js";import X from"../FeatureForm/FeatureFormViewModel.js";import Y from"../Sketch/SketchViewModel.js";import $ from"./UpdateWorkflowData.js";import{findUtilityNetwork as tt,isGraphicForRelatableFeatureSupportedLayer as et}from"../../chunks/featureUtils.js";import"../../PopupTemplate.js";import"../../core/Clonable.js";import"../../chunks/utils.js";import"../../core/Handles.js";import"../../chunks/get.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/object.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../config.js";import"../../chunks/string.js";import"../../chunks/events.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/Warning.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/jsonUtils.js";import"../../core/JSONSupport.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../layers/support/fieldUtils.js";import"../../core/sql.js";import"../../chunks/guards.js";import"../../chunks/datetime.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/support/AttachmentsOrderByInfo.js";import"../../chunks/jsonMap.js";import"../../popup/content/CustomContent.js";import"../../popup/content/ExpressionContent.js";import"../../popup/ElementExpressionInfo.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../chunks/enumeration.js";import"../../popup/support/FieldInfoFormat.js";import"../../chunks/date.js";import"../../chunks/locale.js";import"../../chunks/constants.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/mixins/ChartMediaInfo.js";import"../../popup/content/mixins/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/RelationshipContent.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/content/TextContent.js";import"../../popup/content/UtilityNetworkAssociationsContent.js";import"../../popup/support/UtilityNetworkAssociationType.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../support/actions/ActionBase.js";import"../../core/Identifiable.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../geometry/support/jsonUtils.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../chunks/createFeatureId.js";import"../../chunks/typeUtils2.js";import"../../symbols/CIMSymbol.js";import"../../symbols/Symbol.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils3.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils4.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/vec3f64.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/DoubleArray.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../chunks/lineMarkers.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/Font.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../layers/catalog/catalogUtils.js";import"../../rest/featureService/FeatureService.js";import"../../chunks/applyEditsUtils.js";import"../../chunks/projectionUtils.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectXYZToVector.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../geometry/support/MeshTransform.js";import"../../chunks/mat4.js";import"../../chunks/common.js";import"../../chunks/mat4f64.js";import"../../chunks/quat.js";import"../../chunks/vec3.js";import"../../chunks/vec4.js";import"../../chunks/quatf64.js";import"../../chunks/axisAngleDegrees.js";import"../../chunks/editingSupport.js";import"../../chunks/uuid.js";import"../../geometry/support/normalizeUtils.js";import"../../chunks/normalizeUtilsCommon.js";import"../../chunks/simplify.js";import"../../chunks/utils9.js";import"../../chunks/utils10.js";import"../../chunks/EditBusLayer.js";import"../../chunks/infoFor3D.js";import"../../chunks/featureLayerUtils.js";import"../../chunks/asyncUtils.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../chunks/featureQueryAll.js";import"../../rest/support/Query.js";import"../../chunks/DataLayerSource.js";import"../../layers/support/Field.js";import"../../chunks/domains.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/fieldType.js";import"../../chunks/FullTextSearch.js";import"../../chunks/spatialRelationships.js";import"../../rest/support/StatisticDefinition.js";import"../../time/TimeExtent.js";import"../../chunks/timeUtils.js";import"../../renderers/SimpleRenderer.js";import"../../renderers/Renderer.js";import"../../renderers/support/AuthoringInfo.js";import"../../renderers/support/AuthoringInfoVisualVariable.js";import"../../chunks/colorRamps.js";import"../../rest/support/AlgorithmicColorRamp.js";import"../../rest/support/ColorRamp.js";import"../../rest/support/MultipartColorRamp.js";import"../../renderers/mixins/VisualVariablesMixin.js";import"../../renderers/visualVariables/ColorVariable.js";import"../../renderers/visualVariables/VisualVariable.js";import"../../renderers/visualVariables/support/ColorStop.js";import"../../renderers/visualVariables/OpacityVariable.js";import"../../renderers/visualVariables/support/OpacityStop.js";import"../../renderers/visualVariables/RotationVariable.js";import"../../renderers/visualVariables/SizeVariable.js";import"../../renderers/visualVariables/support/SizeStop.js";import"../../chunks/visualVariableUtils.js";import"../../chunks/lengthUtils.js";import"../../chunks/commonProperties2.js";import"../../symbols/support/jsonUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../renderers/UniqueValueRenderer.js";import"../../chunks/diffUtils.js";import"../../chunks/RendererLegendOptions.js";import"../../renderers/support/UniqueValue.js";import"../../renderers/support/UniqueValueClass.js";import"../../renderers/support/UniqueValueGroup.js";import"../../renderers/support/UniqueValueInfo.js";import"../../chunks/styleUtils.js";import"../../rest/support/AttachmentQuery.js";import"../../rest/support/NormalizationBinParametersMixin.js";import"../../rest/support/RelationshipQuery.js";import"../../chunks/serviceCapabilitiesUtils.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../chunks/portalItemUtils.js";import"../../chunks/editsZScale.js";import"../../chunks/layerUtils2.js";import"../../chunks/signal.js";import"../../views/interactive/sketch/SketchLabelOptions.js";import"../../views/interactive/sketch/SketchTooltipOptions.js";import"../../chunks/SketchTooltipVisibleElements.js";import"../../views/interactive/sketch/SketchValueOptions.js";import"../../chunks/templateUtils2.js";import"../../editing/sharedTemplates/SharedTemplateMetadata.js";import"../../chunks/ReactiveMap.js";import"../../chunks/UpdatingHandles.js";import"../../chunks/utils12.js";import"../../symbols/support/symbolUtils.js";import"../../chunks/gfxUtils.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils6.js";import"../../chunks/defaultCIMValues.js";import"../../chunks/renderUtils.js";import"../../chunks/colorUtils2.js";import"../../chunks/vec4f64.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../../chunks/svgUtils.js";import"../../chunks/mat2df32.js";import"../../chunks/mat2d.js";import"../../chunks/widgetUtils.js";import"../../chunks/jsxFactory.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/utils8.js";import"../../chunks/jsonUtils2.js";import"../../chunks/parser.js";import"../../chunks/utils5.js";import"../../chunks/webStyleSymbolUtils.js";import"../../chunks/devEnvironmentUtils.js";import"../../chunks/helpMessageUtils.js";import"../../views/interactive/snapping/FeatureSnappingLayerSource.js";import"./CreateFeaturesWorkflowData.js";import"../../chunks/formUtils2.js";import"../../chunks/formUtils.js";import"../../form/elements/AttachmentElement.js";import"../../form/elements/Element.js";import"../../form/elements/inputs/attachments/AttachmentInput.js";import"../../chunks/Input.js";import"../../form/elements/inputs/attachments/AudioInput.js";import"../../chunks/utils2.js";import"../../form/elements/inputs/attachments/DocumentInput.js";import"../../form/elements/inputs/attachments/ImageInput.js";import"../../form/elements/inputs/attachments/SignatureInput.js";import"../../form/elements/inputs/attachments/VideoInput.js";import"../../form/elements/FieldElement.js";import"../../form/elements/inputs.js";import"../../form/elements/inputs/BarcodeScannerInput.js";import"../../form/elements/inputs/TextInput.js";import"../../form/elements/inputs/Input.js";import"../../form/elements/inputs/ComboBoxInput.js";import"../../form/elements/inputs/DatePickerInput.js";import"../../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../../form/elements/inputs/DateTimePickerInput.js";import"../../form/elements/inputs/RadioButtonsInput.js";import"../../form/elements/inputs/SwitchInput.js";import"../../form/elements/inputs/TextAreaInput.js";import"../../form/elements/inputs/TextBoxInput.js";import"../../form/elements/inputs/TimePickerInput.js";import"../../form/elements/RelationshipElement.js";import"../../form/elements/TextElement.js";import"../../form/elements/UtilityNetworkAssociationsElement.js";import"../../chunks/dateUtils.js";import"../../intl.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../chunks/GraphicsCollection.js";import"../../layers/Layer.js";import"../../layers/mixins/BlendLayer.js";import"../../chunks/layerContainerType.js";import"../../layers/mixins/ScaleRangeLayer.js";import"../../symbols/support/ElevationInfo.js";import"../../symbols/support/FeatureExpressionInfo.js";import"../../chunks/unitConversionUtils.js";import"../../chunks/SharedTemplateProvider.js";import"../../chunks/utils11.js";import"../../chunks/Version2.js";import"../../chunks/Version.js";import"../../chunks/drapedUtils.js";import"../../chunks/typeUtils3.js";import"../../renderers/ClassBreaksRenderer.js";import"../../renderers/support/ClassBreakInfo.js";import"../../renderers/DictionaryRenderer.js";import"../../chunks/DictionaryScriptEvaluator.js";import"../../layers/support/FieldsIndex.js";import"../../chunks/UnknownTimeZone.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/ArcadeExpression.js";import"../../chunks/TimeOnly.js";import"../../chunks/enum.js";import"../../renderers/DotDensityRenderer.js";import"../../renderers/support/AttributeColorInfo.js";import"../../renderers/HeatmapRenderer.js";import"../../renderers/support/HeatmapColorStop.js";import"../../chunks/heatmapUtils.js";import"../../renderers/PieChartRenderer.js";import"../../chunks/GraphicState.js";import"../../chunks/DrawingMode.js";import"../../chunks/hitTestSelectUtils.js";import"../../chunks/sketchUtils.js";import"../../form/FormTemplate.js";import"../../form/ExpressionInfo.js";import"../../form/elements/GroupElement.js";import"../../chunks/LayerContingentValuesCache.js";import"../../layers/support/Subtype.js";import"../../chunks/featureFormUtils.js";import"../../chunks/utils7.js";import"../../chunks/basemapUtils.js";import"../../chunks/basemapDefinitions.js";import"../FeatureForm/FieldInput.js";import"../FeatureForm/EditableInput.js";import"../FeatureForm/InputBase.js";import"../FeatureForm/GroupInput.js";import"../FeatureForm/RelationshipInput.js";import"../../chunks/FeatureRelationshipViewModel.js";import"../FeatureForm/TextElementInput.js";import"../../chunks/ReactiveSet.js";import"../../arcade.js";import"../../chunks/arcadeEnvironment.js";import"../../chunks/ImmutableArray.js";import"../../layers/FeatureLayer.js";import"../../chunks/MultiOriginJSONSupport.js";import"../../graphic/FeatureGraphicOrigin.js";import"../../graphic/GraphicOrigin.js";import"../../chunks/isFeatureGraphicOrigin.js";import"../../core/workers/workers.js";import"../../core/workers/Connection.js";import"../../core/workers/RemoteClient.js";import"../../chunks/queryZScale.js";import"../../rest/support/FeatureSet.js";import"../../layers/mixins/APIKeyMixin.js";import"../../chunks/ArcGISService.js";import"../../layers/mixins/CustomParametersMixin.js";import"../../layers/mixins/DisplayFilteredLayer.js";import"../../layers/support/DisplayFilterInfo.js";import"../../chunks/scaleUtils.js";import"../../layers/support/DisplayFilter.js";import"../../chunks/displayFilterUtils.js";import"../../layers/mixins/FeatureEffectLayer.js";import"../../layers/support/FeatureEffect.js";import"../../layers/support/FeatureFilter.js";import"../../layers/mixins/FeatureLayerBase.js";import"../../geometry/HeightModelInfo.js";import"../../chunks/commonProperties.js";import"../../tables/AttributeTableTemplate.js";import"../../tables/elements/AttributeTableGroupElement.js";import"../../tables/elements/AttributeTableAttachmentElement.js";import"../../tables/elements/AttributeTableElement.js";import"../../tables/elements/AttributeTableFieldElement.js";import"../../tables/elements/AttributeTableRelationshipElement.js";import"../../layers/support/GeometryFieldsInfo.js";import"../../layers/support/LayerFloorInfo.js";import"../../chunks/multiLayerServiceUtils.js";import"../../layers/support/Relationship.js";import"../../layers/mixins/FeatureReductionLayer.js";import"../../layers/support/AggregateField.js";import"../../layers/support/ExpressionInfo.js";import"../../chunks/FeatureReduction.js";import"../../layers/support/FeatureReductionBinning.js";import"../../layers/support/LabelClass.js";import"../../chunks/labelUtils.js";import"../../renderers/support/jsonUtils.js";import"../../layers/support/FeatureReductionCluster.js";import"../../layers/support/FeatureReductionSelection.js";import"../../chunks/clusterUtils.js";import"../../chunks/MD5.js";import"../../layers/mixins/OperationalLayer.js";import"../../layers/mixins/OrderedLayer.js";import"../../layers/support/OrderByInfo.js";import"../../layers/mixins/PortalLayer.js";import"../../layers/mixins/PublishableLayer.js";import"../../layers/support/PublishingInfo.js";import"../../layers/mixins/RefreshableLayer.js";import"../../layers/mixins/TemporalLayer.js";import"../../layers/support/TimeInfo.js";import"../../time/TimeInterval.js";import"../../layers/mixins/TrackableLayer.js";import"../../layers/support/TrackInfo.js";import"../../layers/support/TrackPartInfo.js";import"../../layers/support/FeatureTemplate.js";import"../../layers/support/FeatureType.js";import"../../chunks/fieldProperties.js";import"../../chunks/labelingInfo.js";import"../../chunks/TitleCreator.js";import"../../chunks/versionUtils.js";import"../../chunks/styleUtils2.js";import"../../support/popupUtils.js";import"../../chunks/isSupportedObject.js";import"../../chunks/keybindings.js";import"../../chunks/SnappingManager.js";import"../../chunks/normalizedPoint.js";import"../../chunks/dehydratedPoint.js";import"../../chunks/Settings.js";import"../../views/interactive/snapping/SnappingOptions.js";import"../../chunks/constraints.js";import"../../chunks/vec2.js";import"../../chunks/vec2f64.js";import"../../geometry/support/geodesicUtils.js";import"../../chunks/plane.js";import"../../chunks/vector.js";import"../../chunks/mat3f64.js";import"../../chunks/mathUtils2.js";import"../../chunks/sphere.js";import"../../chunks/ray.js";import"../../chunks/mat3.js";import"../../chunks/geometry2dUtils.js";import"../../chunks/RightAngleSnappingHint.js";import"../../chunks/geodesicLengthMeasurementUtils.js";import"../../chunks/quantityUtils.js";import"../../chunks/projectVectorToVector.js";import"../../chunks/projectPointToVector.js";import"../../chunks/spatialReferenceEllipsoidUtils.js";import"../../geometry/operators/geodeticLengthOperator.js";import"../../chunks/geodeticCurveType.js";import"../../chunks/geodesicMeasurementUtils.js";import"../../chunks/automaticAreaMeasurementUtils.js";import"../../chunks/geodesicAreaMeasurementUtils.js";import"../../chunks/earcut.js";import"../../chunks/triangle.js";import"../../chunks/lineSegment.js";import"../../chunks/automaticLengthMeasurementUtils.js";import"../../chunks/screenUtils2.js";var st;let it=st=class extends P{constructor(t){super(t),this.association=null,this.editorItem=null,this.edits=null,this.parent=null,this.featureFormCallbacks=null,this.viewModel=null,this.readOnly=!1}get attachmentsCapabilities(){const t=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:t,update:t,delete:t}}}get formTemplate(){return this.editorItem.formTemplate}static async create(t){const e=st._makeConstructorProps(t);return new st(e)}static _makeConstructorProps(t){const{association:e,feature:i,parent:o,featureFormCallbacks:r,viewModel:a,readOnly:n}=t,l=a.editorItems.find(t=>t.layer===i.sourceLayer);if(!l)throw new s("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{association:e,editorItem:l,edits:new x({feature:i}),parent:o,featureFormCallbacks:r,viewModel:a,readOnly:n}}};t([g()],it.prototype,"association",void 0),t([g()],it.prototype,"attachmentsCapabilities",null),t([g({constructOnly:!0})],it.prototype,"editorItem",void 0),t([g()],it.prototype,"edits",void 0),t([g()],it.prototype,"formTemplate",null),t([g()],it.prototype,"parent",void 0),t([g()],it.prototype,"featureFormCallbacks",void 0),t([g()],it.prototype,"viewModel",void 0),t([g()],it.prototype,"readOnly",void 0),it=st=t([v("esri.widgets.Editor.UpdateRecordWorkflowData")],it);const ot=it;var rt;let at=rt=class extends ot{constructor(t){super(t),this.sketchOptions=null,this.snappingManager=null}static async create(t){const{feature:e,snappingManager:i,viewModel:o}=t,r=t.sketchOptions??new _,{view:a}=o;if(!a)throw new s("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const n=await D(a,e.layer??e.sourceLayer);return new rt({...rt._makeConstructorProps(t),layerView:n,sketchOptions:r,snappingManager:i})}};t([g()],at.prototype,"layerView",void 0),t([g({constructOnly:!0})],at.prototype,"sketchOptions",void 0),t([g()],at.prototype,"snappingManager",void 0),at=rt=t([v("esri.widgets.Editor.UpdateFeatureWorkflowData")],at);const nt=at;var lt;const pt={exit:Symbol()};let ct=class extends K{static{lt=this}constructor(t){super(t),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:t}=this,{edits:e}=t,{view:r}=t.viewModel,a=e.feature;r&&(this._highlightHelper=new A({view:r,highlightName:V}),this.addHandles(i(()=>this._highlightHelper?.removeAll())));const n=new AbortController;this.addHandles(o(n)),this._updatingHandles.addPromise(R([a],a.sourceLayer,t.viewModel.view.spatialReference,n.signal).then(([t])=>{l(n)||(this._onFullFeatureLoaded(t),this._initializeFeatureFormViewModel())},t=>this.cancel({force:!0,error:new s("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:t}})})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const t=this.editorItem.capabilities;return t.update.reliesOnOwnerAdminPrivileges||t.delete.reliesOnOwnerAdminPrivileges}stageDelete(){this.data.edits.stageDelete()}async enter(){this._configureAttachmentsViewModel()}exit(t){this.removeHandles(pt.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:t,fullFeature:e}=this,{attachmentsCapabilities:s,viewModel:o}=t,{attachmentsViewModel:r}=o,a=t.readOnly?{editing:!1}:s;r.set({capabilities:a,graphic:e,filesEnabled:!1,mode:"view"}),this.addHandles([i(()=>r.fileInfos.removeAll()),j(()=>r.mode,t=>{switch(t){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],pt.exit)}_initializeFeatureFormViewModel(){const{association:t,edits:e,formTemplate:s,viewModel:{view:i},readOnly:o}=this.data,r=this._featureFormViewModel=new X({activeAssociation:t,editType:"UPDATE",feature:this.fullFeature,formTemplate:s,highlightHelper:this._highlightHelper,map:i?.map,spatialReference:i.spatialReference,timeZone:i?.timeZone,disabled:o});r.callbacks={...this.data.featureFormCallbacks,showAllRelatedRecords:t=>r.relationshipId=t.relationshipId,viewAssociatedLayers:t=>r.associationId=t.associationId,viewAssociatedFeatures:t=>r.associatedLayer=t.associatedLayer};const{initialFeature:a}=e;a&&r.overrideInitialFeature(a),this.addHandles([r.on("value-change",()=>{e.updateAttributes(r.getValues()),this.fullFeature.attributes=e.feature.attributes}),j(()=>i?.timeZone,t=>r.timeZone=t)])}_onFullFeatureLoaded(t){this.fullFeature=t;const{edits:e}=this.data;e.updateAttributes(t.attributes),e.trackChanges()}static async create(t){const e=new lt({data:await ot.create(t),onCommit:this._onCommitFactory(t.applyEdits)});return e._set("steps",this._createWorkflowSteps(e)),e}static _createWorkflowSteps(t){const{attachmentsViewModel:e}=t.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){e.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){e.mode="view"}}]}static{this._onCommitFactory=t=>async e=>{const{edits:s}=e,{feature:i}=s;if(!i)return;const o=i.sourceLayer,r=i.clone();if(!s.attributesModified||s.stagedForDelete){const t=o.objectIdField;if(r.attributes={[t]:i.getAttribute(t)},"scene"===o.type&&null!=o.infoFor3D){const t=o.associatedLayer?.globalIdField;null!=t&&r.setAttribute(t,i.getAttribute(t))}}s.geometryModified&&!s.stagedForDelete||(r.geometry=null);const a=s.stagedForDelete?"deleteFeatures":"updateFeatures";await t(o,{[a]:[r]})}}};var mt;t([g()],ct.prototype,"_featureFormViewModel",void 0),t([g()],ct.prototype,"editorItem",null),t([g()],ct.prototype,"featureFormViewModel",null),t([g()],ct.prototype,"fullFeature",void 0),t([g()],ct.prototype,"hasPendingEdits",null),t([g()],ct.prototype,"layer",null),t([g()],ct.prototype,"parent",null),t([g()],ct.prototype,"parentLayer",null),t([g()],ct.prototype,"shouldShowAttachments",null),t([g()],ct.prototype,"shouldAllowAttachmentEditing",null),t([g()],ct.prototype,"reliesOnOwnerAdminPrivileges",null),ct=lt=t([v("esri.widgets.Editor.UpdateRecordWorkflow")],ct);const ut={highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol(),waitingForTool:Symbol()};let dt=mt=class extends ct{constructor(t){super(t),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){this._layerViewEditSession?.rollback()}async commit(){this.removeHandles(ut.sketchGraphics);try{const t=this.data.edits.stagedForDelete;await super.commit();const e=this._layerViewEditSession;t?e?.rollback():e?.commit()}catch(t){throw await this._configureSketchViewModel(),new s("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:t})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles([this._featureFormViewModel.on("value-change",t=>{this._layerViewEditSession?.setAttribute(t.fieldName,t.value)}),j(()=>this._featureFormViewModel.feature?.sourceLayer,t=>this._sketchGraphicClone.sourceLayer=t)])}_configureHighlight(){const{edits:t,layerView:e}=this.data;T(e)&&this.addHandles(e.highlight(t.feature),ut.highlights)}async _configureSketchViewModel(){const t=this._sketchViewModel;if(!t)return;const{data:e,_featureFormViewModel:s,_sketchGraphicClone:i}=this,{edits:o,viewModel:r}=e,a=o.feature,{view:n}=r,l=O(a),p=await H({feature:a,featureClone:i,visualVariableAttributes:l,sketchViewModel:t,view:n,onUpdate:({geometry:t,attributes:e},i)=>{if(o.updateAttributes(e),o.updateGeometry(t),s.feature&&(s.feature.geometry=t),null!=l.rotation){const{field:t}=l.rotation;s.setValue(t,e[t])}if(null!=l.size){const{field:t}=l.size;s.setValue(t,e[t])}("undo"===i.type||"redo"===i.type||"update"===i.type&&null!=i.toolEventInfo&&q(i.toolEventInfo.type))&&s.notifyFeatureGeometryChanged()},addUpdatingPromise:t=>{this._updatingHandles.addPromise(t)},addHandle:t=>{this.addHandles(t,ut.waitingForTool)},webStyleCache:this._webStyleCache});this.addHandles(p,ut.sketchGraphics),t.addHandles(p)}async _initializeSketchViewModel(){const{data:t,_sketchGraphicClone:e}=this,{readOnly:s}=t,o=t.edits.feature,{capabilities:r,layer:n}=t.editorItem,{view:l}=t.viewModel;if(this.removeHandles([ut.highlights,ut.sketchGraphics,ut.sketchViewModel,ut.waitingForTool]),!r.update.geometry||s||"3d"===l?.type&&L(n.elevationInfo))return{enter:async()=>{this.hasHandles(ut.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([ut.highlights])};const p=new W({elevationInfo:n.elevationInfo,internal:!0,listMode:"hide",title:"updateFeaturesWorkflow-internal"}),c=new Y({allowDeleteKey:!1,layer:p,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:l});return this._sketchViewModel=c,l?.map.add(p),await(l?.whenLayerView(p)),this.addHandles(i(()=>{l?.destroyed||l?.map.remove(p),p.destroyed||p.destroy(),this._sketchViewModel=a(c)}),ut.sketchViewModel),await G(e,this._webStyleCache,"2d"===l?.type?l.scale:null),this.addHandles([await N(c,o,e)]),{enter:async()=>{this.hasHandles(ut.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([ut.sketchGraphics]),viewModel:c}}_onFullFeatureLoaded(t){super._onFullFeatureLoaded(t);const e=this._sketchGraphicClone=B(t),{edits:s,layerView:i}=this.data;s.updateGeometry(t.geometry),s.trackChanges(),z(i)&&(this._layerViewEditSession=i.createInteractiveEditSession(e))}static async create(t){const e=new mt({data:await nt.create(t),onCommit:this._onCommitFactory(t.applyEdits)});return e._set("steps",this._createWorkflowSteps(e)),e}get test(){}};var ht;t([g()],dt.prototype,"_layerViewEditSession",void 0),t([g()],dt.prototype,"_sketchGraphicClone",void 0),t([g()],dt.prototype,"_sketchViewModel",void 0),dt=mt=t([v("esri.widgets.Editor.UpdateFeatureWorkflow")],dt);let jt=ht=class extends K{constructor(t){super(t),this._workflowStack=new h(w),this._sketchStack=new h(w),this.data=void 0,this.type="update"}destroy(){this._drainWorkflowStack(t=>t.cancel({force:!0}))}get activeEditorItem(){return this.activeWorkflow?.data.editorItem??void 0}get activeFeatureFormViewModel(){return this.activeWorkflow?.featureFormViewModel}get activeUtilityNetworkAssociationAddAssociationViewModel(){return"add-association"===this.activeWorkflow?.type?this.activeWorkflow.utilityNetworkAssociationAddAssociationViewModel:null}get activeSketchViewModel(){return this._sketchStack.peek()?.viewModel}get canDeleteAssociation(){const{activeFeatureFormViewModel:t}=this;if(!this.activeWorkflow||!this.data.viewModel.view?.map||!t)return!1;const{activeAssociation:e,feature:s}=t;return!(!e||!s?.sourceLayer||!F(s?.sourceLayer)&&!S(s?.sourceLayer))}get activeWorkflow(){return this._workflowStack.last()}get updating(){return this._updatingHandles.updating||!!this.activeWorkflow?.updating}get hasPreviousStep(){const t=this.activeWorkflow?.featureFormViewModel;return this._stepIndex>0||this.nestedWorkflowCount>1||null!=t?.relationshipId||"view"!==this.data.viewModel.attachmentsViewModel.mode||null!=t?.associationId||null!=t?.associatedLayer}get hasUpdatableCandidates(){const{candidates:t,viewModel:e}=this.data;return t.some(({layer:t})=>e.findEditorItemForLayer(t)?.supportsUpdateWorkflow)}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){return!!this.activeEditorItem?.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return!!this.activeEditorItem?.capabilities.update.attachments.enabled}get hasPendingEdits(){return Array.from(this._workflowStack).some(t=>t.hasPendingEdits)}get helpMessage(){return this.activeWorkflow?.helpMessage?this.activeWorkflow.helpMessage:"awaiting-feature-to-update"===this.stepId?"select":void 0}get reliesOnOwnerAdminPrivileges(){return this.activeWorkflow?.reliesOnOwnerAdminPrivileges??!1}get hasInvalidFormTemplate(){return!!this.activeEditorItem?.hasInvalidFormTemplate}async back(t=()=>Promise.resolve(!0)){const{activeWorkflow:e}=this,s=e?.featureFormViewModel;if(s?.activeRelationshipInput){const t=s.activeRelationshipInput;if(t.activeCategory)return void(t.activeCategory=null);if(null!=s.relationshipId)return void(s.relationshipId=null);if(t.showAllEnabled)return void(t.showAllEnabled=!1)}if("add-association"===e?.type){const{activeUtilityNetworkAssociationAddAssociationViewModel:t}=this;if(t?.filterOptionsVisible)return void(t.filterOptionsVisible=!1);t?.featureSpatialItems.length&&t.reset()}if(null==s?.associatedLayer)if(null==s?.associationId)if("create-features"===e?.type&&e.hasPreviousStep)await e.previous({cancelCurrentStep:!0});else if(e){if(e.hasPendingEdits&&!s?.disabled&&!await t())return;e.hasPreviousStep?await e.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else s.associationId=null;else s.associatedLayer=null}async cancelActiveWorkflow(t){await(this.activeWorkflow?.cancel(t)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(t=>t.commit()),await super.commit()}static create(t){const{viewModel:e,snappingManager:s,startAt:i,addAttachmentsCallback:o,applyEditsCallback:r,applyEditsFeatureServiceCallback:a}=t,n=t.sketchOptions??new _,l=new ht({data:new $({addAttachmentsCallback:o,applyEditsCallback:r,applyEditsFeatureServiceCallback:a,sketchOptions:n,snappingManager:s,viewModel:e}),onCommit:async()=>{}});return l._set("steps",this._createWorkflowSteps(l,i)),l}async save(){const{activeFeatureFormViewModel:t}=this;if(t){if(t.submit(),!t.submittable||t.pendingSubtypeChoice)return;const e=t.getValues();if(t.validateContingencyConstraints(e,{includeIncompleteViolations:!0}).length>0)return}this.nestedWorkflowCount>1?(await(this.activeWorkflow?.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(t){try{const e=this._createNestedCreateFeaturesWorkflow(t);await this._pushWorkflow(e)}catch(t){throw new s("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:t})}}async startUpdating(t,e,i=!1){try{const s=await this._createNestedUpdateWorkflow(t,i,e);await this._pushWorkflow(s)}catch(t){throw new s("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:t})}}async startAddAssociation(t,e,i){try{const s=await this._createNestedAddAssociationWorkflow(t,e,i);await this._pushWorkflow(s)}catch(t){throw new s("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:t})}}async deleteActiveFeature(){const{activeWorkflow:t}=this;if(!t)throw new s("editor:nothing-to-delete","There is no feature to delete");const e=Z(t);e?(t.stageDelete(),t.data.edits.feature===this.data.rootFeature&&this._removeRootFeatureFromCandidates()):await t.cancel(),this.nestedWorkflowCount<2?e?await this.commit():await this.cancel({force:!0}):(e&&await t.commit(),await this._popWorkflow(),await this._returnToPageWithContent())}async deleteActiveAssociation(){if(!this.canDeleteAssociation)throw new s("editor:nothing-to-delete","There is no association to delete");await this._deleteActiveAssociation(),await this._popWorkflow(),await this._returnToPageWithContent()}async cancelAll(){await this._drainWorkflowStack(t=>t.cancel({force:!0}))}async _deleteActiveAssociation(){const{activeFeatureFormViewModel:t,data:e}=this,{activeAssociation:i,feature:o}=t,{applyEditsFeatureServiceCallback:r,viewModel:a}=e,{sourceLayer:n}=o,l=S(n)&&n.parent?n.parent:n,p=I([l]),c=p.values().next().value?.featureService;if(!c)throw new s("editor:failed-to-delete-association","Could not retrieve feature service needed to delete association");await(c?.load());const m=a.view.map,u=tt(m,l);await(u?.networkSystemLayers.loadAssociationsTable());const d=u?.generateDeleteAssociations([i]);if(!d)throw new s("editor:failed-to-delete-association","Could not create payload needed to delete association");const h=u?.gdbVersion??void 0;await r(c,[d],{gdbVersion:h,globalIdUsed:!0})}_removeRootFeatureFromCandidates(){const{candidates:t,rootFeature:e}=this.data;if(0===t.length||!e)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}async _returnToPageWithContent(){const{activeFeatureFormViewModel:t}=this;if(!t?.activeAssociationInput)return;const{activeAssociationInput:e,associationId:s}=t;await e.refresh(),e.associatedLayer&&!e.associatedFeatures?.length&&(t.associatedLayer=null),null==s||e.associatedFeatureInfos.size||(t.associationId=null)}_createNestedCreateFeaturesWorkflow(t){const{relatedLayer:e}=t,{addAttachmentsCallback:i,applyEditsCallback:o,applyEditsFeatureServiceCallback:r,sketchOptions:a,snappingManager:n,viewModel:l}=this.data;if(!b(e))throw new s("editor:unsupported-layer","Editing is not supported on the provided layer");const p=this._getCreationInfoForNestedCreateFeaturesWorkflow(t),c=p.template||p.initialFeature?"creating-features":"awaiting-feature-creation-info",m="create-features"!==this.activeWorkflow?.type&&"add-association"!==this.activeWorkflow?.type?this.activeWorkflow:void 0;return E.create({addAttachmentsCallback:i,applyEditsCallback:o,applyEditsFeatureServiceCallback:r,creationInfo:p,isNested:!0,parent:m,sketchOptions:a,snappingManager:n,startAt:c,viewModel:l})}_getCreationInfoForNestedCreateFeaturesWorkflow(t){const{relatedLayer:i}=t;if(!b(i)||M(i))throw new s("editor:unsupported-layer","Editing is not supported on the provided layer");const{viewModel:o}=this.data,r={layer:i,maxFeatures:1},a=this._makeRelatedRecordAttributes(t),n=o.getTemplatesForLayer(i);return n?.length>0?(r.attributeOverrides=a,1===n.length&&(r.template=n[0])):r.initialFeature=new e({sourceLayer:i,attributes:a}),r}async _createNestedUpdateWorkflow(t,e,s){const i=C(t.sourceLayer)?ct:dt,{applyEditsCallback:o,applyEditsFeatureServiceCallback:r,sketchOptions:a,snappingManager:n,viewModel:l}=this.data,p="create-features"!==this.activeWorkflow?.type&&"add-association"!==this.activeWorkflow?.type?this.activeWorkflow:void 0,c=await i.create({association:s,feature:t,parent:p,sketchOptions:a,snappingManager:n,viewModel:l,readOnly:e,applyEdits:o,applyEditsFeatureService:r,featureFormCallbacks:{addRelatedRecord:async t=>await this._updatingHandles.addPromise(this.startCreatingRelatedRecord(t)),editRelatedRecord:async({relatedFeature:t,readOnly:e})=>await this._updatingHandles.addPromise(this.startUpdating(t,void 0,e)),selectAssociatedFeature:async({feature:t,association:s})=>await this._updatingHandles.addPromise(this.startUpdating(t,s,e)),addAssociation:async t=>await this._updatingHandles.addPromise(this.startAddAssociation(t.feature,t.utilityNetwork,t.associationType))}});return await y(()=>!c.updating),c}async _createNestedAddAssociationWorkflow(t,e,s){const{AddAssociationWorkflow:i}=await import("../../chunks/AddAssociationWorkflow.js"),{applyEditsCallback:o,applyEditsFeatureServiceCallback:r,viewModel:a}=this.data,n="create-features"!==this.activeWorkflow?.type&&"add-association"!==this.activeWorkflow?.type?this.activeWorkflow:void 0,l=this.activeFeatureFormViewModel?.activeAssociationInput,p=await i.create({utilityNetwork:e,associationType:s,feature:t,parent:n,viewModel:a,associationInput:l,applyEdits:o,applyEditsFeatureService:r});return await y(()=>!p.updating),p}async _drainWorkflowStack(t){const e=this._workflowStack,s=[];for(const i of e){const e=t(i).finally(()=>i.destroy());this._updatingHandles.addPromise(e),s.push(e)}await Promise.all(s),this._workflowStack.clear(),this._sketchStack.clear()}_makeRelatedRecordAttributes(t){const{parentFeature:e,relatedLayer:s,relationshipId:i}=t;if(!et(e))return;const o=s.relationships?.find(t=>t.id===i);if(!o)return void this._logContinuingWithoutRelationshipWarning("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if("origin"===o.role)return void this._logContinuingWithoutRelationshipWarning("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const r=e.sourceLayer;o.relatedTableId!==r.layerId&&this._logContinuingWithoutRelationshipWarning("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const a=r.relationships?.find(t=>t.id===i);if(!a)return void this._logContinuingWithoutRelationshipWarning("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const n=yt(r,a),l=e.getAttribute(n);l||this._logContinuingWithoutRelationshipWarning("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field.");const p=yt(s,o);return{[p]:l}}async _popWorkflow(){this._workflowStack.pop()?.destroy(),this._sketchStack.pop();const t=await this._reconcileWorkflowStack();if(t.failureCount>0)throw new s("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",t)}async _pushWorkflow(t){const e=this._workflowRequiresSketchViewModel(t);this.activeWorkflow?.exit({removeSketchHandles:e});const i=this._sketchStack,o=await(t?.start()),r=i.peek();o?(r?.exit(),i.push(o)):i.push(this._cloneSketchController(r)),this._workflowStack.push(t);const a=await this._reconcileWorkflowStack();if(a.failureCount>0)throw new s("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",a)}async _reconcileWorkflowStack(){const t=this._workflowStack,e=this._sketchStack;try{const s=t.peek();return await(s?.enter()),await(e.peek()?.enter()),{activeWorkflow:s,failureCount:0}}catch(s){t.pop().destroy(),e.pop();const{activeWorkflow:i,failureCount:o}=await this._reconcileWorkflowStack();return{activeWorkflow:i,failureCount:o+1}}}_cloneSketchController(t){return{enter:t?.enter??(async()=>{}),exit:t?.exit??(async()=>{}),viewModel:t?.viewModel}}_workflowRequiresSketchViewModel(t){const{type:e}=t;return"update-feature"===e||"create-features"===e&&!C(t.data.creationInfo?.layer)}static _createWorkflowSteps(t,e="awaiting-feature-to-update"){const{data:o}=t;return Q(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],e,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:e}=o.viewModel,s=o.viewModel.view;s.activeTool=null;let r=null;t.addHandles(i(()=>{r=n(r)}),this.id),o.rootFeature=null,o.candidates=[];const a=s.on("immediate-click",async i=>{const a=c();t._updatingHandles.addPromise(a.promise);try{e.location=i.mapPoint,e.visible=!0,r?.abort();const{editorItems:a}=o.viewModel;r=new AbortController;const n=await i.defer(()=>new Promise((t,e)=>{m(r?.signal,()=>e(u())),t(J(a,s,i,r?.signal))}));if(d(r),o.candidates=n.filter(t=>"fulfilled"===t.status).flatMap(t=>t.value).filter(t=>!t.isAggregate),e.visible=1===o.candidates.length,0===o.candidates.length)return;i.stopPropagation(),1===o.candidates.length?(o.rootFeature=o.candidates[0],t.go("editing-existing-feature").catch(()=>{}).then(()=>e.visible=!1)):t.next()}finally{a.resolve()}},U.TOOL),l=f(()=>null!=s.activeTool,()=>t.cancel({force:!0}),{once:!0});s.focus(),t.addHandles([a,l],this.id)},async tearDown(){0===o.candidates.length&&(o.viewModel.spinnerViewModel.visible=!1),t.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){o.rootFeature=null;const{view:e}=o.viewModel;if(!e)return;const s=new A({view:e,highlightName:V});t.addHandles([j(()=>o.rootFeature,(t,e)=>{s.remove(e),s.add(t)},k),i(()=>s.removeAll())],this.id)},async tearDown(){t.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:e,viewModel:i}=t.data;if(!e)throw new s("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await t.startUpdating(e),i.spinnerViewModel.visible=!1;const o=p(async()=>{await y(()=>!t.updating),t.previous()});t.addHandles([j(()=>t.nestedWorkflowCount,(t,e)=>{0===t&&0!==e&&o()},k)],this.id)},async tearDown(){await t.cancelAll(),t.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){o.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){o.viewModel.attachmentsViewModel.mode="view"}})})}_logContinuingWithoutRelationshipWarning(t,e){r.getLogger(this).warn(`editor:${t}`,e,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature.")}};function yt(t,{keyField:e}){return t.getField(e)?.name??e}t([g()],jt.prototype,"activeEditorItem",null),t([g()],jt.prototype,"activeFeatureFormViewModel",null),t([g()],jt.prototype,"activeUtilityNetworkAssociationAddAssociationViewModel",null),t([g()],jt.prototype,"activeSketchViewModel",null),t([g()],jt.prototype,"canDeleteAssociation",null),t([g()],jt.prototype,"activeWorkflow",null),t([g()],jt.prototype,"updating",null),t([g()],jt.prototype,"data",void 0),t([g()],jt.prototype,"hasPreviousStep",null),t([g()],jt.prototype,"hasUpdatableCandidates",null),t([g()],jt.prototype,"nestedWorkflowCount",null),t([g()],jt.prototype,"shouldShowAttachments",null),t([g()],jt.prototype,"shouldAllowAttachmentEditing",null),t([g()],jt.prototype,"hasPendingEdits",null),t([g()],jt.prototype,"helpMessage",null),t([g()],jt.prototype,"reliesOnOwnerAdminPrivileges",null),t([g()],jt.prototype,"hasInvalidFormTemplate",null),jt=ht=t([v("esri.widgets.Editor.UpdateWorkflow")],jt);const kt=jt;export{kt as default};
