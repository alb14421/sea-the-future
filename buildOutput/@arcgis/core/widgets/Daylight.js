/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{L as t}from"../chunks/Logger.js";import{watch as s,syncAndInitial as i}from"../core/reactiveUtils.js";import{property as o}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import{o as r}from"../chunks/locale.js";import l from"./Widget.js";import a,{S as d,o as c}from"./Daylight/DaylightViewModel.js";import h from"../core/Accessor.js";import p from"./Slider.js";import{T as m}from"../chunks/TimezonePicker.js";import{o as u}from"../chunks/widgetUtils.js";import{t as g,a as k}from"../chunks/jsxFactory.js";import{c as b}from"../chunks/css.js";import{l as y}from"../chunks/componentsUtils.js";import{g as j}from"../chunks/globalCss.js";import{H as v}from"../chunks/Heading.js";import{o as w,b as _,c as S,u as C}from"../chunks/timeWidgetUtils.js";import{m as f}from"../chunks/messageBundle.js";import{v as P}from"../chunks/vmEvent.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/events.js";import"../chunks/handleUtils.js";import"../chunks/maybe.js";import"../core/promiseUtils.js";import"../core/Error.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../intl.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number.js";import"../chunks/substitute.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/timeUtils.js";import"../views/3d/environment/SunLighting.js";import"../webscene/SunLighting.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../views/3d/environment/VirtualLighting.js";import"../webscene/VirtualLighting.js";import"../chunks/earthUtils.js";import"../chunks/mathUtils.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../geometry/Point.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../geometry/support/webMercatorUtils.js";import"./Slider/SliderViewModel.js";import"../chunks/SunCalc.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";const M="esri-daylight",D=`${M}__container`,T="esri-slider",x={base:M,dayContainer:`${D} ${M}__day-container`,dateContainer:`${D} ${M}__date-container`,containerDisabled:`${D}--disabled`,sliderAmPmOn:`${T}--ampm-on`,sliderDateOff:`${T}--date-off`,sliderDateOn:`${T}--date-on`,playPauseButton:`${M}__play-pause-button`,datePicker:`${M}__date-picker`,seasonPicker:`${M}__season-picker`,panelError:`${M}__panel--error`,sunLightingCheckbox:`${M}__sun-lighting-checkbox`,shadowsCheckbox:`${M}__shadows-checkbox`};let L=class extends h{constructor(e){super(e),this.header=!0,this.playButtons=!0,this.datePicker=!0,this.timezone=!0,this.sunLightingToggle=!0,this.shadowsToggle=!0}};e([o({type:Boolean,nonNullable:!0})],L.prototype,"header",void 0),e([o({type:Boolean,nonNullable:!0})],L.prototype,"playButtons",void 0),e([o({type:Boolean,nonNullable:!0})],L.prototype,"datePicker",void 0),e([o({type:Boolean,nonNullable:!0})],L.prototype,"timezone",void 0),e([o({type:Boolean,nonNullable:!0})],L.prototype,"sunLightingToggle",void 0),e([o({type:Boolean,nonNullable:!0})],L.prototype,"shadowsToggle",void 0),L=e([n("esri.widgets.Daylight.VisibleElements")],L);const O=L,E="esri-slider-with-dropdown",$="esri-slider__label",U=`${E}__box`,z=`${E}__box--drop-down-on`,B=`${E}__box--drop-down-off`;let A=class extends p{constructor(e,t){super(e,t),this.viewModel=new d,this.showDropDown=!0,this._labelWidth=0,this._onLabelAfterCreate=e=>{const t="label-size-observer";this.removeHandles(t),this.addHandles(u(e,({contentRect:e})=>{this._labelWidth=e.width}),t)},this._getLabelStyles=()=>{if(!this.trackElement)return;const e=this._trackWidth,t=this._labelWidth/2,s=this.getCurrentPosition(),i=s-t,o=s+t;let n=-t;return i<0?n+=-i:o>e&&(n+=e-o),{left:`${n}px`}},this._onTimezoneChange=e=>{this.viewModel.utcOffset=e},this._onTimezonePickerOpen=()=>{this.viewModel.timezonePickerOpen=!0},this._onTimezonePickerClose=()=>{this.viewModel.timezonePickerOpen=!1}}renderThumbLabel(e){const{showDropDown:t,viewModel:s}=this;return g("div",{afterCreate:this._onLabelAfterCreate,class:this.classes({[U]:!0,[$]:!0,[z]:t,[B]:!t}),key:"thumb-label",styles:this._getLabelStyles()},super.renderThumbLabel(e),t?g(m,{disabled:this.disabled,open:s.timezonePickerOpen,value:s.utcOffset,onChange:this._onTimezoneChange,onClose:this._onTimezonePickerClose,onOpen:this._onTimezonePickerOpen}):null)}};e([o()],A.prototype,"viewModel",void 0),e([o()],A.prototype,"showDropDown",void 0),e([o()],A.prototype,"_labelWidth",void 0),A=e([n("esri.widgets.Daylight.support.SliderWithDropdown")],A);const W=A,N="date";let V=class extends l{constructor(e,t){super(e,t),this.headingLevel=3,this.viewModel=new a,this.visibleElements=new O,this.dateOrSeason=N,this._timeSlider=new W({viewModel:this.viewModel.timeSliderViewModel,steps:this.timeSliderSteps,labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(e,t,s)=>w({tickElement:t,labelElement:s,tickClasses:H,onClick:this._makeGoToTime(e)})},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(e,t)=>_({tickElement:t,tickClasses:H,onClick:this._makeGoToTime(e)})}]}),this._onPlayDayClick=()=>{this.viewModel.toggleDayPlaying()},this._onDateChange=e=>{const t=e.currentTarget.valueAsDate;this.viewModel.onDateChange(Array.isArray(t)?t[0]:t)},this._onYearPlayClick=()=>{this.viewModel.toggleYearPlaying()},this._onSeasonChange=e=>{this.viewModel.currentSeason=e.currentTarget.value},this._onSunLightingCheckboxChange=()=>{this.viewModel.toggleSunLightingEnabled()},this._onShadowCheckboxChange=()=>{this.viewModel.toggleDirectShadowsEnabled()}}get icon(){return"brightness"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.title??""}set label(e){this._overrideIfSome("label",e)}get playSpeedMultiplier(){return this.viewModel.playSpeedMultiplier}set playSpeedMultiplier(e){this.viewModel.playSpeedMultiplier=e}get timeSliderSteps(){return this._timeSlider?.steps??5}set timeSliderSteps(e){this._timeSlider.steps=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}postInitialize(){this.viewModel.isSupported&&(this.addHandles([s(()=>this.viewModel.timeSliderViewModel,e=>this._timeSlider.viewModel=e,i),s(()=>this.visibleElements?.timezone,e=>this._timeSlider.showDropDown=e,i),s(()=>!this.viewModel.sunLightingEnabled,e=>{this._timeSlider.disabled=e},i),r(()=>this._adjustTimeSliderPadding())]),this._adjustTimeSliderPadding())}destroy(){this._timeSlider.destroy()}render(){const{messages:e,viewModel:t,visibleElements:s}=this,i=t.isSupported;return g("div",{class:this.classes(x.base,j.widget)},i?g(k,null,s.header?g(v,{level:this.headingLevel},e.title):null,this._renderTimeOptions(),s.datePicker?this._renderDateOrSeason():null,s.sunLightingToggle?this._renderSunLightingToggle():null,s.shadowsToggle?this._renderShadowsToggle():null):g("div",{class:x.panelError,key:"unsupported"},g("p",null,e.unsupported)))}loadDependencies(){return y({button:()=>import("../chunks/index6.js"),checkbox:()=>import("../chunks/index21.js"),label:()=>import("../chunks/index2.js"),"input-date-picker":()=>import("../chunks/index13.js"),option:()=>import("../chunks/index11.js"),select:()=>import("../chunks/index12.js")})}_adjustTimeSliderPadding(){S(this.domNode?.querySelector(`.${b.base}`))}_renderTimeOptions(){const{viewModel:e,visibleElements:t,messages:s}=this,{dayPlaying:i}=e,o=!e.sunLightingEnabled;return g("div",{class:this.classes(x.dayContainer,{[x.sliderDateOn]:t.datePicker,[x.sliderDateOff]:!t.datePicker,[x.sliderAmPmOn]:C(),[x.containerDisabled]:o}),key:"daylight-time-options"},this._timeSlider.render(),t.playButtons?this._renderPlayPauseButton({playing:i,disabled:o,label:s.playDay,onClick:this._onPlayDayClick}):null)}_renderDateOptions(){const{viewModel:e,visibleElements:t,messages:s}=this,{yearPlaying:i}=e,o=!e.sunLightingEnabled;return g("div",{class:this.classes(x.dateContainer,o&&x.containerDisabled),key:x.dateContainer},g("calcite-input-date-picker",{class:x.datePicker,"data-testid":"daylight-date-picker",disabled:o,key:x.datePicker,overlayPositioning:"fixed",placement:"bottom",valueAsDate:e.localDate,onCalciteInputDatePickerChange:this._onDateChange}),t.playButtons?this._renderPlayPauseButton({playing:i,disabled:o,label:s.playYear,onClick:this._onYearPlayClick}):null)}_renderPlayPauseButton({playing:e,disabled:t,label:s,onClick:i}){return g("calcite-button",{appearance:"solid",class:x.playPauseButton,disabled:t,iconStart:e?"pause-f":"play-f",label:s,onclick:i,round:!0,title:s,type:"button"})}_renderSeasonSelect(){const{messages:e,viewModel:t}=this,s=!t.sunLightingEnabled;return g("calcite-select",{class:this.classes(x.seasonPicker),disabled:s,label:e.season,onCalciteSelectChange:this._onSeasonChange},c.map(s=>g("calcite-option",{selected:t.currentSeason===s,value:s},e[s])))}_renderDateOrSeason(){return"date"===this.dateOrSeason?this._renderDateOptions():this._renderSeasonSelect()}_renderSunLightingToggle(){const e=this.messages?.sunLightingToggle;return g("calcite-label",{key:"date-time-toggle",layout:"inline",scale:"s",title:e?.tooltip},g("calcite-checkbox",{checked:this.viewModel.sunLightingEnabled,class:x.sunLightingCheckbox,onCalciteCheckboxChange:this._onSunLightingCheckboxChange}),e?.label)}_renderShadowsToggle(){const e=this.messages.shadowsToggle;return g("calcite-label",{key:"shadow-toggle",layout:"inline",scale:"s",title:e?.tooltip},g("calcite-checkbox",{checked:this.viewModel.directShadowsEnabled,class:x.shadowsCheckbox,onCalciteCheckboxChange:this._onShadowCheckboxChange}),e.label)}_makeGoToTime(e){return()=>{this.viewModel.timeSliderPosition=e}}};e([o(),f("esri/widgets/Daylight/t9n/Daylight")],V.prototype,"messages",void 0),e([o(),f("esri/widgets/support/t9n/timezone")],V.prototype,"timezoneMessages",void 0),e([o()],V.prototype,"headingLevel",void 0),e([o()],V.prototype,"icon",null),e([o()],V.prototype,"label",null),e([o()],V.prototype,"playSpeedMultiplier",null),e([o()],V.prototype,"timeSliderSteps",null),e([o()],V.prototype,"view",null),e([P("user-date-time-change"),o({type:a})],V.prototype,"viewModel",void 0),e([o({type:O,nonNullable:!0})],V.prototype,"visibleElements",void 0),e([o({cast(e){return"season"===e||"date"===e?e:(t.getLogger(this).warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${N}".`),N)}})],V.prototype,"dateOrSeason",void 0),e([o()],V.prototype,"_timeSlider",void 0),V=e([n("esri.widgets.Daylight")],V);const H=[j.interactive,j.anchor],I=V;export{I as default};
