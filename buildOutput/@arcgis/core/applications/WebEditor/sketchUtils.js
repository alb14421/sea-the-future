/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{c as o}from"../../chunks/asyncUtils.js";import{a as t}from"../../chunks/events.js";import{m as e}from"../../chunks/handleUtils.js";import{ignoreAbortErrors as s,isAborted as i,createResolver as n,onAbort as r,waitTick as c}from"../../core/promiseUtils.js";import{whenOnce as a}from"../../core/reactiveUtils.js";import{waitAnimationFrame as p}from"../../core/scheduling.js";import{c as m}from"../../chunks/screenUtils.js";import{S as l}from"../../chunks/SketchTooltipVisibleElements.js";import"../../chunks/tslib.es6.js";import"../../core/Accessor.js";import"../../core/lang.js";import"../../core/Handles.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../chunks/maybe.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/Warning.js";import"../../core/Error.js";import"../../chunks/get.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/watch.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";async function u(l,u,f={}){const h=d.get(l);h&&(h.abort(),await h.promise);const j=o(async function(o){const s=function(o){const{activeComponent:t}=o;return t&&"tooltip"in t&&"activeTooltipInfo"in t&&"destroyed"in t?t:null}(l),{tooltipOptions:d}=l;if("coordinates"===u?(u="x",d.xyMode="coordinates"):"direction"!==u&&"distance"!==u||(d.xyMode="direction-distance"),await p(),i(f)||i(o))return;const h=s?.tooltip;if(!h||!s.activeTooltipInfo?.editableFields?.find(o=>o.name===u))return;const{handle:j,promise:k}=function(o,{hideOnBlur:s=!0}){const i=n();if(!s)return{promise:i.promise,handle:e()};const{outerContainer:r}=o,c=t(r,"focusout",({relatedTarget:o})=>{o instanceof HTMLElement&&r.contains(o)||i.resolve()});return{promise:i.promise,handle:c}}(h,f),g=n(),v=r(f.signal,g.resolve),b=r(o,g.resolve),y=d.offset,w=h.position;try{if(d.forceEnabled=!0,await c(),f.position&&(d.offset=0,h.position=m(f.position[0],f.position[1])),await h.enterInputMode(u),i(f)||i(o))return;f.onOpen?.(),await Promise.race([a(()=>s.destroyed||"feedback"===h.content?.mode,f),k,g.promise])}finally{v?.remove(),b?.remove(),j.remove();const o=h.outerContainer.contains(document.activeElement);d.enabled?await h.exitInputMode({focusOnView:o}):o&&l.view?.focus(),f.onClose?.(),h.position=w,d.offset=y,d.forceEnabled=!1}});return d.set(l,j),j.promise.catch(s).finally(()=>{d.get(l)===j&&d.delete(l)})}const d=new Map,f={area:!1,distance:!1,direction:!1,elevation:!1,orientation:!1,radius:!1,rotation:!1,scale:!1,size:!1,totalLength:!1,coordinates:!1,helpMessage:!1,header:!1};function h(o){o.tooltipOptions.visibleElements=new l(f)}export{h as hideAllVisibleElements,u as showTooltipAndFocusField};
