/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as s}from"../chunks/tslib.es6.js";import t from"./Error.js";import{a as o}from"../chunks/maybe.js";import{EsriPromise as r}from"./Promise.js";import{onAbortOrThrow as e}from"./promiseUtils.js";import{W as i}from"../chunks/Warning.js";import{property as l}from"./accessorSupport/decorators/property.js";import{subclass as n}from"./accessorSupport/decorators/subclass.js";import"./lang.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"./Accessor.js";import"./Handles.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/Lifecycle.js";import"../chunks/metadata.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"./scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/events.js";const a="loaded",d=r=>{const d=r;let c=class extends d{constructor(...s){super(...s),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(s=>{const o=this.load.bind(this);this.load=r=>{const i=new Promise((s,o)=>{const i=e(r,o);this.destroyed&&o(new t("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(s,o).finally(()=>{i&&i.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const s=this._loadController=new AbortController;o({signal:s.signal})}return s(),i}})),this.when(()=>{this._set("loadStatus",a),this._loadController=null},s=>{this.destroyed||(this._set("loadStatus","failed"),this._set("loadError",s),this._loadController=null)})}destroy(){this._loadController&&(this._loadController=o(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===a}get loadWarnings(){return this._get("loadWarnings")}load(s){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new t("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return s([l({readOnly:!0})],c.prototype,"loaded",null),s([l({readOnly:!0})],c.prototype,"loadError",void 0),s([l({clonable:!1})],c.prototype,"loadStatus",void 0),s([l({type:[i],readOnly:!0})],c.prototype,"loadWarnings",null),c=s([n("esri.core.Loadable")],c),c},c=d(r);function h(s){return!(!s||!s.load)}export{c as Loadable,d as LoadableMixin,h as isLoadable};
