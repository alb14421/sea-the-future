/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import t from"../request.js";import{b as o}from"../chunks/ensureType.js";import s from"../geometry/SpatialReference.js";import{fromJSON as r}from"../geometry/support/jsonUtils.js";import{normalizeCentralMeridian as e}from"../geometry/support/normalizeUtils.js";import{Z as i}from"../chunks/unitUtils.js";import{p,e as m,a as n}from"../chunks/utils9.js";import a from"./support/FindImagesParameters.js";import u from"./support/FindImagesResult.js";import l from"./support/ImageAngleParameters.js";import c from"./support/ImageAngleResult.js";import j from"./support/ImageAreaParameters.js";import y from"./support/ImageAreaResult.js";import f from"./support/ImageBoundaryParameters.js";import g from"./support/ImageBoundaryResult.js";import h from"./support/ImageDistanceParameters.js";import d from"./support/ImageDistanceResult.js";import S from"./support/ImageGPSInfoParameters.js";import b from"./support/ImageGPSInfoResult.js";import k from"./support/ImageHeightParameters.js";import I from"./support/ImageHeightResult.js";import R from"./support/ImageHistogramParameters.js";import N from"./support/ImageIdentifyParameters.js";import P from"./support/ImageIdentifyResult.js";import O from"./support/ImagePixelLocationParameters.js";import w from"./support/ImagePixelLocationResult.js";import M from"./support/ImagePointParameters.js";import U from"./support/ImagePointResult.js";import C from"./support/ImageSampleParameters.js";import J from"./support/ImageSampleResult.js";import D from"./support/ImageToMapMultirayParameters.js";import L from"./support/ImageToMapParameters.js";import F from"./support/ImageUrlParameters.js";import x from"./support/ImageUrlResult.js";import q from"./support/ImageVolumeParameters.js";import T from"./support/ImageVolumeResult.js";import G from"./support/MapToImageParameters.js";import A from"./support/MeasureAreaFromImageResult.js";import v from"./support/MeasureFromImageParameters.js";import E from"./support/MeasureLengthFromImageResult.js";import"../config.js";import"../core/lang.js";import"../chunks/object.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Error.js";import"../chunks/Logger.js";import"../chunks/string.js";import"../chunks/jsonUtils.js";import"../chunks/MapUtils.js";import"../core/promiseUtils.js";import"../chunks/handleUtils.js";import"../chunks/events.js";import"../chunks/maybe.js";import"../chunks/persistableUrlUtils.js";import"../chunks/tslib.es6.js";import"../core/Accessor.js";import"../core/Handles.js";import"../core/accessorSupport/decorators/subclass.js";import"../chunks/Lifecycle.js";import"../chunks/metadata.js";import"../chunks/utils.js";import"../chunks/tracking.js";import"../chunks/Warning.js";import"../chunks/get.js";import"../chunks/ObjectPool.js";import"../chunks/ObservableBase.js";import"../core/accessorSupport/decorators/property.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";import"../core/JSONSupport.js";import"../chunks/writer.js";import"../chunks/jsonMap.js";import"../chunks/pe.js";import"../chunks/assets.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../chunks/reader.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../chunks/mathUtils.js";import"../geometry/Polyline.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/simplify.js";import"../chunks/utils10.js";import"../core/Clonable.js";import"./support/ImageInspectionInfo.js";import"./support/CameraInfoMixin.js";import"../chunks/typeUtils.js";import"./support/BaseImageMeasureParameters.js";import"../layers/support/MosaicRule.js";import"../layers/support/DimensionalDefinition.js";import"../layers/support/RasterFunction.js";import"../chunks/enumeration.js";import"../chunks/rasterEnums.js";import"../chunks/imageMeasureUtils.js";import"./support/BaseImageMeasureResult.js";import"../chunks/spatialRelationships.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../chunks/date.js";import"../chunks/locale.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"./support/CameraInfo.js";import"./support/ImageGPSInfo.js";import"./support/FeatureSet.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../core/reactiveUtils.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils3.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils4.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../chunks/DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"./support/ImageSample.js";import"./support/ImageVolume.js";function B(t){const o=t?.time;if(o&&(null!=o.start||null!=o.end)){const s=[];null!=o.start&&s.push(o.start),null==o.end||s.includes(o.end)||s.push(o.end),t.time=s.join(",")}}async function $(t,s,r){s=o(R,s);const i=p(t),a=s.geometry?[s.geometry]:[],u=await e(a),l=s.toJSON();B(l);const c=u?.[0];null!=c&&(l.geometry=it(c));const j=m({...i.query,f:"json",...l});return n(j,r)}async function V(s,r,e){const i=(r=o(q,r)).toJSON();i.geometries=JSON.stringify(i.geometries);const a=p(s),u=m({...a.query,f:"json",...i}),l=n(u,e),{data:c}=await t(`${a.path}/calculateVolume`,l);return T.fromJSON({volumes:c.results})}async function H(r,e,i){const a=(e=o(l,e)).toJSON();null!=a.angleName&&(a.angleName=a.angleName.join(",")),e?.point?.spatialReference?.imageCoordinateSystem&&(a.point.spatialReference=pt(e.point.spatialReference)),e?.spatialReference?.imageCoordinateSystem&&(a.spatialReference=mt(e.spatialReference));const u=p(r),j=m({...u.query,f:"json",...a}),y=n(j,i),{data:f}=await t(`${u.path}/computeAngles`,y);return f.spatialReference=f.spatialReference?null!=f.spatialReference.geodataXform?new s({wkid:0,imageCoordinateSystem:f.spatialReference}):s.fromJSON(f.spatialReference):null,"NaN"===f.north&&(f.north=null),"NaN"===f.up&&(f.up=null),new c(f)}async function z(s,r,e){const i=(r=o(O,r)).toJSON(),{geometries:a}=r;if(a)for(let t=0;t<a.length;t++)a[t].spatialReference?.imageCoordinateSystem&&(i.geometries.geometries[t].spatialReference=pt(a[t].spatialReference));const u=p(s),l=m({...u.query,f:"json",...i}),c=n(l,e),{data:j}=await t(`${u.path}/computePixelLocation`,c);return w.fromJSON(j)}async function W(o,s,r){const e=await $(o,s,r),i=p(o),{data:m}=await t(`${i.path}/computeStatisticsHistograms`,e),{statistics:n}=m;return n?.length&&n.forEach(t=>{t.avg=t.mean,t.stddev=t.standardDeviation}),{statistics:n,histograms:m.histograms}}async function Q(o,s,r){const e=await $(o,s,r),i=p(o),{data:m}=await t(`${i.path}/computeHistograms`,e);return{histograms:m.histograms}}async function X(s,r,i){const a=(r=o(C,r)).toJSON();B(a),a.outFields?.length&&(a.outFields=a.outFields.join(","));const u=await e(r.geometry),l=u?.[0];null!=l&&(a.geometry=it(l));const c=p(s),j=m({...c.query,f:"json",...a}),y=n(j,i),{data:f}=await t(`${c.path}/getSamples`,y),g=f.samples.map(t=>{const o="NaN"===t.value||""===t.value?null:t.value.split(" ").map(t=>Number(t));return{...t,pixelValue:o}});return J.fromJSON({samples:g})}async function Z(s,r,i){r=o(N,r);const a=p(s),u=r.geometry?[r.geometry]:[];return e(u).then(o=>{const s=r.toJSON(),e=o?.[0];null!=e&&(s.geometry=JSON.stringify(it(e)));const p=m({...a.query,f:"json",...s}),u=n(p,i);return t(a.path+"/identify",u)}).then(t=>P.fromJSON(t.data))}async function K(t,s,r){s=o(k,s);const e=await ot(t,s,[s.fromGeometry,s.toGeometry],r);return I.fromJSON(e)}async function Y(t,s,r){s=o(j,s);const e=await ot(t,s,[s.geometry],r);return y.fromJSON(e)}async function _(t,s,r){s=o(M,s);const e=await ot(t,s,[s.geometry],r);return U.fromJSON(e)}async function tt(t,s,r){s=o(h,s);const e=await ot(t,s,[s.fromGeometry,s.toGeometry],r);return d.fromJSON(e)}async function ot(o,s,r,i){const a=p(o),u=await e(r),l=s.toJSON();null!=u[0]&&(l.fromGeometry=JSON.stringify(it(u[0]))),null!=u[1]&&(l.toGeometry=JSON.stringify(it(u[1])));const c=m({...a.query,f:"json",...l}),j=n(c,i),{data:y}=await t(a.path+"/measure",j);return y}async function st(t,o,s){const r=await et(t,o,s);return E.fromJSON(r)}async function rt(t,o,s){const r=await et(t,o,s);return A.fromJSON(r)}async function et(s,r,e){r=o(v,r);const i=p(s),a=r.toJSON(),u=m({...i.query,f:"json",...a}),l=n(u,e),{data:c}=await t(i.path+"/measureFromImage",l);return c}function it(t){const o=t.toJSON();return t.spatialReference?.imageCoordinateSystem&&(o.spatialReference=pt(t.spatialReference)),o}function pt(t){const{imageCoordinateSystem:o}=t;if(o){const{id:t,referenceServiceName:s}=o;return null!=t?s?{icsid:t,icsns:s}:{icsid:t}:{ics:o}}return t.toJSON()}function mt(t,o){if(!t.imageCoordinateSystem)return i(t);const s=pt(t),{icsid:r,icsns:e}=s;return null==r||null!=e&&!o?.toLowerCase().includes("/"+e.toLowerCase()+"/")?JSON.stringify(s):`0:${r}`}async function nt(s,r,e){r=o(f,r);const i=p(s),a=r.toJSON();r.outSpatialReference&&(a.outSR=mt(r.outSpatialReference));const u=m({...i.query,f:"json",...a}),l=n(u,e),{data:c}=await t(i.path+"/queryBoundary",l);return g.fromJSON(c)}async function at(s,r,i){const a=(r=o(S,r)).toJSON();B(a),a.objectIds?.length&&(a.objectIds=a.objectIds.join(",")),a.geometry||a.objectIds||a.time||a.where||(a.where="1=1");const u=await e(r.geometry),l=u?.[0];null!=l&&(a.geometry=it(l));const c=l?.spatialReference??r.geometry?.spatialReference;c&&(a.inSR=mt(c));const j=p(s),y=m({...j.query,f:"json",...a}),f=n(y,i),{data:g}=await t(`${j.path}/queryGPSInfo`,f);return b.fromJSON(g)}async function ut(s,e,i){const a=(e=o(L,e)).toJSON();e.geometry.spatialReference.imageCoordinateSystem&&(a.geometry=it(e.geometry)),e.depthOffset&&e.adjust||delete a.options;const u=p(s),l=m({...u.query,f:"json",...a}),c=n(l,i),{data:j}=await t(`${u.path}/imageToMap`,c);return r(j)}async function lt(s,e,i){const a=(e=o(D,e)).toJSON();e.rasterIds?.length&&(a.rasterIds=e.rasterIds.join(","));const u=p(s),l=m({...u.query,f:"json",...a}),c=n(l,i),{data:j}=await t(`${u.path}/imageToMapMultiray`,c);return r(j)}async function ct(s,i,a){const u=(i=o(G,i)).toJSON(),l=await e(i.geometry),c=l?.[0];null!=c&&(u.geometry=it(c)),i.visibleOnly||delete u.options;const j=c?.spatialReference??i.geometry?.spatialReference;j&&(u.inSR=mt(j));const y=p(s),f=m({...y.query,f:"json",...u}),g=n(f,a),{data:h}=await t(`${y.path}/mapToImage`,g);return r(h)}async function jt(s,r,e){const i=(r=o(F,r)).toJSON(),a=p(s),u=m({...a.query,f:"json",...i}),l=n(u,e),{data:c}=await t(`${a.path}/getImageUrl`,l);return x.fromJSON(c)}async function yt(s,r,i){const l=(r=o(a,r)).toJSON(),c=await e([r.fromGeometry,r.toGeometry]);null!=c[0]&&(l.fromGeometry=it(c[0]),c[0].spatialReference&&(l.inSR=mt(c[0].spatialReference))),null!=c[1]&&(l.toGeometry=it(c[1])),r.objectIds?.length&&(l.objectIds=l.objectIds.join(","));const j=p(s),y=m({...j.query,f:"json",...l}),f=n(y,i),{data:g}=await t(`${j.path}/find`,f);return u.fromJSON(g)}export{V as calculateVolume,H as computeAngles,Q as computeHistograms,z as computePixelSpaceLocations,W as computeStatisticsHistograms,yt as findImages,pt as getImageSpatialReferenceJSON,mt as getImageSpatialReferenceQueryParameter,jt as getImageUrl,X as getSamples,Z as identify,ut as imageToMap,lt as imageToMapMultiray,ct as mapToImage,Y as measureAreaAndPerimeter,rt as measureAreaFromImage,tt as measureDistanceAndAngle,K as measureHeight,st as measureLengthFromImage,_ as measurePointOrCentroid,nt as queryBoundary,at as queryGPSInfo};
